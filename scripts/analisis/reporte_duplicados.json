{
  "resumen": {
    "total_tablas_detectadas": 16,
    "total_funciones_detectadas": 5,
    "total_policies_detectadas": 0,
    "objetos_duplicados_o_modificados": 16
  },
  "detalles": {
    "tables": {
      "config_buildings": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 16,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.config_buildings (\n    id text PRIMARY KEY, -- e.g., 'oficina', 'escuela'\n    name text NOT NULL,\n    description text,\n    cost_armaments integer NOT NULL DEFAULT 0,\n    cost_munitions integer NOT NULL DEFAULT 0,\n    cost_dollars integer NOT NULL DEFAULT 0,\n    base_duration integer NOT NULL DEFAULT 0, -- in seconds\n    base_production integer NOT NULL DEFAULT 0,\n    points numeric(10, 2) NOT NULL DEFAULT 0,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 329,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.config_buildings ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "config_research": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 29,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.config_research (\n    id text PRIMARY KEY, -- e.g., 'rutas', 'armas'\n    name text NOT NULL,\n    description text,\n    cost_armaments integer NOT NULL DEFAULT 0,\n    cost_munitions integer NOT NULL DEFAULT 0,\n    cost_dollars integer NOT NULL DEFAULT 0,\n    base_duration integer NOT NULL DEFAULT 0, -- in seconds\n    points numeric(10, 2) NOT NULL DEFAULT 0,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 330,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.config_research ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "config_units": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 41,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.config_units (\n    id text PRIMARY KEY, -- e.g., 'maton', 'portero'\n    name text NOT NULL,\n    description text,\n    cost_armaments integer NOT NULL DEFAULT 0,\n    cost_munitions integer NOT NULL DEFAULT 0,\n    cost_dollars integer NOT NULL DEFAULT 0,\n    base_duration integer NOT NULL DEFAULT 0, -- in seconds\n    points numeric(10, 2) NOT NULL DEFAULT 0,\n    attack integer NOT NULL DEFAULT 0,\n    defense integer NOT NULL DEFAULT 0,\n    capacity integer NOT NULL DEFAULT 0,\n    velocity integer NOT NULL DEFAULT 0,\n    salary integer NOT NULL DEFAULT 0, -- upkeep cost\n    type text CHECK (type IN ('attack', 'defense', 'special')) DEFAULT 'attack',\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 331,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.config_units ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "profiles": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 65,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.profiles (\n    id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,\n    username text UNIQUE NOT NULL,\n    email text, -- Optional, mostly handled by auth.users\n    legacy_id integer, -- To keep reference to old ID during migration\n    last_active_at timestamptz,\n    points_buildings numeric(15, 2) DEFAULT 0,\n    points_units numeric(15, 2) DEFAULT 0,\n    points_research numeric(15, 2) DEFAULT 0,\n    total_points numeric(15, 2) DEFAULT 0,\n    ranking_position integer,\n    is_banned boolean DEFAULT false,\n    language varchar(2) DEFAULT 'es',\n    created_at timestamptz DEFAULT now(),\n    updated_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 316,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "alliances": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 86,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.alliances (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    legacy_id integer,\n    name text NOT NULL,\n    tag varchar(8) NOT NULL,\n    description text,\n    logo_url text,\n    website text,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 317,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.alliances ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "alliance_members": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 98,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.alliance_members (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    alliance_id uuid REFERENCES public.alliances(id) ON DELETE CASCADE,\n    user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    rank_name text, -- Simplified from rank ID\n    joined_at timestamptz DEFAULT now(),\n    UNIQUE(user_id) -- User can only be in one alliance\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 318,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.alliance_members ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "bases": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 108,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.bases (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    legacy_id integer,\n    user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    name text, -- Optional custom name\n    coord_x integer NOT NULL,\n    coord_y integer NOT NULL,\n    coord_z integer NOT NULL,\n    resources_armaments numeric(20, 2) DEFAULT 0,\n    resources_munitions numeric(20, 2) DEFAULT 0,\n    resources_alcohol numeric(20, 2) DEFAULT 0,\n    resources_dollars numeric(20, 2) DEFAULT 0,\n    points numeric(15, 2) DEFAULT 0,\n    last_updated_at timestamptz DEFAULT now(),\n    created_at timestamptz DEFAULT now(),\n    UNIQUE(coord_x, coord_y, coord_z)\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 319,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.bases ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "base_buildings": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 129,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.base_buildings (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    base_id uuid REFERENCES public.bases(id) ON DELETE CASCADE,\n    building_id text REFERENCES public.config_buildings(id),\n    level integer NOT NULL DEFAULT 0,\n    created_at timestamptz DEFAULT now(),\n    UNIQUE(base_id, building_id)\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 320,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.base_buildings ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "base_units": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 139,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.base_units (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    base_id uuid REFERENCES public.bases(id) ON DELETE CASCADE,\n    unit_id text REFERENCES public.config_units(id),\n    amount integer NOT NULL DEFAULT 0,\n    created_at timestamptz DEFAULT now(),\n    UNIQUE(base_id, unit_id)\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 321,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.base_units ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "user_research": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 149,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.user_research (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    research_id text REFERENCES public.config_research(id),\n    level integer NOT NULL DEFAULT 0,\n    created_at timestamptz DEFAULT now(),\n    UNIQUE(user_id, research_id)\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 322,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.user_research ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "construction_queue": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 162,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.construction_queue (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    base_id uuid REFERENCES public.bases(id) ON DELETE CASCADE,\n    building_id text REFERENCES public.config_buildings(id),\n    target_level integer NOT NULL,\n    start_time timestamptz DEFAULT now(),\n    end_time timestamptz NOT NULL,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 323,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.construction_queue ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "unit_queue": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 173,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.unit_queue (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    base_id uuid REFERENCES public.bases(id) ON DELETE CASCADE,\n    unit_id text REFERENCES public.config_units(id),\n    amount integer NOT NULL,\n    start_time timestamptz DEFAULT now(),\n    end_time timestamptz NOT NULL,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 324,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.unit_queue ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "research_queue": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 184,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.research_queue (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    base_id uuid REFERENCES public.bases(id) ON DELETE SET NULL, -- Research happens at a base but belongs to user\n    research_id text REFERENCES public.config_research(id),\n    target_level integer NOT NULL,\n    start_time timestamptz DEFAULT now(),\n    end_time timestamptz NOT NULL,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 325,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.research_queue ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "market_offers": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 199,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.market_offers (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    seller_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    resource_type text NOT NULL, -- 'arm', 'mun', 'dol', 'alc'\n    amount integer NOT NULL,\n    cost_armaments integer DEFAULT 0,\n    cost_munitions integer DEFAULT 0,\n    cost_dollars integer DEFAULT 0,\n    recipient_id uuid REFERENCES public.profiles(id), -- Null for public offer\n    created_at timestamptz DEFAULT now(),\n    expires_at timestamptz\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 326,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.market_offers ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "messages": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 213,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.messages (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    sender_id uuid REFERENCES public.profiles(id) ON DELETE SET NULL,\n    recipient_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    subject text,\n    body text,\n    is_read boolean DEFAULT false,\n    is_deleted_by_sender boolean DEFAULT false,\n    is_deleted_by_recipient boolean DEFAULT false,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 327,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.messages ENABLE ROW LEVEL SECURITY;\n"
        }
      ],
      "map_movements": [
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 226,
          "type": "CREATE_TABLE",
          "code": "CREATE TABLE IF NOT EXISTS public.map_movements (\n    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id uuid REFERENCES public.profiles(id) ON DELETE CASCADE,\n    origin_base_id uuid REFERENCES public.bases(id) ON DELETE CASCADE,\n    target_coord_x integer,\n    target_coord_y integer,\n    target_coord_z integer,\n    mission_type text NOT NULL, -- 'attack', 'transport', 'spy', etc.\n    units jsonb NOT NULL DEFAULT '{}'::jsonb, -- { \"maton\": 10, ... }\n    resources jsonb DEFAULT '{}'::jsonb, -- { \"arm\": 100, ... }\n    start_time timestamptz DEFAULT now(),\n    arrival_time timestamptz NOT NULL,\n    return_time timestamptz,\n    created_at timestamptz DEFAULT now()\n);\n"
        },
        {
          "file": "20250225120000_recreate_legacy_schema.sql",
          "line": 328,
          "type": "ALTER_TABLE",
          "code": "ALTER TABLE public.map_movements ENABLE ROW LEVEL SECURITY;\n"
        }
      ]
    },
    "functions": {},
    "types": {},
    "policies": {},
    "triggers": {}
  }
}