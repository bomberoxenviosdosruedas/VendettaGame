{
  "src/app/page.tsx": {
    "route": "/",
    "code": "import { LandingPage } from '@/components/landing/landing-page';\n\nexport default function HomePage() {\n  return <LandingPage />;\n}\n",
    "components": [
      {
        "path": "src/components/landing/landing-page.tsx",
        "code": "import Image from \"next/image\";\nimport Link from \"next/link\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { GamePreview } from \"./game-preview\";\nimport { getPublicStats } from \"@/lib/actions/public-stats\";\nimport { LoginForm } from \"./login-form\";\nimport { TopPlayers } from \"./top-players\";\n\nexport async function LandingPage() {\n  const vendettaHeader = PlaceHolderImages.find(p => p.id === \"vendetta-header\");\n  const gangster = PlaceHolderImages.find(p => p.id === \"gangster-silhouette\");\n\n  // Fetch stats server-side\n  const stats = await getPublicStats();\n\n  return (\n    <div className=\"bg-black text-white min-h-screen\">\n      <div className=\"container mx-auto px-4 py-2\">\n        <header className=\"relative text-center py-4 border-b-4 border-primary\">\n          {vendettaHeader && (\n            <Image\n              src={vendettaHeader.imageUrl}\n              alt={vendettaHeader.description}\n              fill\n              style={{ objectFit: 'cover' }}\n              className=\"opacity-20\"\n              data-ai-hint={vendettaHeader.imageHint}\n              priority\n            />\n          )}\n          <div className=\"relative z-10\">\n            <h1 className=\"text-6xl md:text-8xl vendetta-font text-gray-200\">VENDETTA</h1>\n            <p className=\"text-xl md:text-2xl vendetta-font text-gray-300\">THE VAULT GATE</p>\n          </div>\n        </header>\n\n        <nav className=\"bg-primary text-primary-foreground flex justify-between items-center px-4 py-2 text-sm\">\n          <Link href=\"/signup\" className=\"hover:underline font-bold\">\n            \u00a1REG\u00cdSTRATE GRATIS!\n          </Link>\n          <div className=\"flex gap-4\">\n            <span>Online: {stats.online}</span>\n            <span>Jugadores: {stats.registered}</span>\n          </div>\n        </nav>\n\n        <div className=\"bg-gray-800/50 flex justify-between items-center px-4 py-1 text-xs border-b border-border\">\n          <div className=\"flex gap-2\">\n            <button aria-label=\"Select language: Italian\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/it.svg\" width={20} height={15} alt=\"Italian Flag\" />\n            </button>\n            <button aria-label=\"Select language: English\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/gb.svg\" width={20} height={15} alt=\"British Flag\" />\n            </button>\n            <button aria-label=\"Select language: French\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/fr.svg\" width={20} height={15} alt=\"French Flag\" />\n            </button>\n            <button aria-label=\"Select language: German\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/de.svg\" width={20} height={15} alt=\"German Flag\" />\n            </button>\n            <button aria-label=\"Select language: Spanish\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/es.svg\" width={20} height={15} alt=\"Spanish Flag\" />\n            </button>\n          </div>\n          <div className=\"text-gray-400\">\n             Server Time: {new Date().toLocaleTimeString()}\n          </div>\n        </div>\n\n        <main className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 py-4\">\n\n          {/* Left Column */}\n          <div className=\"space-y-4 lg:col-span-2\">\n\n            {/* Login Section */}\n            <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Login</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4\">\n                    <LoginForm />\n                </CardContent>\n                </Card>\n            </section>\n\n             {/* Game Preview Carousel */}\n             <GamePreview />\n\n             {/* Description / Register Call to Action */}\n             <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Reg\u00edstrate</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4 text-center text-sm text-gray-300 space-y-4\">\n                    <p>\u00bfQuieres ser el Capo de la Mafia m\u00e1s importante en la ciudad? \u00bfQu\u00e9 esperas?</p>\n                    <p>Construye habitaciones para obtener m\u00e1s recursos junto con las m\u00e1s avanzadas tecnolog\u00edas, tropas de ataque e incluso podr\u00e1s obtener un ej\u00e9rcito inmejorable con las tropas de defensa mejor desarrolladas, y as\u00ed...</p>\n                    <p className=\"font-bold text-lg text-red-500\">\u00a1Dominar la ciudad!</p>\n                    <p>Entrena a tus &quot;chicos&quot; para volverse m\u00e1s fuertes; vigila el mapa de la ciudad para comprobar aquellos aliados o enemigos que se encuentren cerca de tu zona; revisa la clasificaci\u00f3n para conocer quienes son actualmente los mafiosos m\u00e1s poderosos y... \u00a1muchas cosas m\u00e1s!</p>\n                    <Link href=\"/signup\">\n                        <Button variant=\"destructive\" size=\"lg\" className=\"w-full bg-accent hover:bg-accent/90 mt-2\">\n                            REG\u00cdSTRATE GRATIS EN EL SERVIDOR 1\n                        </Button>\n                    </Link>\n                </CardContent>\n                </Card>\n            </section>\n\n          </div>\n\n          {/* Right Column */}\n          <div className=\"space-y-4\">\n\n            {/* Top Players */}\n            <section>\n                <TopPlayers />\n            </section>\n\n            {/* Support */}\n            <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                    <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Supporto Tecnico / SOS</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-4 bg-card/80\">\n                    <div className=\"bg-black/50 p-4 rounded-sm\">\n                        <h3 className=\"text-lg font-bold text-yellow-500 flex items-center gap-2\"><AlertTriangle size={20}/> SYSTEM ALERT</h3>\n                        <ul className=\"text-sm mt-2 space-y-1 list-disc list-inside text-gray-300\">\n                            <li><span className=\"mr-2\">\ud83c\uddec\ud83c\udde7</span> Login issues? Account locked?</li>\n                            <li><span className=\"mr-2\">\ud83c\uddee\ud83c\uddf9</span> Problemi di accesso? Account bloccato?</li>\n                            <li><span className=\"mr-2\">\ud83c\uddea\ud83c\uddf8</span> \u00bfProblemas de conexi\u00f3n?</li>\n                        </ul>\n                        <Button variant=\"destructive\" className=\"mt-4 w-full bg-accent hover:bg-accent/90 text-xs\">APRI SEGNALAZIONE SOS</Button>\n                    </div>\n                    </CardContent>\n                </Card>\n            </section>\n\n             {/* Maintenance Notice */}\n             <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Aviso Importante</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4 text-xs text-gray-300 space-y-2\">\n                    <p className=\"font-bold\">MANTENIMIENTO PROGRAMADO:</p>\n                    <p>Cada S\u00e1bado ha sido designado como d\u00eda oficial para el mantenimiento rutinario.</p>\n                </CardContent>\n                </Card>\n            </section>\n\n            {/* Banner */}\n            <section>\n                <Card className=\"bg-stone-200 border-stone-400 text-black p-4 flex flex-col items-center justify-center text-center\">\n                {gangster && (\n                    <Image src={gangster.imageUrl} alt={gangster.description} width={80} height={100} data-ai-hint={gangster.imageHint} className=\"mb-2\" />\n                )}\n                <h2 className=\"text-4xl font-bold vendetta-font text-black/80\">REGISTRATI</h2>\n                <h2 className=\"text-4xl font-bold vendetta-font text-black/80\">ORA</h2>\n                </Card>\n            </section>\n\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}\n",
        "dependencies": [
          {
            "path": "src/components/landing/game-preview.tsx",
            "code": "'use client'\nimport Image from \"next/image\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\n\n\nconst previewImages = [\n    PlaceHolderImages.find(p => p.id === \"game-preview-1\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-2\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-3\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-4\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-5\"),\n].filter(Boolean) as (typeof PlaceHolderImages[0])[];\n\n\nexport function GamePreview() {\n    return (\n        <section>\n            <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Vista previa del juego</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4 text-center\">\n                    <p className=\"text-sm text-gray-300 mb-4\">Haz clic en las im\u00e1genes para ampliarlas y echar un vistazo al juego.</p>\n                    <div className=\"flex justify-center gap-2\">\n                        {previewImages.map((img, index) => (\n                             <Dialog key={index}>\n                                <DialogTrigger>\n                                     <Image\n                                        key={index}\n                                        src={img.imageUrl}\n                                        alt={`${img.description} ${index + 1}`}\n                                        width={120}\n                                        height={90}\n                                        className=\"border-2 border-gray-500 hover:border-accent cursor-pointer transition-all\"\n                                        data-ai-hint={img.imageHint}\n                                    />\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-4xl bg-card border-primary\">\n                                     <Image\n                                        src={img.imageUrl}\n                                        alt={`${img.description} ${index + 1}`}\n                                        width={800}\n                                        height={600}\n                                        className=\"w-full h-auto\"\n                                        data-ai-hint={img.imageHint}\n                                    />\n                                </DialogContent>\n                            </Dialog>\n                        ))}\n                    </div>\n                </CardContent>\n            </Card>\n        </section>\n    )\n}\n"
          },
          {
            "path": "src/components/landing/login-form.tsx",
            "code": "'use client';\n\nimport { useActionState } from 'react';\nimport { login } from '@/lib/actions/auth';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport Link from 'next/link';\n\nexport function LoginForm() {\n  const [state, formAction, isPending] = useActionState(login, null);\n\n  return (\n    <div className=\"w-full\">\n      <form action={formAction} className=\"flex flex-col md:flex-row items-center gap-2\">\n        <Select defaultValue=\"server1\" name=\"server\">\n          <SelectTrigger className=\"w-full md:w-[150px] bg-input text-foreground\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"server1\">Server 1</SelectItem>\n          </SelectContent>\n        </Select>\n\n        <Input\n          name=\"email\"\n          placeholder=\"Email\"\n          className=\"bg-input text-foreground\"\n          required\n        />\n        <Input\n          type=\"password\"\n          name=\"password\"\n          placeholder=\"Password\"\n          className=\"bg-input text-foreground\"\n          required\n        />\n\n        <Button\n          type=\"submit\"\n          variant=\"destructive\"\n          className=\"w-full md:w-auto bg-accent hover:bg-accent/90\"\n          disabled={isPending}\n        >\n          {isPending ? 'Entrando...' : 'Entrar'}\n        </Button>\n      </form>\n\n      {state?.message && (\n        <p className=\"text-red-500 text-xs mt-2 text-center md:text-left\">{state.message}</p>\n      )}\n\n      <Link href=\"/forgot-password\" passHref>\n          <p className=\"text-xs text-right mt-2 hover:underline cursor-pointer text-gray-400\">\u00bfOlvidaste tu password?</p>\n      </Link>\n    </div>\n  );\n}\n"
          },
          {
            "path": "src/components/landing/top-players.tsx",
            "code": "import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\nimport { getTopPlayers } from \"@/lib/actions/public-stats\";\n\nexport async function TopPlayers() {\n  const players = await getTopPlayers(10);\n\n  return (\n    <Card className=\"bg-primary/20 border-primary\">\n      <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Mejores Jugadores</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <Table>\n          <TableHeader>\n            <TableRow className=\"border-b border-primary/20 hover:bg-transparent\">\n              <TableHead className=\"text-gray-300 w-[50px]\">#</TableHead>\n              <TableHead className=\"text-gray-300\">Jugador</TableHead>\n              <TableHead className=\"text-right text-gray-300\">Puntos</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {players.length > 0 ? (\n              players.map((player, index) => (\n                <TableRow key={index} className=\"border-b border-primary/10 hover:bg-primary/10\">\n                  <TableCell className=\"font-medium text-gray-400\">\n                    {player.ranking_position || index + 1}\n                  </TableCell>\n                  <TableCell className=\"text-white\">{player.username}</TableCell>\n                  <TableCell className=\"text-right text-yellow-500 font-mono\">\n                    {Math.floor(player.total_points || 0).toLocaleString()}\n                  </TableCell>\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell colSpan={3} className=\"text-center text-gray-500 py-4\">\n                  Sin datos\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </CardContent>\n    </Card>\n  );\n}\n"
          },
          {
            "path": "src/lib/actions/public-stats.ts",
            "code": "'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { unstable_cache } from 'next/cache';\n\nexport async function getPublicStats() {\n  const supabase = await createClient();\n\n  // Registered Count\n  const { count: registeredCount, error: countError } = await supabase\n    .from('profiles')\n    .select('*', { count: 'exact', head: true });\n\n  if (countError) {\n    console.error('Error fetching registered count:', countError);\n  }\n\n  // Online Count (Active in last 10 minutes)\n  const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000).toISOString();\n  const { count: onlineCount, error: onlineError } = await supabase\n    .from('profiles')\n    .select('*', { count: 'exact', head: true })\n    .gt('last_active_at', tenMinutesAgo);\n\n  if (onlineError) {\n    console.error('Error fetching online count:', onlineError);\n  }\n\n  return {\n    registered: registeredCount || 0,\n    online: onlineCount || 0,\n  };\n}\n\nexport async function getTopPlayers(limit = 5) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('username, total_points, ranking_position')\n    .order('ranking_position', { ascending: true }) // Assuming 1 is top\n    .limit(limit);\n\n  if (error) {\n    console.error('Error fetching top players:', error);\n    return [];\n  }\n\n  return data;\n}\n"
          },
          {
            "path": "src/lib/placeholder-images.ts",
            "code": "import data from './placeholder-images.json';\n\nexport type ImagePlaceholder = {\n  id: string;\n  description: string;\n  imageUrl: string;\n  imageHint: string;\n};\n\nexport const PlaceHolderImages: ImagePlaceholder[] = data.placeholderImages;\n"
          }
        ]
      }
    ]
  },
  "src/app/dashboard/page.tsx": {
    "route": "/dashboard",
    "code": "import { createClient } from \"@/lib/supabase/server\";\nimport { redirect } from \"next/navigation\";\nimport { getUserProperty } from \"@/lib/services/game.service\";\n\nexport default async function DashboardPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect(\"/login\");\n  }\n\n  const propertyId = await getUserProperty(user.id);\n\n  if (propertyId) {\n    redirect(\"/dashboard/overview\");\n  } else {\n    redirect(\"/onboarding\");\n  }\n}\n",
    "components": []
  },
  "src/app/dashboard/buildings/page.tsx": {
    "route": "/dashboard/buildings",
    "code": "import { createClient } from '@/lib/supabase/server';\nimport { notFound, redirect } from 'next/navigation';\nimport ConstructionQueue from '@/components/buildings/ConstructionQueue';\nimport BuildingList from '@/components/buildings/BuildingList';\nimport { BaseBuildingRPC, ConstructionQueueItem } from '@/types/legacy_schema';\n\nexport default async function BuildingsPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect('/auth/login');\n  }\n\n  // Fetch Base (Assuming single base for now or first base)\n  const { data: bases } = await supabase\n    .from('bases')\n    .select('id')\n    .eq('user_id', user.id)\n    .limit(1);\n\n  if (!bases || bases.length === 0) {\n    // If no legacy base exists, handling is tricky. Redirect to creation or show error?\n    // For now, let's assume one exists or redirect to an initializer.\n    // Ideally we might trigger an initial setup here.\n    return <div className=\"p-8 text-center\">No base found. Please contact support or restart.</div>;\n  }\n\n  const baseId = bases[0].id;\n\n  // Parallel Fetching\n  const [buildingsRes, queueRes] = await Promise.all([\n    supabase.rpc('get_base_buildings', { p_base_id: baseId }),\n    supabase.rpc('get_construction_queue', { p_base_id: baseId }),\n  ]);\n\n  if (buildingsRes.error || queueRes.error) {\n    console.error('Fetch Error:', buildingsRes.error, queueRes.error);\n    return <div>Error loading building data.</div>;\n  }\n\n  // Cast to correct flat type\n  const buildings = buildingsRes.data as BaseBuildingRPC[];\n  const queue = queueRes.data as ConstructionQueueItem[];\n\n  const isQueueFull = queue.length >= 5;\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">Habitaciones</h1>\n\n      {/* Queue Section */}\n      <section>\n        <ConstructionQueue queue={queue} />\n      </section>\n\n      {/* Buildings Grid */}\n      <section>\n        <h2 className=\"text-xl font-semibold mb-4 text-slate-300\">Edificios Disponibles</h2>\n        <BuildingList\n            buildings={buildings}\n            baseId={baseId}\n            isQueueFull={isQueueFull}\n        />\n      </section>\n    </div>\n  );\n}\n",
    "components": [
      {
        "path": "src/components/buildings/BuildingList.tsx",
        "code": "import { BaseBuildingRPC } from '@/types/legacy_schema';\nimport BuildingCard from './BuildingCard';\n\ninterface BuildingListProps {\n  buildings: BaseBuildingRPC[];\n  baseId: string;\n  isQueueFull: boolean;\n}\n\nexport default function BuildingList({ buildings, baseId, isQueueFull }: BuildingListProps) {\n  return (\n    <div className=\"space-y-4\">\n      {buildings.map((b) => (\n        <BuildingCard\n          key={b.building_id}\n          building={b}\n          baseId={baseId}\n          isQueueFull={isQueueFull}\n        />\n      ))}\n    </div>\n  );\n}\n",
        "dependencies": [
          {
            "path": "src/components/buildings/BuildingCard.tsx",
            "code": "'use client';\n\nimport { useOptimistic, useTransition } from 'react';\nimport Link from 'next/link';\nimport { enqueueBuildingUpgrade } from '@/lib/actions/buildings';\nimport { BaseBuildingRPC } from '@/types/legacy_schema';\n\ninterface BuildingCardProps {\n  building: BaseBuildingRPC;\n  baseId: string;\n  isQueueFull: boolean;\n}\n\nexport default function BuildingCard({ building, baseId, isQueueFull }: BuildingCardProps) {\n  const [isPending, startTransition] = useTransition();\n\n  const handleUpgrade = () => {\n    startTransition(async () => {\n      const result = await enqueueBuildingUpgrade(baseId, building.building_id); // Use building_id (config id)\n      if (result.error) {\n        alert(result.error);\n      }\n    });\n  };\n\n  const canAfford = true;\n  const isDisabled = isQueueFull || isPending || !canAfford;\n\n  return (\n    <div className=\"bg-slate-800 border border-slate-700 rounded-lg p-4 flex flex-col md:flex-row gap-4\">\n      {/* Image Fallback */}\n      <div className=\"w-full md:w-32 h-32 bg-slate-700 rounded-md flex-shrink-0 relative overflow-hidden\">\n        {building.name && (\n          <div className=\"absolute inset-0 flex items-center justify-center text-xs text-slate-500\">\n             {building.name[0]}\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex-grow\">\n        <Link href={`/dashboard/buildings/${building.building_id}`} className=\"hover:underline\">\n            <h3 className=\"text-lg font-bold text-white cursor-pointer\">\n            {building.name} <span className=\"text-sm font-normal text-slate-400\">(Nivel {building.level})</span>\n            </h3>\n        </Link>\n        <p className=\"text-sm text-slate-400 mt-1 mb-2 line-clamp-2\">\n          {building.description}\n        </p>\n\n        <div className=\"flex gap-4 text-xs text-slate-300\">\n          <span title=\"Armamentos\">\ud83d\udd2b {building.cost_armaments}</span>\n          <span title=\"Munici\u00f3n\">\ud83d\udce6 {building.cost_munitions}</span>\n          <span title=\"D\u00f3lares\">\ud83d\udcb5 {building.cost_dollars}</span>\n          <span title=\"Duraci\u00f3n\">\u23f1 {building.base_duration}s</span>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col justify-center items-end min-w-[120px]\">\n        {isDisabled ? (\n           <button\n             disabled\n             className=\"px-4 py-2 bg-slate-600 text-slate-300 rounded cursor-not-allowed w-full text-center\"\n           >\n             {isPending ? 'Encolando...' : isQueueFull ? 'Cola Llena' : 'Recursos Insuf.'}\n           </button>\n        ) : (\n          <button\n            onClick={handleUpgrade}\n            className=\"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors w-full\"\n          >\n            Mejorar\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n"
          },
          {
            "path": "src/types/legacy_schema.ts",
            "code": "export interface ConfigBuilding {\n  id: string;\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n  created_at?: string;\n}\n\n// Flat structure returned by get_base_buildings RPC\nexport interface BaseBuildingRPC {\n  id: string; // base_building id\n  base_id: string;\n  building_id: string;\n  level: number;\n  created_at?: string;\n\n  // Joined Config Fields\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n}\n\nexport interface ConstructionQueueItem {\n  id: string;\n  base_id: string;\n  building_id: string;\n  target_level: number;\n  start_time: string;\n  end_time: string;\n  created_at?: string;\n  // Joined fields\n  building_name?: string;\n}\n\nexport interface Base {\n  id: string;\n  user_id: string;\n  name: string | null;\n  coord_x: number;\n  coord_y: number;\n  coord_z: number;\n  resources_armaments: number;\n  resources_munitions: number;\n  resources_alcohol: number;\n  resources_dollars: number;\n  points: number;\n  last_updated_at?: string;\n  created_at?: string;\n}\n"
          }
        ]
      },
      {
        "path": "src/components/buildings/ConstructionQueue.tsx",
        "code": "'use client';\n\nimport { useTransition } from 'react';\nimport { cancelBuildingUpgrade } from '@/lib/actions/buildings';\nimport { ConstructionQueueItem } from '@/types/legacy_schema';\n\ninterface ConstructionQueueProps {\n  queue: ConstructionQueueItem[];\n}\n\nexport default function ConstructionQueue({ queue }: ConstructionQueueProps) {\n  const [isPending, startTransition] = useTransition();\n\n  const handleCancel = (queueId: string) => {\n    if (confirm('\u00bfCancelar esta construcci\u00f3n? Se reembolsar\u00e1n los recursos.')) {\n        startTransition(async () => {\n            const result = await cancelBuildingUpgrade(queueId);\n            if (result.error) alert(result.error);\n        });\n    }\n  };\n\n  if (!queue || queue.length === 0) {\n    return <div className=\"p-4 bg-slate-800 rounded-lg text-slate-400 text-center text-sm\">Cola de construcci\u00f3n vac\u00eda</div>;\n  }\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg overflow-hidden border border-slate-700\">\n      <div className=\"bg-slate-900 px-4 py-2 border-b border-slate-700 font-semibold text-slate-200 text-sm\">\n        Cola de Construcci\u00f3n ({queue.length}/5)\n      </div>\n      <table className=\"w-full text-sm text-left text-slate-300\">\n        <thead className=\"bg-slate-700/50 text-xs uppercase text-slate-400\">\n          <tr>\n            <th className=\"px-4 py-2\">#</th>\n            <th className=\"px-4 py-2\">Edificio</th>\n            <th className=\"px-4 py-2\">Nivel</th>\n            <th className=\"px-4 py-2\">Fin</th>\n            <th className=\"px-4 py-2 text-right\">Acci\u00f3n</th>\n          </tr>\n        </thead>\n        <tbody>\n          {queue.map((item, index) => (\n            <tr key={item.id} className=\"border-b border-slate-700/50 last:border-0 hover:bg-slate-700/30 transition-colors\">\n              <td className=\"px-4 py-2 font-mono text-slate-500\">{index + 1}</td>\n              <td className=\"px-4 py-2 font-medium text-white\">{item.building_name}</td>\n              <td className=\"px-4 py-2\">{item.target_level}</td>\n              <td className=\"px-4 py-2 text-xs\">\n                 {/* Simple formatting for now. Ideally client-side countdown */}\n                 {new Date(item.end_time).toLocaleTimeString()}\n              </td>\n              <td className=\"px-4 py-2 text-right\">\n                <button\n                  onClick={() => handleCancel(item.id)}\n                  disabled={isPending}\n                  className=\"text-red-400 hover:text-red-300 text-xs underline disabled:opacity-50\"\n                >\n                  Cancelar\n                </button>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n",
        "dependencies": [
          {
            "path": "src/lib/actions/buildings.ts",
            "code": "'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { createClient } from '@/lib/supabase/server';\nimport { z } from 'zod';\n\nconst EnqueueSchema = z.object({\n  baseId: z.string().uuid(),\n  buildingId: z.string().min(1),\n});\n\nconst CancelSchema = z.object({\n  queueId: z.string().uuid(),\n});\n\nexport async function enqueueBuildingUpgrade(baseId: string, buildingId: string) {\n  const supabase = await createClient(); // Await createClient in Next.js 15\n\n  const validated = EnqueueSchema.safeParse({ baseId, buildingId });\n  if (!validated.success) {\n    return { error: 'Invalid input' };\n  }\n\n  const { error, data } = await supabase.rpc('enqueue_building_upgrade', {\n    p_base_id: baseId,\n    p_building_id: buildingId,\n  });\n\n  if (error) {\n    console.error('RPC Error:', error);\n    return { error: 'Database error occurred' };\n  }\n\n  // RPC returns { error: '...' } or { success: true }\n  // We need to check the JSON result\n  if (data && typeof data === 'object' && 'error' in data) {\n    return { error: (data as any).error };\n  }\n\n  revalidatePath('/dashboard/buildings');\n  return { success: true };\n}\n\nexport async function cancelBuildingUpgrade(queueId: string) {\n  const supabase = await createClient();\n\n  const validated = CancelSchema.safeParse({ queueId });\n  if (!validated.success) {\n    return { error: 'Invalid input' };\n  }\n\n  const { error, data } = await supabase.rpc('cancel_building_upgrade', {\n    p_queue_id: queueId,\n  });\n\n  if (error) {\n    console.error('RPC Error:', error);\n    return { error: 'Database error occurred' };\n  }\n\n  if (data && typeof data === 'object' && 'error' in data) {\n    return { error: (data as any).error };\n  }\n\n  revalidatePath('/dashboard/buildings');\n  return { success: true };\n}\n\nexport async function getBuildingProductionProjection(baseId: string, buildingId: string) {\n    const supabase = await createClient();\n\n    const { data, error } = await supabase.rpc('get_building_production_projection', {\n        p_base_id: baseId,\n        p_building_id: buildingId,\n        p_limit: 10\n    });\n\n    if (error) {\n        console.error('RPC Error:', error);\n        return [];\n    }\n\n    return data;\n}\n"
          },
          {
            "path": "src/types/legacy_schema.ts",
            "code": "export interface ConfigBuilding {\n  id: string;\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n  created_at?: string;\n}\n\n// Flat structure returned by get_base_buildings RPC\nexport interface BaseBuildingRPC {\n  id: string; // base_building id\n  base_id: string;\n  building_id: string;\n  level: number;\n  created_at?: string;\n\n  // Joined Config Fields\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n}\n\nexport interface ConstructionQueueItem {\n  id: string;\n  base_id: string;\n  building_id: string;\n  target_level: number;\n  start_time: string;\n  end_time: string;\n  created_at?: string;\n  // Joined fields\n  building_name?: string;\n}\n\nexport interface Base {\n  id: string;\n  user_id: string;\n  name: string | null;\n  coord_x: number;\n  coord_y: number;\n  coord_z: number;\n  resources_armaments: number;\n  resources_munitions: number;\n  resources_alcohol: number;\n  resources_dollars: number;\n  points: number;\n  last_updated_at?: string;\n  created_at?: string;\n}\n"
          }
        ]
      }
    ]
  },
  "src/app/dashboard/buildings/[id]/page.tsx": {
    "route": "/dashboard/buildings/[id]",
    "code": "import { createClient } from '@/lib/supabase/server';\nimport { redirect } from 'next/navigation';\nimport { getBuildingProductionProjection } from '@/lib/actions/buildings';\nimport BuildingDetailsHeader from '@/components/buildings/building-details-header';\nimport ProductionTable from '@/components/buildings/production-table';\nimport { BaseBuildingRPC } from '@/types/legacy_schema';\n\nexport default async function BuildingDetailsPage({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        redirect('/auth/login');\n    }\n\n    // Fetch Base ID (Assuming single base)\n    const { data: bases } = await supabase.from('bases').select('id').eq('user_id', user.id).limit(1);\n    if (!bases || bases.length === 0) return <div>No base found</div>;\n    const baseId = bases[0].id;\n\n    // Fetch Building Details via RPC (reuse get_base_buildings but filter in JS or DB)\n    // Ideally we should have get_building_details RPC, but get_base_buildings works if we filter.\n    // Efficiency note: Fetching all buildings to find one is suboptimal but acceptable for migration MVP (10-20 items).\n    const { data: allBuildings, error } = await supabase.rpc('get_base_buildings', { p_base_id: baseId });\n\n    if (error || !allBuildings) {\n        return <div>Error loading building</div>;\n    }\n\n    // Cast and Find\n    const buildings = allBuildings as BaseBuildingRPC[];\n    const building = buildings.find(b => b.building_id === id); // building_id is the config id (e.g. 'armeria')\n\n    if (!building) {\n        return <div>Edificio no encontrado o no disponible.</div>;\n    }\n\n    // Fetch Production Projection\n    const projection = await getBuildingProductionProjection(baseId, id);\n\n    return (\n        <div className=\"container mx-auto p-4 space-y-6\">\n            <BuildingDetailsHeader building={building} />\n            <ProductionTable projection={projection} currentLevel={building.level} />\n        </div>\n    );\n}\n",
    "components": [
      {
        "path": "src/components/buildings/building-details-header.tsx",
        "code": "'use client';\n\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { BaseBuildingRPC } from '@/types/legacy_schema';\n\ninterface BuildingDetailsHeaderProps {\n    building: BaseBuildingRPC;\n}\n\nexport default function BuildingDetailsHeader({ building }: BuildingDetailsHeaderProps) {\n    return (\n        <div className=\"bg-slate-800 rounded-lg p-6 flex flex-col md:flex-row gap-6 border border-slate-700\">\n            <div className=\"w-full md:w-64 h-48 bg-slate-700 rounded-lg flex-shrink-0 relative overflow-hidden\">\n                {/* Fallback Image */}\n                <div className=\"absolute inset-0 flex items-center justify-center text-4xl text-slate-500\">\n                    {building.name[0]}\n                </div>\n            </div>\n\n            <div className=\"flex-grow space-y-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-white\">{building.name}</h1>\n                    <p className=\"text-xl text-slate-400\">Nivel Actual: <span className=\"text-white\">{building.level}</span></p>\n                </div>\n\n                <p className=\"text-slate-300 leading-relaxed\">\n                    {building.description}\n                </p>\n\n                <div className=\"flex gap-6 pt-4 border-t border-slate-700\">\n                     <div className=\"text-center\">\n                        <span className=\"block text-xs text-slate-500 uppercase\">Puntos por Nivel</span>\n                        <span className=\"text-lg font-mono text-yellow-500\">{building.points}</span>\n                     </div>\n                     <div className=\"text-center\">\n                        <span className=\"block text-xs text-slate-500 uppercase\">Duraci\u00f3n Base</span>\n                        <span className=\"text-lg font-mono text-blue-400\">{building.base_duration}s</span>\n                     </div>\n                </div>\n\n                <div className=\"pt-4\">\n                    <Link href=\"/dashboard/buildings\">\n                        <button className=\"text-sm text-slate-400 hover:text-white underline\">\n                            \u2190 Volver al listado\n                        </button>\n                    </Link>\n                </div>\n            </div>\n        </div>\n    );\n}\n",
        "dependencies": [
          {
            "path": "src/types/legacy_schema.ts",
            "code": "export interface ConfigBuilding {\n  id: string;\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n  created_at?: string;\n}\n\n// Flat structure returned by get_base_buildings RPC\nexport interface BaseBuildingRPC {\n  id: string; // base_building id\n  base_id: string;\n  building_id: string;\n  level: number;\n  created_at?: string;\n\n  // Joined Config Fields\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n}\n\nexport interface ConstructionQueueItem {\n  id: string;\n  base_id: string;\n  building_id: string;\n  target_level: number;\n  start_time: string;\n  end_time: string;\n  created_at?: string;\n  // Joined fields\n  building_name?: string;\n}\n\nexport interface Base {\n  id: string;\n  user_id: string;\n  name: string | null;\n  coord_x: number;\n  coord_y: number;\n  coord_z: number;\n  resources_armaments: number;\n  resources_munitions: number;\n  resources_alcohol: number;\n  resources_dollars: number;\n  points: number;\n  last_updated_at?: string;\n  created_at?: string;\n}\n"
          }
        ]
      },
      {
        "path": "src/components/buildings/production-table.tsx",
        "code": "'use client';\n\ninterface ProductionRow {\n    level: number;\n    production_hourly: number;\n    resource_type: string | null;\n}\n\ninterface ProductionTableProps {\n    projection: ProductionRow[];\n    currentLevel: number;\n}\n\nexport default function ProductionTable({ projection, currentLevel }: ProductionTableProps) {\n    if (!projection || projection.length === 0) {\n        return null;\n    }\n\n    // Determine resource name from first row if available, or generic\n    const resourceName = projection[0].resource_type\n        ? projection[0].resource_type.charAt(0).toUpperCase() + projection[0].resource_type.slice(1)\n        : 'Recursos';\n\n    return (\n        <div className=\"bg-slate-800 rounded-lg overflow-hidden border border-slate-700 mt-6\">\n            <div className=\"bg-slate-900 px-6 py-4 border-b border-slate-700\">\n                <h3 className=\"text-lg font-semibold text-white\">Proyecci\u00f3n de Producci\u00f3n</h3>\n            </div>\n\n            <table className=\"w-full text-left text-sm text-slate-300\">\n                <thead className=\"bg-slate-700/50 text-xs uppercase text-slate-400\">\n                    <tr>\n                        <th className=\"px-6 py-3\">Nivel</th>\n                        <th className=\"px-6 py-3 text-right\">Producci\u00f3n / Hora ({resourceName})</th>\n                        <th className=\"px-6 py-3 text-right\">Diferencia</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {projection.map((row, index) => {\n                        const isCurrent = row.level === currentLevel;\n                        const prevRow = index > 0 ? projection[index - 1] : null;\n                        const diff = prevRow ? row.production_hourly - prevRow.production_hourly : 0;\n\n                        return (\n                            <tr\n                                key={row.level}\n                                className={`border-b border-slate-700/50 last:border-0 ${isCurrent ? 'bg-blue-900/20' : 'hover:bg-slate-700/20'}`}\n                            >\n                                <td className=\"px-6 py-3 font-medium\">\n                                    {row.level} {isCurrent && <span className=\"ml-2 text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full\">Actual</span>}\n                                </td>\n                                <td className=\"px-6 py-3 text-right font-mono text-white\">\n                                    {row.production_hourly.toLocaleString()}\n                                </td>\n                                <td className=\"px-6 py-3 text-right font-mono text-green-400\">\n                                    {index > 0 && `+${diff.toLocaleString()}`}\n                                </td>\n                            </tr>\n                        );\n                    })}\n                </tbody>\n            </table>\n        </div>\n    );\n}\n",
        "dependencies": []
      }
    ]
  },
  "src/app/dashboard/training/page.tsx": {
    "route": "/dashboard/training",
    "code": "\nimport { trainingData } from \"@/lib/data/training-data\";\nimport { TrainingCard } from \"@/components/dashboard/training/training-card\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\n\nexport default function TrainingPage() {\n  return (\n    <div className=\"space-y-4\">\n        <Card className=\"border-primary bg-stone-200 text-black\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4\">\n                <CardTitle className=\"text-lg text-primary-foreground\">\n                    Allenamento\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 space-y-4\">\n                {trainingData.map((training) => (\n                    <TrainingCard key={training.id} training={training} />\n                ))}\n            </CardContent>\n        </Card>\n    </div>\n  );\n}\n",
    "components": [
      {
        "path": "src/components/dashboard/training/training-card.tsx",
        "code": "\n'use client';\n\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { Coins, Shell, Droplets } from \"lucide-react\";\nimport { Training, trainingData } from \"@/lib/data/training-data\";\n\ntype TrainingCardProps = {\n  training: Training;\n};\n\nconst ResourceIcon = ({ type }: { type: string }) => {\n    switch (type) {\n        case 'Armas': return <Shell className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Municion': return <Coins className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Dolares': return <p className=\"text-lg font-bold text-green-600 inline-block ml-1\">$</p>;\n        default: return null;\n    }\n}\n\nexport function TrainingCard({ training }: TrainingCardProps) {\n  const image = PlaceHolderImages.find((p) => p.id === training.image);\n\n  return (\n    <div className=\"bg-stone-300/60 text-black p-4 rounded-md border border-primary/50 flex flex-col md:flex-row gap-4 items-start w-full\">\n      <div className=\"flex-shrink-0 w-24\">\n        {image && (\n            <Image\n                src={image.imageUrl}\n                alt={image.description}\n                width={100}\n                height={100}\n                className=\"rounded w-full h-auto object-cover\"\n                data-ai-hint={image.imageHint}\n            />\n        )}\n      </div>\n      <div className=\"flex-1\">\n        <h3 className=\"font-bold text-lg text-primary\">{training.name}</h3>\n        <p className=\"text-sm my-2\">{training.description}</p>\n        <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm\">\n          {Object.entries(training.costs).map(([resource, value]) => (\n            <div key={resource} className=\"flex items-center\">\n              <span>{resource.charAt(0)}: {value.toLocaleString()}</span>\n              <ResourceIcon type={resource} />\n            </div>\n          ))}\n           <span>Duraci\u00f3n: {training.duration}</span>\n        </div>\n      </div>\n      <div className=\"flex flex-col items-center justify-center h-full ml-auto text-center\">\n        <Button variant=\"link\" className=\"text-green-600 h-auto p-0 flex flex-col items-center\">\n            <span className=\"text-lg\">Inizia</span>\n            <span>espansione</span>\n        </Button>\n      </div>\n    </div>\n  );\n}\n",
        "dependencies": [
          {
            "path": "src/lib/data/training-data.ts",
            "code": "\nexport type Training = {\n    id: string;\n    name: string;\n    description: string;\n    image: string;\n    costs: {\n        Armas?: number;\n        Municion?: number;\n        Dolares?: number;\n    };\n    duration: string;\n};\n\nexport const trainingData: Training[] = [\n    {\n        id: \"planificacion-rutas\",\n        name: \"Planificacion de rutas\",\n        description: \"Para ser m\u00e1s efectivos en llegar tan r\u00e1pido como sea posible al objetivo, tus chicos deber\u00edan hacer este entrenamiento. Aqu\u00ed aprender\u00e1n a planear rutas, viajar silenciosamente, y aproximarse al objetivo sin ser detectados, para llevar a cabo su trabajo tan efectivamente como sea posible.\",\n        image: \"training-routes\",\n        costs: { Armas: 500, Municion: 1200 },\n        duration: \"00:11:07\",\n    },\n    {\n        id: \"extorsion\",\n        name: \"Extorsion\",\n        description: \"Con ayuda de este entrenamiento tus chicos mejorar\u00e1n notablemente cuando se trata de sacar dinero a base de extorsionar a tus enemigos. Esto se notar\u00e1 en la fuerza de combate que aumentar\u00e1 seg\u00fan el nivel alcanzado.\",\n        image: \"training-extortion\",\n        costs: { Armas: 1000, Municion: 2000 },\n        duration: \"00:16:40\",\n    },\n    {\n        id: \"espionaje\",\n        name: \"Espionaje\",\n        description: \"En este entrenamiento aprender\u00e1s las virtudes del espionaje por el cual tus esp\u00edas podr\u00e1n sacar informaci\u00f3n amplia y valiosa de tus enemigos.\",\n        image: \"training-espionage\",\n        costs: { Armas: 500, Municion: 500, Dolares: 300 },\n        duration: \"00:23:20\",\n    },\n    {\n        id: \"seguridad\",\n        name: \"Seguridad\",\n        description: \"Seguridad te permite desarrollar todos los sistemas necesarios para proteger tu edificio. A mayor nivel alcanzado mejor ser\u00e1 tu defensa y tus chicos sabr\u00e1n defenderse con mayor eficacia ante ataques.\",\n        image: \"training-security\",\n        costs: { Armas: 1000, Municion: 4000, Dolares: 1000 },\n        duration: \"00:22:13\",\n    },\n];\n"
          },
          {
            "path": "src/lib/placeholder-images.ts",
            "code": "import data from './placeholder-images.json';\n\nexport type ImagePlaceholder = {\n  id: string;\n  description: string;\n  imageUrl: string;\n  imageHint: string;\n};\n\nexport const PlaceHolderImages: ImagePlaceholder[] = data.placeholderImages;\n"
          }
        ]
      },
      {
        "path": "src/components/ui/card.tsx",
        "code": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n",
        "dependencies": []
      }
    ]
  },
  "src/app/dashboard/resources/page.tsx": {
    "route": "/dashboard/resources",
    "code": "import { TotalProduction } from \"@/components/dashboard/resources/total-production\";\nimport { BuildingProduction } from \"@/components/dashboard/resources/building-production\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n  } from \"@/components/ui/select\"\n  \n\nexport default function ResourcesPage() {\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center gap-2\">\n                <span className=\"font-semibold\">Edificio:</span>\n                <Select defaultValue=\"34:13:129\">\n                    <SelectTrigger className=\"w-[180px] bg-stone-200 border-primary/50 text-black\">\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"34:13:129\">34:13:129</SelectItem>\n                    </SelectContent>\n                </Select>\n            </div>\n            <TotalProduction />\n            <BuildingProduction />\n        </div>\n    );\n}",
    "components": [
      {
        "path": "src/components/dashboard/resources/building-production.tsx",
        "code": "import {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\";\nimport { buildingProductionData } from \"@/lib/data/resources-data\";\n  \nexport function BuildingProduction() {\n    const totals = buildingProductionData.buildings.reduce((acc, building) => {\n        acc.armas += building.production.armas;\n        acc.municion += building.production.municion;\n        acc.alcohol += building.production.alcohol;\n        acc.dolares += building.production.dolares;\n        return acc;\n    }, { ...buildingProductionData.baseSalary });\n\n    return (\n        <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4\">\n                <CardTitle className=\"text-lg text-primary-foreground\">Edificio 34:13:129 / Recursos / Hora</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n                <Table>\n                    <TableHeader>\n                        <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                            <TableHead className=\"text-primary-foreground w-[200px]\"></TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Armas</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Munici\u00f3n</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Alcohol</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">D\u00f3lares</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-semibold\">Salario base</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{buildingProductionData.baseSalary.armas}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{buildingProductionData.baseSalary.municion}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{buildingProductionData.baseSalary.alcohol}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.baseSalary.dolares}</TableCell>\n                        </TableRow>\n                        {buildingProductionData.buildings.map((building) => (\n                            <TableRow key={building.name} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                <TableCell className=\"font-semibold\">{building.name} ({building.level})</TableCell>\n                                <TableCell className={`text-center ${building.production.armas > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.armas}</TableCell>\n                                <TableCell className={`text-center ${building.production.municion > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.municion}</TableCell>\n                                <TableCell className={`text-center ${building.production.alcohol > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.alcohol}</TableCell>\n                                <TableCell className={`text-center ${building.production.dolares > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.dolares}</TableCell>\n                            </TableRow>\n                        ))}\n                        <TableRow className=\"bg-primary/20 hover:bg-primary/30\">\n                            <TableCell className=\"font-semibold text-center text-lg\">=</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{totals.armas}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{totals.municion}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{totals.alcohol}</TableCell>\n                            <TableCell className=\"text-center\">{totals.dolares}</TableCell>\n                        </TableRow>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-semibold\">Capacidad de Almacenamiento</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.armas.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.municion.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.alcohol.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.dolares.toLocaleString()}</TableCell>\n                        </TableRow>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-semibold\">Almacenados en forma segura</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.armas.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.municion.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.alcohol.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.dolares.toLocaleString()}</TableCell>\n                        </TableRow>\n                    </TableBody>\n                </Table>\n            </CardContent>\n        </Card>\n    );\n}\n",
        "dependencies": [
          {
            "path": "src/lib/data/resources-data.ts",
            "code": "export const totalProductionData = [\n    { resource: 'Armas', hour: 10, day: 240 },\n    { resource: 'Municion', hour: 20, day: 480 },\n    { resource: 'Alcohol', hour: 60, day: 1440 },\n    { resource: 'Dolares', hour: 0, day: 0 },\n];\n  \nexport const buildingProductionData = {\n    baseSalary: { armas: 10, municion: 10, alcohol: 10, dolares: 0 },\n    buildings: [\n        { name: 'Almac\u00e9n de munici\u00f3n', level: 1, production: { armas: 0, municion: 10, alcohol: 0, dolares: 0 } },\n        { name: 'Cervecer\u00eda', level: 1, production: { armas: 0, municion: 0, alcohol: 50, dolares: 0 } },\n    ],\n    storage: {\n        capacity: { armas: 10000, municion: 10000, alcohol: 10000, dolares: 10000 },\n        safe: { armas: 1000, municion: 1000, alcohol: 1000, dolares: 1000 },\n    }\n};"
          }
        ]
      },
      {
        "path": "src/components/dashboard/resources/total-production.tsx",
        "code": "import {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n  } from \"@/components/ui/table\";\nimport { totalProductionData } from \"@/lib/data/resources-data\";\n\nexport function TotalProduction() {\n    return (\n        <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4\">\n                <CardTitle className=\"text-lg text-primary-foreground\">Producci\u00f3n Total</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n                <Table>\n                    <TableHeader>\n                        <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                            <TableHead className=\"text-primary-foreground w-1/3\">Recurso</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Hora</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">D\u00eda</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        {totalProductionData.map((item) => (\n                            <TableRow key={item.resource} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                <TableCell className=\"font-semibold\">{item.resource}</TableCell>\n                                <TableCell className=\"text-center\">{item.hour}</TableCell>\n                                <TableCell className=\"text-center\">{item.day.toLocaleString()}</TableCell>\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n            </CardContent>\n        </Card>\n    );\n}\n",
        "dependencies": [
          {
            "path": "src/lib/data/resources-data.ts",
            "code": "export const totalProductionData = [\n    { resource: 'Armas', hour: 10, day: 240 },\n    { resource: 'Municion', hour: 20, day: 480 },\n    { resource: 'Alcohol', hour: 60, day: 1440 },\n    { resource: 'Dolares', hour: 0, day: 0 },\n];\n  \nexport const buildingProductionData = {\n    baseSalary: { armas: 10, municion: 10, alcohol: 10, dolares: 0 },\n    buildings: [\n        { name: 'Almac\u00e9n de munici\u00f3n', level: 1, production: { armas: 0, municion: 10, alcohol: 0, dolares: 0 } },\n        { name: 'Cervecer\u00eda', level: 1, production: { armas: 0, municion: 0, alcohol: 50, dolares: 0 } },\n    ],\n    storage: {\n        capacity: { armas: 10000, municion: 10000, alcohol: 10000, dolares: 10000 },\n        safe: { armas: 1000, municion: 1000, alcohol: 1000, dolares: 1000 },\n    }\n};"
          }
        ]
      },
      {
        "path": "src/components/ui/select.tsx",
        "code": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n",
        "dependencies": []
      }
    ]
  },
  "src/app/dashboard/poderataque/page.tsx": {
    "route": "/dashboard/poderataque",
    "code": "import {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n  } from \"@/components/ui/table\";\nimport { attackPowerData } from \"@/lib/data/poderataque-data\";\n\nexport default function AttackPowerPage() {\n    return (\n        <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n            <CardHeader className=\"bg-primary/80 py-3 px-4\">\n                <CardTitle className=\"text-xl text-primary-foreground\">\n                    Poder de ataque ( % )\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n                <div className=\"overflow-x-auto\">\n                    <Table>\n                        <TableHeader>\n                            <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                                <TableHead className=\"text-primary-foreground font-bold align-bottom\" rowSpan={2}>Edificios</TableHead>\n                                <TableHead className=\"text-primary-foreground font-bold text-center\" colSpan={attackPowerData.honorLevels.length}>Onore</TableHead>\n                            </TableRow>\n                            <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                                {attackPowerData.honorLevels.map(level => (\n                                    <TableHead key={level} className=\"text-primary-foreground text-center\">{level}</TableHead>\n                                ))}\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {attackPowerData.buildingLevels.map((row, index) => (\n                                <TableRow key={index} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                    <TableCell className=\"font-semibold text-center\">{row.level}</TableCell>\n                                    {row.values.map((value, vIndex) => (\n                                        <TableCell key={vIndex} className=\"text-center\">{value}</TableCell>\n                                    ))}\n                                </TableRow>\n                            ))}\n                        </TableBody>\n                    </Table>\n                </div>\n            </CardContent>\n        </Card>\n    )\n}\n",
    "components": [
      {
        "path": "src/components/ui/card.tsx",
        "code": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n",
        "dependencies": []
      },
      {
        "path": "src/components/ui/table.tsx",
        "code": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n",
        "dependencies": []
      }
    ]
  },
  "src/app/dashboard/map/page.tsx": {
    "route": "/dashboard/map",
    "code": "\nimport { MapControls } from \"@/components/dashboard/map/map-controls\";\nimport { CityMap } from \"@/components/dashboard/map/city-map\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\nimport { getMapTiles, getUserProperty, getDashboardData, MapTileData } from \"@/lib/services/game.service\";\nimport { createClient } from '@/lib/supabase/server';\n\ntype SearchParams = Promise<{ [key: string]: string | string[] | undefined }>\n\nexport default async function MapPage({\n    searchParams,\n}: {\n    searchParams: SearchParams\n}) {\n    const params = await searchParams;\n    let city = params.city ? parseInt(params.city as string) : null;\n    let district = params.district ? parseInt(params.district as string) : null;\n\n    let userProperty = null;\n    let dashboardData = null;\n\n    // Fetch user property to determine origin\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n    if (user) {\n        const propertyId = await getUserProperty(user.id);\n        if (propertyId) {\n            dashboardData = await getDashboardData(propertyId);\n            if (dashboardData) {\n                userProperty = {\n                    city: dashboardData.propiedad.coordenada_ciudad,\n                    district: dashboardData.propiedad.coordenada_barrio,\n                    building: dashboardData.propiedad.coordenada_edificio\n                };\n\n                // If coordinates are missing from URL, use user's location\n                if (city === null || district === null) {\n                    city = userProperty.city;\n                    district = userProperty.district;\n                }\n            }\n        }\n    }\n\n    // Default fallbacks if user has no property or something fails\n    const currentCity = city ?? 1;\n    const currentDistrict = district ?? 1;\n\n    const tilesData = await getMapTiles(currentCity, currentDistrict);\n\n    return (\n        <Card className=\"border-primary bg-stone-950 text-stone-100 min-h-[calc(100vh-8rem)]\">\n            <CardHeader className=\"bg-stone-900/50 py-3 px-6 border-b border-stone-800\">\n                <CardTitle className=\"text-xl text-amber-500 tracking-tight flex items-center justify-between\">\n                    <span>Mapa T\u00e1ctico</span>\n                    <span className=\"text-sm font-mono text-stone-500 bg-stone-900 px-2 py-1 rounded\">\n                        Sector {currentCity}:{currentDistrict}\n                    </span>\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0 flex flex-col items-center gap-0\">\n                <div className=\"w-full bg-stone-900/30 p-4 border-b border-stone-800 flex justify-center\">\n                    <MapControls currentCity={currentCity} currentDistrict={currentDistrict} />\n                </div>\n                <div className=\"w-full flex-1 p-6 flex justify-center items-start bg-[url('/grid-bg.png')] bg-repeat overflow-auto\">\n                    <CityMap\n                        tiles={tilesData}\n                        currentCity={currentCity}\n                        currentDistrict={currentDistrict}\n                        userProperty={userProperty}\n                    />\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n",
    "components": [
      {
        "path": "src/components/dashboard/map/city-map.tsx",
        "code": "\n'use client'\n\nimport { MapTileData } from \"@/lib/services/game.service\"\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\nimport { cn } from \"@/lib/utils\"\nimport { useState, useMemo } from 'react'\nimport { useRouter } from \"next/navigation\"\nimport { TileDetailsDialog } from \"./tile-details-dialog\"\nimport { User, Shield, AlertTriangle } from \"lucide-react\"\n\ninterface CityMapProps {\n  tiles: MapTileData[]\n  currentCity: number\n  currentDistrict: number\n  userProperty: {\n    city: number\n    district: number\n    building: number\n  } | null\n}\n\nexport function CityMap({ tiles, currentCity, currentDistrict, userProperty }: CityMapProps) {\n  const router = useRouter()\n  const [selectedTile, setSelectedTile] = useState<MapTileData | null>(null)\n  const [isDialogOpen, setIsDialogOpen] = useState(false)\n\n  // Memoize the grid generation to avoid re-renders\n  // Grid is 17 columns x 15 rows (255 tiles total)\n  const gridCells = useMemo(() => {\n    const cells = [];\n    const occupiedTiles = new Map(tiles.map(t => [t.coordenada_edificio, t]));\n\n    for (let i = 1; i <= 255; i++) {\n      const tileData = occupiedTiles.get(i);\n      cells.push({\n        id: i,\n        data: tileData || null\n      });\n    }\n    return cells;\n  }, [tiles]);\n\n  const handleTileClick = (id: number, tileData: MapTileData | null) => {\n    if (tileData) {\n      if (tileData.es_propia) {\n        // Redirect to overview if it's my own property\n        router.push('/dashboard/overview');\n      } else {\n        // Open dialog for other occupied properties\n        setSelectedTile(tileData);\n        setIsDialogOpen(true);\n      }\n    } else {\n      // Create a virtual \"Empty\" tile data for the dialog\n      const emptyTile: MapTileData = {\n        propiedad_id: '',\n        coordenada_edificio: id,\n        usuario_id: '00000000-0000-0000-0000-000000000000', // Empty GUID\n        nombre_usuario: 'Desocupado',\n        nombre_familia: null,\n        etiqueta_familia: null,\n        puntos: 0,\n        es_propia: false\n      };\n      setSelectedTile(emptyTile);\n      setIsDialogOpen(true);\n    }\n  };\n\n  return (\n    <>\n      <div\n        className=\"grid gap-1 w-fit bg-stone-900/80 p-2 rounded-xl border border-stone-800 shadow-2xl\"\n        style={{ gridTemplateColumns: 'repeat(17, minmax(0, 1fr))' }}\n      >\n        <TooltipProvider delayDuration={100}>\n          {gridCells.map((cell) => {\n            const isOccupied = !!cell.data;\n            const isOwn = cell.data?.es_propia;\n            const hasFamily = !!cell.data?.nombre_familia;\n\n            return (\n              <Tooltip key={cell.id}>\n                <TooltipTrigger asChild>\n                  <div\n                    onClick={() => handleTileClick(cell.id, cell.data)}\n                    className={cn(\n                      \"w-8 h-8 sm:w-10 sm:h-10 border rounded-sm transition-all duration-200 cursor-pointer flex items-center justify-center relative overflow-hidden group\",\n                      isOwn\n                        ? \"bg-green-900/40 border-green-600 hover:bg-green-800/60 hover:shadow-[0_0_10px_rgba(34,197,94,0.3)]\"\n                        : isOccupied\n                          ? \"bg-stone-800 border-stone-600 hover:bg-stone-700 hover:border-amber-500/50\"\n                          : \"bg-stone-950/50 border-stone-800/50 hover:bg-stone-900 hover:border-stone-600 opacity-60 hover:opacity-100\"\n                    )}\n                  >\n                     {/* Visual Indicators */}\n                     {isOwn && (\n                        <div className=\"absolute inset-0 bg-green-500/10 animate-pulse\" />\n                     )}\n\n                     {isOccupied ? (\n                        hasFamily ? (\n                           <Shield className={cn(\"h-4 w-4 sm:h-5 sm:w-5\", isOwn ? \"text-green-400\" : \"text-amber-500\")} />\n                        ) : (\n                           <User className={cn(\"h-4 w-4 sm:h-5 sm:w-5\", isOwn ? \"text-green-400\" : \"text-stone-400\")} />\n                        )\n                     ) : (\n                        <div className=\"text-[10px] text-stone-700 group-hover:text-stone-500 font-mono select-none\">\n                           {cell.id}\n                        </div>\n                     )}\n\n                     {/* Coordinate Label on Hover */}\n                     <div className=\"absolute bottom-0 right-0 text-[8px] sm:text-[9px] font-mono leading-none p-0.5 text-stone-500 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        {cell.id}\n                     </div>\n                  </div>\n                </TooltipTrigger>\n                <TooltipContent className=\"bg-stone-900 border-stone-700 text-stone-200 shadow-xl z-50\">\n                  <div className=\"text-xs space-y-1\">\n                    <p className=\"font-bold text-amber-500\">Solar {currentCity}:{currentDistrict}:{cell.id}</p>\n                    {isOccupied ? (\n                      <>\n                        <p className=\"flex items-center gap-1\"><User className=\"h-3 w-3\" /> {cell.data?.nombre_usuario}</p>\n                        {cell.data?.nombre_familia && (\n                           <p className=\"flex items-center gap-1 text-stone-400\"><Shield className=\"h-3 w-3\" /> {cell.data.etiqueta_familia}</p>\n                        )}\n                        <p className=\"text-stone-500\">Puntos: {cell.data?.puntos.toLocaleString()}</p>\n                        {isOwn && <p className=\"text-green-400 font-bold mt-1\">Tu Propiedad</p>}\n                      </>\n                    ) : (\n                      <p className=\"text-stone-500 italic\">Disponible para colonizar</p>\n                    )}\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            )\n          })}\n        </TooltipProvider>\n      </div>\n\n      <TileDetailsDialog\n        tile={selectedTile}\n        city={currentCity}\n        district={currentDistrict}\n        userProperty={userProperty}\n        isOpen={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n      />\n    </>\n  )\n}\n",
        "dependencies": [
          {
            "path": "src/components/dashboard/map/tile-details-dialog.tsx",
            "code": "\n'use client'\n\nimport { useState, useMemo } from 'react'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from \"@/components/ui/dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { MapTileData } from \"@/lib/services/game.service\"\nimport { MapCoordinates, calculateDistance, formatDuration, calculateTravelTime } from \"@/lib/utils/map-utils\"\nimport { useRouter } from 'next/navigation'\nimport { Sword, Eye, Truck, Flag, MapPin, User, Shield } from 'lucide-react'\n\ninterface TileDetailsDialogProps {\n  tile: MapTileData | null\n  city: number\n  district: number\n  userProperty: {\n    city: number\n    district: number\n    building: number\n  } | null\n  isOpen: boolean\n  onClose: () => void\n}\n\nexport function TileDetailsDialog({ tile, city, district, userProperty, isOpen, onClose }: TileDetailsDialogProps) {\n  const router = useRouter()\n\n  const distance = useMemo(() => {\n    if (!tile || !userProperty) return 0;\n    const origin: MapCoordinates = {\n      city: userProperty.city,\n      district: userProperty.district,\n      building: userProperty.building\n    };\n    const target: MapCoordinates = {\n      city: city,\n      district: district,\n      building: tile.coordenada_edificio\n    };\n    return calculateDistance(origin, target);\n  }, [tile, city, district, userProperty]);\n\n  // Estimate travel time with a base speed (e.g. 100) just for display\n  const estimatedTime = calculateTravelTime(distance, 100);\n\n  if (!tile) return null;\n\n  const handleAction = (action: string) => {\n    // Redirigir a /dashboard/missions\n    // Params: type, target=C:B:E\n    const targetStr = `${city}:${district}:${tile.coordenada_edificio}`;\n    router.push(`/dashboard/missions?type=${action}&target=${targetStr}`);\n    onClose();\n  };\n\n  const isOwn = tile.es_propia;\n  const isEmpty = tile.usuario_id === '00000000-0000-0000-0000-000000000000'; // Assuming empty tiles have null/zero user, but check logic.\n  // Actually, get_map_tiles might return null for user fields if empty.\n  // Let's check MapTileData type. It has usuario_id string.\n  // Usually the backend might filter out empty spots or return them with placeholders.\n  // We'll assume if points == 0 or specific check.\n  // Wait, legacy code usually treats 0-level or specific ID as empty.\n  // Let's assume non-empty if usuario_id is valid.\n\n  // Re-reading MapTileData: usuario_id is string.\n  // If it's a free slot, does it appear in get_map_tiles?\n  // get_map_tiles returns properties. If a slot is empty, is it returned?\n  // Usually map RPCs return ALL slots 1-255 or just occupied ones.\n  // If just occupied, then we can't click empty slots unless we render a full grid and fill gaps.\n  // CityMap receives `tiles` which is MapTileData[].\n  // If we want to click \"Empty\" slots, CityMap needs to render them.\n  // We will address that in CityMap.\n  // Here, we assume `tile` is passed. If it's a \"virtual\" empty tile, we need to handle it.\n\n  // Let's support a \"virtual\" tile object for empty slots passed from CityMap\n  const isOccupied = tile.usuario_id && tile.usuario_id !== '00000000-0000-0000-0000-000000000000';\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[425px] bg-stone-900 text-stone-100 border-stone-700\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2 text-xl text-amber-500\">\n            <MapPin className=\"h-5 w-5\" />\n            Solar {city}:{district}:{tile.coordenada_edificio}\n          </DialogTitle>\n          <DialogDescription className=\"text-stone-400\">\n            {isOccupied ? \"Propiedad Ocupada\" : \"Solar Disponible\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid gap-4 py-4\">\n          {isOccupied ? (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-3 p-3 bg-stone-800 rounded-lg\">\n                <User className=\"h-8 w-8 text-stone-400\" />\n                <div>\n                  <p className=\"font-medium text-stone-200\">{tile.nombre_usuario}</p>\n                  {tile.nombre_familia && (\n                    <Badge variant=\"outline\" className=\"text-xs border-amber-500/50 text-amber-500 mt-1\">\n                      [{tile.etiqueta_familia}] {tile.nombre_familia}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex justify-between items-center p-3 bg-stone-800/50 rounded-lg\">\n                <span className=\"text-sm text-stone-400\">Puntos</span>\n                <span className=\"font-mono text-stone-200\">{tile.puntos.toLocaleString()}</span>\n              </div>\n            </div>\n          ) : (\n            <div className=\"p-4 bg-stone-800/30 rounded-lg border border-stone-700 border-dashed text-center text-stone-500\">\n              Este solar est\u00e1 disponible para colonizar o fundar una nueva propiedad.\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-2 text-sm\">\n            <div className=\"p-2 bg-stone-950 rounded border border-stone-800\">\n              <span className=\"block text-xs text-stone-500 mb-1\">Distancia</span>\n              <span className=\"font-mono\">{distance} km</span>\n            </div>\n            <div className=\"p-2 bg-stone-950 rounded border border-stone-800\">\n              <span className=\"block text-xs text-stone-500 mb-1\">Tiempo Est.</span>\n              <span className=\"font-mono\">~{formatDuration(estimatedTime)}</span>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"grid grid-cols-2 gap-2 sm:gap-2\">\n          {isOwn ? (\n            <Button variant=\"default\" className=\"col-span-2 bg-green-600 hover:bg-green-700\" onClick={() => router.push('/dashboard/overview')}>\n              Gestionar Propiedad\n            </Button>\n          ) : isOccupied ? (\n            <>\n              <Button variant=\"outline\" className=\"border-stone-600 hover:bg-stone-800\" onClick={() => handleAction('espiar')}>\n                <Eye className=\"mr-2 h-4 w-4\" /> Espiar\n              </Button>\n              <Button variant=\"outline\" className=\"border-stone-600 hover:bg-stone-800\" onClick={() => handleAction('transportar')}>\n                <Truck className=\"mr-2 h-4 w-4\" /> Transportar\n              </Button>\n              <Button variant=\"destructive\" className=\"col-span-2 bg-red-900/80 hover:bg-red-900 border-red-800\" onClick={() => handleAction('atacar')}>\n                <Sword className=\"mr-2 h-4 w-4\" /> Atacar\n              </Button>\n            </>\n          ) : (\n            <Button className=\"col-span-2 bg-amber-600 hover:bg-amber-700\" onClick={() => handleAction('colonizar')}>\n              <Flag className=\"mr-2 h-4 w-4\" /> Colonizar / Fundar\n            </Button>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"
          },
          {
            "path": "src/lib/services/game.service.ts",
            "code": "import { createClient } from '@/lib/supabase/server'\nimport { Propiedad, AtaqueEntrante, ColaMisiones, MiembroFamilia, Familia } from '@/types/database'\nimport { RespuestaConstruccion, ColaConstruccion, DashboardData } from '@/types/game'\nimport { sanitizeDatabaseError } from '@/lib/utils/db-error'\n\ninterface CreateInitialPropertyData {\n  nombre: string\n  ciudad: number\n  barrio: number\n  edificio: number\n}\n\ninterface CreateInitialPropertyResponse {\n  success?: boolean\n  error?: string\n  propiedad_id?: string\n}\n\ninterface ResearchResponse {\n  success?: boolean\n  error?: string\n}\n\ninterface RecruitResponse {\n  success?: boolean\n  error?: string\n}\n\ninterface MissionData {\n  propiedad_origen_id: string\n  tipo_mision: 'atacar' | 'transportar' | 'espiar' | 'colonizar' | 'recolectar'\n  tropas: Record<string, number>\n  recursos?: Record<string, number>\n  destino_ciudad: number\n  destino_barrio: number\n  destino_edificio: number\n  velocidad_flota?: number\n}\n\ninterface MissionResponse {\n  success?: boolean\n  error?: string\n  mision_id?: string\n}\n\nexport interface MapTileData {\n  propiedad_id: string\n  coordenada_edificio: number\n  usuario_id: string\n  nombre_usuario: string\n  nombre_familia: string | null\n  etiqueta_familia: string | null\n  puntos: number\n  es_propia: boolean\n}\n\nexport async function getMapTiles(city: number, district: number): Promise<MapTileData[]> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('get_map_tiles', {\n    p_ciudad: city,\n    p_barrio: district\n  })\n\n  if (error) {\n    console.error('Error fetching map tiles:', error)\n    return []\n  }\n\n  return data as MapTileData[]\n}\n\nexport async function createInitialProperty(data: CreateInitialPropertyData): Promise<CreateInitialPropertyResponse> {\n  const supabase = await createClient()\n\n  const { data: result, error } = await supabase.rpc('crear_propiedad_inicial', {\n    p_nombre: data.nombre,\n    p_ciudad: data.ciudad,\n    p_barrio: data.barrio,\n    p_edificio: data.edificio\n  })\n\n  if (error) {\n    console.error('Error creating initial property:', error)\n    return { error: sanitizeDatabaseError(error) }\n  }\n\n  return result as CreateInitialPropertyResponse\n}\n\nexport async function getUserProperty(userId: string): Promise<string | null> {\n  if (!userId) return null\n\n  const supabase = await createClient()\n  // Use 'bases' table as per migration, replacing legacy 'propiedad'\n  const { data, error } = await supabase.from('bases').select('id').eq('user_id', userId).maybeSingle()\n\n  if (error) {\n    console.error('Error checking user property:', JSON.stringify(error, null, 2))\n    return null\n  }\n  return data?.id || null\n}\n\nexport async function getDashboardData(propertyId: string): Promise<DashboardData | null> {\n  const supabase = await createClient()\n\n  const { data: dashboardData, error } = await supabase.rpc('get_dashboard_data', {\n    p_propiedad_id: propertyId\n  })\n\n  if (error || !dashboardData) {\n    console.error('Error fetching dashboard data:', error)\n    return null\n  }\n\n  // Fetch real-time collections in parallel\n  const [attacks, missions] = await Promise.all([\n    getIncomingAttacks(propertyId),\n    getActiveMissions(propertyId)\n  ])\n\n  // Merge into expanded DashboardData structure\n  const result: DashboardData = {\n    ...dashboardData,\n    incoming_attacks: attacks,\n    cola_misiones: missions,\n    tropa_usuario: dashboardData.tropas || [],\n    cola_reclutamiento: dashboardData.colas?.reclutamiento || []\n  }\n\n  return result\n}\n\nexport async function getIncomingAttacks(propertyId: string): Promise<AtaqueEntrante[]> {\n  const supabase = await createClient()\n\n  // First get the user_id for this property to filter attacks targeting this user\n  const { data: prop, error: propError } = await supabase\n    .from('propiedad')\n    .select('usuario_id')\n    .eq('id', propertyId)\n    .single()\n\n  if (propError || !prop) {\n      console.error('Error getting property owner for attacks:', propError)\n      return []\n  }\n\n  const { data, error } = await supabase\n    .from('ataque_entrante')\n    .select('*')\n    .eq('defensor_id', prop.usuario_id)\n    .order('fecha_llegada', { ascending: true })\n\n  if (error) {\n    console.error('Error fetching incoming attacks:', error)\n    return []\n  }\n\n  return data as AtaqueEntrante[]\n}\n\nexport async function getActiveMissions(propertyId: string): Promise<ColaMisiones[]> {\n  const supabase = await createClient()\n  const { data, error } = await supabase\n      .from('cola_misiones')\n      .select('*')\n      .eq('propiedad_origen_id', propertyId)\n      .order('fecha_llegada', { ascending: true })\n\n  if (error) {\n      console.error('Error fetching active missions:', error)\n      return []\n  }\n\n  return data as ColaMisiones[]\n}\n\nexport async function getFamilyInfo(userId: string): Promise<{ miembro: MiembroFamilia, familia: Familia } | null> {\n  const supabase = await createClient()\n  const { data: miembro, error: mError } = await supabase\n      .from('miembro_familia')\n      .select('*')\n      .eq('usuario_id', userId)\n      .maybeSingle()\n  \n  if (mError || !miembro) return null\n\n  const { data: familia, error: fError } = await supabase\n      .from('familia')\n      .select('*')\n      .eq('id', miembro.familia_id)\n      .single()\n  \n  if (fError || !familia) return null\n\n  return { miembro, familia }\n}\n\nexport async function cancelConstruction(queueId: string): Promise<{ success: boolean; error?: string }> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('cancelar_construccion', {\n    p_cola_id: queueId\n  })\n\n  if (error) {\n    console.error('Error cancelling construction:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  const result = data as { success: boolean; error?: string }\n  if (result.error) {\n    return { success: false, error: result.error }\n  }\n\n  return { success: true }\n}\n\nexport async function syncResources(propertyId: string): Promise<Propiedad | null> {\n  const supabase = await createClient()\n  \n  // 1. Process queues (construction, research, etc.) for this property\n  const { error: queueError } = await supabase.rpc('procesar_colas_propiedad', {\n    p_propiedad_id: propertyId\n  })\n\n  if (queueError) {\n    console.error('Error processing queues:', queueError)\n    // Continue anyway to at least try to get resources\n  }\n\n  // 2. Materialize resources (lazy update)\n  const { error: rpcError } = await supabase.rpc('materializar_recursos', {\n    p_propiedad_id: propertyId\n  })\n\n  if (rpcError) {\n    console.error('Error synchronizing resources:', rpcError)\n  }\n\n  // 3. Fetch the updated property data\n  const { data, error } = await supabase\n    .from('propiedad')\n    .select('*')\n    .eq('id', propertyId)\n    .single()\n\n  if (error) {\n    console.error('Error fetching property:', error)\n    return null\n  }\n\n  return data\n}\n\nexport async function startConstruction(propertyId: string, buildingId: string): Promise<RespuestaConstruccion> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_construccion_habitacion', {\n    p_propiedad_id: propertyId,\n    p_habitacion_id: buildingId\n  })\n\n  if (error) {\n    console.error('Error starting construction:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as RespuestaConstruccion\n}\n\nexport async function getConstructionQueue(propertyId: string): Promise<ColaConstruccion[]> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from('cola_construccion')\n    .select('id, propiedad_id, habitacion_id, nivel_destino, fecha_fin')\n    .eq('propiedad_id', propertyId)\n    .order('fecha_fin', { ascending: true })\n\n  if (error) {\n    console.error('Error fetching construction queue:', error)\n    return []\n  }\n\n  return data as ColaConstruccion[]\n}\n\nexport async function startResearch(propertyId: string, researchId: string): Promise<ResearchResponse> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_entrenamiento', {\n    p_propiedad_id: propertyId,\n    p_entrenamiento_id: researchId\n  })\n\n  if (error) {\n    console.error('Error starting research:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as ResearchResponse\n}\n\nexport async function recruitTroops(propertyId: string, troopId: string, amount: number): Promise<RecruitResponse> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_reclutamiento', {\n    p_propiedad_id: propertyId,\n    p_tropa_id: troopId,\n    p_cantidad: amount\n  })\n\n  if (error) {\n    console.error('Error recruiting troops:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as RecruitResponse\n}\n\nexport async function launchMission(missionData: MissionData): Promise<MissionResponse> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_mision', {\n    p_propiedad_origen_id: missionData.propiedad_origen_id,\n    p_tipo_mision: missionData.tipo_mision,\n    p_tropas: missionData.tropas,\n    p_recursos: missionData.recursos || {},\n    p_destino_ciudad: missionData.destino_ciudad,\n    p_destino_barrio: missionData.destino_barrio,\n    p_destino_edificio: missionData.destino_edificio,\n    p_velocidad_flota: missionData.velocidad_flota || 100\n  })\n\n  if (error) {\n    console.error('Error launching mission:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as MissionResponse\n}\n"
          },
          {
            "path": "src/lib/utils.ts",
            "code": "import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"
          }
        ]
      },
      {
        "path": "src/components/dashboard/map/map-controls.tsx",
        "code": "\n'use client'\n\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { ChevronLeft, ChevronRight, Search, Map as MapIcon } from 'lucide-react'\nimport { useState, useEffect } from 'react'\n\ninterface MapControlsProps {\n  currentCity: number\n  currentDistrict: number\n}\n\nexport function MapControls({ currentCity, currentDistrict }: MapControlsProps) {\n  const router = useRouter()\n  // Local state for inputs to allow typing before navigating\n  const [cityInput, setCityInput] = useState(currentCity.toString())\n  const [districtInput, setDistrictInput] = useState(currentDistrict.toString())\n\n  // Sync state if props change (e.g. external navigation)\n  useEffect(() => {\n    setCityInput(currentCity.toString())\n    setDistrictInput(currentDistrict.toString())\n  }, [currentCity, currentDistrict])\n\n  const navigateTo = (city: number | string, district: number | string) => {\n    const c = Number(city)\n    const d = Number(district)\n    if (c > 0 && d > 0) {\n      router.push(`/dashboard/map?city=${c}&district=${d}`)\n    }\n  }\n\n  const handlePrevDistrict = () => {\n    if (currentDistrict > 1) {\n      navigateTo(currentCity, currentDistrict - 1)\n    } else {\n      // Logic to go to previous city? Maybe keep it simple for now.\n    }\n  }\n\n  const handleNextDistrict = () => {\n    // Assuming max district 50 or infinite? Requirement says 1-50 in memory, but let's just go +1\n    navigateTo(currentCity, currentDistrict + 1)\n  }\n\n  const handleGo = () => {\n    navigateTo(cityInput, districtInput)\n  }\n\n  return (\n    <div className=\"flex flex-wrap items-center justify-center gap-4 bg-stone-900/80 p-3 rounded-lg border border-stone-700 w-full max-w-2xl shadow-xl\">\n      <div className=\"flex items-center gap-2\">\n        <label className=\"text-xs text-amber-500 font-bold uppercase tracking-wider\">Ciudad</label>\n        <Input\n          type=\"number\"\n          min={1}\n          className=\"w-20 bg-stone-950 border-stone-700 text-stone-200 h-9\"\n          value={cityInput}\n          onChange={(e) => setCityInput(e.target.value)}\n          onKeyDown={(e) => e.key === 'Enter' && handleGo()}\n        />\n      </div>\n\n      <div className=\"flex items-center gap-2\">\n        <label className=\"text-xs text-amber-500 font-bold uppercase tracking-wider\">Barrio</label>\n        <div className=\"flex items-center\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-9 w-9 rounded-r-none border-r-0 border-stone-700 hover:bg-stone-800 text-stone-400\"\n            onClick={handlePrevDistrict}\n            disabled={currentDistrict <= 1}\n          >\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Input\n            type=\"number\"\n            min={1}\n            className=\"w-20 bg-stone-950 border-stone-700 text-stone-200 h-9 rounded-none text-center focus-visible:ring-0\"\n            value={districtInput}\n            onChange={(e) => setDistrictInput(e.target.value)}\n            onKeyDown={(e) => e.key === 'Enter' && handleGo()}\n          />\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-9 w-9 rounded-l-none border-l-0 border-stone-700 hover:bg-stone-800 text-stone-400\"\n            onClick={handleNextDistrict}\n          >\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Button\n        variant=\"default\"\n        size=\"sm\"\n        className=\"bg-amber-600 hover:bg-amber-700 text-white shadow-lg\"\n        onClick={handleGo}\n      >\n        <Search className=\"h-4 w-4 mr-2\" />\n        Ir\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        className=\"border-stone-600 text-stone-400 hover:bg-stone-800\"\n        onClick={() => router.push('/dashboard/map')} // Resets to home\n      >\n        <MapIcon className=\"h-4 w-4\" />\n      </Button>\n    </div>\n  )\n}\n",
        "dependencies": []
      },
      {
        "path": "src/components/ui/card.tsx",
        "code": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n",
        "dependencies": []
      }
    ]
  },
  "src/app/dashboard/overview/page.tsx": {
    "route": "/dashboard/overview",
    "code": "import { createClient } from \"@/lib/supabase/server\";\nimport { getActiveMissions, getDashboardData, getFamilyInfo, getIncomingAttacks, getUserProperty } from \"@/lib/services/game.service\";\nimport { OverviewWrapper } from \"@/components/dashboard/overview/overview-wrapper\";\nimport { DashboardData } from \"@/types/game\";\n\nexport default async function OverviewPage() {\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        return <div>Acceso denegado</div>;\n    }\n\n    const propertyId = await getUserProperty(user.id);\n\n    if (!propertyId) {\n        return <div>No se encontr\u00f3 propiedad para el usuario.</div>;\n    }\n\n    // Parallel data fetching\n    const [dashboardData, familyInfo] = await Promise.all([\n        getDashboardData(propertyId),\n        getFamilyInfo(user.id)\n    ]);\n\n    if (!dashboardData) {\n        return <div>Error cargando datos.</div>;\n    }\n\n    return (\n        <OverviewWrapper\n            initialData={dashboardData}\n            familyInfo={familyInfo}\n        />\n    );\n}\n",
    "components": [
      {
        "path": "src/components/dashboard/overview/overview-wrapper.tsx",
        "code": "'use client';\n\nimport { GameStateProvider } from '@/components/providers/game-state-provider';\nimport { OverviewView } from './overview-view';\nimport { DashboardData } from '@/types/game';\nimport { MiembroFamilia, Familia } from '@/types/database';\n\ninterface OverviewWrapperProps {\n  initialData: DashboardData;\n  familyInfo: { miembro: MiembroFamilia; familia: Familia } | null;\n}\n\nexport function OverviewWrapper({ initialData, familyInfo }: OverviewWrapperProps) {\n  return (\n    <GameStateProvider initialData={initialData}>\n      <OverviewView familyInfo={familyInfo} />\n    </GameStateProvider>\n  );\n}\n",
        "dependencies": [
          {
            "path": "src/components/dashboard/overview/overview-view.tsx",
            "code": "'use client';\n\nimport { useGameState } from '@/components/providers/game-state-provider';\nimport { MiembroFamilia, Familia } from '@/types/database';\nimport { ConstructionQueueList } from '../rooms/construction-queue-list';\nimport { ActiveMissionsList } from '../missions/active-missions-list';\nimport { AlertsWidget } from './alerts-widget';\nimport { QuickActions } from './quick-actions';\nimport { ResourceTicker } from './resource-ticker';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Building2, TrendingUp, Users } from 'lucide-react';\n\ninterface OverviewViewProps {\n  familyInfo: { miembro: MiembroFamilia; familia: Familia } | null;\n}\n\nexport function OverviewView({ familyInfo }: OverviewViewProps) {\n  const { gameState } = useGameState();\n\n  if (!gameState) {\n    return <div className=\"p-4 text-center\">Cargando datos del imperio...</div>;\n  }\n\n  const { propiedad, recursos, edificios, puntos, incoming_attacks, cola_misiones, tropa_usuario } = gameState;\n  const attacks = incoming_attacks || [];\n  const missions = cola_misiones || [];\n  \n  // Ensure we handle colas correctly. gameState.colas can be null if not populated, but types say it's there.\n  // Based on DashboardData type, 'colas' is mandatory but sub-arrays can be empty.\n  const construction = gameState.colas?.construccion || [];\n\n  const resourceList = [\n    { name: \"Armas\", value: recursos.armas.val, max: recursos.armas.max, prod: recursos.armas.prod },\n    { name: \"Munici\u00f3n\", value: recursos.municion.val, max: recursos.municion.max, prod: recursos.municion.prod },\n    { name: \"Alcohol\", value: recursos.alcohol.val, max: recursos.alcohol.max, prod: recursos.alcohol.prod },\n    { name: \"D\u00f3lares\", value: recursos.dolares.val, max: recursos.dolares.max, prod: recursos.dolares.prod },\n  ];\n\n  // Main building logic (Oficina del Jefe)\n  const mainBuilding = edificios.find(e => e.id === 'oficina_del_jefe');\n  \n  return (\n    <div className=\"space-y-4 animate-in fade-in duration-500\">\n      {/* Header: Resources & Status */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n         {resourceList.map((res) => (\n             <Card key={res.name} className=\"bg-card shadow-sm border-l-4 border-l-primary\">\n                 <CardContent className=\"p-4 pb-2\">\n                     <div className=\"text-xs text-muted-foreground uppercase font-bold\">{res.name}</div>\n                     <div className=\"text-2xl font-bold font-mono my-1\">\n                        <ResourceTicker initialValue={res.value} productionRate={res.prod} className=\"text-foreground\" />\n                     </div>\n                     <div className=\"flex justify-between text-xs text-muted-foreground\">\n                        <span>Cap: {(res.max / 1000).toFixed(0)}k</span>\n                        <span className=\"text-green-600 font-medium\">+{Math.floor(res.prod)}/h</span>\n                     </div>\n                 </CardContent>\n             </Card>\n         ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\n        {/* Left Column (Actions & Queues) */}\n        <div className=\"lg:col-span-3 space-y-6\">\n            <QuickActions />\n            <ConstructionQueueList queue={construction} limit={3} compact={true} />\n        </div>\n\n        {/* Center Column (Empire Status) */}\n        <div className=\"lg:col-span-6 space-y-6\">\n             <Card>\n                <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"flex justify-between items-center text-lg\">\n                        <span className=\"flex items-center gap-2\">\n                            {propiedad.nombre}\n                        </span>\n                        <Badge variant=\"secondary\" className=\"font-mono text-xs\">\n                            {propiedad.coordenada_ciudad}:{propiedad.coordenada_barrio}:{propiedad.coordenada_edificio}\n                        </Badge>\n                    </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6 pt-4\">\n                    <div className=\"grid grid-cols-3 gap-4 text-center\">\n                        <div className=\"p-4 bg-muted/30 border rounded-lg hover:bg-muted/50 transition-colors\">\n                            <Building2 className=\"w-6 h-6 mx-auto mb-2 text-primary\" />\n                            <div className=\"text-3xl font-bold\">{mainBuilding?.nivel || 0}</div>\n                            <div className=\"text-xs text-muted-foreground font-medium uppercase mt-1\">Nivel Base</div>\n                        </div>\n                        <div className=\"p-4 bg-muted/30 border rounded-lg hover:bg-muted/50 transition-colors\">\n                            <Users className=\"w-6 h-6 mx-auto mb-2 text-primary\" />\n                            <div className=\"text-3xl font-bold\">{tropa_usuario?.reduce((acc: number, t: any) => acc + t.cantidad, 0) || 0}</div>\n                            <div className=\"text-xs text-muted-foreground font-medium uppercase mt-1\">Tropas</div>\n                        </div>\n                        <div className=\"p-4 bg-muted/30 border rounded-lg hover:bg-muted/50 transition-colors\">\n                            <TrendingUp className=\"w-6 h-6 mx-auto mb-2 text-primary\" />\n                            <div className=\"text-3xl font-bold\">{Math.floor(puntos).toLocaleString()}</div>\n                            <div className=\"text-xs text-muted-foreground font-medium uppercase mt-1\">Puntos</div>\n                        </div>\n                    </div>\n                    \n                    {familyInfo && (\n                        <div className=\"p-4 border rounded-md bg-stone-50/80 dark:bg-stone-900/50 flex justify-between items-center\">\n                            <div>\n                                <div className=\"text-xs text-muted-foreground font-bold uppercase mb-1\">Familia</div>\n                                <div className=\"font-bold text-lg\">{familyInfo.familia?.nombre}</div>\n                            </div>\n                            <Badge className=\"text-lg px-3 py-1 font-mono\">[{familyInfo.familia?.etiqueta}]</Badge>\n                        </div>\n                    )}\n                </CardContent>\n             </Card>\n        </div>\n\n        {/* Right Column (Alerts & Missions) */}\n        <div className=\"lg:col-span-3 space-y-6\">\n            <AlertsWidget attacks={attacks} />\n            <ActiveMissionsList missions={missions} limit={5} compact={true} />\n        </div>\n      </div>\n    </div>\n  );\n}\n"
          },
          {
            "path": "src/components/providers/game-state-provider.tsx",
            "code": "'use client';\n\nimport React, { createContext, useContext, ReactNode } from 'react';\nimport { DashboardData } from '@/types/game';\nimport { useGameRealtime } from '@/hooks/use-game-realtime';\n\ninterface GameStateContextType {\n  gameState: DashboardData | null;\n}\n\nconst GameStateContext = createContext<GameStateContextType | undefined>(undefined);\n\ninterface GameStateProviderProps {\n  initialData: DashboardData | null;\n  children: ReactNode;\n}\n\nexport function GameStateProvider({ initialData, children }: GameStateProviderProps) {\n  const gameState = useGameRealtime(initialData);\n\n  return (\n    <GameStateContext.Provider value={{ gameState }}>\n      {children}\n    </GameStateContext.Provider>\n  );\n}\n\nexport function useGameState() {\n  const context = useContext(GameStateContext);\n  if (context === undefined) {\n    throw new Error('useGameState must be used within a GameStateProvider');\n  }\n  return context;\n}\n"
          },
          {
            "path": "src/types/database.ts",
            "code": "// src/types/database.ts\n\n// Enums\nexport type EstadoInvitacion = 'pendiente' | 'aceptada' | 'rechazada';\n// Alias for typo compatibility if needed, though strictly we should use the correct one.\nexport type EstadoInvaticion = EstadoInvitacion; \n\nexport type RolFamilia = 'miembro' | 'capitan' | 'lider';\nexport type CategoriaMensaje = 'jugador' | 'familia' | 'sistema' | 'batalla' | 'espionaje';\nexport type EstadoFlota = 'en_camino' | 'regresando' | 'estacionada' | 'combatiendo';\nexport type TipoMision = 'atacar' | 'transportar' | 'espiar' | 'colonizar' | 'recolectar';\n\n// Interfaces for Tables\nexport interface Usuario {\n  id: string; // uuid\n  nombre_usuario: string;\n  email: string;\n  url_avatar?: string;\n  nombre?: string;\n  titulo?: string;\n  rol?: string;\n  primer_login?: boolean;\n  ultimo_visto?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface HistorialAcceso {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  fecha_acceso?: string; // timestamptz\n  direccion_ip?: string;\n  agente_usuario?: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface PuntuacionUsuario {\n  usuario_id: string; // uuid\n  puntos_habitaciones?: number; // real\n  puntos_tropas?: number; // real\n  puntos_entrenamientos?: number; // real\n  puntos_totales?: number; // real\n  puntos_honor_atacante?: number; // real\n  puntos_honor_defensor?: number; // real\n  puntos_honor_totales?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ErroresConfiguracion {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  mensaje_error?: string;\n  fecha_creacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionHabitacion {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_construccion?: number; // integer\n  produccion_base?: number; // real\n  recurso_producido?: string;\n  puntos?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionEntrenamiento {\n  id: string;\n  nombre: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_entrenamiento?: number; // integer\n  puntos?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_reclutamiento?: number; // integer\n  ataque?: number; // integer\n  defensa?: number; // integer\n  capacidad_carga?: number; // integer\n  velocidad?: number; // bigint\n  salario?: number; // integer\n  puntos?: number; // real\n  tipo: string;\n  requisitos?: Record<string, any>; // jsonb\n  bonus_ataque?: string[];\n  bonus_defensa?: string[];\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface RequisitoHabitacion {\n  id: string; // uuid\n  habitacion_id?: string;\n  habitacion_requerida_id?: string;\n  nivel_requerido?: number; // integer\n}\n\nexport interface RequisitoEntrenamiento {\n  id: string; // uuid\n  entrenamiento_id?: string;\n  entrenamiento_requerido_id?: string;\n  nivel_requerido?: number; // integer\n}\n\nexport interface TropaBonusContrincante {\n  id: string; // uuid\n  tropa_atacante_id?: string;\n  tropa_defensora_id?: string;\n  factor_prioridad?: number; // real\n}\n\nexport interface Propiedad {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  nombre: string;\n  coordenada_ciudad: number; // integer\n  coordenada_barrio: number; // integer\n  coordenada_edificio: number; // integer\n  armas?: number; // bigint\n  municion?: number; // bigint\n  alcohol?: number; // bigint\n  dolares?: number; // bigint\n  ultima_recogida_recursos?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface HabitacionUsuario {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  habitacion_id?: string;\n  nivel?: number; // smallint\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface TropaPropiedad {\n  propiedad_id: string; // uuid\n  tropa_id: string;\n  cantidad?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface TropaSeguridadPropiedad {\n  propiedad_id: string; // uuid\n  tropa_id: string;\n  cantidad?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface EntrenamientoUsuario {\n  usuario_id: string; // uuid\n  entrenamiento_id: string;\n  nivel?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaConstruccion {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  habitacion_id?: string;\n  nivel_destino: number; // integer\n  duracion_segundos: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaInvestigacion {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  propiedad_id?: string; // uuid\n  entrenamiento_id?: string;\n  nivel_destino: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaReclutamiento {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  tropa_id?: string;\n  cantidad: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface Familia {\n  id: string; // uuid\n  nombre: string;\n  etiqueta: string;\n  descripcion?: string;\n  url_avatar?: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface MiembroFamilia {\n  usuario_id: string; // uuid\n  familia_id?: string; // uuid\n  rol?: RolFamilia;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface InvitacionFamilia {\n  id: string; // uuid\n  familia_id?: string; // uuid\n  usuario_id?: string; // uuid\n  tipo: string;\n  estado?: EstadoInvitacion;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface AnuncioFamilia {\n  id: string; // uuid\n  familia_id?: string; // uuid\n  autor_id?: string; // uuid\n  contenido: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaMisiones {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  propiedad_origen_id?: string; // uuid\n  tipo_mision: TipoMision;\n  tropas: Record<string, any>; // jsonb\n  recursos?: Record<string, any>; // jsonb\n  origen_ciudad: number; // integer\n  origen_barrio: number; // integer\n  origen_edificio: number; // integer\n  destino_ciudad: number; // integer\n  destino_barrio: number; // integer\n  destino_edificio: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_llegada: string; // timestamptz\n  fecha_regreso?: string; // timestamptz\n  velocidad_flota: number; // integer\n  duracion_viaje: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaEventosFlota {\n  id: string; // uuid\n  datos: Record<string, any>; // jsonb\n  estado?: string;\n  fecha_ejecucion?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n}\n\nexport interface InformeBatalla {\n  id: string; // uuid\n  atacante_id?: string; // uuid\n  defensor_id?: string; // uuid\n  coordenada_ciudad: number; // integer\n  coordenada_barrio: number; // integer\n  coordenada_edificio: number; // integer\n  ganador: string;\n  detalles: Record<string, any>; // jsonb\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface InformeEspionaje {\n  id: string; // uuid\n  atacante_id?: string; // uuid\n  defensor_id?: string; // uuid\n  detalles: Record<string, any>; // jsonb\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface Mensaje {\n  id: string; // uuid\n  remitente_id?: string; // uuid\n  destinatario_id?: string; // uuid\n  asunto: string;\n  contenido: string;\n  categoria?: CategoriaMensaje;\n  informe_batalla_id?: string; // uuid\n  informe_espionaje_id?: string; // uuid\n  leido?: boolean;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface AtaqueEntrante {\n  id: string; // uuid\n  defensor_id?: string; // uuid\n  atacante_id?: string; // uuid\n  nombre_atacante: string;\n  propiedad_objetivo: string;\n  total_tropas: number; // integer\n  fecha_llegada: string; // timestamptz\n  mision_id?: string; // uuid\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n"
          },
          {
            "path": "src/types/game.ts",
            "code": "import { z } from 'zod';\nimport { Propiedad, ColaConstruccion as ColaConstruccionDB, AtaqueEntrante, ColaMisiones, Familia, MiembroFamilia } from './database';\n\nexport interface IncomingAttack extends AtaqueEntrante {}\n\nexport interface ActiveMission extends ColaMisiones {}\n\nexport interface FamilyInfo extends MiembroFamilia {\n  familia: Familia | null;\n}\n\nexport interface RecursoDetalle {\n  val: number;\n  max: number;\n  prod: number;\n}\n\nexport interface EdificioDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface TropaDetalle {\n  id: string;\n  cantidad: number;\n  nombre: string;\n}\n\nexport interface InvestigacionDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion: string | null;\n  url_imagen: string;\n  costo_armas: number;\n  costo_municion: number;\n  costo_dolares: number;\n  duracion_reclutamiento: number;\n  ataque: number;\n  defensa: number;\n  capacidad_carga: number;\n  velocidad: number;\n  salario: number;\n  puntos: number;\n  tipo: string;\n  requisitos: Record<string, number> | null;\n  bonus_ataque: string[] | null;\n  bonus_defensa: string[] | null;\n  fecha_creacion: string | null;\n  fecha_actualizacion: string | null;\n}\n\nexport interface ColaDetalle {\n  id: string;\n  habitacion_id?: string;\n  entrenamiento_id?: string;\n  tropa_id?: string;\n  nivel_destino?: number;\n  cantidad?: number;\n  fecha_fin: string;\n  nombre: string;\n}\n\nexport interface Colas {\n  construccion: ColaDetalle[];\n  investigacion: ColaDetalle[];\n  reclutamiento: ColaDetalle[];\n}\n\nexport interface DashboardData {\n  propiedad: Propiedad;\n  recursos: {\n    armas: RecursoDetalle;\n    municion: RecursoDetalle;\n    alcohol: RecursoDetalle;\n    dolares: RecursoDetalle;\n  };\n  edificios: EdificioDetalle[];\n  colas: Colas;\n  tropas: TropaDetalle[];\n  investigaciones: InvestigacionDetalle[];\n  puntos: number;\n  cola_misiones: ActiveMission[];\n  incoming_attacks: IncomingAttack[];\n  tropa_usuario: TropaDetalle[];\n  cola_reclutamiento: ColaDetalle[];\n}\n\nexport interface Recursos {\n  armas: number;\n  municion: number;\n  alcohol: number;\n  dolares: number;\n}\n\nexport interface RespuestaConstruccion {\n  success: boolean;\n  fecha_inicio?: string;\n  fecha_fin?: string;\n  error?: string;\n}\n\nexport type ColaConstruccion = Pick<ColaConstruccionDB, 'id' | 'propiedad_id' | 'habitacion_id' | 'nivel_destino' | 'fecha_fin'>;\n\nexport const IniciarConstruccionSchema = z.object({\n  propiedad_id: z.string().uuid(),\n  habitacion_id: z.string().min(1),\n});\n"
          }
        ]
      }
    ]
  },
  "src/app/dashboard/recruitment/page.tsx": {
    "route": "/dashboard/recruitment",
    "code": "import { createClient } from \"@/lib/supabase/server\";\nimport { getDashboardData, getUserProperty } from \"@/lib/services/game.service\";\nimport { RecruitmentView } from \"@/components/dashboard/recruitment/recruitment-view\";\nimport { ConfiguracionTropa } from \"@/types/game\";\n\nexport default async function RecruitmentPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n      return <div>Acceso denegado</div>;\n  }\n\n  const propertyId = await getUserProperty(user.id);\n\n  if (!propertyId) {\n      return <div>No se encontr\u00f3 propiedad para el usuario.</div>;\n  }\n\n  // Run fetches in parallel\n  const [dashboardData, troopsData] = await Promise.all([\n    getDashboardData(propertyId),\n    supabase.from('configuracion_tropa').select('*').order('costo_dolares', { ascending: true })\n  ]);\n\n  if (!dashboardData) {\n      return <div>Error cargando datos del dashboard.</div>;\n  }\n\n  if (troopsData.error) {\n    console.error('Error fetching troops:', troopsData.error);\n    return <div>Error cargando configuraci\u00f3n de tropas.</div>;\n  }\n\n  const troops = troopsData.data as ConfiguracionTropa[];\n\n  return <RecruitmentView initialData={dashboardData} troops={troops} />;\n}\n",
    "components": [
      {
        "path": "src/components/dashboard/recruitment/recruitment-view.tsx",
        "code": "'use client';\n\nimport { GameStateProvider, useGameState } from \"@/components/providers/game-state-provider\";\nimport { DashboardData, ConfiguracionTropa } from \"@/types/game\";\nimport { TroopCard } from \"./troop-card\";\nimport { RecruitmentQueueList } from \"./recruitment-queue-list\";\n\nfunction RecruitmentContent({ troops }: { troops: ConfiguracionTropa[] }) {\n    const { gameState } = useGameState();\n\n    if (!gameState) return <div>Cargando...</div>;\n\n    const { propiedad, tropas, cola_reclutamiento, recursos } = gameState;\n    const queue = cola_reclutamiento || [];\n\n    // Create a simple resources object from nested structure\n    const currentResources = {\n        armas: recursos.armas.val,\n        municion: recursos.municion.val,\n        alcohol: recursos.alcohol.val,\n        dolares: recursos.dolares.val,\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <RecruitmentQueueList queue={queue} />\n\n            <div className=\"space-y-2\">\n                {troops.map((troop) => {\n                    const myTroop = tropas.find(t => t.id === troop.id);\n                    return (\n                        <TroopCard\n                            key={troop.id}\n                            troop={troop}\n                            currentAmount={myTroop?.cantidad || 0}\n                            resources={currentResources}\n                        />\n                    );\n                })}\n            </div>\n        </div>\n    );\n}\n\nexport function RecruitmentView({ initialData, troops }: { initialData: DashboardData; troops: ConfiguracionTropa[] }) {\n    return (\n        <GameStateProvider initialData={initialData}>\n            <RecruitmentContent troops={troops} />\n        </GameStateProvider>\n    );\n}\n",
        "dependencies": [
          {
            "path": "src/components/dashboard/recruitment/recruitment-queue-list.tsx",
            "code": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ColaDetalle } from \"@/types/game\";\nimport { useEffect, useState } from \"react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Progress } from \"@/components/ui/progress\";\n\ninterface RecruitmentQueueListProps {\n  queue: ColaDetalle[];\n}\n\nexport function RecruitmentQueueList({ queue }: RecruitmentQueueListProps) {\n  const [timeLeft, setTimeLeft] = useState<number>(0);\n\n  useEffect(() => {\n    if (queue.length === 0) return;\n\n    const interval = setInterval(() => {\n      const firstItem = queue[0];\n      const end = new Date(firstItem.fecha_fin).getTime();\n      const now = Date.now();\n      const diff = Math.max(0, Math.floor((end - now) / 1000));\n      setTimeLeft(diff);\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [queue]);\n\n  if (queue.length === 0) {\n    return (\n      <Card className=\"border-primary bg-stone-200 text-black\">\n        <CardHeader className=\"bg-primary/80 py-2 px-4\">\n          <CardTitle className=\"text-lg text-primary-foreground\">\n            Cola de Reclutamiento (0)\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-4 flex flex-col items-center gap-2\">\n          <p className=\"text-sm text-gray-500\">No hay tropas en entrenamiento.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Format time left\n  const hours = Math.floor(timeLeft / 3600);\n  const minutes = Math.floor((timeLeft % 3600) / 60);\n  const seconds = timeLeft % 60;\n  const timeLeftStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4\">\n        <CardTitle className=\"text-lg text-primary-foreground\">\n          Cola de Reclutamiento ({queue.length})\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4 flex flex-col items-center gap-2\">\n        <div className=\"w-full space-y-2\">\n          <Select defaultValue={queue[0]?.id}>\n            <SelectTrigger className=\"w-full bg-white\">\n              <SelectValue placeholder={`${queue.length} procesos activos`} />\n            </SelectTrigger>\n            <SelectContent>\n              {queue.map((item, index) => {\n                // Determine display string for each item\n                // Only the first item is actively processing (usually) in this game logic?\n                // Assuming sequential processing.\n                const isFirst = index === 0;\n                return (\n                  <SelectItem key={item.id} value={item.id} disabled={!isFirst}>\n                    {item.cantidad} {item.nombre} {isFirst ? `- ${timeLeftStr}` : '(En cola)'}\n                  </SelectItem>\n                );\n              })}\n            </SelectContent>\n          </Select>\n          <div className=\"text-xs text-center text-muted-foreground\">\n             Finaliza: {new Date(queue[0].fecha_fin).toLocaleTimeString()}\n          </div>\n          {/* Progress bar could be added here if we knew total duration, but we assume lazy updates or just countdown */}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n"
          },
          {
            "path": "src/components/dashboard/recruitment/troop-card.tsx",
            "code": "'use client';\n\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { Coins, Shell, Droplets } from \"lucide-react\";\nimport { useState, useTransition } from \"react\";\nimport { ConfiguracionTropa, Recursos } from \"@/types/game\";\nimport { recruitTroopsAction } from \"@/lib/actions/recruitment.actions\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype TroopCardProps = {\n  troop: ConfiguracionTropa;\n  currentAmount: number;\n  resources: Recursos;\n};\n\nconst ResourceIcon = ({ type }: { type: string }) => {\n    switch (type) {\n        case 'Armas': return <Shell className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Municion': return <Coins className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Alcohol': return <Droplets className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Dolares': return <p className=\"text-lg font-bold text-green-600 inline-block ml-1\">$</p>;\n        default: return null;\n    }\n}\n\nexport function TroopCard({ troop, currentAmount, resources }: TroopCardProps) {\n  // Use a fallback image if 'troop.url_imagen' is not in PlaceHolderImages logic or use direct URL\n  // Assuming PlaceHolderImages has logic for IDs. If `url_imagen` is a filename like 'troop-porteador', we use it.\n  // The DB `url_imagen` might be 'troop-porteador'.\n  const image = PlaceHolderImages.find((p) => p.id === troop.url_imagen) || PlaceHolderImages.find(p => p.id === 'dark-alley');\n  \n  const [amount, setAmount] = useState<number | ''>('');\n  const [isPending, startTransition] = useTransition();\n  const { toast } = useToast();\n\n  const calculateMax = () => {\n    let max = Infinity;\n    if (troop.costo_armas > 0) max = Math.min(max, Math.floor(resources.armas / troop.costo_armas));\n    if (troop.costo_municion > 0) max = Math.min(max, Math.floor(resources.municion / troop.costo_municion));\n    if (troop.costo_dolares > 0) max = Math.min(max, Math.floor(resources.dolares / troop.costo_dolares));\n    // Alcohol is not usually a cost for troops unless specified, but schema doesn't have it.\n    // Wait, schema has `costo_armas`, `costo_municion`, `costo_dolares`. No alcohol cost in schema.\n    \n    return max === Infinity ? 0 : max;\n  };\n\n  const maxRecruitable = calculateMax();\n\n  const handleRecruit = async () => {\n    const quantity = Number(amount);\n    if (!quantity || quantity <= 0) return;\n\n    if (quantity > maxRecruitable) {\n        toast({ title: \"Error\", description: \"No tienes suficientes recursos.\", variant: \"destructive\" });\n        return;\n    }\n\n    startTransition(async () => {\n        const result = await recruitTroopsAction(troop.id, quantity);\n        if (result.success) {\n            toast({ title: \"Reclutamiento iniciado\", description: `Reclutando ${quantity} ${troop.nombre}.` });\n            setAmount('');\n        } else {\n            toast({ title: \"Error\", description: result.error || \"Error desconocido\", variant: \"destructive\" });\n        }\n    });\n  };\n\n  // Format duration\n  const formatDuration = (seconds: number) => {\n    const h = Math.floor(seconds / 3600);\n    const m = Math.floor((seconds % 3600) / 60);\n    const s = seconds % 60;\n    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"bg-stone-200 text-black p-4 rounded-md border border-primary/50 flex flex-col items-start gap-4\">\n        <div className=\"flex justify-between w-full\">\n            <h3 className=\"font-bold text-lg text-primary\">{troop.nombre}</h3>\n            <span className=\"text-sm font-bold bg-white/50 px-2 py-1 rounded\">Disponibles: {currentAmount}</span>\n        </div>\n        <div className=\"flex flex-col md:flex-row gap-4 w-full\">\n            <div className=\"flex-shrink-0 w-24\">\n                {image && (\n                    <Image\n                        src={image.imageUrl}\n                        alt={troop.nombre}\n                        width={100}\n                        height={100}\n                        className=\"rounded w-full h-auto object-cover\"\n                    />\n                )}\n                <p className=\"text-xs text-center mt-1\">{formatDuration(troop.duracion_reclutamiento)}</p>\n            </div>\n            <div className=\"flex-1\">\n                <p className=\"text-sm mb-2\">{troop.descripcion}</p>\n                <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm border-t border-b border-black/10 py-2\">\n                    {troop.costo_armas > 0 && (\n                        <div className=\"flex items-center\">\n                            <span>Armas: {troop.costo_armas}</span>\n                            <ResourceIcon type=\"Armas\" />\n                        </div>\n                    )}\n                    {troop.costo_municion > 0 && (\n                        <div className=\"flex items-center\">\n                            <span>Munici\u00f3n: {troop.costo_municion}</span>\n                            <ResourceIcon type=\"Municion\" />\n                        </div>\n                    )}\n                     {troop.costo_dolares > 0 && (\n                        <div className=\"flex items-center\">\n                            <span>D\u00f3lares: {troop.costo_dolares}</span>\n                            <ResourceIcon type=\"Dolares\" />\n                        </div>\n                    )}\n                </div>\n                 <div className=\"mt-2 text-xs flex gap-2 text-muted-foreground\">\n                    <span>ATK: {troop.ataque}</span>\n                    <span>DEF: {troop.defensa}</span>\n                    <span>VEL: {troop.velocidad}</span>\n                    <span>CAP: {troop.capacidad_carga}</span>\n                </div>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n                <Input\n                    type=\"number\"\n                    placeholder=\"0\"\n                    className=\"w-20 h-8 text-sm text-center\"\n                    value={amount}\n                    onChange={(e) => setAmount(Number(e.target.value))}\n                    min={1}\n                    max={maxRecruitable}\n                />\n                <div className=\"flex gap-1\">\n                    <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"bg-accent hover:bg-accent/90 h-8 text-xs\"\n                        onClick={handleRecruit}\n                        disabled={isPending || !amount || Number(amount) <= 0 || Number(amount) > maxRecruitable}\n                    >\n                        {isPending ? \"...\" : \"Reclutar\"}\n                    </Button>\n                    <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"h-8 text-xs\"\n                        onClick={() => setAmount(maxRecruitable)}\n                        disabled={maxRecruitable === 0}\n                    >\n                        Max ({maxRecruitable})\n                    </Button>\n                </div>\n            </div>\n        </div>\n    </div>\n  );\n}\n"
          },
          {
            "path": "src/components/providers/game-state-provider.tsx",
            "code": "'use client';\n\nimport React, { createContext, useContext, ReactNode } from 'react';\nimport { DashboardData } from '@/types/game';\nimport { useGameRealtime } from '@/hooks/use-game-realtime';\n\ninterface GameStateContextType {\n  gameState: DashboardData | null;\n}\n\nconst GameStateContext = createContext<GameStateContextType | undefined>(undefined);\n\ninterface GameStateProviderProps {\n  initialData: DashboardData | null;\n  children: ReactNode;\n}\n\nexport function GameStateProvider({ initialData, children }: GameStateProviderProps) {\n  const gameState = useGameRealtime(initialData);\n\n  return (\n    <GameStateContext.Provider value={{ gameState }}>\n      {children}\n    </GameStateContext.Provider>\n  );\n}\n\nexport function useGameState() {\n  const context = useContext(GameStateContext);\n  if (context === undefined) {\n    throw new Error('useGameState must be used within a GameStateProvider');\n  }\n  return context;\n}\n"
          },
          {
            "path": "src/types/game.ts",
            "code": "import { z } from 'zod';\nimport { Propiedad, ColaConstruccion as ColaConstruccionDB, AtaqueEntrante, ColaMisiones, Familia, MiembroFamilia } from './database';\n\nexport interface IncomingAttack extends AtaqueEntrante {}\n\nexport interface ActiveMission extends ColaMisiones {}\n\nexport interface FamilyInfo extends MiembroFamilia {\n  familia: Familia | null;\n}\n\nexport interface RecursoDetalle {\n  val: number;\n  max: number;\n  prod: number;\n}\n\nexport interface EdificioDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface TropaDetalle {\n  id: string;\n  cantidad: number;\n  nombre: string;\n}\n\nexport interface InvestigacionDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion: string | null;\n  url_imagen: string;\n  costo_armas: number;\n  costo_municion: number;\n  costo_dolares: number;\n  duracion_reclutamiento: number;\n  ataque: number;\n  defensa: number;\n  capacidad_carga: number;\n  velocidad: number;\n  salario: number;\n  puntos: number;\n  tipo: string;\n  requisitos: Record<string, number> | null;\n  bonus_ataque: string[] | null;\n  bonus_defensa: string[] | null;\n  fecha_creacion: string | null;\n  fecha_actualizacion: string | null;\n}\n\nexport interface ColaDetalle {\n  id: string;\n  habitacion_id?: string;\n  entrenamiento_id?: string;\n  tropa_id?: string;\n  nivel_destino?: number;\n  cantidad?: number;\n  fecha_fin: string;\n  nombre: string;\n}\n\nexport interface Colas {\n  construccion: ColaDetalle[];\n  investigacion: ColaDetalle[];\n  reclutamiento: ColaDetalle[];\n}\n\nexport interface DashboardData {\n  propiedad: Propiedad;\n  recursos: {\n    armas: RecursoDetalle;\n    municion: RecursoDetalle;\n    alcohol: RecursoDetalle;\n    dolares: RecursoDetalle;\n  };\n  edificios: EdificioDetalle[];\n  colas: Colas;\n  tropas: TropaDetalle[];\n  investigaciones: InvestigacionDetalle[];\n  puntos: number;\n  cola_misiones: ActiveMission[];\n  incoming_attacks: IncomingAttack[];\n  tropa_usuario: TropaDetalle[];\n  cola_reclutamiento: ColaDetalle[];\n}\n\nexport interface Recursos {\n  armas: number;\n  municion: number;\n  alcohol: number;\n  dolares: number;\n}\n\nexport interface RespuestaConstruccion {\n  success: boolean;\n  fecha_inicio?: string;\n  fecha_fin?: string;\n  error?: string;\n}\n\nexport type ColaConstruccion = Pick<ColaConstruccionDB, 'id' | 'propiedad_id' | 'habitacion_id' | 'nivel_destino' | 'fecha_fin'>;\n\nexport const IniciarConstruccionSchema = z.object({\n  propiedad_id: z.string().uuid(),\n  habitacion_id: z.string().min(1),\n});\n"
          }
        ]
      }
    ]
  },
  "src/app/dashboard/tech-tree/page.tsx": {
    "route": "/dashboard/tech-tree",
    "code": "\nimport { createClient } from '@/lib/supabase/server'\nimport { getDashboardData } from '@/lib/services/game.service'\nimport { TechTreeView } from '@/components/dashboard/tech-tree/tech-tree-view'\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\"\nimport { Construction } from 'lucide-react'\nimport { Recursos } from '@/types/game'\nimport { ColaInvestigacion } from '@/types/database'\n\nexport default async function TechTreePage() {\n  const supabase = await createClient()\n\n  // 1. Get user property\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) return <div>No user found</div>\n\n  const { data: prop } = await supabase\n    .from('propiedad')\n    .select('id')\n    .eq('usuario_id', user.id)\n    .maybeSingle()\n\n  if (!prop) return <div>No property found</div>\n\n  // 2. Fetch Dashboard Data (User Progress, Resources, Queue)\n  const dashboardData = await getDashboardData(prop.id)\n\n  // 3. Fetch Static Configs\n  const { data: configs } = await supabase\n    .from('configuracion_entrenamiento')\n    .select('*')\n    .order('nombre')\n\n  // 4. Fetch Requirements\n  const { data: requirements } = await supabase\n    .from('requisito_entrenamiento')\n    .select('*')\n\n  // 5. Fetch Active Queue specifically for this property if not fully reliable from dashboardData\n  const { data: realQueue } = await supabase\n      .from('cola_investigacion')\n      .select('*')\n      .eq('propiedad_id', prop.id)\n      .maybeSingle()\n\n  if (!dashboardData || !configs) {\n    return (\n        <Alert variant=\"destructive\">\n            <AlertTitle>Error</AlertTitle>\n            <AlertDescription>No se pudieron cargar los datos.</AlertDescription>\n        </Alert>\n    )\n  }\n\n  // Transform Resources\n  const simpleResources: Recursos = {\n      armas: dashboardData.recursos.armas.val,\n      municion: dashboardData.recursos.municion.val,\n      alcohol: dashboardData.recursos.alcohol.val,\n      dolares: dashboardData.recursos.dolares.val\n  }\n\n  return (\n    <div className=\"space-y-4\">\n        <Card className=\"border-primary bg-stone-200 text-black\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4 flex flex-row items-center gap-2\">\n                <Construction className=\"w-6 h-6 text-primary-foreground\" />\n                <CardTitle className=\"text-lg text-primary-foreground\">\n                    Centro de Investigaci\u00f3n (Tech Tree)\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n               <TechTreeView \n                  configs={configs}\n                  requirements={requirements || []}\n                  userResearch={dashboardData.investigaciones || []}\n                  queue={realQueue as ColaInvestigacion | null} \n                  activeQueueItem={realQueue as ColaInvestigacion}\n                  resources={simpleResources}\n                  propertyId={prop.id}\n               />\n            </CardContent>\n        </Card>\n    </div>\n  )\n}\n",
    "components": [
      {
        "path": "src/components/dashboard/tech-tree/tech-tree-view.tsx",
        "code": "'use client'\n\nimport { TechCard } from './tech-card'\nimport { ConfiguracionEntrenamiento, RequisitoEntrenamiento, ColaInvestigacion } from '@/types/database'\nimport { Recursos, InvestigacionDetalle } from '@/types/game' \nimport { ScrollArea } from '@/components/ui/scroll-area'\n\ninterface TechTreeViewProps {\n  configs: ConfiguracionEntrenamiento[]\n  requirements: RequisitoEntrenamiento[]\n  userResearch: InvestigacionDetalle[]\n  queue: ColaInvestigacion | null \n  activeQueueItem?: ColaInvestigacion \n  resources: Recursos\n  propertyId: string\n}\n\nexport function TechTreeView({\n  configs,\n  requirements,\n  userResearch,\n  activeQueueItem,\n  resources,\n  propertyId\n}: TechTreeViewProps) {\n\n  // Helper to find current level\n  const getLevel = (techId: string) => {\n    const research = userResearch.find(r => r.id === techId)\n    return research ? research.nivel : 0\n  }\n\n  // Helper to check requirements\n  const checkRequirements = (techId: string) => {\n    const techReqs = requirements.filter(r => r.entrenamiento_id === techId)\n    if (techReqs.length === 0) return { met: true, texts: [] }\n\n    const missing: string[] = []\n    \n    for (const req of techReqs) {\n      if (req.entrenamiento_requerido_id) {\n        const currentLvl = getLevel(req.entrenamiento_requerido_id)\n        if (currentLvl < (req.nivel_requerido || 1)) {\n           const reqConfig = configs.find(c => c.id === req.entrenamiento_requerido_id)\n           const reqName = reqConfig ? reqConfig.nombre : req.entrenamiento_requerido_id\n           missing.push(`${reqName} (Nvl ${req.nivel_requerido})`)\n        }\n      }\n    }\n\n    return {\n      met: missing.length === 0,\n      texts: missing\n    }\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-4\">\n      {configs.map(config => {\n        const level = getLevel(config.id)\n        const reqStatus = checkRequirements(config.id)\n        const queueItem = activeQueueItem && activeQueueItem.entrenamiento_id === config.id ? activeQueueItem : undefined\n        \n        return (\n          <TechCard\n            key={config.id}\n            config={config}\n            level={level}\n            queueItem={queueItem}\n            resources={resources}\n            requirementsMet={reqStatus.met}\n            requirementsText={reqStatus.texts}\n            propertyId={propertyId}\n            queueFull={!!activeQueueItem && activeQueueItem.entrenamiento_id !== config.id}\n          />\n        )\n      })}\n    </div>\n  )\n}\n",
        "dependencies": [
          {
            "path": "src/components/dashboard/tech-tree/tech-card.tsx",
            "code": "'use client'\n\nimport { useTransition } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Progress } from '@/components/ui/progress'\nimport { startResearchAction } from '@/lib/actions/research.actions'\nimport { useToast } from '@/hooks/use-toast'\nimport { ConfiguracionEntrenamiento, ColaInvestigacion } from '@/types/database'\nimport { Recursos } from '@/types/game'\nimport { Loader2, Lock, Clock, Pickaxe, Shield, Sword } from 'lucide-react'\nimport Image from 'next/image'\n\ninterface TechCardProps {\n  config: ConfiguracionEntrenamiento\n  level: number\n  queueItem?: ColaInvestigacion\n  resources: Recursos\n  requirementsMet: boolean\n  requirementsText: string[]\n  propertyId: string\n  queueFull: boolean\n}\n\nexport function TechCard({\n  config,\n  level,\n  queueItem,\n  resources,\n  requirementsMet,\n  requirementsText,\n  propertyId,\n  queueFull\n}: TechCardProps) {\n  const [isPending, startTransition] = useTransition()\n  const { toast } = useToast()\n\n  const canAfford = \n    resources.armas >= (config.costo_armas || 0) &&\n    resources.municion >= (config.costo_municion || 0) &&\n    resources.dolares >= (config.costo_dolares || 0)\n\n  const isResearching = !!queueItem\n  \n  // Calculate progress if researching\n  const calculateProgress = () => {\n    if (!queueItem) return 0\n    const start = new Date(queueItem.fecha_inicio).getTime()\n    const end = new Date(queueItem.fecha_fin).getTime()\n    const now = new Date().getTime()\n    const total = end - start\n    const current = now - start\n    return Math.min(Math.max((current / total) * 100, 0), 100)\n  }\n\n  const handleStartResearch = () => {\n    startTransition(async () => {\n      const result = await startResearchAction(propertyId, config.id)\n      if (result.success) {\n        toast({\n          title: \"Investigaci\u00f3n iniciada\",\n          description: `Se ha iniciado la investigaci\u00f3n de ${config.nombre}`,\n        })\n      } else {\n        toast({\n          title: \"Error\",\n          description: result.error,\n          variant: \"destructive\"\n        })\n      }\n    })\n  }\n\n  const formatDuration = (seconds: number) => {\n    const h = Math.floor(seconds / 3600)\n    const m = Math.floor((seconds % 3600) / 60)\n    const s = seconds % 60\n    return `${h > 0 ? h + 'h ' : ''}${m}m ${s}s`\n  }\n\n  return (\n    <Card className={`relative overflow-hidden ${!requirementsMet ? 'opacity-75 bg-stone-100' : ''}`}>\n      {!requirementsMet && (\n        <div className=\"absolute inset-0 bg-stone-900/10 z-10 pointer-events-none flex items-center justify-center\">\n          <Lock className=\"w-12 h-12 text-stone-500 opacity-20\" />\n        </div>\n      )}\n      \n      <CardHeader className=\"pb-2\">\n        <div className=\"flex justify-between items-start\">\n          <CardTitle className=\"text-lg font-bold truncate\">{config.nombre}</CardTitle>\n          <Badge variant={level > 0 ? \"default\" : \"secondary\"}>\n            Nvl {level}\n          </Badge>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        <div className=\"relative aspect-video w-full overflow-hidden rounded-md bg-stone-200\">\n           {/* Placeholder or Image */}\n           <div className=\"absolute inset-0 flex items-center justify-center text-stone-400\">\n             {config.url_imagen ? (\n                <Image \n                  src={`/images/${config.url_imagen}.jpg`} \n                  alt={config.nombre}\n                  fill\n                  className=\"object-cover\"\n                  onError={(e) => {\n                    // Fallback if image fails\n                    (e.target as HTMLImageElement).style.display = 'none'\n                  }}\n                />\n             ) : (\n                <Pickaxe className=\"w-10 h-10\" />\n             )}\n           </div>\n           \n           {isResearching && (\n             <div className=\"absolute inset-0 bg-black/60 flex flex-col items-center justify-center p-4\">\n                <span className=\"text-white text-sm font-medium mb-2\">Investigando...</span>\n                <Progress value={calculateProgress()} className=\"h-2 w-full\" />\n                <span className=\"text-white text-xs mt-1\">\n                   {formatDuration((config.duracion_entrenamiento || 0))}\n                </span>\n             </div>\n           )}\n        </div>\n\n        <div className=\"space-y-2 text-sm\">\n          {config.costo_armas && config.costo_armas > 0 ? (\n            <div className={`flex justify-between ${resources.armas < config.costo_armas ? 'text-red-500' : ''}`}>\n              <span className=\"flex items-center gap-1\"><Sword className=\"w-3 h-3\"/> Armas</span>\n              <span>{config.costo_armas.toLocaleString()}</span>\n            </div>\n          ) : null}\n          \n          {config.costo_municion && config.costo_municion > 0 ? (\n            <div className={`flex justify-between ${resources.municion < config.costo_municion ? 'text-red-500' : ''}`}>\n               <span className=\"flex items-center gap-1\"><Shield className=\"w-3 h-3\"/> Munici\u00f3n</span>\n               <span>{config.costo_municion.toLocaleString()}</span>\n            </div>\n          ) : null}\n          \n          {config.costo_dolares && config.costo_dolares > 0 ? (\n            <div className={`flex justify-between ${resources.dolares < config.costo_dolares ? 'text-red-500' : ''}`}>\n               <span className=\"flex items-center gap-1\">$ D\u00f3lares</span>\n               <span>{config.costo_dolares.toLocaleString()}</span>\n            </div>\n          ) : null}\n\n          <div className=\"flex justify-between text-stone-500\">\n             <span className=\"flex items-center gap-1\"><Clock className=\"w-3 h-3\"/> Tiempo</span>\n             <span>{formatDuration(config.duracion_entrenamiento || 0)}</span>\n          </div>\n        </div>\n\n        {!requirementsMet && requirementsText.length > 0 && (\n           <div className=\"text-xs text-red-500 mt-2 bg-red-50 p-2 rounded\">\n             <p className=\"font-semibold mb-1\">Requisitos:</p>\n             <ul className=\"list-disc list-inside\">\n               {requirementsText.map((req, i) => (\n                 <li key={i}>{req}</li>\n               ))}\n             </ul>\n           </div>\n        )}\n      </CardContent>\n\n      <CardFooter>\n        <Button \n          className=\"w-full\" \n          onClick={handleStartResearch}\n          disabled={!requirementsMet || !canAfford || isResearching || queueFull || isPending}\n        >\n          {isPending ? (\n            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n          ) : isResearching ? (\n            \"En Progreso\"\n          ) : (\n            \"Investigar\"\n          )}\n        </Button>\n      </CardFooter>\n    </Card>\n  )\n}\n"
          },
          {
            "path": "src/types/database.ts",
            "code": "// src/types/database.ts\n\n// Enums\nexport type EstadoInvitacion = 'pendiente' | 'aceptada' | 'rechazada';\n// Alias for typo compatibility if needed, though strictly we should use the correct one.\nexport type EstadoInvaticion = EstadoInvitacion; \n\nexport type RolFamilia = 'miembro' | 'capitan' | 'lider';\nexport type CategoriaMensaje = 'jugador' | 'familia' | 'sistema' | 'batalla' | 'espionaje';\nexport type EstadoFlota = 'en_camino' | 'regresando' | 'estacionada' | 'combatiendo';\nexport type TipoMision = 'atacar' | 'transportar' | 'espiar' | 'colonizar' | 'recolectar';\n\n// Interfaces for Tables\nexport interface Usuario {\n  id: string; // uuid\n  nombre_usuario: string;\n  email: string;\n  url_avatar?: string;\n  nombre?: string;\n  titulo?: string;\n  rol?: string;\n  primer_login?: boolean;\n  ultimo_visto?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface HistorialAcceso {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  fecha_acceso?: string; // timestamptz\n  direccion_ip?: string;\n  agente_usuario?: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface PuntuacionUsuario {\n  usuario_id: string; // uuid\n  puntos_habitaciones?: number; // real\n  puntos_tropas?: number; // real\n  puntos_entrenamientos?: number; // real\n  puntos_totales?: number; // real\n  puntos_honor_atacante?: number; // real\n  puntos_honor_defensor?: number; // real\n  puntos_honor_totales?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ErroresConfiguracion {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  mensaje_error?: string;\n  fecha_creacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionHabitacion {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_construccion?: number; // integer\n  produccion_base?: number; // real\n  recurso_producido?: string;\n  puntos?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionEntrenamiento {\n  id: string;\n  nombre: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_entrenamiento?: number; // integer\n  puntos?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_reclutamiento?: number; // integer\n  ataque?: number; // integer\n  defensa?: number; // integer\n  capacidad_carga?: number; // integer\n  velocidad?: number; // bigint\n  salario?: number; // integer\n  puntos?: number; // real\n  tipo: string;\n  requisitos?: Record<string, any>; // jsonb\n  bonus_ataque?: string[];\n  bonus_defensa?: string[];\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface RequisitoHabitacion {\n  id: string; // uuid\n  habitacion_id?: string;\n  habitacion_requerida_id?: string;\n  nivel_requerido?: number; // integer\n}\n\nexport interface RequisitoEntrenamiento {\n  id: string; // uuid\n  entrenamiento_id?: string;\n  entrenamiento_requerido_id?: string;\n  nivel_requerido?: number; // integer\n}\n\nexport interface TropaBonusContrincante {\n  id: string; // uuid\n  tropa_atacante_id?: string;\n  tropa_defensora_id?: string;\n  factor_prioridad?: number; // real\n}\n\nexport interface Propiedad {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  nombre: string;\n  coordenada_ciudad: number; // integer\n  coordenada_barrio: number; // integer\n  coordenada_edificio: number; // integer\n  armas?: number; // bigint\n  municion?: number; // bigint\n  alcohol?: number; // bigint\n  dolares?: number; // bigint\n  ultima_recogida_recursos?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface HabitacionUsuario {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  habitacion_id?: string;\n  nivel?: number; // smallint\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface TropaPropiedad {\n  propiedad_id: string; // uuid\n  tropa_id: string;\n  cantidad?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface TropaSeguridadPropiedad {\n  propiedad_id: string; // uuid\n  tropa_id: string;\n  cantidad?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface EntrenamientoUsuario {\n  usuario_id: string; // uuid\n  entrenamiento_id: string;\n  nivel?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaConstruccion {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  habitacion_id?: string;\n  nivel_destino: number; // integer\n  duracion_segundos: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaInvestigacion {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  propiedad_id?: string; // uuid\n  entrenamiento_id?: string;\n  nivel_destino: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaReclutamiento {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  tropa_id?: string;\n  cantidad: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface Familia {\n  id: string; // uuid\n  nombre: string;\n  etiqueta: string;\n  descripcion?: string;\n  url_avatar?: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface MiembroFamilia {\n  usuario_id: string; // uuid\n  familia_id?: string; // uuid\n  rol?: RolFamilia;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface InvitacionFamilia {\n  id: string; // uuid\n  familia_id?: string; // uuid\n  usuario_id?: string; // uuid\n  tipo: string;\n  estado?: EstadoInvitacion;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface AnuncioFamilia {\n  id: string; // uuid\n  familia_id?: string; // uuid\n  autor_id?: string; // uuid\n  contenido: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaMisiones {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  propiedad_origen_id?: string; // uuid\n  tipo_mision: TipoMision;\n  tropas: Record<string, any>; // jsonb\n  recursos?: Record<string, any>; // jsonb\n  origen_ciudad: number; // integer\n  origen_barrio: number; // integer\n  origen_edificio: number; // integer\n  destino_ciudad: number; // integer\n  destino_barrio: number; // integer\n  destino_edificio: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_llegada: string; // timestamptz\n  fecha_regreso?: string; // timestamptz\n  velocidad_flota: number; // integer\n  duracion_viaje: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaEventosFlota {\n  id: string; // uuid\n  datos: Record<string, any>; // jsonb\n  estado?: string;\n  fecha_ejecucion?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n}\n\nexport interface InformeBatalla {\n  id: string; // uuid\n  atacante_id?: string; // uuid\n  defensor_id?: string; // uuid\n  coordenada_ciudad: number; // integer\n  coordenada_barrio: number; // integer\n  coordenada_edificio: number; // integer\n  ganador: string;\n  detalles: Record<string, any>; // jsonb\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface InformeEspionaje {\n  id: string; // uuid\n  atacante_id?: string; // uuid\n  defensor_id?: string; // uuid\n  detalles: Record<string, any>; // jsonb\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface Mensaje {\n  id: string; // uuid\n  remitente_id?: string; // uuid\n  destinatario_id?: string; // uuid\n  asunto: string;\n  contenido: string;\n  categoria?: CategoriaMensaje;\n  informe_batalla_id?: string; // uuid\n  informe_espionaje_id?: string; // uuid\n  leido?: boolean;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface AtaqueEntrante {\n  id: string; // uuid\n  defensor_id?: string; // uuid\n  atacante_id?: string; // uuid\n  nombre_atacante: string;\n  propiedad_objetivo: string;\n  total_tropas: number; // integer\n  fecha_llegada: string; // timestamptz\n  mision_id?: string; // uuid\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n"
          },
          {
            "path": "src/types/game.ts",
            "code": "import { z } from 'zod';\nimport { Propiedad, ColaConstruccion as ColaConstruccionDB, AtaqueEntrante, ColaMisiones, Familia, MiembroFamilia } from './database';\n\nexport interface IncomingAttack extends AtaqueEntrante {}\n\nexport interface ActiveMission extends ColaMisiones {}\n\nexport interface FamilyInfo extends MiembroFamilia {\n  familia: Familia | null;\n}\n\nexport interface RecursoDetalle {\n  val: number;\n  max: number;\n  prod: number;\n}\n\nexport interface EdificioDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface TropaDetalle {\n  id: string;\n  cantidad: number;\n  nombre: string;\n}\n\nexport interface InvestigacionDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion: string | null;\n  url_imagen: string;\n  costo_armas: number;\n  costo_municion: number;\n  costo_dolares: number;\n  duracion_reclutamiento: number;\n  ataque: number;\n  defensa: number;\n  capacidad_carga: number;\n  velocidad: number;\n  salario: number;\n  puntos: number;\n  tipo: string;\n  requisitos: Record<string, number> | null;\n  bonus_ataque: string[] | null;\n  bonus_defensa: string[] | null;\n  fecha_creacion: string | null;\n  fecha_actualizacion: string | null;\n}\n\nexport interface ColaDetalle {\n  id: string;\n  habitacion_id?: string;\n  entrenamiento_id?: string;\n  tropa_id?: string;\n  nivel_destino?: number;\n  cantidad?: number;\n  fecha_fin: string;\n  nombre: string;\n}\n\nexport interface Colas {\n  construccion: ColaDetalle[];\n  investigacion: ColaDetalle[];\n  reclutamiento: ColaDetalle[];\n}\n\nexport interface DashboardData {\n  propiedad: Propiedad;\n  recursos: {\n    armas: RecursoDetalle;\n    municion: RecursoDetalle;\n    alcohol: RecursoDetalle;\n    dolares: RecursoDetalle;\n  };\n  edificios: EdificioDetalle[];\n  colas: Colas;\n  tropas: TropaDetalle[];\n  investigaciones: InvestigacionDetalle[];\n  puntos: number;\n  cola_misiones: ActiveMission[];\n  incoming_attacks: IncomingAttack[];\n  tropa_usuario: TropaDetalle[];\n  cola_reclutamiento: ColaDetalle[];\n}\n\nexport interface Recursos {\n  armas: number;\n  municion: number;\n  alcohol: number;\n  dolares: number;\n}\n\nexport interface RespuestaConstruccion {\n  success: boolean;\n  fecha_inicio?: string;\n  fecha_fin?: string;\n  error?: string;\n}\n\nexport type ColaConstruccion = Pick<ColaConstruccionDB, 'id' | 'propiedad_id' | 'habitacion_id' | 'nivel_destino' | 'fecha_fin'>;\n\nexport const IniciarConstruccionSchema = z.object({\n  propiedad_id: z.string().uuid(),\n  habitacion_id: z.string().min(1),\n});\n"
          }
        ]
      },
      {
        "path": "src/components/ui/alert.tsx",
        "code": "import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n",
        "dependencies": []
      },
      {
        "path": "src/components/ui/card.tsx",
        "code": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n",
        "dependencies": []
      }
    ]
  },
  "src/app/dashboard/rooms/page.tsx": {
    "route": "/dashboard/rooms",
    "code": "import { createClient } from \"@/lib/supabase/server\";\nimport { getDashboardData, getUserProperty } from \"@/lib/services/game.service\";\nimport { RoomsView } from \"@/components/dashboard/rooms/rooms-view\";\n\nexport default async function RoomsPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n      return <div>Acceso denegado</div>;\n  }\n\n  const propertyId = await getUserProperty(user.id);\n\n  if (!propertyId) {\n      return <div>No se encontr\u00f3 propiedad para el usuario.</div>;\n  }\n\n  const dashboardData = await getDashboardData(propertyId);\n\n  if (!dashboardData) {\n      return <div>Error cargando datos.</div>;\n  }\n\n  return <RoomsView initialData={dashboardData} />;\n}\n",
    "components": [
      {
        "path": "src/components/dashboard/rooms/rooms-view.tsx",
        "code": "'use client';\n\nimport { GameStateProvider, useGameState } from \"@/components/providers/game-state-provider\";\nimport { DashboardData } from \"@/types/game\";\nimport { roomsData } from \"@/lib/data/rooms-data\";\nimport { RoomCard } from \"./room-card\";\nimport { ConstructionQueueList } from \"./construction-queue-list\";\nimport { MAX_CONSTRUCTION_QUEUE_SIZE } from \"@/lib/constants\";\n\n// Inner component that consumes hook\nfunction RoomsContent() {\n    const { gameState } = useGameState();\n\n    if (!gameState) return <div>Cargando...</div>;\n\n    const { propiedad, edificios, colas } = gameState;\n    const queueLength = colas.construccion.length;\n    const isQueueFull = queueLength >= MAX_CONSTRUCTION_QUEUE_SIZE;\n\n    return (\n      <div className=\"space-y-6\">\n          <ConstructionQueueList queue={colas.construccion} />\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4 md:gap-6\">\n            {roomsData.map((room) => {\n                // Find dynamic data\n                // Match room.id with edificios.id\n                const edificio = edificios.find(e => e.id === room.id);\n                // Match room.id with colas.construccion.habitacion_id\n                const construction = colas.construccion.find(c => c.habitacion_id === room.id);\n\n                return (\n                  <RoomCard\n                    key={room.id}\n                    room={room}\n                    propiedadId={propiedad.id}\n                    dynamicLevel={edificio?.nivel || 0}\n                    construction={construction}\n                    isQueueFull={isQueueFull}\n                  />\n                );\n            })}\n          </div>\n      </div>\n    );\n}\n\nexport function RoomsView({ initialData }: { initialData: DashboardData }) {\n    return (\n        <GameStateProvider initialData={initialData}>\n            <div className=\"space-y-4 md:space-y-6\">\n                <div className=\"bg-primary text-primary-foreground text-center py-3 rounded-sm shadow-sm\">\n                    <h1 className=\"text-xl md:text-2xl font-bold tracking-wide\">Gesti\u00f3n de Habitaciones</h1>\n                </div>\n                <RoomsContent />\n            </div>\n        </GameStateProvider>\n    );\n}\n",
        "dependencies": [
          {
            "path": "src/components/dashboard/rooms/construction-queue-list.tsx",
            "code": "'use client';\n\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Clock, Hammer } from \"lucide-react\";\nimport { ColaDetalle } from \"@/types/game\";\nimport { useEffect, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ConstructionQueueListProps {\n  queue: ColaDetalle[];\n  limit?: number;\n  compact?: boolean;\n}\n\nexport function ConstructionQueueList({ queue, limit, compact = false }: ConstructionQueueListProps) {\n  const [now, setNow] = useState<number>(Date.now());\n\n  useEffect(() => {\n    if (queue.length === 0) return;\n    const interval = setInterval(() => setNow(Date.now()), 1000);\n    return () => clearInterval(interval);\n  }, [queue.length]);\n\n  if (!queue || queue.length === 0) {\n    if (compact) {\n        return (\n            <Card className=\"border-dashed border-stone-300 bg-stone-50/50 shadow-none\">\n                <CardContent className=\"p-4 text-center text-sm text-muted-foreground flex flex-col items-center gap-2\">\n                    <Hammer className=\"w-4 h-4 opacity-50\" />\n                    <span>Cola de construcci\u00f3n vac\u00eda</span>\n                </CardContent>\n            </Card>\n        )\n    }\n    return null;\n  }\n\n  const displayQueue = limit ? queue.slice(0, limit) : queue;\n\n  return (\n    <Card className={cn(\"border-amber-500/30 bg-amber-950/10\", compact && \"shadow-sm\")}>\n      <CardContent className={cn(\"space-y-3\", compact ? \"p-3\" : \"p-4\")}>\n        <div className=\"flex items-center gap-2 mb-2\">\n            <Hammer className={cn(\"text-amber-600\", compact ? \"w-4 h-4\" : \"w-5 h-5\")} />\n            <h3 className={cn(\"font-bold text-amber-800 dark:text-amber-500\", compact ? \"text-sm\" : \"\")}>\n                Cola de Construcci\u00f3n\n            </h3>\n            <Badge variant=\"outline\" className=\"ml-auto border-amber-500/50 text-amber-700 dark:text-amber-400\">\n                {queue.length} / 5\n            </Badge>\n        </div>\n        \n        <div className={cn(\"grid gap-3\", compact ? \"grid-cols-1\" : \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5\")}>\n            {displayQueue.map((item) => {\n                const endTime = new Date(item.fecha_fin).getTime();\n                const timeLeft = Math.max(0, endTime - now);\n                const secondsLeft = Math.floor(timeLeft / 1000);\n                \n                const hours = Math.floor(secondsLeft / 3600);\n                const minutes = Math.floor((secondsLeft % 3600) / 60);\n                const seconds = secondsLeft % 60;\n                \n                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n\n                return (\n                    <div key={item.id} className=\"bg-card border border-border/50 rounded p-2 flex flex-col gap-1 shadow-sm\">\n                        <div className=\"flex justify-between items-start\">\n                            <span className={cn(\"font-semibold truncate pr-2\", compact ? \"text-xs\" : \"text-sm\")}>{item.nombre}</span>\n                            <span className=\"text-xs font-mono bg-muted px-1 rounded\">{timeString}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center text-xs text-muted-foreground\">\n                            <span>Nivel {item.nivel_destino}</span>\n                            <Clock className=\"w-3 h-3\" />\n                        </div>\n                         <Progress value={100} className=\"h-1 mt-1 animate-pulse\" /> \n                    </div>\n                );\n            })}\n        </div>\n        {limit && queue.length > limit && (\n            <div className=\"text-center text-xs text-muted-foreground pt-1\">\n                + {queue.length - limit} m\u00e1s...\n            </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n"
          },
          {
            "path": "src/components/dashboard/rooms/room-card.tsx",
            "code": "'use client';\n\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { Coins, Shell, Droplets } from \"lucide-react\";\nimport type { Room } from \"@/lib/data/rooms-data\";\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { upgradeBuildingAction, cancelConstructionAction } from \"@/actions/game.actions\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState, useOptimistic, useTransition } from \"react\";\nimport { ColaDetalle } from \"@/types/game\";\nimport { Progress } from \"@/components/ui/progress\";\n\ntype RoomCardProps = {\n  room: Room;\n  propiedadId?: string;\n  dynamicLevel: number;\n  construction?: ColaDetalle;\n  isQueueFull?: boolean;\n};\n\nconst ResourceIcon = ({ type }: { type: string }) => {\n    const iconClass = \"w-3 h-3 md:w-4 md:h-4 mr-1\";\n    switch (type) {\n        case 'Armas':\n            return <Shell className={`${iconClass} text-stone-600`} />;\n        case 'Municion':\n            return <Coins className={`${iconClass} text-yellow-600`} />;\n        case 'Dolares':\n            return <span className={`${iconClass} font-bold text-green-700 flex items-center justify-center`}>$</span>;\n        default:\n            return null;\n    }\n}\n\nexport function RoomCard({ room, propiedadId, dynamicLevel, construction, isQueueFull = false }: RoomCardProps) {\n  const image = PlaceHolderImages.find((p) => p.id === room.image) || PlaceHolderImages.find(p => p.id === 'dark-alley');\n  const { toast } = useToast();\n  const [isPending, startTransition] = useTransition();\n\n  const handleUpgrade = async () => {\n    if (!propiedadId) return;\n\n    startTransition(async () => {\n      const result = await upgradeBuildingAction(room.id);\n      if (result.success) {\n        toast({ title: \"Construcci\u00f3n iniciada\", description: `Mejorando ${room.name}.` });\n      } else {\n        toast({ title: \"Error\", description: result.error, variant: \"destructive\" });\n      }\n    });\n  };\n\n  const handleCancel = async () => {\n      if (!construction) return;\n      startTransition(async () => {\n          const result = await cancelConstructionAction(construction.id);\n          if (result.success) {\n              toast({ title: \"Cancelado\", description: \"Construcci\u00f3n cancelada.\" });\n          } else {\n              toast({ title: \"Error\", description: result.error, variant: \"destructive\" });\n          }\n      });\n  };\n\n  const isConstructing = !!construction;\n\n  return (\n    <Card className=\"flex flex-col sm:flex-row overflow-hidden hover:shadow-lg transition-shadow duration-300 border-primary/20 bg-card\">\n      {/* Image Section */}\n      <div className=\"relative w-full sm:w-1/3 min-h-[160px] sm:min-h-full\">\n        {image && (\n            <Image\n            src={image.imageUrl}\n            alt={image.description}\n            fill\n            className=\"object-cover\"\n            data-ai-hint={image.imageHint}\n            sizes=\"(max-width: 640px) 100vw, 33vw\"\n            />\n        )}\n        <div className=\"absolute top-2 right-2 sm:hidden\">\n             <Badge variant=\"secondary\" className=\"font-bold\">Nv. {dynamicLevel}</Badge>\n        </div>\n      </div>\n\n      {/* Content Section */}\n      <div className=\"flex-1 flex flex-col justify-between p-4 gap-3\">\n        <div className=\"space-y-2\">\n            <div className=\"flex justify-between items-start\">\n                <h3 className=\"font-bold text-lg md:text-xl text-primary font-headline leading-tight\">\n                {room.name}\n                </h3>\n                <Badge variant=\"outline\" className=\"hidden sm:inline-flex border-primary/50 text-primary font-bold\">\n                    Nv. {dynamicLevel}\n                </Badge>\n            </div>\n            \n            <p className=\"text-sm text-muted-foreground line-clamp-2 md:line-clamp-3\">\n                {room.description}\n            </p>\n        </div>\n\n        {/* Resources & Action Footer */}\n        <div className=\"space-y-3 pt-2 border-t border-border/50\">\n             <div className=\"flex flex-wrap gap-x-4 gap-y-2 text-xs md:text-sm text-muted-foreground\">\n                {Object.entries(room.costs).map(([resource, value]) => (\n                    <div key={resource} className=\"flex items-center font-medium\">\n                        <ResourceIcon type={resource} />\n                        <span>{value}</span>\n                    </div>\n                ))}\n                <div className=\"flex items-center ml-auto text-xs font-mono bg-secondary/30 px-2 py-0.5 rounded\">\n                    \u23f1 {room.duration}\n                </div>\n            </div>\n\n            <div className=\"flex justify-end pt-1\">\n                {isConstructing ? (\n                <div className=\"w-full space-y-2\">\n                    <div className=\"flex justify-between text-xs\">\n                        <span className=\"font-bold text-amber-600\">En construcci\u00f3n...</span>\n                        <span>{new Date(construction.fecha_fin).toLocaleTimeString()}</span>\n                    </div>\n                    {/* Simplified progress bar or countdown could be here */}\n                    <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"w-full h-7 text-xs\"\n                        onClick={handleCancel}\n                        disabled={isPending}\n                    >\n                        {isPending ? \"Cancelando...\" : \"Cancelar\"}\n                    </Button>\n                </div>\n                ) : (\n                <Button\n                    className=\"w-full sm:w-auto\"\n                    size=\"sm\"\n                    onClick={handleUpgrade}\n                    disabled={isPending || !propiedadId || isQueueFull}\n                    title={isQueueFull ? \"Cola de construcci\u00f3n llena (5/5)\" : \"Ampliar edificio\"}\n                >\n                    {isPending ? \"Iniciando...\" : (isQueueFull ? \"Cola Llena\" : \"Ampliar\")}\n                </Button>\n                )}\n            </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n"
          },
          {
            "path": "src/components/providers/game-state-provider.tsx",
            "code": "'use client';\n\nimport React, { createContext, useContext, ReactNode } from 'react';\nimport { DashboardData } from '@/types/game';\nimport { useGameRealtime } from '@/hooks/use-game-realtime';\n\ninterface GameStateContextType {\n  gameState: DashboardData | null;\n}\n\nconst GameStateContext = createContext<GameStateContextType | undefined>(undefined);\n\ninterface GameStateProviderProps {\n  initialData: DashboardData | null;\n  children: ReactNode;\n}\n\nexport function GameStateProvider({ initialData, children }: GameStateProviderProps) {\n  const gameState = useGameRealtime(initialData);\n\n  return (\n    <GameStateContext.Provider value={{ gameState }}>\n      {children}\n    </GameStateContext.Provider>\n  );\n}\n\nexport function useGameState() {\n  const context = useContext(GameStateContext);\n  if (context === undefined) {\n    throw new Error('useGameState must be used within a GameStateProvider');\n  }\n  return context;\n}\n"
          },
          {
            "path": "src/lib/constants.ts",
            "code": "export const MAX_CONSTRUCTION_QUEUE_SIZE = 5;\n"
          },
          {
            "path": "src/lib/data/rooms-data.ts",
            "code": "export type Room = {\n    id: string;\n    name: string;\n    level?: number;\n    description: string;\n    image: string;\n    costs: {\n        Armas?: number;\n        Municion?: number;\n        Dolares?: number;\n    };\n    duration: string;\n    status: 'upgrade' | 'expand';\n    upgradeLevel?: number;\n};\n  \n\nexport const roomsData: Room[] = [\n    {\n        id: \"oficina_del_jefe\",\n        name: \"Oficina del Jefe\",\n        level: 2,\n        description: \"El Jefe se encuentra en esta oficina, y aqu\u00ed, se toman todas las decisiones. Coordina el desarrollo y la velocidad de construcci\u00f3n de las otras \u00e1reas. Cuando m\u00e1s nivel, m\u00e1s r\u00e1pido se desarrollan el resto.\",\n        image: \"room-office\",\n        costs: { Armas: 900, Municion: 1800 },\n        duration: \"00:22:30\",\n        status: 'upgrade',\n        upgradeLevel: 3,\n    },\n    {\n        id: \"escuela_especializacion\",\n        name: \"Escuela de especializaci\u00f3n\",\n        description: \"Como ya dice el nombre, esta habitaci\u00f3n permite el entrenamiento de \\\"los chicos\\\" en nuevas t\u00e9nicas, permiti\u00e9ndoles tener m\u00e1s experiencia en combate. Al igual que para la oficina de El Jefe, cu\u00e1nto m\u00e1s r\u00e1pido se haga el entrenamiento, m\u00e1s r\u00e1pido se desarrollan las habilidades.\",\n        image: \"room-specialization\",\n        costs: { Armas: 1000, Municion: 1000, Dolares: 25 },\n        duration: \"00:05:33\",\n        status: 'expand',\n    },\n    {\n        id: \"armeria\",\n        name: \"Armer\u00eda\",\n        description: \"Aqu\u00ed, en la Armer\u00eda, como dice el nombre, se guardan armas. Ser\u00e1n de gran necesidad para ocupar nuevos lugares, y para entrenamientos en combate. Cuanto mejor desarrollada est\u00e9, m\u00e1s armas podr\u00e1s hacer al mismo tiempo.\",\n        image: \"room-armory\",\n        costs: { Armas: 12, Municion: 60 },\n        duration: \"00:01:23\",\n        status: 'expand',\n    },\n    {\n        id: \"almacen_de_municion\",\n        name: \"Almac\u00e9n de munici\u00f3n\",\n        level: 1,\n        description: \"El almac\u00e9n de munici\u00f3n es similar a la armer\u00eda. Aqu\u00ed, se manufactura la munici\u00f3n importante. Es necesaria, en grandes cantidades, al ocupar \u00e1reas, as\u00ed como para su uso en entrenamientos. A diferencia de las armas, la munici\u00f3n se usa mucho m\u00e1s r\u00e1pido.\",\n        image: \"room-ammo\",\n        costs: { Armas: 36, Municion: 60 },\n        duration: \"00:06:40\",\n        status: 'upgrade',\n        upgradeLevel: 2,\n    },\n    {\n        id: \"cerveceria\",\n        name: \"Cervecer\u00eda\",\n        description: \"Esta habitaci\u00f3n manufactura alcohol. Desgraciadamente (\u00bfo afortunadamente?) est\u00e1 prohibido y por tanto, muy demandado por la poblaci\u00f3n, as\u00ed que es un negocio pr\u00f3spero. Sin embargo, necesitar\u00e1s ciertas estrategias para poder llevarlo hasta los ciudadanos.\",\n        image: \"room-brewery\",\n        costs: { Armas: 20, Municion: 20 },\n        duration: \"00:02:47\",\n        status: 'expand',\n    },\n    {\n        id: \"campo_de_entrenamiento\",\n        name: \"Campo de entrenamiento\",\n        description: \"Tal y como dice el nombre, en el campo de entrenamiento, tus \\\"chicos\\\" entrenar\u00e1n. El mismo, depender\u00e1 seg\u00fan el tipo de unidades que puedas producir, por ejemplo, simples delincuentes, asesinos, profesionales, a los que tus enemigos tendr\u00e1n un respeto extremo. Dependiendo del nivel, las unidades ser\u00e1n creadas en menor tiempo.\",\n        image: \"room-training\",\n        costs: { Armas: 1000, Municion: 2500 },\n        duration: \"00:15:33\",\n        status: 'expand',\n    },\n];\n"
          },
          {
            "path": "src/types/game.ts",
            "code": "import { z } from 'zod';\nimport { Propiedad, ColaConstruccion as ColaConstruccionDB, AtaqueEntrante, ColaMisiones, Familia, MiembroFamilia } from './database';\n\nexport interface IncomingAttack extends AtaqueEntrante {}\n\nexport interface ActiveMission extends ColaMisiones {}\n\nexport interface FamilyInfo extends MiembroFamilia {\n  familia: Familia | null;\n}\n\nexport interface RecursoDetalle {\n  val: number;\n  max: number;\n  prod: number;\n}\n\nexport interface EdificioDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface TropaDetalle {\n  id: string;\n  cantidad: number;\n  nombre: string;\n}\n\nexport interface InvestigacionDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion: string | null;\n  url_imagen: string;\n  costo_armas: number;\n  costo_municion: number;\n  costo_dolares: number;\n  duracion_reclutamiento: number;\n  ataque: number;\n  defensa: number;\n  capacidad_carga: number;\n  velocidad: number;\n  salario: number;\n  puntos: number;\n  tipo: string;\n  requisitos: Record<string, number> | null;\n  bonus_ataque: string[] | null;\n  bonus_defensa: string[] | null;\n  fecha_creacion: string | null;\n  fecha_actualizacion: string | null;\n}\n\nexport interface ColaDetalle {\n  id: string;\n  habitacion_id?: string;\n  entrenamiento_id?: string;\n  tropa_id?: string;\n  nivel_destino?: number;\n  cantidad?: number;\n  fecha_fin: string;\n  nombre: string;\n}\n\nexport interface Colas {\n  construccion: ColaDetalle[];\n  investigacion: ColaDetalle[];\n  reclutamiento: ColaDetalle[];\n}\n\nexport interface DashboardData {\n  propiedad: Propiedad;\n  recursos: {\n    armas: RecursoDetalle;\n    municion: RecursoDetalle;\n    alcohol: RecursoDetalle;\n    dolares: RecursoDetalle;\n  };\n  edificios: EdificioDetalle[];\n  colas: Colas;\n  tropas: TropaDetalle[];\n  investigaciones: InvestigacionDetalle[];\n  puntos: number;\n  cola_misiones: ActiveMission[];\n  incoming_attacks: IncomingAttack[];\n  tropa_usuario: TropaDetalle[];\n  cola_reclutamiento: ColaDetalle[];\n}\n\nexport interface Recursos {\n  armas: number;\n  municion: number;\n  alcohol: number;\n  dolares: number;\n}\n\nexport interface RespuestaConstruccion {\n  success: boolean;\n  fecha_inicio?: string;\n  fecha_fin?: string;\n  error?: string;\n}\n\nexport type ColaConstruccion = Pick<ColaConstruccionDB, 'id' | 'propiedad_id' | 'habitacion_id' | 'nivel_destino' | 'fecha_fin'>;\n\nexport const IniciarConstruccionSchema = z.object({\n  propiedad_id: z.string().uuid(),\n  habitacion_id: z.string().min(1),\n});\n"
          }
        ]
      }
    ]
  },
  "src/app/(auth)/forgot-password/page.tsx": {
    "route": "/forgot-password",
    "code": "import { ForgotPasswordForm } from '@/components/auth/forgot-password/forgot-password-form'\nimport Link from 'next/link'\n\nexport default function ForgotPasswordPage() {\n  return (\n    <>\n      <ForgotPasswordForm />\n      <div className=\"mt-4 text-center text-sm\">\n        \u00bfRecordaste tu contrase\u00f1a?{' '}\n        <Link href=\"/login\" className=\"underline text-accent hover:text-accent/90\">\n          Inicia Sesi\u00f3n\n        </Link>\n      </div>\n    </>\n  )\n}\n",
    "components": [
      {
        "path": "src/components/auth/forgot-password/forgot-password-form.tsx",
        "code": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { forgotPassword } from '@/actions/auth.stubs'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect, useState } from 'react'\nimport { useToast } from '@/hooks/use-toast'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\nimport { Terminal } from 'lucide-react'\n\nconst initialState = {\n  message: '',\n  errors: {} as Record<string, string[]>,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Enviando...' : 'Enviar enlace de restablecimiento'}\n    </Button>\n  )\n}\n\nexport function ForgotPasswordForm() {\n  const [state, formAction] = useActionState(forgotPassword, initialState)\n  const { toast } = useToast()\n  const [showSuccess, setShowSuccess] = useState(false)\n\n  useEffect(() => {\n    if (state?.message && !state.errors) {\n      setShowSuccess(true)\n    } else if (state?.message) {\n      toast({\n        title: 'Error',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  if(showSuccess) {\n    return (\n        <Alert>\n          <Terminal className=\"h-4 w-4\" />\n          <AlertTitle>\u00a1Revisa tu correo!</AlertTitle>\n          <AlertDescription>\n            {state.message}\n          </AlertDescription>\n        </Alert>\n    )\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">\u00bfOlvidaste tu contrase\u00f1a?</CardTitle>\n        <CardDescription>\n          Ingresa tu correo electr\u00f3nico y te enviaremos un enlace para restablecerla.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Correo Electr\u00f3nico</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              placeholder=\"nombre@ejemplo.com\"\n              required\n            />\n            {state?.errors?.email && (\n              <p className=\"text-sm text-destructive\">{state.errors.email[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n",
        "dependencies": [
          {
            "path": "src/actions/auth.stubs.ts",
            "code": "'use server'\n\nexport async function forgotPassword(prevState: any, formData: FormData) {\n  // Return undefined for errors to match the expected type somewhat, or empty object\n  // But Typescript seems to think state.errors is 'never' or something?\n  // Let's explicitly return the shape.\n  return { \n      message: 'Not implemented', \n      errors: {} as Record<string, string[]> // Cast to satisfy potential users\n  }\n}\n\nexport async function socialLogin(provider: string) {\n    console.log('Social login with', provider);\n}\n\nexport async function resetPassword(prevState: any, formData: FormData) {\n  return { \n      message: 'Not implemented', \n      errors: {} as Record<string, string[]>\n  }\n}\n"
          },
          {
            "path": "src/hooks/use-toast.ts",
            "code": "\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n"
          }
        ]
      }
    ]
  },
  "src/app/(auth)/login/page.tsx": {
    "route": "/login",
    "code": "import { LoginForm } from '@/components/auth/login/login-form'\nimport Link from 'next/link'\n\nexport default function LoginPage() {\n  return (\n    <>\n      <LoginForm />\n      <div className=\"mt-4 text-center text-sm\">\n        \u00bfNo tienes una cuenta?{' '}\n        <Link href=\"/signup\" className=\"underline text-accent hover:text-accent/90\">\n          Reg\u00edstrate\n        </Link>\n      </div>\n    </>\n  )\n}\n",
    "components": [
      {
        "path": "src/components/auth/login/login-form.tsx",
        "code": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { loginAction as login } from '@/actions/auth.actions'\nimport { SocialButtons } from '@/components/auth/social-buttons'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport Link from 'next/link'\nimport { useEffect } from 'react'\nimport { useToast } from '@/hooks/use-toast'\nimport { Button } from 'react-day-picker'\n\nconst initialState = {\n  message: '',\n  errors: undefined,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Iniciando Sesi\u00f3n...' : 'Iniciar Sesi\u00f3n'}\n    </Button>\n  )\n}\n\nexport function LoginForm() {\n  const [state, formAction] = useActionState(login, initialState)\n  const { toast } = useToast()\n\n  useEffect(() => {\n    if (state?.message) {\n      toast({\n        title: 'Error de inicio de sesi\u00f3n',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Iniciar Sesi\u00f3n</CardTitle>\n        <CardDescription>\n          Ingresa tu correo electr\u00f3nico para acceder a tu cuenta.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Correo Electr\u00f3nico</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              placeholder=\"nombre@ejemplo.com\"\n              required\n              defaultValue=\"profematiasprestes@gmail.com\"\n            />\n            {state?.errors?.email && (\n              <p className=\"text-sm text-destructive\">{state.errors.email[0]}</p>\n            )}\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center\">\n              <Label htmlFor=\"password\">Contrase\u00f1a</Label>\n              <Link\n                href=\"/forgot-password\"\n                className=\"ml-auto inline-block text-sm underline text-accent hover:text-accent/90\"\n              >\n                \u00bfOlvidaste tu contrase\u00f1a?\n              </Link>\n            </div>\n            <Input id=\"password\" name=\"password\" type=\"password\" required defaultValue=\"123456789\" />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n        <div className=\"relative my-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <span className=\"w-full border-t\" />\n          </div>\n          <div className=\"relative flex justify-center text-xs uppercase\">\n            <span className=\"bg-card px-2 text-muted-foreground\">O contin\u00faa con</span>\n          </div>\n        </div>\n        <SocialButtons />\n      </CardContent>\n    </Card>\n  )\n}\n",
        "dependencies": [
          {
            "path": "src/actions/auth.actions.ts",
            "code": "'use server'\n\nimport { z } from 'zod'\nimport { signUp, signIn, signOut } from '@/lib/services/auth.service'\nimport { redirect } from 'next/navigation'\n\nconst registerSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  fullName: z.string().min(3),\n})\n\nconst loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n})\n\nexport async function registerAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n  \n  const parsed = registerSchema.safeParse({\n    email: data.email,\n    password: data.password,\n    fullName: data.fullName,\n  })\n\n  if (!parsed.success) {\n    return {\n      message: 'Error de validaci\u00f3n',\n      errors: parsed.error.flatten().fieldErrors\n    }\n  }\n\n  const result = await signUp({\n    email: parsed.data.email,\n    password: parsed.data.password,\n    full_name: parsed.data.fullName,\n  })\n\n  if (!result.success) {\n    return {\n      message: result.error || 'Error desconocido',\n      errors: undefined\n    }\n  }\n\n  // Si hay sesi\u00f3n (autologin), redirigir al dashboard\n  if (result.data?.session) {\n    redirect('/dashboard')\n  }\n\n  return { message: 'Cuenta creada exitosamente. Por favor inicia sesi\u00f3n.' }\n}\n\nexport async function loginAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n\n  const parsed = loginSchema.safeParse({\n    email: data.email,\n    password: data.password,\n  })\n\n  if (!parsed.success) {\n    return {\n      message: 'Error de validaci\u00f3n',\n      errors: parsed.error.flatten().fieldErrors\n    }\n  }\n\n  const result = await signIn({\n    email: parsed.data.email,\n    password: parsed.data.password,\n  })\n\n  if (!result.success) {\n    return {\n      message: result.error || 'Credenciales inv\u00e1lidas',\n      errors: undefined\n    }\n  }\n\n  redirect('/dashboard')\n}\n\nexport async function signOutAction() {\n  await signOut()\n}\n"
          },
          {
            "path": "src/components/auth/social-buttons.tsx",
            "code": "'use client'\nimport { Button } from '@/components/ui/button'\nimport { socialLogin } from '@/actions/auth.stubs'\nimport { Github } from 'lucide-react'\n\nconst GoogleIcon = () => (\n    <svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 mr-2\">\n      <path\n        fill=\"#4285F4\"\n        d=\"M22.56,12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26,1.37-1.04,2.53-2.21,3.31v2.77h3.57c2.08-1.92,3.28-4.74,3.28-8.09Z\"\n      />\n      <path\n        fill=\"#34A853\"\n        d=\"M12,23c2.97,0,5.46-.98,7.28-2.66l-3.57-2.77c-.98,.66-2.23,1.06-3.71,1.06-2.86,0-5.29-1.93-6.16-4.53H2.18v2.84C3.99,20.53,7.7,23,12,23Z\"\n      />\n      <path\n        fill=\"#FBBC05\"\n        d=\"M5.84,14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43,.35-2.09V7.07H2.18C1.43,8.55,1,10.22,1,12s.43,3.45,1.18,4.93l3.66-2.84Z\"\n      />\n      <path\n        fill=\"#EA4335\"\n        d=\"M12,5.38c1.62,0,3.06,.56,4.21,1.64l3.15-3.15C17.45,2.09,14.97,1,12,1,7.7,1,3.99,3.47,2.18,7.07l3.66,2.84c.87-2.6,3.3-4.53,6.16-4.53Z\"\n      />\n    </svg>\n  );\n\nexport function SocialButtons() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <form action={() => socialLogin('google')}>\n          <Button variant=\"outline\" type=\"submit\" className=\"w-full\">\n              <GoogleIcon /> Google\n          </Button>\n        </form>\n        <form action={() => socialLogin('github')}>\n          <Button variant=\"outline\" type=\"submit\" className=\"w-full\">\n              <Github className=\"mr-2 h-4 w-4\" /> Github\n          </Button>\n        </form>\n    </div>\n  )\n}\n"
          },
          {
            "path": "src/hooks/use-toast.ts",
            "code": "\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n"
          }
        ]
      }
    ]
  },
  "src/app/(auth)/signup/page.tsx": {
    "route": "/signup",
    "code": "import { SignupForm } from '@/components/auth/signup/signup-form'\nimport Link from 'next/link'\n\nexport default function SignupPage() {\n  return (\n    <>\n      <SignupForm />\n      <div className=\"mt-4 text-center text-sm\">\n        \u00bfYa tienes una cuenta?{' '}\n        <Link href=\"/login\" className=\"underline text-accent hover:text-accent/90\">\n          Inicia Sesi\u00f3n\n        </Link>\n      </div>\n    </>\n  )\n}\n",
    "components": [
      {
        "path": "src/components/auth/signup/signup-form.tsx",
        "code": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { registerAction as signup } from '@/actions/auth.actions'\nimport { SocialButtons } from '@/components/auth/social-buttons'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect, useState } from 'react'\nimport { useToast } from '@/hooks/use-toast'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\nimport { Terminal } from 'lucide-react'\nimport { Button } from 'react-day-picker'\n\nconst initialState = {\n  message: '',\n  errors: undefined,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Creando cuenta...' : 'Crear una cuenta'}\n    </Button>\n  )\n}\n\nexport function SignupForm() {\n  const [state, formAction] = useActionState(signup, initialState)\n  const { toast } = useToast()\n  const [showSuccess, setShowSuccess] = useState(false)\n\n  useEffect(() => {\n    if (state?.message && !state.errors) {\n      setShowSuccess(true)\n    } else if (state?.message) {\n      toast({\n        title: 'Error de registro',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  if (showSuccess) {\n    return (\n        <Alert>\n          <Terminal className=\"h-4 w-4\" />\n          <AlertTitle>\u00a1Hecho!</AlertTitle>\n          <AlertDescription>\n            {state.message}\n          </AlertDescription>\n        </Alert>\n    )\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Registrarse</CardTitle>\n        <CardDescription>\n          Ingresa tu informaci\u00f3n para crear una cuenta.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"fullName\">Nombre Completo</Label>\n            <Input\n              id=\"fullName\"\n              name=\"fullName\"\n              type=\"text\"\n              placeholder=\"Tu nombre\"\n              required\n            />\n            {state?.errors?.fullName && (\n              <p className=\"text-sm text-destructive\">{state.errors.fullName[0]}</p>\n            )}\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Correo Electr\u00f3nico</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              placeholder=\"nombre@ejemplo.com\"\n              required\n            />\n             {state?.errors?.email && (\n              <p className=\"text-sm text-destructive\">{state.errors.email[0]}</p>\n            )}\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Contrase\u00f1a</Label>\n            <Input id=\"password\" name=\"password\" type=\"password\" required />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n        <div className=\"relative my-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <span className=\"w-full border-t\" />\n          </div>\n          <div className=\"relative flex justify-center text-xs uppercase\">\n            <span className=\"bg-card px-2 text-muted-foreground\">O contin\u00faa con</span>\n          </div>\n        </div>\n        <SocialButtons />\n      </CardContent>\n    </Card>\n  )\n}\n",
        "dependencies": [
          {
            "path": "src/actions/auth.actions.ts",
            "code": "'use server'\n\nimport { z } from 'zod'\nimport { signUp, signIn, signOut } from '@/lib/services/auth.service'\nimport { redirect } from 'next/navigation'\n\nconst registerSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  fullName: z.string().min(3),\n})\n\nconst loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n})\n\nexport async function registerAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n  \n  const parsed = registerSchema.safeParse({\n    email: data.email,\n    password: data.password,\n    fullName: data.fullName,\n  })\n\n  if (!parsed.success) {\n    return {\n      message: 'Error de validaci\u00f3n',\n      errors: parsed.error.flatten().fieldErrors\n    }\n  }\n\n  const result = await signUp({\n    email: parsed.data.email,\n    password: parsed.data.password,\n    full_name: parsed.data.fullName,\n  })\n\n  if (!result.success) {\n    return {\n      message: result.error || 'Error desconocido',\n      errors: undefined\n    }\n  }\n\n  // Si hay sesi\u00f3n (autologin), redirigir al dashboard\n  if (result.data?.session) {\n    redirect('/dashboard')\n  }\n\n  return { message: 'Cuenta creada exitosamente. Por favor inicia sesi\u00f3n.' }\n}\n\nexport async function loginAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n\n  const parsed = loginSchema.safeParse({\n    email: data.email,\n    password: data.password,\n  })\n\n  if (!parsed.success) {\n    return {\n      message: 'Error de validaci\u00f3n',\n      errors: parsed.error.flatten().fieldErrors\n    }\n  }\n\n  const result = await signIn({\n    email: parsed.data.email,\n    password: parsed.data.password,\n  })\n\n  if (!result.success) {\n    return {\n      message: result.error || 'Credenciales inv\u00e1lidas',\n      errors: undefined\n    }\n  }\n\n  redirect('/dashboard')\n}\n\nexport async function signOutAction() {\n  await signOut()\n}\n"
          },
          {
            "path": "src/components/auth/social-buttons.tsx",
            "code": "'use client'\nimport { Button } from '@/components/ui/button'\nimport { socialLogin } from '@/actions/auth.stubs'\nimport { Github } from 'lucide-react'\n\nconst GoogleIcon = () => (\n    <svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 mr-2\">\n      <path\n        fill=\"#4285F4\"\n        d=\"M22.56,12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26,1.37-1.04,2.53-2.21,3.31v2.77h3.57c2.08-1.92,3.28-4.74,3.28-8.09Z\"\n      />\n      <path\n        fill=\"#34A853\"\n        d=\"M12,23c2.97,0,5.46-.98,7.28-2.66l-3.57-2.77c-.98,.66-2.23,1.06-3.71,1.06-2.86,0-5.29-1.93-6.16-4.53H2.18v2.84C3.99,20.53,7.7,23,12,23Z\"\n      />\n      <path\n        fill=\"#FBBC05\"\n        d=\"M5.84,14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43,.35-2.09V7.07H2.18C1.43,8.55,1,10.22,1,12s.43,3.45,1.18,4.93l3.66-2.84Z\"\n      />\n      <path\n        fill=\"#EA4335\"\n        d=\"M12,5.38c1.62,0,3.06,.56,4.21,1.64l3.15-3.15C17.45,2.09,14.97,1,12,1,7.7,1,3.99,3.47,2.18,7.07l3.66,2.84c.87-2.6,3.3-4.53,6.16-4.53Z\"\n      />\n    </svg>\n  );\n\nexport function SocialButtons() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <form action={() => socialLogin('google')}>\n          <Button variant=\"outline\" type=\"submit\" className=\"w-full\">\n              <GoogleIcon /> Google\n          </Button>\n        </form>\n        <form action={() => socialLogin('github')}>\n          <Button variant=\"outline\" type=\"submit\" className=\"w-full\">\n              <Github className=\"mr-2 h-4 w-4\" /> Github\n          </Button>\n        </form>\n    </div>\n  )\n}\n"
          },
          {
            "path": "src/hooks/use-toast.ts",
            "code": "\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n"
          }
        ]
      }
    ]
  },
  "src/app/onboarding/page.tsx": {
    "route": "/onboarding",
    "code": "import { createClient } from \"@/lib/supabase/server\";\nimport { redirect } from \"next/navigation\";\nimport { createInitialProperty } from \"@/lib/services/game.service\";\n\nexport default async function OnboardingPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect(\"/login\");\n  }\n\n  // Handle form submission\n  async function setupBase(formData: FormData) {\n    \"use server\";\n\n    // In the future, this would take coordinates from the form\n    // For now, we use the auto-assignment logic\n    const result = await createInitialProperty({\n        nombre: \"Base Principal\",\n        ciudad: 0, // 0 triggers auto-assignment in RPC if logic permits, or we should change RPC\n        barrio: 0,\n        edificio: 0\n    });\n\n    if (result.success || result.propiedad_id) {\n        redirect(\"/dashboard/overview\");\n    } else {\n        // Handle error (would need client component for proper error feedback)\n        console.error(\"Failed to create base\", result.error);\n    }\n  }\n\n  return (\n    <div className=\"flex min-h-screen flex-col items-center justify-center p-24\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center\">\n          <h1 className=\"text-4xl font-bold tracking-tight text-white\">Bienvenido a Vendetta</h1>\n          <p className=\"mt-2 text-lg text-gray-400\">\n            Para comenzar, necesitamos establecer tu primera base de operaciones.\n          </p>\n        </div>\n\n        <div className=\"mt-8 space-y-6\">\n            {/*\n              This is a temporary placeholder.\n              Ideally this would be a client form allowing coordinate selection\n              or showing a map.\n            */}\n            <form action={setupBase}>\n                <button\n                    type=\"submit\"\n                    className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\n                >\n                    Establecer Base Autom\u00e1ticamente\n                </button>\n            </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "components": []
  },
  "src/app/reset-password/page.tsx": {
    "route": "/reset-password",
    "code": "import { ResetPasswordForm } from '@/components/reset-password/reset-password-form'\n\nexport default function ResetPasswordPage() {\n  return (\n    <div className=\"flex min-h-screen w-full items-center justify-center bg-background p-4\">\n      <div className=\"w-full max-w-md\">\n        <ResetPasswordForm />\n      </div>\n    </div>\n  )\n}\n",
    "components": [
      {
        "path": "src/components/reset-password/reset-password-form.tsx",
        "code": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { resetPassword } from '@/lib/actions/auth'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect } from 'react'\nimport { useToast } from '@/hooks/use-toast'\n\nconst initialState = {\n  message: '',\n  errors: undefined,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Restableciendo...' : 'Restablecer Contrase\u00f1a'}\n    </Button>\n  )\n}\n\nexport function ResetPasswordForm() {\n  const [state, formAction] = useActionState(resetPassword, initialState)\n  const { toast } = useToast()\n\n  useEffect(() => {\n    if (state?.message) {\n      toast({\n        title: 'Error',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Restablecer Contrase\u00f1a</CardTitle>\n        <CardDescription>\n          Ingresa tu nueva contrase\u00f1a a continuaci\u00f3n.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Nueva Contrase\u00f1a</Label>\n            <Input id=\"password\" name=\"password\" type=\"password\" required />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n",
        "dependencies": [
          {
            "path": "src/hooks/use-toast.ts",
            "code": "\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n"
          },
          {
            "path": "src/lib/actions/auth.ts",
            "code": "'use server'\n\nimport { createClient } from '@/lib/supabase/server'\nimport { headers } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { z } from 'zod'\n\nconst loginSchema = z.object({\n  email: z.string().email({ message: 'Correo electr\u00f3nico inv\u00e1lido' }),\n  password: z.string().min(6, { message: 'La contrase\u00f1a debe tener al menos 6 caracteres' }),\n})\n\nexport async function login(prevState: any, formData: FormData) {\n  const supabase = createClient()\n  const validatedFields = loginSchema.safeParse(Object.fromEntries(formData.entries()))\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: 'Por favor, corrige los errores en el formulario.',\n    }\n  }\n  \n  const { email, password } = validatedFields.data\n\n  const { error } = await supabase.auth.signInWithPassword({\n    email,\n    password,\n  })\n\n  if (error) {\n    return {\n        message: 'Credenciales inv\u00e1lidas. Por favor, int\u00e9ntalo de nuevo.',\n    }\n  }\n\n  return redirect('/dashboard')\n}\n\nconst signupSchema = z.object({\n  email: z.string().email({ message: 'Correo electr\u00f3nico inv\u00e1lido' }),\n  password: z.string().min(6, { message: 'La contrase\u00f1a debe tener al menos 6 caracteres' }),\n})\n\nexport async function signup(prevState: any, formData: FormData) {\n  const origin = (await headers()).get('origin')\n  const supabase = createClient()\n  const validatedFields = signupSchema.safeParse(Object.fromEntries(formData.entries()))\n  \n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: 'Por favor, corrige los errores en el formulario.',\n    }\n  }\n  \n  const { email, password } = validatedFields.data\n\n  const { error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${origin}/auth/callback`,\n    },\n  })\n\n  if (error) {\n    if (error.message.includes('User already registered')) {\n        return { message: 'Este correo electr\u00f3nico ya est\u00e1 registrado.'}\n    }\n    return { message: 'No se pudo crear la cuenta. Por favor, int\u00e9ntalo de nuevo.' }\n  }\n\n  return { message: '\u00a1Revisa tu correo electr\u00f3nico para verificar tu cuenta!' }\n}\n\nconst forgotPasswordSchema = z.object({\n    email: z.string().email({ message: 'Correo electr\u00f3nico inv\u00e1lido' }),\n})\n\nexport async function forgotPassword(prevState: any, formData: FormData) {\n    const origin = (await headers()).get('origin')\n    const supabase = createClient()\n    const validatedFields = forgotPasswordSchema.safeParse(Object.fromEntries(formData.entries()))\n\n    if (!validatedFields.success) {\n        return {\n            errors: validatedFields.error.flatten().fieldErrors,\n            message: 'Por favor, corrige los errores en el formulario.',\n        }\n    }\n\n    const { email } = validatedFields.data\n\n    const { error } = await supabase.auth.resetPasswordForEmail(email, {\n        redirectTo: `${origin}/reset-password`,\n    })\n\n    if (error) {\n        return { message: 'No se pudo enviar el correo de restablecimiento. Por favor, int\u00e9ntalo de nuevo.' }\n    }\n\n    return { message: 'Si existe una cuenta con este correo, recibir\u00e1s un enlace para restablecer tu contrase\u00f1a.' }\n}\n\nconst resetPasswordSchema = z.object({\n    password: z.string().min(6, { message: 'La contrase\u00f1a debe tener al menos 6 caracteres' }),\n});\n\nexport async function resetPassword(prevState: any, formData: FormData) {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n        return { message: 'No est\u00e1s autenticado o la sesi\u00f3n ha expirado.' };\n    }\n\n    const validatedFields = resetPasswordSchema.safeParse(Object.fromEntries(formData.entries()));\n\n    if (!validatedFields.success) {\n        return {\n            errors: validatedFields.error.flatten().fieldErrors,\n            message: 'Por favor, corrige los errores en el formulario.',\n        }\n    }\n    const { password } = validatedFields.data;\n    \n    const { error } = await supabase.auth.updateUser({ password });\n\n    if (error) {\n        return { message: 'No se pudo restablecer la contrase\u00f1a. El enlace puede haber expirado.' };\n    }\n\n    redirect('/dashboard');\n}\n\nexport async function socialLogin(provider: 'google' | 'github') {\n  const origin = (await headers()).get('origin')\n  const supabase = createClient()\n  const { data, error } = await supabase.auth.signInWithOAuth({\n    provider,\n    options: {\n      redirectTo: `${origin}/auth/callback`,\n    },\n  })\n\n  if (error) {\n    // This will be caught by the nearest error boundary\n    return redirect(`/login?message=No se pudo iniciar sesi\u00f3n con ${provider}.`)\n  }\n  \n  return redirect(data.url)\n}\n\nexport async function signOut() {\n  const supabase = createClient()\n  await supabase.auth.signOut()\n  redirect('/login')\n}\n"
          }
        ]
      }
    ]
  }
}