{
  "name": "src",
  "type": "directory",
  "children": [
    {
      "name": "actions",
      "type": "directory",
      "children": [
        {
          "name": "auth.actions.ts",
          "type": "file",
          "content": "'use server'\n\nimport { z } from 'zod'\nimport { signUp, signIn, signOut } from '@/lib/services/auth.service'\nimport { redirect } from 'next/navigation'\n\nconst registerSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  fullName: z.string().min(3),\n})\n\nconst loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n})\n\nexport async function registerAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n  \n  const parsed = registerSchema.safeParse({\n    email: data.email,\n    password: data.password,\n    fullName: data.fullName,\n  })\n\n  if (!parsed.success) {\n    return {\n      message: 'Error de validación',\n      errors: parsed.error.flatten().fieldErrors\n    }\n  }\n\n  const result = await signUp({\n    email: parsed.data.email,\n    password: parsed.data.password,\n    full_name: parsed.data.fullName,\n  })\n\n  if (!result.success) {\n    return {\n      message: result.error || 'Error desconocido',\n      errors: undefined\n    }\n  }\n\n  // Si hay sesión (autologin), redirigir al dashboard\n  if (result.data?.session) {\n    redirect('/dashboard')\n  }\n\n  return { message: 'Cuenta creada exitosamente. Por favor inicia sesión.' }\n}\n\nexport async function loginAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n\n  const parsed = loginSchema.safeParse({\n    email: data.email,\n    password: data.password,\n  })\n\n  if (!parsed.success) {\n    return {\n      message: 'Error de validación',\n      errors: parsed.error.flatten().fieldErrors\n    }\n  }\n\n  const result = await signIn({\n    email: parsed.data.email,\n    password: parsed.data.password,\n  })\n\n  if (!result.success) {\n    return {\n      message: result.error || 'Credenciales inválidas',\n      errors: undefined\n    }\n  }\n\n  redirect('/dashboard')\n}\n\nexport async function signOutAction() {\n  await signOut()\n}\n"
        },
        {
          "name": "auth.stubs.ts",
          "type": "file",
          "content": "'use server'\n\nexport async function forgotPassword(prevState: any, formData: FormData) {\n  // Return undefined for errors to match the expected type somewhat, or empty object\n  // But Typescript seems to think state.errors is 'never' or something?\n  // Let's explicitly return the shape.\n  return { \n      message: 'Not implemented', \n      errors: {} as Record<string, string[]> // Cast to satisfy potential users\n  }\n}\n\nexport async function socialLogin(provider: string) {\n    console.log('Social login with', provider);\n}\n\nexport async function resetPassword(prevState: any, formData: FormData) {\n  return { \n      message: 'Not implemented', \n      errors: {} as Record<string, string[]>\n  }\n}\n"
        },
        {
          "name": "game.actions.ts",
          "type": "file",
          "content": "'use server'\n\nimport { z } from 'zod'\nimport {\n  createInitialProperty,\n  startConstruction,\n  syncResources,\n  startResearch,\n  recruitTroops,\n  launchMission,\n  cancelConstruction,\n  getDashboardData\n} from '@/lib/services/game.service'\nimport { createClient } from '@/lib/supabase/server'\nimport { revalidatePath } from 'next/cache'\nimport { redirect } from 'next/navigation'\n\nconst onboardingSchema = z.object({\n  nombre: z.string().min(3),\n  ciudad: z.coerce.number().min(1).max(100),\n  barrio: z.coerce.number().min(1).max(25),\n  edificio: z.coerce.number().min(1).max(25),\n})\n\nconst missionSchema = z.object({\n  propiedad_origen_id: z.string().uuid(),\n  tipo_mision: z.enum(['atacar', 'transportar', 'espiar', 'colonizar', 'recolectar']),\n  tropas: z.record(z.string(), z.number().int().min(1)),\n  recursos: z.record(z.string(), z.number().int().min(0)).optional(),\n  destino_ciudad: z.coerce.number().min(1),\n  destino_barrio: z.coerce.number().min(1),\n  destino_edificio: z.coerce.number().min(1),\n  velocidad_flota: z.coerce.number().min(1).max(100).optional(),\n})\n\nexport async function completeOnboardingAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n\n  const parsed = onboardingSchema.safeParse(data)\n\n  if (!parsed.success) {\n    return { success: false, error: 'Datos inválidos. Verifica las coordenadas y el nombre.' }\n  }\n\n  const result = await createInitialProperty({\n    nombre: parsed.data.nombre,\n    ciudad: parsed.data.ciudad,\n    barrio: parsed.data.barrio,\n    edificio: parsed.data.edificio,\n  })\n\n  if (result.error) {\n    return { success: false, error: result.error }\n  }\n\n  revalidatePath('/dashboard')\n  redirect('/dashboard')\n}\n\nexport async function upgradeBuildingAction(buildingId: string) {\n  const schema = z.string().min(1)\n  const parsed = schema.safeParse(buildingId)\n\n  if (!parsed.success) {\n    return { success: false, error: 'ID de edificio inválido' }\n  }\n\n  const supabase = await createClient()\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n  if (authError || !user) {\n    return { success: false, error: 'No autenticado' }\n  }\n\n  const { data: propiedad, error: propError } = await supabase\n    .from('propiedad')\n    .select('id')\n    .eq('usuario_id', user.id)\n    .single()\n\n  if (propError || !propiedad) {\n    return { success: false, error: 'Propiedad no encontrada' }\n  }\n\n  const result = await startConstruction(propiedad.id, parsed.data)\n\n  if (result.success) {\n    revalidatePath('/dashboard/buildings')\n    revalidatePath('/dashboard/overview')\n    return { success: true, message: 'Construcción iniciada' }\n  } else {\n    return { success: false, error: result.error || 'No se pudo iniciar la construcción' }\n  }\n}\n\nexport async function cancelConstructionAction(queueId: string) {\n  const schema = z.string().uuid()\n  const parsed = schema.safeParse(queueId)\n\n  if (!parsed.success) {\n    return { success: false, error: 'ID de cola inválido' }\n  }\n\n  // Assuming auth check in RPC\n  const result = await cancelConstruction(parsed.data)\n\n  if (result.success) {\n    revalidatePath('/dashboard/buildings')\n    revalidatePath('/dashboard/overview')\n    return { success: true, message: 'Construcción cancelada' }\n  } else {\n    return { success: false, error: result.error || 'No se pudo cancelar la construcción' }\n  }\n}\n\nexport async function getDashboardDataAction() {\n  const supabase = await createClient()\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n  if (authError || !user) {\n    return { success: false, error: 'No autenticado' }\n  }\n\n  const { data: propiedad, error: propError } = await supabase\n    .from('propiedad')\n    .select('id')\n    .eq('usuario_id', user.id)\n    .single()\n\n  if (propError || !propiedad) {\n    return { success: false, error: 'Propiedad no encontrada' }\n  }\n\n  const dashboardData = await getDashboardData(propiedad.id)\n  \n  if (!dashboardData) {\n    return { success: false, error: 'Error al obtener datos' }\n  }\n\n  return { success: true, data: dashboardData }\n}\n\nexport async function refreshGameStateAction() {\n  const result = await getDashboardDataAction()\n  if (!result.success || !result.data) {\n    return { success: false, error: result.error }\n  }\n  return { success: true, data: result.data.propiedad } // Return prop only for legacy support if needed\n}\n\nexport async function startResearchAction(researchId: string) {\n  const schema = z.string().min(1)\n  const parsed = schema.safeParse(researchId)\n\n  if (!parsed.success) {\n    return { success: false, error: 'ID de investigación inválido' }\n  }\n\n  const supabase = await createClient()\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n  if (authError || !user) {\n    return { success: false, error: 'No autenticado' }\n  }\n\n  // Research is tied to property for queue, so we need a property context.\n  // Assuming active property or main property. For now, fetch main property.\n  const { data: propiedad, error: propError } = await supabase\n    .from('propiedad')\n    .select('id')\n    .eq('usuario_id', user.id)\n    .single()\n\n  if (propError || !propiedad) {\n    return { success: false, error: 'Propiedad no encontrada' }\n  }\n\n  const result = await startResearch(propiedad.id, parsed.data)\n\n  if (result.success) {\n    revalidatePath('/game/research')\n    return { success: true, message: 'Investigación iniciada' }\n  } else {\n    return { success: false, error: result.error || 'No se pudo iniciar la investigación' }\n  }\n}\n\nexport async function recruitTroopsAction(troopId: string, amount: number) {\n  if (amount <= 0) return { success: false, error: 'Cantidad inválida' }\n\n  const supabase = await createClient()\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n  if (authError || !user) {\n    return { success: false, error: 'No autenticado' }\n  }\n\n  const { data: propiedad, error: propError } = await supabase\n    .from('propiedad')\n    .select('id')\n    .eq('usuario_id', user.id)\n    .single()\n\n  if (propError || !propiedad) {\n    return { success: false, error: 'Propiedad no encontrada' }\n  }\n\n  const result = await recruitTroops(propiedad.id, troopId, amount)\n\n  if (result.success) {\n    revalidatePath('/game/recruitment')\n    return { success: true, message: 'Reclutamiento iniciado' }\n  } else {\n    return { success: false, error: result.error || 'No se pudo iniciar el reclutamiento' }\n  }\n}\n\nexport async function launchMissionAction(prevState: any, formData: FormData) {\n  const data = Object.fromEntries(formData.entries())\n\n  // Parse nested JSON strings if coming from form hidden inputs, or handle appropriately.\n  // Assuming the form sends 'tropas' as a JSON string for now, or constructing it manually.\n  // For simplicity, let's assume valid form data structure or client-side preparation.\n  // If complex, it might need more parsing logic.\n\n  // However, Server Actions usually receive FormData. If the client sends complex structures,\n  // they often serialize to JSON strings.\n\n  const rawTropas = data.tropas ? JSON.parse(data.tropas as string) : {}\n  const rawRecursos = data.recursos ? JSON.parse(data.recursos as string) : {}\n\n  const payload = {\n    propiedad_origen_id: data.propiedad_origen_id,\n    tipo_mision: data.tipo_mision,\n    tropas: rawTropas,\n    recursos: rawRecursos,\n    destino_ciudad: data.destino_ciudad,\n    destino_barrio: data.destino_barrio,\n    destino_edificio: data.destino_edificio,\n    velocidad_flota: data.velocidad_flota\n  }\n\n  const parsed = missionSchema.safeParse(payload)\n\n  if (!parsed.success) {\n    return { success: false, error: 'Datos de misión inválidos', details: parsed.error.flatten() }\n  }\n\n  const result = await launchMission(parsed.data)\n\n  if (result.success) {\n    revalidatePath('/game/fleet')\n    return { success: true, message: 'Misión lanzada exitosamente' }\n  } else {\n    return { success: false, error: result.error || 'No se pudo lanzar la misión' }\n  }\n}\n"
        }
      ]
    },
    {
      "name": "ai",
      "type": "directory",
      "children": [
        {
          "name": "dev.ts",
          "type": "file",
          "content": "// Flows will be imported for their side effects in this file.\n"
        },
        {
          "name": "genkit.ts",
          "type": "file",
          "content": "import {genkit} from 'genkit';\nimport {googleAI} from '@genkit-ai/google-genai';\n\nexport const ai = genkit({\n  plugins: [googleAI()],\n  model: 'googleai/gemini-2.5-flash',\n});\n"
        }
      ]
    },
    {
      "name": "app",
      "type": "directory",
      "children": [
        {
          "name": "(auth)",
          "type": "directory",
          "children": [
            {
              "name": "forgot-password",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { ForgotPasswordForm } from '@/components/auth/forgot-password/forgot-password-form'\nimport Link from 'next/link'\n\nexport default function ForgotPasswordPage() {\n  return (\n    <>\n      <ForgotPasswordForm />\n      <div className=\"mt-4 text-center text-sm\">\n        ¿Recordaste tu contraseña?{' '}\n        <Link href=\"/login\" className=\"underline text-accent hover:text-accent/90\">\n          Inicia Sesión\n        </Link>\n      </div>\n    </>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "layout.tsx",
              "type": "file",
              "content": "import Image from 'next/image';\nimport { PlaceHolderImages } from '@/lib/placeholder-images';\n\nexport default function AuthLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const vendettaImage = PlaceHolderImages.find(p => p.id === \"vendetta-logo\");\n  return (\n    <div className=\"flex min-h-screen w-full bg-background text-foreground\">\n      {/* Left Column (Image/Branding) - Hidden on Mobile, Visible on LG */}\n      <div className=\"hidden lg:flex lg:w-1/2 flex-col items-center justify-center bg-primary/5 p-12 relative overflow-hidden\">\n        <div className=\"text-center z-10 relative\">\n          {vendettaImage && (\n            <div className=\"relative mx-auto mb-8 w-48 h-48 lg:w-64 lg:h-64\">\n                <Image\n                src={vendettaImage.imageUrl}\n                alt={vendettaImage.description}\n                fill\n                className=\"rounded-full shadow-2xl object-cover\"\n                data-ai-hint={vendettaImage.imageHint}\n                priority\n                sizes=\"(max-width: 1024px) 100vw, 50vw\"\n                />\n            </div>\n          )}\n          <h1 className=\"text-5xl xl:text-6xl font-bold text-primary font-headline tracking-tight\">Vendetta</h1>\n          <p className=\"mt-4 text-xl xl:text-2xl text-foreground/80 max-w-md mx-auto\">\n            El juego de estrategia y conquista definitivo.\n          </p>\n        </div>\n        {/* Abstract Background Elements could go here */}\n      </div>\n\n      {/* Right Column (Form) - Full width on Mobile */}\n      <div className=\"w-full lg:w-1/2 flex items-center justify-center p-4 sm:p-8 lg:p-12\">\n        <div className=\"w-full max-w-sm sm:max-w-md space-y-6\">\n            {/* Mobile Branding (Visible only on small screens) */}\n            <div className=\"lg:hidden text-center mb-8\">\n                 <h1 className=\"text-4xl font-bold text-primary font-headline\">Vendetta</h1>\n                 <p className=\"text-muted-foreground mt-2\">Bienvenido de nuevo</p>\n            </div>\n            \n            {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n"
            },
            {
              "name": "login",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { LoginForm } from '@/components/auth/login/login-form'\nimport Link from 'next/link'\n\nexport default function LoginPage() {\n  return (\n    <>\n      <LoginForm />\n      <div className=\"mt-4 text-center text-sm\">\n        ¿No tienes una cuenta?{' '}\n        <Link href=\"/signup\" className=\"underline text-accent hover:text-accent/90\">\n          Regístrate\n        </Link>\n      </div>\n    </>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "signup",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { SignupForm } from '@/components/auth/signup/signup-form'\nimport Link from 'next/link'\n\nexport default function SignupPage() {\n  return (\n    <>\n      <SignupForm />\n      <div className=\"mt-4 text-center text-sm\">\n        ¿Ya tienes una cuenta?{' '}\n        <Link href=\"/login\" className=\"underline text-accent hover:text-accent/90\">\n          Inicia Sesión\n        </Link>\n      </div>\n    </>\n  )\n}\n"
                }
              ]
            }
          ]
        },
        {
          "name": "api",
          "type": "directory",
          "children": [
            {
              "name": "cron",
              "type": "directory",
              "children": [
                {
                  "name": "process-queues",
                  "type": "directory",
                  "children": [
                    {
                      "name": "route.ts",
                      "type": "file",
                      "content": "import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nexport async function GET(request: NextRequest) {\n  const authHeader = request.headers.get('authorization');\n  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {\n    return new NextResponse('Unauthorized', { status: 401 });\n  }\n\n  // Create a Supabase client with the Service Role Key to bypass RLS\n  // The 'procesar_colas' function might not be SECURITY DEFINER, so we need admin privileges.\n  const supabaseAdmin = createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\n  );\n\n  try {\n    const { error } = await supabaseAdmin.rpc('procesar_colas');\n\n    if (error) {\n      console.error('Error processing queues:', error);\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    return NextResponse.json({ processed: true });\n  } catch (err: any) {\n    console.error('Unexpected error processing queues:', err);\n    return NextResponse.json({ error: err.message }, { status: 500 });\n  }\n}\n"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "auth",
          "type": "directory",
          "children": [
            {
              "name": "callback",
              "type": "directory",
              "children": [
                {
                  "name": "route.ts",
                  "type": "file",
                  "content": "import { createClient } from '@/lib/supabase/server'\nimport { NextResponse } from 'next/server'\n\nexport async function GET(request: Request) {\n  const { searchParams, origin } = new URL(request.url)\n  const code = searchParams.get('code')\n  const next = searchParams.get('next') ?? '/'\n\n  if (code) {\n    const supabase = createClient()\n    const { error } = await supabase.auth.exchangeCodeForSession(code)\n    if (!error) {\n        // For password recovery, Supabase redirects to the specified URL.\n        // After code exchange, we can check for user and redirect to a reset password page.\n        const { data: { user } } = await supabase.auth.getUser()\n        if (searchParams.get('type') === 'recovery') {\n          return NextResponse.redirect(`${origin}/reset-password`)\n        }\n        return NextResponse.redirect(`${origin}${next}`)\n    }\n  }\n\n  // return the user to an error page with instructions\n  return NextResponse.redirect(`${origin}/login?message=No se pudo autenticar al usuario.`)\n}\n"
                }
              ]
            }
          ]
        },
        {
          "name": "dashboard",
          "type": "directory",
          "children": [
            {
              "name": "buildings",
              "type": "directory",
              "children": [
                {
                  "name": "[id]",
                  "type": "directory",
                  "children": [
                    {
                      "name": "page.tsx",
                      "type": "file",
                      "content": "import { createClient } from '@/lib/supabase/server';\nimport { redirect } from 'next/navigation';\nimport { getBuildingProductionProjection } from '@/lib/actions/buildings';\nimport BuildingDetailsHeader from '@/components/buildings/building-details-header';\nimport ProductionTable from '@/components/buildings/production-table';\nimport { BaseBuildingRPC } from '@/types/legacy_schema';\n\nexport default async function BuildingDetailsPage({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        redirect('/auth/login');\n    }\n\n    // Fetch Base ID (Assuming single base)\n    const { data: bases } = await supabase.from('bases').select('id').eq('user_id', user.id).limit(1);\n    if (!bases || bases.length === 0) return <div>No base found</div>;\n    const baseId = bases[0].id;\n\n    // Fetch Building Details via RPC (reuse get_base_buildings but filter in JS or DB)\n    // Ideally we should have get_building_details RPC, but get_base_buildings works if we filter.\n    // Efficiency note: Fetching all buildings to find one is suboptimal but acceptable for migration MVP (10-20 items).\n    const { data: allBuildings, error } = await supabase.rpc('get_base_buildings', { p_base_id: baseId });\n\n    if (error || !allBuildings) {\n        return <div>Error loading building</div>;\n    }\n\n    // Cast and Find\n    const buildings = allBuildings as BaseBuildingRPC[];\n    const building = buildings.find(b => b.building_id === id); // building_id is the config id (e.g. 'armeria')\n\n    if (!building) {\n        return <div>Edificio no encontrado o no disponible.</div>;\n    }\n\n    // Fetch Production Projection\n    const projection = await getBuildingProductionProjection(baseId, id);\n\n    return (\n        <div className=\"container mx-auto p-4 space-y-6\">\n            <BuildingDetailsHeader building={building} />\n            <ProductionTable projection={projection} currentLevel={building.level} />\n        </div>\n    );\n}\n"
                    }
                  ]
                },
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { createClient } from '@/lib/supabase/server';\nimport { notFound, redirect } from 'next/navigation';\nimport ConstructionQueue from '@/components/buildings/ConstructionQueue';\nimport BuildingList from '@/components/buildings/BuildingList';\nimport { BaseBuildingRPC, ConstructionQueueItem } from '@/types/legacy_schema';\n\nexport default async function BuildingsPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect('/auth/login');\n  }\n\n  // Fetch Base (Assuming single base for now or first base)\n  const { data: bases } = await supabase\n    .from('bases')\n    .select('id')\n    .eq('user_id', user.id)\n    .limit(1);\n\n  if (!bases || bases.length === 0) {\n    // If no legacy base exists, handling is tricky. Redirect to creation or show error?\n    // For now, let's assume one exists or redirect to an initializer.\n    // Ideally we might trigger an initial setup here.\n    return <div className=\"p-8 text-center\">No base found. Please contact support or restart.</div>;\n  }\n\n  const baseId = bases[0].id;\n\n  // Parallel Fetching\n  const [buildingsRes, queueRes] = await Promise.all([\n    supabase.rpc('get_base_buildings', { p_base_id: baseId }),\n    supabase.rpc('get_construction_queue', { p_base_id: baseId }),\n  ]);\n\n  if (buildingsRes.error || queueRes.error) {\n    console.error('Fetch Error:', buildingsRes.error, queueRes.error);\n    return <div>Error loading building data.</div>;\n  }\n\n  // Cast to correct flat type\n  const buildings = buildingsRes.data as BaseBuildingRPC[];\n  const queue = queueRes.data as ConstructionQueueItem[];\n\n  const isQueueFull = queue.length >= 5;\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      <h1 className=\"text-2xl font-bold mb-4\">Habitaciones</h1>\n\n      {/* Queue Section */}\n      <section>\n        <ConstructionQueue queue={queue} />\n      </section>\n\n      {/* Buildings Grid */}\n      <section>\n        <h2 className=\"text-xl font-semibold mb-4 text-slate-300\">Edificios Disponibles</h2>\n        <BuildingList\n            buildings={buildings}\n            baseId={baseId}\n            isQueueFull={isQueueFull}\n        />\n      </section>\n    </div>\n  );\n}\n"
                }
              ]
            },
            {
              "name": "layout.tsx",
              "type": "file",
              "content": "import { createClient } from '@/lib/supabase/server';\nimport { redirect } from 'next/navigation';\nimport { SideNav } from '@/components/dashboard/side-nav';\nimport { ResourceBar } from '@/components/dashboard/resource-bar';\nimport { SidebarProvider, Sidebar, SidebarTrigger, SidebarInset } from '@/components/ui/sidebar';\nimport { getUserProperty, getDashboardData } from '@/lib/services/game.service';\nimport { GameStateProvider } from '@/components/providers/game-state-provider';\n\nexport default async function DashboardLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const supabase = await createClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect('/login');\n  }\n\n  // Fetch initial game state\n  const propertyId = await getUserProperty(user.id);\n  const initialData = propertyId ? await getDashboardData(propertyId) : null;\n\n  return (\n    <GameStateProvider initialData={initialData}>\n      <SidebarProvider>\n        <div className=\"flex min-h-screen bg-stone-300 text-black\">\n          <Sidebar>\n            <SideNav userEmail={user.email} />\n          </Sidebar>\n          <SidebarInset>\n            <div className=\"flex flex-1 flex-col\">\n              <header className=\"bg-primary/90 text-primary-foreground flex justify-start items-center px-4 py-1 text-sm border-b-2 border-black/20 shadow-md\">\n                <div className=\"flex items-center gap-2\">\n                  <SidebarTrigger />\n                </div>\n              </header>\n              <ResourceBar />\n              <main className=\"flex-1 p-4 overflow-y-auto\">\n                  {children}\n              </main>\n            </div>\n          </SidebarInset>\n        </div>\n      </SidebarProvider>\n    </GameStateProvider>\n  );\n}\n"
            },
            {
              "name": "map",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "\nimport { MapControls } from \"@/components/dashboard/map/map-controls\";\nimport { CityMap } from \"@/components/dashboard/map/city-map\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\nimport { getMapTiles, getUserProperty, getDashboardData, MapTileData } from \"@/lib/services/game.service\";\nimport { createClient } from '@/lib/supabase/server';\n\ntype SearchParams = Promise<{ [key: string]: string | string[] | undefined }>\n\nexport default async function MapPage({\n    searchParams,\n}: {\n    searchParams: SearchParams\n}) {\n    const params = await searchParams;\n    let city = params.city ? parseInt(params.city as string) : null;\n    let district = params.district ? parseInt(params.district as string) : null;\n\n    let userProperty = null;\n    let dashboardData = null;\n\n    // Fetch user property to determine origin\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n    if (user) {\n        const propertyId = await getUserProperty(user.id);\n        if (propertyId) {\n            dashboardData = await getDashboardData(propertyId);\n            if (dashboardData) {\n                userProperty = {\n                    city: dashboardData.propiedad.coordenada_ciudad,\n                    district: dashboardData.propiedad.coordenada_barrio,\n                    building: dashboardData.propiedad.coordenada_edificio\n                };\n\n                // If coordinates are missing from URL, use user's location\n                if (city === null || district === null) {\n                    city = userProperty.city;\n                    district = userProperty.district;\n                }\n            }\n        }\n    }\n\n    // Default fallbacks if user has no property or something fails\n    const currentCity = city ?? 1;\n    const currentDistrict = district ?? 1;\n\n    const tilesData = await getMapTiles(currentCity, currentDistrict);\n\n    return (\n        <Card className=\"border-primary bg-stone-950 text-stone-100 min-h-[calc(100vh-8rem)]\">\n            <CardHeader className=\"bg-stone-900/50 py-3 px-6 border-b border-stone-800\">\n                <CardTitle className=\"text-xl text-amber-500 tracking-tight flex items-center justify-between\">\n                    <span>Mapa Táctico</span>\n                    <span className=\"text-sm font-mono text-stone-500 bg-stone-900 px-2 py-1 rounded\">\n                        Sector {currentCity}:{currentDistrict}\n                    </span>\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0 flex flex-col items-center gap-0\">\n                <div className=\"w-full bg-stone-900/30 p-4 border-b border-stone-800 flex justify-center\">\n                    <MapControls currentCity={currentCity} currentDistrict={currentDistrict} />\n                </div>\n                <div className=\"w-full flex-1 p-6 flex justify-center items-start bg-[url('/grid-bg.png')] bg-repeat overflow-auto\">\n                    <CityMap\n                        tiles={tilesData}\n                        currentCity={currentCity}\n                        currentDistrict={currentDistrict}\n                        userProperty={userProperty}\n                    />\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n"
                }
              ]
            },
            {
              "name": "overview",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { createClient } from \"@/lib/supabase/server\";\nimport { getActiveMissions, getDashboardData, getFamilyInfo, getIncomingAttacks, getUserProperty } from \"@/lib/services/game.service\";\nimport { OverviewWrapper } from \"@/components/dashboard/overview/overview-wrapper\";\nimport { DashboardData } from \"@/types/game\";\n\nexport default async function OverviewPage() {\n    const supabase = await createClient();\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        return <div>Acceso denegado</div>;\n    }\n\n    const propertyId = await getUserProperty(user.id);\n\n    if (!propertyId) {\n        return <div>No se encontró propiedad para el usuario.</div>;\n    }\n\n    // Parallel data fetching\n    const [dashboardData, familyInfo] = await Promise.all([\n        getDashboardData(propertyId),\n        getFamilyInfo(user.id)\n    ]);\n\n    if (!dashboardData) {\n        return <div>Error cargando datos.</div>;\n    }\n\n    return (\n        <OverviewWrapper\n            initialData={dashboardData}\n            familyInfo={familyInfo}\n        />\n    );\n}\n"
                }
              ]
            },
            {
              "name": "page.tsx",
              "type": "file",
              "content": "'use client';\nimport { ServerTime } from '@/components/dashboard/server-time';\nimport { Troops } from '@/components/dashboard/troops';\nimport { ExpandingRooms } from '@/components/dashboard/expanding-rooms';\nimport { BuildingInfo } from '@/components/dashboard/building-info';\nimport { Training } from '@/components/dashboard/training';\nimport { TroopsDefense } from '@/components/dashboard/troops-defense';\nimport { TroopsInTraining } from '@/components/dashboard/troops-in-training';\nimport { Needles } from '@/components/dashboard/needles';\n\nexport default function DashboardPage() {\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n      <div className=\"lg:col-span-1 space-y-4\">\n        <ServerTime />\n        <Troops />\n        <ExpandingRooms />\n        <Training />\n      </div>\n      <div className=\"lg:col-span-2 space-y-4\">\n        <BuildingInfo />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4\">\n          <TroopsDefense />\n          <TroopsInTraining />\n        </div>\n        <Needles />\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "name": "poderataque",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n  } from \"@/components/ui/table\";\nimport { attackPowerData } from \"@/lib/data/poderataque-data\";\n\nexport default function AttackPowerPage() {\n    return (\n        <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n            <CardHeader className=\"bg-primary/80 py-3 px-4\">\n                <CardTitle className=\"text-xl text-primary-foreground\">\n                    Poder de ataque ( % )\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n                <div className=\"overflow-x-auto\">\n                    <Table>\n                        <TableHeader>\n                            <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                                <TableHead className=\"text-primary-foreground font-bold align-bottom\" rowSpan={2}>Edificios</TableHead>\n                                <TableHead className=\"text-primary-foreground font-bold text-center\" colSpan={attackPowerData.honorLevels.length}>Onore</TableHead>\n                            </TableRow>\n                            <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                                {attackPowerData.honorLevels.map(level => (\n                                    <TableHead key={level} className=\"text-primary-foreground text-center\">{level}</TableHead>\n                                ))}\n                            </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                            {attackPowerData.buildingLevels.map((row, index) => (\n                                <TableRow key={index} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                    <TableCell className=\"font-semibold text-center\">{row.level}</TableCell>\n                                    {row.values.map((value, vIndex) => (\n                                        <TableCell key={vIndex} className=\"text-center\">{value}</TableCell>\n                                    ))}\n                                </TableRow>\n                            ))}\n                        </TableBody>\n                    </Table>\n                </div>\n            </CardContent>\n        </Card>\n    )\n}\n"
                }
              ]
            },
            {
              "name": "recruitment",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { createClient } from \"@/lib/supabase/server\";\nimport { getDashboardData, getUserProperty } from \"@/lib/services/game.service\";\nimport { RecruitmentView } from \"@/components/dashboard/recruitment/recruitment-view\";\nimport { ConfiguracionTropa } from \"@/types/game\";\n\nexport default async function RecruitmentPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n      return <div>Acceso denegado</div>;\n  }\n\n  const propertyId = await getUserProperty(user.id);\n\n  if (!propertyId) {\n      return <div>No se encontró propiedad para el usuario.</div>;\n  }\n\n  // Run fetches in parallel\n  const [dashboardData, troopsData] = await Promise.all([\n    getDashboardData(propertyId),\n    supabase.from('configuracion_tropa').select('*').order('costo_dolares', { ascending: true })\n  ]);\n\n  if (!dashboardData) {\n      return <div>Error cargando datos del dashboard.</div>;\n  }\n\n  if (troopsData.error) {\n    console.error('Error fetching troops:', troopsData.error);\n    return <div>Error cargando configuración de tropas.</div>;\n  }\n\n  const troops = troopsData.data as ConfiguracionTropa[];\n\n  return <RecruitmentView initialData={dashboardData} troops={troops} />;\n}\n"
                }
              ]
            },
            {
              "name": "resources",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { TotalProduction } from \"@/components/dashboard/resources/total-production\";\nimport { BuildingProduction } from \"@/components/dashboard/resources/building-production\";\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n  } from \"@/components/ui/select\"\n  \n\nexport default function ResourcesPage() {\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center gap-2\">\n                <span className=\"font-semibold\">Edificio:</span>\n                <Select defaultValue=\"34:13:129\">\n                    <SelectTrigger className=\"w-[180px] bg-stone-200 border-primary/50 text-black\">\n                        <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                        <SelectItem value=\"34:13:129\">34:13:129</SelectItem>\n                    </SelectContent>\n                </Select>\n            </div>\n            <TotalProduction />\n            <BuildingProduction />\n        </div>\n    );\n}"
                }
              ]
            },
            {
              "name": "rooms",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "import { createClient } from \"@/lib/supabase/server\";\nimport { getDashboardData, getUserProperty } from \"@/lib/services/game.service\";\nimport { RoomsView } from \"@/components/dashboard/rooms/rooms-view\";\n\nexport default async function RoomsPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n      return <div>Acceso denegado</div>;\n  }\n\n  const propertyId = await getUserProperty(user.id);\n\n  if (!propertyId) {\n      return <div>No se encontró propiedad para el usuario.</div>;\n  }\n\n  const dashboardData = await getDashboardData(propertyId);\n\n  if (!dashboardData) {\n      return <div>Error cargando datos.</div>;\n  }\n\n  return <RoomsView initialData={dashboardData} />;\n}\n"
                }
              ]
            },
            {
              "name": "tech-tree",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "\nimport { createClient } from '@/lib/supabase/server'\nimport { getDashboardData } from '@/lib/services/game.service'\nimport { TechTreeView } from '@/components/dashboard/tech-tree/tech-tree-view'\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\"\nimport { Construction } from 'lucide-react'\nimport { Recursos } from '@/types/game'\nimport { ColaInvestigacion } from '@/types/database'\n\nexport default async function TechTreePage() {\n  const supabase = await createClient()\n\n  // 1. Get user property\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) return <div>No user found</div>\n\n  const { data: prop } = await supabase\n    .from('propiedad')\n    .select('id')\n    .eq('usuario_id', user.id)\n    .maybeSingle()\n\n  if (!prop) return <div>No property found</div>\n\n  // 2. Fetch Dashboard Data (User Progress, Resources, Queue)\n  const dashboardData = await getDashboardData(prop.id)\n\n  // 3. Fetch Static Configs\n  const { data: configs } = await supabase\n    .from('configuracion_entrenamiento')\n    .select('*')\n    .order('nombre')\n\n  // 4. Fetch Requirements\n  const { data: requirements } = await supabase\n    .from('requisito_entrenamiento')\n    .select('*')\n\n  // 5. Fetch Active Queue specifically for this property if not fully reliable from dashboardData\n  const { data: realQueue } = await supabase\n      .from('cola_investigacion')\n      .select('*')\n      .eq('propiedad_id', prop.id)\n      .maybeSingle()\n\n  if (!dashboardData || !configs) {\n    return (\n        <Alert variant=\"destructive\">\n            <AlertTitle>Error</AlertTitle>\n            <AlertDescription>No se pudieron cargar los datos.</AlertDescription>\n        </Alert>\n    )\n  }\n\n  // Transform Resources\n  const simpleResources: Recursos = {\n      armas: dashboardData.recursos.armas.val,\n      municion: dashboardData.recursos.municion.val,\n      alcohol: dashboardData.recursos.alcohol.val,\n      dolares: dashboardData.recursos.dolares.val\n  }\n\n  return (\n    <div className=\"space-y-4\">\n        <Card className=\"border-primary bg-stone-200 text-black\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4 flex flex-row items-center gap-2\">\n                <Construction className=\"w-6 h-6 text-primary-foreground\" />\n                <CardTitle className=\"text-lg text-primary-foreground\">\n                    Centro de Investigación (Tech Tree)\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n               <TechTreeView \n                  configs={configs}\n                  requirements={requirements || []}\n                  userResearch={dashboardData.investigaciones || []}\n                  queue={realQueue as ColaInvestigacion | null} \n                  activeQueueItem={realQueue as ColaInvestigacion}\n                  resources={simpleResources}\n                  propertyId={prop.id}\n               />\n            </CardContent>\n        </Card>\n    </div>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "training",
              "type": "directory",
              "children": [
                {
                  "name": "page.tsx",
                  "type": "file",
                  "content": "\nimport { trainingData } from \"@/lib/data/training-data\";\nimport { TrainingCard } from \"@/components/dashboard/training/training-card\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\n\nexport default function TrainingPage() {\n  return (\n    <div className=\"space-y-4\">\n        <Card className=\"border-primary bg-stone-200 text-black\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4\">\n                <CardTitle className=\"text-lg text-primary-foreground\">\n                    Allenamento\n                </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-4 space-y-4\">\n                {trainingData.map((training) => (\n                    <TrainingCard key={training.id} training={training} />\n                ))}\n            </CardContent>\n        </Card>\n    </div>\n  );\n}\n"
                }
              ]
            }
          ]
        },
        {
          "name": "favicon.ico",
          "type": "file",
          "content": "<binary or unreadable content>"
        },
        {
          "name": "globals.css",
          "type": "file",
          "content": "@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --background: 0 0% 7%;\n    --foreground: 0 0% 98%;\n    --card: 224 71.4% 4.1%;\n    --card-foreground: 210 20% 98%;\n    --popover: 0 0% 7%;\n    --popover-foreground: 0 0% 98%;\n    --primary: 0 54% 38%;\n    --primary-foreground: 0 0% 98%;\n    --secondary: 0 0% 15%;\n    --secondary-foreground: 0 0% 98%;\n    --muted: 0 0% 15%;\n    --muted-foreground: 0 0% 63.9%;\n    --accent: 350 79% 51%;\n    --accent-foreground: 0 0% 98%;\n    --destructive: 0 63% 31%;\n    --destructive-foreground: 0 0% 98%;\n    --border: 0 0% 25%;\n    --input: 0 0% 15%;\n    --ring: 0 54% 38%;\n    --radius: 0.2rem;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply bg-background text-foreground;\n  }\n  .vendetta-font {\n    font-family: 'Playfair Display', serif;\n    font-weight: 700;\n    text-transform: uppercase;\n    letter-spacing: 0.2em;\n    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);\n  }\n}\n"
        },
        {
          "name": "layout.tsx",
          "type": "file",
          "content": "import type {Metadata} from 'next';\nimport './globals.css';\nimport { Toaster } from \"@/components/ui/toaster\";\n\nexport const metadata: Metadata = {\n  title: 'Vendetta Game',\n  description: 'El juego de estrategia y conquista',\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"es\" className=\"dark\">\n      <head>\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"anonymous\" />\n        <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700&display=swap\" rel=\"stylesheet\" />\n      </head>\n      <body className=\"font-body antialiased bg-background text-foreground\">\n        {children}\n        <Toaster />\n      </body>\n    </html>\n  );\n}\n"
        },
        {
          "name": "page.tsx",
          "type": "file",
          "content": "import { LandingPage } from '@/components/landing/landing-page';\n\nexport default function HomePage() {\n  return <LandingPage />;\n}\n"
        },
        {
          "name": "reset-password",
          "type": "directory",
          "children": [
            {
              "name": "page.tsx",
              "type": "file",
              "content": "import { ResetPasswordForm } from '@/components/reset-password/reset-password-form'\n\nexport default function ResetPasswordPage() {\n  return (\n    <div className=\"flex min-h-screen w-full items-center justify-center bg-background p-4\">\n      <div className=\"w-full max-w-md\">\n        <ResetPasswordForm />\n      </div>\n    </div>\n  )\n}\n"
            }
          ]
        }
      ]
    },
    {
      "name": "components",
      "type": "directory",
      "children": [
        {
          "name": "auth",
          "type": "directory",
          "children": [
            {
              "name": "forgot-password",
              "type": "directory",
              "children": [
                {
                  "name": "forgot-password-form.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { forgotPassword } from '@/actions/auth.stubs'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect, useState } from 'react'\nimport { useToast } from '@/hooks/use-toast'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\nimport { Terminal } from 'lucide-react'\n\nconst initialState = {\n  message: '',\n  errors: {} as Record<string, string[]>,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Enviando...' : 'Enviar enlace de restablecimiento'}\n    </Button>\n  )\n}\n\nexport function ForgotPasswordForm() {\n  const [state, formAction] = useActionState(forgotPassword, initialState)\n  const { toast } = useToast()\n  const [showSuccess, setShowSuccess] = useState(false)\n\n  useEffect(() => {\n    if (state?.message && !state.errors) {\n      setShowSuccess(true)\n    } else if (state?.message) {\n      toast({\n        title: 'Error',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  if(showSuccess) {\n    return (\n        <Alert>\n          <Terminal className=\"h-4 w-4\" />\n          <AlertTitle>¡Revisa tu correo!</AlertTitle>\n          <AlertDescription>\n            {state.message}\n          </AlertDescription>\n        </Alert>\n    )\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">¿Olvidaste tu contraseña?</CardTitle>\n        <CardDescription>\n          Ingresa tu correo electrónico y te enviaremos un enlace para restablecerla.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Correo Electrónico</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              placeholder=\"nombre@ejemplo.com\"\n              required\n            />\n            {state?.errors?.email && (\n              <p className=\"text-sm text-destructive\">{state.errors.email[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "login",
              "type": "directory",
              "children": [
                {
                  "name": "login-form.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { loginAction as login } from '@/actions/auth.actions'\nimport { SocialButtons } from '@/components/auth/social-buttons'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport Link from 'next/link'\nimport { useEffect } from 'react'\nimport { useToast } from '@/hooks/use-toast'\nimport { Button } from 'react-day-picker'\n\nconst initialState = {\n  message: '',\n  errors: undefined,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Iniciando Sesión...' : 'Iniciar Sesión'}\n    </Button>\n  )\n}\n\nexport function LoginForm() {\n  const [state, formAction] = useActionState(login, initialState)\n  const { toast } = useToast()\n\n  useEffect(() => {\n    if (state?.message) {\n      toast({\n        title: 'Error de inicio de sesión',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Iniciar Sesión</CardTitle>\n        <CardDescription>\n          Ingresa tu correo electrónico para acceder a tu cuenta.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Correo Electrónico</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              placeholder=\"nombre@ejemplo.com\"\n              required\n              defaultValue=\"profematiasprestes@gmail.com\"\n            />\n            {state?.errors?.email && (\n              <p className=\"text-sm text-destructive\">{state.errors.email[0]}</p>\n            )}\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center\">\n              <Label htmlFor=\"password\">Contraseña</Label>\n              <Link\n                href=\"/forgot-password\"\n                className=\"ml-auto inline-block text-sm underline text-accent hover:text-accent/90\"\n              >\n                ¿Olvidaste tu contraseña?\n              </Link>\n            </div>\n            <Input id=\"password\" name=\"password\" type=\"password\" required defaultValue=\"password123\" />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n        <div className=\"relative my-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <span className=\"w-full border-t\" />\n          </div>\n          <div className=\"relative flex justify-center text-xs uppercase\">\n            <span className=\"bg-card px-2 text-muted-foreground\">O continúa con</span>\n          </div>\n        </div>\n        <SocialButtons />\n      </CardContent>\n    </Card>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "signup",
              "type": "directory",
              "children": [
                {
                  "name": "signup-form.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { registerAction as signup } from '@/actions/auth.actions'\nimport { SocialButtons } from '@/components/auth/social-buttons'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect, useState } from 'react'\nimport { useToast } from '@/hooks/use-toast'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\nimport { Terminal } from 'lucide-react'\nimport { Button } from 'react-day-picker'\n\nconst initialState = {\n  message: '',\n  errors: undefined,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Creando cuenta...' : 'Crear una cuenta'}\n    </Button>\n  )\n}\n\nexport function SignupForm() {\n  const [state, formAction] = useActionState(signup, initialState)\n  const { toast } = useToast()\n  const [showSuccess, setShowSuccess] = useState(false)\n\n  useEffect(() => {\n    if (state?.message && !state.errors) {\n      setShowSuccess(true)\n    } else if (state?.message) {\n      toast({\n        title: 'Error de registro',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  if (showSuccess) {\n    return (\n        <Alert>\n          <Terminal className=\"h-4 w-4\" />\n          <AlertTitle>¡Hecho!</AlertTitle>\n          <AlertDescription>\n            {state.message}\n          </AlertDescription>\n        </Alert>\n    )\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Registrarse</CardTitle>\n        <CardDescription>\n          Ingresa tu información para crear una cuenta.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"fullName\">Nombre Completo</Label>\n            <Input\n              id=\"fullName\"\n              name=\"fullName\"\n              type=\"text\"\n              placeholder=\"Tu nombre\"\n              required\n            />\n            {state?.errors?.fullName && (\n              <p className=\"text-sm text-destructive\">{state.errors.fullName[0]}</p>\n            )}\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Correo Electrónico</Label>\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              placeholder=\"nombre@ejemplo.com\"\n              required\n            />\n             {state?.errors?.email && (\n              <p className=\"text-sm text-destructive\">{state.errors.email[0]}</p>\n            )}\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Contraseña</Label>\n            <Input id=\"password\" name=\"password\" type=\"password\" required />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n        <div className=\"relative my-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <span className=\"w-full border-t\" />\n          </div>\n          <div className=\"relative flex justify-center text-xs uppercase\">\n            <span className=\"bg-card px-2 text-muted-foreground\">O continúa con</span>\n          </div>\n        </div>\n        <SocialButtons />\n      </CardContent>\n    </Card>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "social-buttons.tsx",
              "type": "file",
              "content": "'use client'\nimport { Button } from '@/components/ui/button'\nimport { socialLogin } from '@/actions/auth.stubs'\nimport { Github } from 'lucide-react'\n\nconst GoogleIcon = () => (\n    <svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 mr-2\">\n      <path\n        fill=\"#4285F4\"\n        d=\"M22.56,12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26,1.37-1.04,2.53-2.21,3.31v2.77h3.57c2.08-1.92,3.28-4.74,3.28-8.09Z\"\n      />\n      <path\n        fill=\"#34A853\"\n        d=\"M12,23c2.97,0,5.46-.98,7.28-2.66l-3.57-2.77c-.98,.66-2.23,1.06-3.71,1.06-2.86,0-5.29-1.93-6.16-4.53H2.18v2.84C3.99,20.53,7.7,23,12,23Z\"\n      />\n      <path\n        fill=\"#FBBC05\"\n        d=\"M5.84,14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43,.35-2.09V7.07H2.18C1.43,8.55,1,10.22,1,12s.43,3.45,1.18,4.93l3.66-2.84Z\"\n      />\n      <path\n        fill=\"#EA4335\"\n        d=\"M12,5.38c1.62,0,3.06,.56,4.21,1.64l3.15-3.15C17.45,2.09,14.97,1,12,1,7.7,1,3.99,3.47,2.18,7.07l3.66,2.84c.87-2.6,3.3-4.53,6.16-4.53Z\"\n      />\n    </svg>\n  );\n\nexport function SocialButtons() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <form action={() => socialLogin('google')}>\n          <Button variant=\"outline\" type=\"submit\" className=\"w-full\">\n              <GoogleIcon /> Google\n          </Button>\n        </form>\n        <form action={() => socialLogin('github')}>\n          <Button variant=\"outline\" type=\"submit\" className=\"w-full\">\n              <Github className=\"mr-2 h-4 w-4\" /> Github\n          </Button>\n        </form>\n    </div>\n  )\n}\n"
            }
          ]
        },
        {
          "name": "buildings",
          "type": "directory",
          "children": [
            {
              "name": "BuildingCard.tsx",
              "type": "file",
              "content": "'use client';\n\nimport { useOptimistic, useTransition } from 'react';\nimport Link from 'next/link';\nimport { enqueueBuildingUpgrade } from '@/lib/actions/buildings';\nimport { BaseBuildingRPC } from '@/types/legacy_schema';\n\ninterface BuildingCardProps {\n  building: BaseBuildingRPC;\n  baseId: string;\n  isQueueFull: boolean;\n}\n\nexport default function BuildingCard({ building, baseId, isQueueFull }: BuildingCardProps) {\n  const [isPending, startTransition] = useTransition();\n\n  const handleUpgrade = () => {\n    startTransition(async () => {\n      const result = await enqueueBuildingUpgrade(baseId, building.building_id); // Use building_id (config id)\n      if (result.error) {\n        alert(result.error);\n      }\n    });\n  };\n\n  const canAfford = true;\n  const isDisabled = isQueueFull || isPending || !canAfford;\n\n  return (\n    <div className=\"bg-slate-800 border border-slate-700 rounded-lg p-4 flex flex-col md:flex-row gap-4\">\n      {/* Image Fallback */}\n      <div className=\"w-full md:w-32 h-32 bg-slate-700 rounded-md flex-shrink-0 relative overflow-hidden\">\n        {building.name && (\n          <div className=\"absolute inset-0 flex items-center justify-center text-xs text-slate-500\">\n             {building.name[0]}\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex-grow\">\n        <Link href={`/dashboard/buildings/${building.building_id}`} className=\"hover:underline\">\n            <h3 className=\"text-lg font-bold text-white cursor-pointer\">\n            {building.name} <span className=\"text-sm font-normal text-slate-400\">(Nivel {building.level})</span>\n            </h3>\n        </Link>\n        <p className=\"text-sm text-slate-400 mt-1 mb-2 line-clamp-2\">\n          {building.description}\n        </p>\n\n        <div className=\"flex gap-4 text-xs text-slate-300\">\n          <span title=\"Armamentos\">🔫 {building.cost_armaments}</span>\n          <span title=\"Munición\">📦 {building.cost_munitions}</span>\n          <span title=\"Dólares\">💵 {building.cost_dollars}</span>\n          <span title=\"Duración\">⏱ {building.base_duration}s</span>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col justify-center items-end min-w-[120px]\">\n        {isDisabled ? (\n           <button\n             disabled\n             className=\"px-4 py-2 bg-slate-600 text-slate-300 rounded cursor-not-allowed w-full text-center\"\n           >\n             {isPending ? 'Encolando...' : isQueueFull ? 'Cola Llena' : 'Recursos Insuf.'}\n           </button>\n        ) : (\n          <button\n            onClick={handleUpgrade}\n            className=\"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors w-full\"\n          >\n            Mejorar\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "name": "BuildingList.tsx",
              "type": "file",
              "content": "import { BaseBuildingRPC } from '@/types/legacy_schema';\nimport BuildingCard from './BuildingCard';\n\ninterface BuildingListProps {\n  buildings: BaseBuildingRPC[];\n  baseId: string;\n  isQueueFull: boolean;\n}\n\nexport default function BuildingList({ buildings, baseId, isQueueFull }: BuildingListProps) {\n  return (\n    <div className=\"space-y-4\">\n      {buildings.map((b) => (\n        <BuildingCard\n          key={b.building_id}\n          building={b}\n          baseId={baseId}\n          isQueueFull={isQueueFull}\n        />\n      ))}\n    </div>\n  );\n}\n"
            },
            {
              "name": "ConstructionQueue.tsx",
              "type": "file",
              "content": "'use client';\n\nimport { useTransition } from 'react';\nimport { cancelBuildingUpgrade } from '@/lib/actions/buildings';\nimport { ConstructionQueueItem } from '@/types/legacy_schema';\n\ninterface ConstructionQueueProps {\n  queue: ConstructionQueueItem[];\n}\n\nexport default function ConstructionQueue({ queue }: ConstructionQueueProps) {\n  const [isPending, startTransition] = useTransition();\n\n  const handleCancel = (queueId: string) => {\n    if (confirm('¿Cancelar esta construcción? Se reembolsarán los recursos.')) {\n        startTransition(async () => {\n            const result = await cancelBuildingUpgrade(queueId);\n            if (result.error) alert(result.error);\n        });\n    }\n  };\n\n  if (!queue || queue.length === 0) {\n    return <div className=\"p-4 bg-slate-800 rounded-lg text-slate-400 text-center text-sm\">Cola de construcción vacía</div>;\n  }\n\n  return (\n    <div className=\"bg-slate-800 rounded-lg overflow-hidden border border-slate-700\">\n      <div className=\"bg-slate-900 px-4 py-2 border-b border-slate-700 font-semibold text-slate-200 text-sm\">\n        Cola de Construcción ({queue.length}/5)\n      </div>\n      <table className=\"w-full text-sm text-left text-slate-300\">\n        <thead className=\"bg-slate-700/50 text-xs uppercase text-slate-400\">\n          <tr>\n            <th className=\"px-4 py-2\">#</th>\n            <th className=\"px-4 py-2\">Edificio</th>\n            <th className=\"px-4 py-2\">Nivel</th>\n            <th className=\"px-4 py-2\">Fin</th>\n            <th className=\"px-4 py-2 text-right\">Acción</th>\n          </tr>\n        </thead>\n        <tbody>\n          {queue.map((item, index) => (\n            <tr key={item.id} className=\"border-b border-slate-700/50 last:border-0 hover:bg-slate-700/30 transition-colors\">\n              <td className=\"px-4 py-2 font-mono text-slate-500\">{index + 1}</td>\n              <td className=\"px-4 py-2 font-medium text-white\">{item.building_name}</td>\n              <td className=\"px-4 py-2\">{item.target_level}</td>\n              <td className=\"px-4 py-2 text-xs\">\n                 {/* Simple formatting for now. Ideally client-side countdown */}\n                 {new Date(item.end_time).toLocaleTimeString()}\n              </td>\n              <td className=\"px-4 py-2 text-right\">\n                <button\n                  onClick={() => handleCancel(item.id)}\n                  disabled={isPending}\n                  className=\"text-red-400 hover:text-red-300 text-xs underline disabled:opacity-50\"\n                >\n                  Cancelar\n                </button>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n"
            },
            {
              "name": "building-details-header.tsx",
              "type": "file",
              "content": "'use client';\n\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { BaseBuildingRPC } from '@/types/legacy_schema';\n\ninterface BuildingDetailsHeaderProps {\n    building: BaseBuildingRPC;\n}\n\nexport default function BuildingDetailsHeader({ building }: BuildingDetailsHeaderProps) {\n    return (\n        <div className=\"bg-slate-800 rounded-lg p-6 flex flex-col md:flex-row gap-6 border border-slate-700\">\n            <div className=\"w-full md:w-64 h-48 bg-slate-700 rounded-lg flex-shrink-0 relative overflow-hidden\">\n                {/* Fallback Image */}\n                <div className=\"absolute inset-0 flex items-center justify-center text-4xl text-slate-500\">\n                    {building.name[0]}\n                </div>\n            </div>\n\n            <div className=\"flex-grow space-y-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-white\">{building.name}</h1>\n                    <p className=\"text-xl text-slate-400\">Nivel Actual: <span className=\"text-white\">{building.level}</span></p>\n                </div>\n\n                <p className=\"text-slate-300 leading-relaxed\">\n                    {building.description}\n                </p>\n\n                <div className=\"flex gap-6 pt-4 border-t border-slate-700\">\n                     <div className=\"text-center\">\n                        <span className=\"block text-xs text-slate-500 uppercase\">Puntos por Nivel</span>\n                        <span className=\"text-lg font-mono text-yellow-500\">{building.points}</span>\n                     </div>\n                     <div className=\"text-center\">\n                        <span className=\"block text-xs text-slate-500 uppercase\">Duración Base</span>\n                        <span className=\"text-lg font-mono text-blue-400\">{building.base_duration}s</span>\n                     </div>\n                </div>\n\n                <div className=\"pt-4\">\n                    <Link href=\"/dashboard/buildings\">\n                        <button className=\"text-sm text-slate-400 hover:text-white underline\">\n                            ← Volver al listado\n                        </button>\n                    </Link>\n                </div>\n            </div>\n        </div>\n    );\n}\n"
            },
            {
              "name": "production-table.tsx",
              "type": "file",
              "content": "'use client';\n\ninterface ProductionRow {\n    level: number;\n    production_hourly: number;\n    resource_type: string | null;\n}\n\ninterface ProductionTableProps {\n    projection: ProductionRow[];\n    currentLevel: number;\n}\n\nexport default function ProductionTable({ projection, currentLevel }: ProductionTableProps) {\n    if (!projection || projection.length === 0) {\n        return null;\n    }\n\n    // Determine resource name from first row if available, or generic\n    const resourceName = projection[0].resource_type\n        ? projection[0].resource_type.charAt(0).toUpperCase() + projection[0].resource_type.slice(1)\n        : 'Recursos';\n\n    return (\n        <div className=\"bg-slate-800 rounded-lg overflow-hidden border border-slate-700 mt-6\">\n            <div className=\"bg-slate-900 px-6 py-4 border-b border-slate-700\">\n                <h3 className=\"text-lg font-semibold text-white\">Proyección de Producción</h3>\n            </div>\n\n            <table className=\"w-full text-left text-sm text-slate-300\">\n                <thead className=\"bg-slate-700/50 text-xs uppercase text-slate-400\">\n                    <tr>\n                        <th className=\"px-6 py-3\">Nivel</th>\n                        <th className=\"px-6 py-3 text-right\">Producción / Hora ({resourceName})</th>\n                        <th className=\"px-6 py-3 text-right\">Diferencia</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {projection.map((row, index) => {\n                        const isCurrent = row.level === currentLevel;\n                        const prevRow = index > 0 ? projection[index - 1] : null;\n                        const diff = prevRow ? row.production_hourly - prevRow.production_hourly : 0;\n\n                        return (\n                            <tr\n                                key={row.level}\n                                className={`border-b border-slate-700/50 last:border-0 ${isCurrent ? 'bg-blue-900/20' : 'hover:bg-slate-700/20'}`}\n                            >\n                                <td className=\"px-6 py-3 font-medium\">\n                                    {row.level} {isCurrent && <span className=\"ml-2 text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full\">Actual</span>}\n                                </td>\n                                <td className=\"px-6 py-3 text-right font-mono text-white\">\n                                    {row.production_hourly.toLocaleString()}\n                                </td>\n                                <td className=\"px-6 py-3 text-right font-mono text-green-400\">\n                                    {index > 0 && `+${diff.toLocaleString()}`}\n                                </td>\n                            </tr>\n                        );\n                    })}\n                </tbody>\n            </table>\n        </div>\n    );\n}\n"
            }
          ]
        },
        {
          "name": "dashboard",
          "type": "directory",
          "children": [
            {
              "name": "building-info.tsx",
              "type": "file",
              "content": "import Image from \"next/image\";\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport Link from \"next/link\";\n\nexport function BuildingInfo() {\n  const buildingImage = PlaceHolderImages.find(p => p.id === \"dark-alley\") || PlaceHolderImages.find(p => p.id === \"vendetta-header\");\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4\">\n        <CardTitle className=\"text-lg text-primary-foreground\">\n          all2 - Edificio 34:13:129\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4 flex flex-col items-center gap-2\">\n        {buildingImage && (\n             <Image\n                src={buildingImage.imageUrl}\n                alt={buildingImage.description}\n                width={400}\n                height={200}\n                className=\"w-full h-auto rounded\"\n                data-ai-hint={buildingImage.imageHint}\n            />\n        )}\n        <Link href=\"#\" className=\"text-sm hover:underline text-blue-800\">\n            Editar imagen\n        </Link>\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "buildings",
              "type": "directory",
              "children": [
                {
                  "name": "buildings-content.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { useGameState } from '@/components/providers/game-state-provider';\nimport { cancelConstructionAction } from '@/actions/game.actions';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useOptimistic, useTransition } from 'react';\nimport { useToast } from '@/hooks/use-toast';\nimport { ColaDetalle } from '@/types/game';\n\nexport function BuildingsContent() {\n  const { gameState } = useGameState();\n  const { toast } = useToast();\n  const [isPending, startTransition] = useTransition();\n\n  // Optimistic State for Construction Queue\n  const [optimisticQueue, removeOptimisticItem] = useOptimistic(\n    gameState?.colas.construccion || [],\n    (state, queueId: string) => state.filter((item) => item.id !== queueId)\n  );\n\n  if (!gameState) {\n    return <div className=\"p-4 text-center\">Cargando gestión de edificios...</div>;\n  }\n\n  const { propiedad } = gameState;\n  const queues = optimisticQueue;\n\n  const handleCancel = (queueId: string) => {\n    startTransition(async () => {\n      // Optimistic update\n      removeOptimisticItem(queueId);\n\n      // Server Action\n      const result = await cancelConstructionAction(queueId);\n\n      if (!result.success) {\n        toast({\n            variant: \"destructive\",\n            title: \"Error\",\n            description: result.error,\n        });\n        // Note: useOptimistic automatically reverts if we don't update state via other means,\n        // but since we are relying on revalidatePath in Server Action or Realtime,\n        // a failure implies the data won't change on server, so next render might show it again (correct).\n      } else {\n        toast({\n            title: \"Construcción cancelada\",\n            description: result.message,\n        });\n      }\n    });\n  };\n\n  const formatTime = (isoString: string) => {\n    const date = new Date(isoString);\n    const now = new Date();\n    const diff = Math.max(0, Math.floor((date.getTime() - now.getTime()) / 1000));\n\n    const hours = Math.floor(diff / 3600);\n    const minutes = Math.floor((diff % 3600) / 60);\n    const seconds = diff % 60;\n\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  };\n\n  // Mock property list row (since we only have 1 property currently in dashboard context)\n  // In a multi-property view, we would map over properties.\n  // Here we show the current property as the \"active\" one being managed.\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n        <CardHeader className=\"bg-primary/80 py-3 px-4\">\n            <CardTitle className=\"text-xl text-primary-foreground\">\n                Gestión de Edificios y Colas\n            </CardTitle>\n            <CardDescription className=\"text-primary-foreground/80 pt-1\">\n                Monitorea el estado de tus edificios. Actualizaciones de construcción en tiempo real.\n            </CardDescription>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n            {/* Vista de tabla para pantallas grandes */}\n            <div className=\"hidden md:block overflow-x-auto\">\n                <Table>\n                    <TableHeader>\n                        <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                            <TableHead className=\"text-primary-foreground\">Coordenadas</TableHead>\n                            <TableHead className=\"text-primary-foreground\">Nombre</TableHead>\n                            <TableHead className=\"text-primary-foreground\">Cola de Construcción</TableHead>\n                            <TableHead className=\"text-primary-foreground\">Acción</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-medium text-red-600\">\n                                [{propiedad.coordenada_ciudad}:{propiedad.coordenada_barrio}:{propiedad.coordenada_edificio}]\n                            </TableCell>\n                            <TableCell>\n                                <div className=\"flex flex-col gap-2\">\n                                    <span>{propiedad.nombre}</span>\n                                    <div className=\"flex gap-1\">\n                                        <Input defaultValue=\"Renombrar\" className=\"h-8 text-xs w-28\" disabled />\n                                        <Button variant=\"outline\" size=\"sm\" className=\"h-8 text-xs\" disabled>Renombrar</Button>\n                                    </div>\n                                </div>\n                            </TableCell>\n                            <TableCell>\n                                {queues.length === 0 ? (\n                                    <span className=\"text-stone-500 italic\">Sin construcciones en curso</span>\n                                ) : (\n                                    <div className=\"flex flex-col gap-2\">\n                                        {queues.map((item) => (\n                                            <div key={item.id} className=\"flex items-center gap-2 text-sm\">\n                                                <span className=\"text-red-600 font-semibold\">\n                                                    {item.nombre} (Niv. {item.nivel_destino})\n                                                </span>\n                                                <span className=\"font-mono text-xs\">\n                                                    {formatTime(item.fecha_fin)}\n                                                </span>\n                                                <button\n                                                    onClick={() => handleCancel(item.id)}\n                                                    disabled={isPending}\n                                                    className=\"text-red-600 hover:underline text-xs font-bold\"\n                                                >\n                                                    [X] Cancelar\n                                                </button>\n                                            </div>\n                                        ))}\n                                    </div>\n                                )}\n                            </TableCell>\n                            <TableCell>\n                                <Button variant=\"destructive\" size=\"sm\" className=\"bg-accent hover:bg-accent/90\">Gestionar</Button>\n                            </TableCell>\n                        </TableRow>\n                    </TableBody>\n                </Table>\n            </div>\n\n            {/* Vista de tarjetas para pantallas pequeñas */}\n            <div className=\"md:hidden p-4 space-y-4\">\n                <div className=\"bg-stone-300/60 p-4 rounded-lg border border-primary/30 space-y-3\">\n                     <div className=\"flex justify-between items-start\">\n                        <div>\n                            <p className=\"text-sm text-muted-foreground\">Coordenadas</p>\n                            <p className=\"font-medium text-red-600\">\n                                [{propiedad.coordenada_ciudad}:{propiedad.coordenada_barrio}:{propiedad.coordenada_edificio}]\n                            </p>\n                        </div>\n                        <Button variant=\"destructive\" size=\"sm\" className=\"bg-accent hover:bg-accent/90\">Gestionar</Button>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">Nombre</p>\n                        <div className=\"flex flex-col gap-2 mt-1\">\n                            <span>{propiedad.nombre}</span>\n                        </div>\n                    </div>\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">Cola de Construcción</p>\n                        <div className=\"flex flex-col mt-1 gap-2\">\n                            {queues.length === 0 ? (\n                                <span className=\"text-stone-500 italic text-sm\">Sin construcciones en curso</span>\n                            ) : (\n                                queues.map((item) => (\n                                    <div key={item.id} className=\"flex flex-col\">\n                                        <span className=\"text-red-600 font-semibold text-sm\">\n                                            {item.nombre} (Niv. {item.nivel_destino})\n                                        </span>\n                                        <div className=\"flex justify-between items-center\">\n                                            <span className=\"text-xs\">{formatTime(item.fecha_fin)}</span>\n                                            <button\n                                                onClick={() => handleCancel(item.id)}\n                                                disabled={isPending}\n                                                className=\"text-red-600 hover:underline text-xs\"\n                                            >\n                                                [X] Cancelar\n                                            </button>\n                                        </div>\n                                    </div>\n                                ))\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </CardContent>\n    </Card>\n  );\n}\n"
                }
              ]
            },
            {
              "name": "expanding-rooms.tsx",
              "type": "file",
              "content": "import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\nexport function ExpandingRooms() {\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4 flex-row items-center justify-between\">\n        <CardTitle className=\"text-lg text-primary-foreground\">\n          Habitaciones en expansión\n        </CardTitle>\n        <span className=\"text-sm text-primary-foreground font-mono\">(1/1)</span>\n      </CardHeader>\n      <CardContent className=\"p-4 text-sm flex justify-between items-center\">\n        <span className=\"font-mono\">00:19:29</span>\n        <span className=\"truncate px-2\">Oficina del Jefe (2)</span>\n        <span className=\"font-mono\">34:13:129</span>\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "map",
              "type": "directory",
              "children": [
                {
                  "name": "city-map.tsx",
                  "type": "file",
                  "content": "\n'use client'\n\nimport { MapTileData } from \"@/lib/services/game.service\"\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\nimport { cn } from \"@/lib/utils\"\nimport { useState, useMemo } from 'react'\nimport { useRouter } from \"next/navigation\"\nimport { TileDetailsDialog } from \"./tile-details-dialog\"\nimport { User, Shield, AlertTriangle } from \"lucide-react\"\n\ninterface CityMapProps {\n  tiles: MapTileData[]\n  currentCity: number\n  currentDistrict: number\n  userProperty: {\n    city: number\n    district: number\n    building: number\n  } | null\n}\n\nexport function CityMap({ tiles, currentCity, currentDistrict, userProperty }: CityMapProps) {\n  const router = useRouter()\n  const [selectedTile, setSelectedTile] = useState<MapTileData | null>(null)\n  const [isDialogOpen, setIsDialogOpen] = useState(false)\n\n  // Memoize the grid generation to avoid re-renders\n  // Grid is 17 columns x 15 rows (255 tiles total)\n  const gridCells = useMemo(() => {\n    const cells = [];\n    const occupiedTiles = new Map(tiles.map(t => [t.coordenada_edificio, t]));\n\n    for (let i = 1; i <= 255; i++) {\n      const tileData = occupiedTiles.get(i);\n      cells.push({\n        id: i,\n        data: tileData || null\n      });\n    }\n    return cells;\n  }, [tiles]);\n\n  const handleTileClick = (id: number, tileData: MapTileData | null) => {\n    if (tileData) {\n      if (tileData.es_propia) {\n        // Redirect to overview if it's my own property\n        router.push('/dashboard/overview');\n      } else {\n        // Open dialog for other occupied properties\n        setSelectedTile(tileData);\n        setIsDialogOpen(true);\n      }\n    } else {\n      // Create a virtual \"Empty\" tile data for the dialog\n      const emptyTile: MapTileData = {\n        propiedad_id: '',\n        coordenada_edificio: id,\n        usuario_id: '00000000-0000-0000-0000-000000000000', // Empty GUID\n        nombre_usuario: 'Desocupado',\n        nombre_familia: null,\n        etiqueta_familia: null,\n        puntos: 0,\n        es_propia: false\n      };\n      setSelectedTile(emptyTile);\n      setIsDialogOpen(true);\n    }\n  };\n\n  return (\n    <>\n      <div\n        className=\"grid gap-1 w-fit bg-stone-900/80 p-2 rounded-xl border border-stone-800 shadow-2xl\"\n        style={{ gridTemplateColumns: 'repeat(17, minmax(0, 1fr))' }}\n      >\n        <TooltipProvider delayDuration={100}>\n          {gridCells.map((cell) => {\n            const isOccupied = !!cell.data;\n            const isOwn = cell.data?.es_propia;\n            const hasFamily = !!cell.data?.nombre_familia;\n\n            return (\n              <Tooltip key={cell.id}>\n                <TooltipTrigger asChild>\n                  <div\n                    onClick={() => handleTileClick(cell.id, cell.data)}\n                    className={cn(\n                      \"w-8 h-8 sm:w-10 sm:h-10 border rounded-sm transition-all duration-200 cursor-pointer flex items-center justify-center relative overflow-hidden group\",\n                      isOwn\n                        ? \"bg-green-900/40 border-green-600 hover:bg-green-800/60 hover:shadow-[0_0_10px_rgba(34,197,94,0.3)]\"\n                        : isOccupied\n                          ? \"bg-stone-800 border-stone-600 hover:bg-stone-700 hover:border-amber-500/50\"\n                          : \"bg-stone-950/50 border-stone-800/50 hover:bg-stone-900 hover:border-stone-600 opacity-60 hover:opacity-100\"\n                    )}\n                  >\n                     {/* Visual Indicators */}\n                     {isOwn && (\n                        <div className=\"absolute inset-0 bg-green-500/10 animate-pulse\" />\n                     )}\n\n                     {isOccupied ? (\n                        hasFamily ? (\n                           <Shield className={cn(\"h-4 w-4 sm:h-5 sm:w-5\", isOwn ? \"text-green-400\" : \"text-amber-500\")} />\n                        ) : (\n                           <User className={cn(\"h-4 w-4 sm:h-5 sm:w-5\", isOwn ? \"text-green-400\" : \"text-stone-400\")} />\n                        )\n                     ) : (\n                        <div className=\"text-[10px] text-stone-700 group-hover:text-stone-500 font-mono select-none\">\n                           {cell.id}\n                        </div>\n                     )}\n\n                     {/* Coordinate Label on Hover */}\n                     <div className=\"absolute bottom-0 right-0 text-[8px] sm:text-[9px] font-mono leading-none p-0.5 text-stone-500 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        {cell.id}\n                     </div>\n                  </div>\n                </TooltipTrigger>\n                <TooltipContent className=\"bg-stone-900 border-stone-700 text-stone-200 shadow-xl z-50\">\n                  <div className=\"text-xs space-y-1\">\n                    <p className=\"font-bold text-amber-500\">Solar {currentCity}:{currentDistrict}:{cell.id}</p>\n                    {isOccupied ? (\n                      <>\n                        <p className=\"flex items-center gap-1\"><User className=\"h-3 w-3\" /> {cell.data?.nombre_usuario}</p>\n                        {cell.data?.nombre_familia && (\n                           <p className=\"flex items-center gap-1 text-stone-400\"><Shield className=\"h-3 w-3\" /> {cell.data.etiqueta_familia}</p>\n                        )}\n                        <p className=\"text-stone-500\">Puntos: {cell.data?.puntos.toLocaleString()}</p>\n                        {isOwn && <p className=\"text-green-400 font-bold mt-1\">Tu Propiedad</p>}\n                      </>\n                    ) : (\n                      <p className=\"text-stone-500 italic\">Disponible para colonizar</p>\n                    )}\n                  </div>\n                </TooltipContent>\n              </Tooltip>\n            )\n          })}\n        </TooltipProvider>\n      </div>\n\n      <TileDetailsDialog\n        tile={selectedTile}\n        city={currentCity}\n        district={currentDistrict}\n        userProperty={userProperty}\n        isOpen={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n      />\n    </>\n  )\n}\n"
                },
                {
                  "name": "map-controls.tsx",
                  "type": "file",
                  "content": "\n'use client'\n\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { ChevronLeft, ChevronRight, Search, Map as MapIcon } from 'lucide-react'\nimport { useState, useEffect } from 'react'\n\ninterface MapControlsProps {\n  currentCity: number\n  currentDistrict: number\n}\n\nexport function MapControls({ currentCity, currentDistrict }: MapControlsProps) {\n  const router = useRouter()\n  // Local state for inputs to allow typing before navigating\n  const [cityInput, setCityInput] = useState(currentCity.toString())\n  const [districtInput, setDistrictInput] = useState(currentDistrict.toString())\n\n  // Sync state if props change (e.g. external navigation)\n  useEffect(() => {\n    setCityInput(currentCity.toString())\n    setDistrictInput(currentDistrict.toString())\n  }, [currentCity, currentDistrict])\n\n  const navigateTo = (city: number | string, district: number | string) => {\n    const c = Number(city)\n    const d = Number(district)\n    if (c > 0 && d > 0) {\n      router.push(`/dashboard/map?city=${c}&district=${d}`)\n    }\n  }\n\n  const handlePrevDistrict = () => {\n    if (currentDistrict > 1) {\n      navigateTo(currentCity, currentDistrict - 1)\n    } else {\n      // Logic to go to previous city? Maybe keep it simple for now.\n    }\n  }\n\n  const handleNextDistrict = () => {\n    // Assuming max district 50 or infinite? Requirement says 1-50 in memory, but let's just go +1\n    navigateTo(currentCity, currentDistrict + 1)\n  }\n\n  const handleGo = () => {\n    navigateTo(cityInput, districtInput)\n  }\n\n  return (\n    <div className=\"flex flex-wrap items-center justify-center gap-4 bg-stone-900/80 p-3 rounded-lg border border-stone-700 w-full max-w-2xl shadow-xl\">\n      <div className=\"flex items-center gap-2\">\n        <label className=\"text-xs text-amber-500 font-bold uppercase tracking-wider\">Ciudad</label>\n        <Input\n          type=\"number\"\n          min={1}\n          className=\"w-20 bg-stone-950 border-stone-700 text-stone-200 h-9\"\n          value={cityInput}\n          onChange={(e) => setCityInput(e.target.value)}\n          onKeyDown={(e) => e.key === 'Enter' && handleGo()}\n        />\n      </div>\n\n      <div className=\"flex items-center gap-2\">\n        <label className=\"text-xs text-amber-500 font-bold uppercase tracking-wider\">Barrio</label>\n        <div className=\"flex items-center\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-9 w-9 rounded-r-none border-r-0 border-stone-700 hover:bg-stone-800 text-stone-400\"\n            onClick={handlePrevDistrict}\n            disabled={currentDistrict <= 1}\n          >\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Input\n            type=\"number\"\n            min={1}\n            className=\"w-20 bg-stone-950 border-stone-700 text-stone-200 h-9 rounded-none text-center focus-visible:ring-0\"\n            value={districtInput}\n            onChange={(e) => setDistrictInput(e.target.value)}\n            onKeyDown={(e) => e.key === 'Enter' && handleGo()}\n          />\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-9 w-9 rounded-l-none border-l-0 border-stone-700 hover:bg-stone-800 text-stone-400\"\n            onClick={handleNextDistrict}\n          >\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Button\n        variant=\"default\"\n        size=\"sm\"\n        className=\"bg-amber-600 hover:bg-amber-700 text-white shadow-lg\"\n        onClick={handleGo}\n      >\n        <Search className=\"h-4 w-4 mr-2\" />\n        Ir\n      </Button>\n\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        className=\"border-stone-600 text-stone-400 hover:bg-stone-800\"\n        onClick={() => router.push('/dashboard/map')} // Resets to home\n      >\n        <MapIcon className=\"h-4 w-4\" />\n      </Button>\n    </div>\n  )\n}\n"
                },
                {
                  "name": "tile-details-dialog.tsx",
                  "type": "file",
                  "content": "\n'use client'\n\nimport { useState, useMemo } from 'react'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from \"@/components/ui/dialog\"\nimport { Button } from \"@/components/ui/button\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { MapTileData } from \"@/lib/services/game.service\"\nimport { MapCoordinates, calculateDistance, formatDuration, calculateTravelTime } from \"@/lib/utils/map-utils\"\nimport { useRouter } from 'next/navigation'\nimport { Sword, Eye, Truck, Flag, MapPin, User, Shield } from 'lucide-react'\n\ninterface TileDetailsDialogProps {\n  tile: MapTileData | null\n  city: number\n  district: number\n  userProperty: {\n    city: number\n    district: number\n    building: number\n  } | null\n  isOpen: boolean\n  onClose: () => void\n}\n\nexport function TileDetailsDialog({ tile, city, district, userProperty, isOpen, onClose }: TileDetailsDialogProps) {\n  const router = useRouter()\n\n  const distance = useMemo(() => {\n    if (!tile || !userProperty) return 0;\n    const origin: MapCoordinates = {\n      city: userProperty.city,\n      district: userProperty.district,\n      building: userProperty.building\n    };\n    const target: MapCoordinates = {\n      city: city,\n      district: district,\n      building: tile.coordenada_edificio\n    };\n    return calculateDistance(origin, target);\n  }, [tile, city, district, userProperty]);\n\n  // Estimate travel time with a base speed (e.g. 100) just for display\n  const estimatedTime = calculateTravelTime(distance, 100);\n\n  if (!tile) return null;\n\n  const handleAction = (action: string) => {\n    // Redirigir a /dashboard/missions\n    // Params: type, target=C:B:E\n    const targetStr = `${city}:${district}:${tile.coordenada_edificio}`;\n    router.push(`/dashboard/missions?type=${action}&target=${targetStr}`);\n    onClose();\n  };\n\n  const isOwn = tile.es_propia;\n  const isEmpty = tile.usuario_id === '00000000-0000-0000-0000-000000000000'; // Assuming empty tiles have null/zero user, but check logic.\n  // Actually, get_map_tiles might return null for user fields if empty.\n  // Let's check MapTileData type. It has usuario_id string.\n  // Usually the backend might filter out empty spots or return them with placeholders.\n  // We'll assume if points == 0 or specific check.\n  // Wait, legacy code usually treats 0-level or specific ID as empty.\n  // Let's assume non-empty if usuario_id is valid.\n\n  // Re-reading MapTileData: usuario_id is string.\n  // If it's a free slot, does it appear in get_map_tiles?\n  // get_map_tiles returns properties. If a slot is empty, is it returned?\n  // Usually map RPCs return ALL slots 1-255 or just occupied ones.\n  // If just occupied, then we can't click empty slots unless we render a full grid and fill gaps.\n  // CityMap receives `tiles` which is MapTileData[].\n  // If we want to click \"Empty\" slots, CityMap needs to render them.\n  // We will address that in CityMap.\n  // Here, we assume `tile` is passed. If it's a \"virtual\" empty tile, we need to handle it.\n\n  // Let's support a \"virtual\" tile object for empty slots passed from CityMap\n  const isOccupied = tile.usuario_id && tile.usuario_id !== '00000000-0000-0000-0000-000000000000';\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[425px] bg-stone-900 text-stone-100 border-stone-700\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2 text-xl text-amber-500\">\n            <MapPin className=\"h-5 w-5\" />\n            Solar {city}:{district}:{tile.coordenada_edificio}\n          </DialogTitle>\n          <DialogDescription className=\"text-stone-400\">\n            {isOccupied ? \"Propiedad Ocupada\" : \"Solar Disponible\"}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid gap-4 py-4\">\n          {isOccupied ? (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-3 p-3 bg-stone-800 rounded-lg\">\n                <User className=\"h-8 w-8 text-stone-400\" />\n                <div>\n                  <p className=\"font-medium text-stone-200\">{tile.nombre_usuario}</p>\n                  {tile.nombre_familia && (\n                    <Badge variant=\"outline\" className=\"text-xs border-amber-500/50 text-amber-500 mt-1\">\n                      [{tile.etiqueta_familia}] {tile.nombre_familia}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex justify-between items-center p-3 bg-stone-800/50 rounded-lg\">\n                <span className=\"text-sm text-stone-400\">Puntos</span>\n                <span className=\"font-mono text-stone-200\">{tile.puntos.toLocaleString()}</span>\n              </div>\n            </div>\n          ) : (\n            <div className=\"p-4 bg-stone-800/30 rounded-lg border border-stone-700 border-dashed text-center text-stone-500\">\n              Este solar está disponible para colonizar o fundar una nueva propiedad.\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-2 text-sm\">\n            <div className=\"p-2 bg-stone-950 rounded border border-stone-800\">\n              <span className=\"block text-xs text-stone-500 mb-1\">Distancia</span>\n              <span className=\"font-mono\">{distance} km</span>\n            </div>\n            <div className=\"p-2 bg-stone-950 rounded border border-stone-800\">\n              <span className=\"block text-xs text-stone-500 mb-1\">Tiempo Est.</span>\n              <span className=\"font-mono\">~{formatDuration(estimatedTime)}</span>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"grid grid-cols-2 gap-2 sm:gap-2\">\n          {isOwn ? (\n            <Button variant=\"default\" className=\"col-span-2 bg-green-600 hover:bg-green-700\" onClick={() => router.push('/dashboard/overview')}>\n              Gestionar Propiedad\n            </Button>\n          ) : isOccupied ? (\n            <>\n              <Button variant=\"outline\" className=\"border-stone-600 hover:bg-stone-800\" onClick={() => handleAction('espiar')}>\n                <Eye className=\"mr-2 h-4 w-4\" /> Espiar\n              </Button>\n              <Button variant=\"outline\" className=\"border-stone-600 hover:bg-stone-800\" onClick={() => handleAction('transportar')}>\n                <Truck className=\"mr-2 h-4 w-4\" /> Transportar\n              </Button>\n              <Button variant=\"destructive\" className=\"col-span-2 bg-red-900/80 hover:bg-red-900 border-red-800\" onClick={() => handleAction('atacar')}>\n                <Sword className=\"mr-2 h-4 w-4\" /> Atacar\n              </Button>\n            </>\n          ) : (\n            <Button className=\"col-span-2 bg-amber-600 hover:bg-amber-700\" onClick={() => handleAction('colonizar')}>\n              <Flag className=\"mr-2 h-4 w-4\" /> Colonizar / Fundar\n            </Button>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "missions",
              "type": "directory",
              "children": [
                {
                  "name": "active-missions-list.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plane, Clock, MapPin } from \"lucide-react\";\nimport { ColaMisiones } from \"@/types/database\";\nimport { useEffect, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ActiveMissionsListProps {\n  missions: ColaMisiones[];\n  limit?: number;\n  compact?: boolean;\n}\n\nexport function ActiveMissionsList({ missions, limit, compact = false }: ActiveMissionsListProps) {\n  const [now, setNow] = useState<number>(Date.now());\n\n  useEffect(() => {\n    if (missions.length === 0) return;\n    const interval = setInterval(() => setNow(Date.now()), 1000);\n    return () => clearInterval(interval);\n  }, [missions.length]);\n\n  if (!missions || missions.length === 0) {\n    if (compact) {\n        return (\n            <Card className=\"border-dashed border-stone-300 bg-stone-50/50 shadow-none\">\n                <CardContent className=\"p-4 text-center text-sm text-muted-foreground flex flex-col items-center gap-2\">\n                    <Plane className=\"w-4 h-4 opacity-50\" />\n                    <span>Sin misiones activas</span>\n                </CardContent>\n            </Card>\n        )\n    }\n    return null;\n  }\n\n  const displayMissions = limit ? missions.slice(0, limit) : missions;\n\n  return (\n    <Card className={cn(\"border-blue-500/30 bg-blue-950/5\", compact && \"shadow-sm\")}>\n      <CardContent className={cn(\"space-y-3\", compact ? \"p-3\" : \"p-4\")}>\n        <div className=\"flex items-center gap-2 mb-2\">\n            <Plane className={cn(\"text-blue-600\", compact ? \"w-4 h-4\" : \"w-5 h-5\")} />\n            <h3 className={cn(\"font-bold text-blue-800 dark:text-blue-500\", compact ? \"text-sm\" : \"\")}>\n                Misiones Activas\n            </h3>\n            <Badge variant=\"outline\" className=\"ml-auto border-blue-500/50 text-blue-700 dark:text-blue-400\">\n                {missions.length}\n            </Badge>\n        </div>\n        \n        <div className={cn(\"grid gap-2\", compact ? \"grid-cols-1\" : \"grid-cols-1 md:grid-cols-2\")}>\n            {displayMissions.map((mission) => {\n                const endTime = new Date(mission.fecha_llegada).getTime();\n                const timeLeft = Math.max(0, endTime - now);\n                const secondsLeft = Math.floor(timeLeft / 1000);\n                \n                const hours = Math.floor(secondsLeft / 3600);\n                const minutes = Math.floor((secondsLeft % 3600) / 60);\n                const seconds = secondsLeft % 60;\n                \n                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n                \n                const isReturning = false; // Logic for return not yet fully exposed in type or needs parsing\n\n                return (\n                    <div key={mission.id} className=\"bg-card border border-border/50 rounded p-2 flex flex-col gap-1 shadow-sm\">\n                        <div className=\"flex justify-between items-center\">\n                            <Badge variant={isReturning ? \"secondary\" : \"default\"} className=\"text-[10px] px-1 h-5 uppercase\">\n                                {mission.tipo_mision}\n                            </Badge>\n                            <span className=\"text-xs font-mono bg-muted px-1 rounded flex items-center gap-1\">\n                                <Clock className=\"w-3 h-3\" /> {timeString}\n                            </span>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                            <MapPin className=\"w-3 h-3\" />\n                            <span className=\"truncate\">\n                                {mission.destino_ciudad}:{mission.destino_barrio}:{mission.destino_edificio}\n                            </span>\n                        </div>\n                    </div>\n                );\n            })}\n        </div>\n        {limit && missions.length > limit && (\n            <div className=\"text-center text-xs text-muted-foreground pt-1\">\n                + {missions.length - limit} más...\n            </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n"
                }
              ]
            },
            {
              "name": "needles.tsx",
              "type": "file",
              "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport Link from 'next/link';\nimport { useGameState } from '@/components/providers/game-state-provider';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function Needles() {\n  const { gameState } = useGameState();\n\n  if (!gameState) {\n    return <Skeleton className=\"h-[200px] w-full\" />;\n  }\n\n  const totalEdificios = gameState.edificios.filter(e => e.nivel > 0).length;\n  const totalPuntos = gameState.puntos;\n\n  const stats = [\n    { label: \"Cantidad de edificios\", value: totalEdificios.toString() },\n    { label: \"Puntos de construcción\", value: totalPuntos.toString() },\n    { label: \"Puntos de entrenamiento\", value: \"N/A\" },\n    { label: \"Puntos de tropa\", value: \"N/A\" },\n    { label: \"Ranking\", value: \"N/A\" },\n  ];\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Agujas</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4 text-sm\">\n        {stats.map(stat => (\n            <div key={stat.label} className=\"flex justify-between\">\n                <span>{stat.label}</span>\n                <span>{stat.value}</span>\n            </div>\n        ))}\n        <div className=\"flex justify-between border-t border-black/20 mt-2 pt-2\">\n            <span>Poder de ataque</span>\n            <span>N/A (<Link href=\"/dashboard/poderataque\" className=\"text-blue-800 hover:underline\">Detalles</Link>)</span>\n        </div>\n        <div className=\"text-center mt-2\">\n            <Link href=\"/dashboard/overview\" className=\"text-blue-800 hover:underline\">Visión global</Link>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "overview",
              "type": "directory",
              "children": [
                {
                  "name": "alerts-widget.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { AtaqueEntrante } from '@/types/database';\nimport { ShieldCheck, AlertTriangle } from 'lucide-react';\nimport { useEffect, useState } from 'react';\n\ninterface AlertsWidgetProps {\n  attacks: AtaqueEntrante[];\n}\n\nexport function AlertsWidget({ attacks }: AlertsWidgetProps) {\n  const [nearestAttackTime, setNearestAttackTime] = useState<string | null>(null);\n  const [countdown, setCountdown] = useState<string>('');\n\n  useEffect(() => {\n    if (attacks.length === 0) return;\n\n    // Find the nearest attack\n    // Assuming attacks are already sorted by date, but let's be safe\n    const sortedAttacks = [...attacks].sort((a, b) => \n      new Date(a.fecha_llegada).getTime() - new Date(b.fecha_llegada).getTime()\n    );\n    \n    const nearest = sortedAttacks[0];\n    setNearestAttackTime(nearest.fecha_llegada);\n\n    const updateCountdown = () => {\n      const now = new Date().getTime();\n      const arrival = new Date(nearest.fecha_llegada).getTime();\n      const diff = arrival - now;\n\n      if (diff <= 0) {\n        setCountdown(\"00:00:00\");\n        return;\n      }\n\n      const hours = Math.floor(diff / (1000 * 60 * 60));\n      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n      const seconds = Math.floor((diff % (1000 * 60)) / 1000);\n\n      setCountdown(\n        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\n      );\n    };\n\n    updateCountdown();\n    const interval = setInterval(updateCountdown, 1000);\n\n    return () => clearInterval(interval);\n  }, [attacks]);\n\n  if (attacks.length === 0) {\n    return (\n      <Card className=\"border-green-600 bg-green-50\">\n        <CardContent className=\"flex items-center gap-4 p-4\">\n          <ShieldCheck className=\"h-8 w-8 text-green-600\" />\n          <div>\n            <h3 className=\"font-bold text-green-700\">Estado: Seguro</h3>\n            <p className=\"text-sm text-green-600\">No hay amenazas inminentes detectadas.</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"border-red-600 bg-red-50 animate-pulse-slow\">\n      <CardHeader className=\"bg-red-600 py-2 px-4\">\n        <CardTitle className=\"text-white text-sm font-bold flex items-center gap-2\">\n            <AlertTriangle className=\"h-4 w-4\" /> ALERTA DE ATAQUE\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4\">\n        <div className=\"flex flex-col gap-2\">\n            <div className=\"flex justify-between items-center\">\n                <span className=\"font-bold text-red-700 text-lg\">\n                    {attacks.length} {attacks.length === 1 ? 'Ataque Entrante' : 'Ataques Entrantes'}\n                </span>\n                <span className=\"font-mono text-xl font-black text-red-600\">\n                    T - {countdown}\n                </span>\n            </div>\n            <div className=\"text-sm text-red-800\">\n                Próximo impacto: {new Date(nearestAttackTime || '').toLocaleTimeString()}\n            </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n"
                },
                {
                  "name": "overview-dashboard.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Table, TableBody, TableCell, TableHead, TableRow } from '@/components/ui/table';\nimport { cn } from '@/lib/utils';\nimport { MiembroFamilia, Familia } from '@/types/database';\nimport { ResourceTicker } from './resource-ticker';\nimport { AlertsWidget } from './alerts-widget';\nimport { useGameState } from '@/components/providers/game-state-provider';\n\ninterface OverviewDashboardProps {\n    familyInfo: { miembro: MiembroFamilia; familia: Familia } | null;\n}\n\nexport function OverviewDashboard({ familyInfo }: OverviewDashboardProps) {\n  const { gameState } = useGameState();\n\n  if (!gameState) {\n    return <div className=\"p-4 text-center\">Cargando datos del imperio...</div>;\n  }\n\n  const { propiedad, recursos, edificios, puntos, incoming_attacks, cola_misiones } = gameState;\n  const attacks = incoming_attacks || [];\n  const missions = cola_misiones || [];\n\n  const resourceList = [\n    { name: \"Armas\", value: recursos.armas.val, max: recursos.armas.max, prod: recursos.armas.prod, highlight: recursos.armas.val >= recursos.armas.max },\n    { name: \"Munición\", value: recursos.municion.val, max: recursos.municion.max, prod: recursos.municion.prod, highlight: recursos.municion.val >= recursos.municion.max },\n    { name: \"Alcohol\", value: recursos.alcohol.val, max: recursos.alcohol.max, prod: recursos.alcohol.prod, highlight: recursos.alcohol.val >= recursos.alcohol.max },\n    { name: \"Dólares\", value: recursos.dolares.val, max: recursos.dolares.max, prod: recursos.dolares.prod, highlight: recursos.dolares.val >= recursos.dolares.max },\n  ];\n\n  // Find main building (Oficina del Jefe)\n  const mainBuilding = edificios.find(e => e.id === 'oficina_del_jefe');\n  const mainBuildingLevel = mainBuilding ? mainBuilding.nivel : 0;\n  const mainBuildingName = mainBuilding ? mainBuilding.nombre : \"Oficina del Jefe\";\n\n  const totalBuildingsLevel = edificios.reduce((acc, curr) => acc + curr.nivel, 0);\n  const researchLevel = 0; // Placeholder\n\n  const levels = [\n      { name: \"Edificios\", level: totalBuildingsLevel },\n      { name: \"Investigación\", level: researchLevel }\n  ];\n\n  return (\n    <div className=\"space-y-4\">\n        <AlertsWidget attacks={attacks} />\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n            <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n                <CardHeader className=\"bg-primary/80 py-3 px-4\">\n                    <CardTitle className=\"text-xl text-primary-foreground flex justify-between\">\n                        <span>Visión Global {propiedad.nombre}</span>\n                        {familyInfo && (\n                            <span className=\"text-sm bg-stone-800 text-stone-200 px-2 py-1 rounded\">\n                                [{familyInfo.familia.etiqueta}] {familyInfo.familia.nombre}\n                            </span>\n                        )}\n                    </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-0\">\n                    <div className=\"overflow-x-auto\">\n                        <Table>\n                            <TableBody>\n                                <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                                    <TableHead className=\"text-primary-foreground font-bold\">{mainBuildingName}</TableHead>\n                                    <TableHead className=\"text-primary-foreground font-bold text-center\">Nivel {mainBuildingLevel}</TableHead>\n                                    <TableHead className=\"text-primary-foreground font-bold text-center\">=</TableHead>\n                                </TableRow>\n                                {resourceList.map((resource, index) => (\n                                    <TableRow key={index} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                        <TableCell className=\"font-semibold\">{resource.name}</TableCell>\n                                        <TableCell className={cn(\"text-center font-semibold\", resource.highlight && \"text-red-600\")}>\n                                            <ResourceTicker \n                                                initialValue={resource.value} \n                                                productionRate={resource.prod}\n                                                // Assuming initialValue is fresh from server render time\n                                            />\n                                            <span className=\"text-xs text-gray-500 ml-1\">/ {resource.max.toLocaleString()}</span>\n                                        </TableCell>\n                                        <TableCell className=\"text-center text-xs\">\n                                            +{Math.floor(resource.prod).toLocaleString()}/h\n                                        </TableCell>\n                                    </TableRow>\n                                ))}\n                                {levels.map((item, index) => (\n                                    <TableRow key={index} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                        <TableCell className=\"font-semibold\">{item.name}</TableCell>\n                                        <TableCell className=\"text-center font-bold\">{item.level}</TableCell>\n                                        <TableCell className=\"text-center\">{item.level}</TableCell>\n                                    </TableRow>\n                                ))}\n                                <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                    <TableCell className=\"font-semibold\">Puntos</TableCell>\n                                    <TableCell className=\"text-center font-bold\">{Math.floor(puntos).toLocaleString()}</TableCell>\n                                    <TableCell className=\"text-center\">{Math.floor(puntos).toLocaleString()}</TableCell>\n                                </TableRow>\n                            </TableBody>\n                        </Table>\n                    </div>\n                </CardContent>\n            </Card>\n\n            {/* Active Missions Section - Simple list for now */}\n            {missions.length > 0 && (\n                <Card className=\"border-stone-400 bg-stone-100\">\n                     <CardHeader className=\"bg-stone-300 py-3 px-4\">\n                        <CardTitle className=\"text-lg\">Misiones Activas</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-4\">\n                        <ul className=\"space-y-2\">\n                            {missions.map(m => (\n                                <li key={m.id} className=\"bg-white p-2 rounded shadow-sm flex justify-between\">\n                                    <span className=\"capitalize font-semibold\">{m.tipo_mision}</span>\n                                    <span>Llegada: {new Date(m.fecha_llegada).toLocaleString()}</span>\n                                </li>\n                            ))}\n                        </ul>\n                    </CardContent>\n                </Card>\n            )}\n        </div>\n    </div>\n  );\n}\n"
                },
                {
                  "name": "overview-view.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { useGameState } from '@/components/providers/game-state-provider';\nimport { MiembroFamilia, Familia } from '@/types/database';\nimport { ConstructionQueueList } from '../rooms/construction-queue-list';\nimport { ActiveMissionsList } from '../missions/active-missions-list';\nimport { AlertsWidget } from './alerts-widget';\nimport { QuickActions } from './quick-actions';\nimport { ResourceTicker } from './resource-ticker';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Building2, TrendingUp, Users } from 'lucide-react';\n\ninterface OverviewViewProps {\n  familyInfo: { miembro: MiembroFamilia; familia: Familia } | null;\n}\n\nexport function OverviewView({ familyInfo }: OverviewViewProps) {\n  const { gameState } = useGameState();\n\n  if (!gameState) {\n    return <div className=\"p-4 text-center\">Cargando datos del imperio...</div>;\n  }\n\n  const { propiedad, recursos, edificios, puntos, incoming_attacks, cola_misiones, tropa_usuario } = gameState;\n  const attacks = incoming_attacks || [];\n  const missions = cola_misiones || [];\n  \n  // Ensure we handle colas correctly. gameState.colas can be null if not populated, but types say it's there.\n  // Based on DashboardData type, 'colas' is mandatory but sub-arrays can be empty.\n  const construction = gameState.colas?.construccion || [];\n\n  const resourceList = [\n    { name: \"Armas\", value: recursos.armas.val, max: recursos.armas.max, prod: recursos.armas.prod },\n    { name: \"Munición\", value: recursos.municion.val, max: recursos.municion.max, prod: recursos.municion.prod },\n    { name: \"Alcohol\", value: recursos.alcohol.val, max: recursos.alcohol.max, prod: recursos.alcohol.prod },\n    { name: \"Dólares\", value: recursos.dolares.val, max: recursos.dolares.max, prod: recursos.dolares.prod },\n  ];\n\n  // Main building logic (Oficina del Jefe)\n  const mainBuilding = edificios.find(e => e.id === 'oficina_del_jefe');\n  \n  return (\n    <div className=\"space-y-4 animate-in fade-in duration-500\">\n      {/* Header: Resources & Status */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n         {resourceList.map((res) => (\n             <Card key={res.name} className=\"bg-card shadow-sm border-l-4 border-l-primary\">\n                 <CardContent className=\"p-4 pb-2\">\n                     <div className=\"text-xs text-muted-foreground uppercase font-bold\">{res.name}</div>\n                     <div className=\"text-2xl font-bold font-mono my-1\">\n                        <ResourceTicker initialValue={res.value} productionRate={res.prod} className=\"text-foreground\" />\n                     </div>\n                     <div className=\"flex justify-between text-xs text-muted-foreground\">\n                        <span>Cap: {(res.max / 1000).toFixed(0)}k</span>\n                        <span className=\"text-green-600 font-medium\">+{Math.floor(res.prod)}/h</span>\n                     </div>\n                 </CardContent>\n             </Card>\n         ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\n        {/* Left Column (Actions & Queues) */}\n        <div className=\"lg:col-span-3 space-y-6\">\n            <QuickActions />\n            <ConstructionQueueList queue={construction} limit={3} compact={true} />\n        </div>\n\n        {/* Center Column (Empire Status) */}\n        <div className=\"lg:col-span-6 space-y-6\">\n             <Card>\n                <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"flex justify-between items-center text-lg\">\n                        <span className=\"flex items-center gap-2\">\n                            {propiedad.nombre}\n                        </span>\n                        <Badge variant=\"secondary\" className=\"font-mono text-xs\">\n                            {propiedad.coordenada_ciudad}:{propiedad.coordenada_barrio}:{propiedad.coordenada_edificio}\n                        </Badge>\n                    </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6 pt-4\">\n                    <div className=\"grid grid-cols-3 gap-4 text-center\">\n                        <div className=\"p-4 bg-muted/30 border rounded-lg hover:bg-muted/50 transition-colors\">\n                            <Building2 className=\"w-6 h-6 mx-auto mb-2 text-primary\" />\n                            <div className=\"text-3xl font-bold\">{mainBuilding?.nivel || 0}</div>\n                            <div className=\"text-xs text-muted-foreground font-medium uppercase mt-1\">Nivel Base</div>\n                        </div>\n                        <div className=\"p-4 bg-muted/30 border rounded-lg hover:bg-muted/50 transition-colors\">\n                            <Users className=\"w-6 h-6 mx-auto mb-2 text-primary\" />\n                            <div className=\"text-3xl font-bold\">{tropa_usuario?.reduce((acc: number, t: any) => acc + t.cantidad, 0) || 0}</div>\n                            <div className=\"text-xs text-muted-foreground font-medium uppercase mt-1\">Tropas</div>\n                        </div>\n                        <div className=\"p-4 bg-muted/30 border rounded-lg hover:bg-muted/50 transition-colors\">\n                            <TrendingUp className=\"w-6 h-6 mx-auto mb-2 text-primary\" />\n                            <div className=\"text-3xl font-bold\">{Math.floor(puntos).toLocaleString()}</div>\n                            <div className=\"text-xs text-muted-foreground font-medium uppercase mt-1\">Puntos</div>\n                        </div>\n                    </div>\n                    \n                    {familyInfo && (\n                        <div className=\"p-4 border rounded-md bg-stone-50/80 dark:bg-stone-900/50 flex justify-between items-center\">\n                            <div>\n                                <div className=\"text-xs text-muted-foreground font-bold uppercase mb-1\">Familia</div>\n                                <div className=\"font-bold text-lg\">{familyInfo.familia?.nombre}</div>\n                            </div>\n                            <Badge className=\"text-lg px-3 py-1 font-mono\">[{familyInfo.familia?.etiqueta}]</Badge>\n                        </div>\n                    )}\n                </CardContent>\n             </Card>\n        </div>\n\n        {/* Right Column (Alerts & Missions) */}\n        <div className=\"lg:col-span-3 space-y-6\">\n            <AlertsWidget attacks={attacks} />\n            <ActiveMissionsList missions={missions} limit={5} compact={true} />\n        </div>\n      </div>\n    </div>\n  );\n}\n"
                },
                {
                  "name": "overview-wrapper.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { GameStateProvider } from '@/components/providers/game-state-provider';\nimport { OverviewView } from './overview-view';\nimport { DashboardData } from '@/types/game';\nimport { MiembroFamilia, Familia } from '@/types/database';\n\ninterface OverviewWrapperProps {\n  initialData: DashboardData;\n  familyInfo: { miembro: MiembroFamilia; familia: Familia } | null;\n}\n\nexport function OverviewWrapper({ initialData, familyInfo }: OverviewWrapperProps) {\n  return (\n    <GameStateProvider initialData={initialData}>\n      <OverviewView familyInfo={familyInfo} />\n    </GameStateProvider>\n  );\n}\n"
                },
                {
                  "name": "quick-actions.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Map, Crosshair, FlaskConical, Users, Zap } from \"lucide-react\";\nimport Link from \"next/link\";\n\nexport function QuickActions() {\n  return (\n    <Card className=\"border-stone-200 shadow-sm\">\n      <CardHeader className=\"py-3 px-4 bg-stone-50 border-b border-stone-100\">\n        <CardTitle className=\"text-sm font-bold text-stone-700 flex items-center gap-2\">\n            <Zap className=\"w-4 h-4 text-yellow-600\" />\n            Acciones Rápidas\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-3 grid grid-cols-2 gap-2\">\n        <Button variant=\"outline\" className=\"w-full justify-start gap-2 h-auto py-2 px-3 text-xs\" asChild>\n            <Link href=\"/dashboard/map\">\n                <Map className=\"w-4 h-4 text-blue-600\" />\n                <span className=\"truncate\">Mapa Global</span>\n            </Link>\n        </Button>\n        <Button variant=\"outline\" className=\"w-full justify-start gap-2 h-auto py-2 px-3 text-xs\" asChild>\n            <Link href=\"/dashboard/recruitment\">\n                <Users className=\"w-4 h-4 text-green-600\" />\n                <span className=\"truncate\">Reclutar</span>\n            </Link>\n        </Button>\n        <Button variant=\"outline\" className=\"w-full justify-start gap-2 h-auto py-2 px-3 text-xs\" asChild>\n            <Link href=\"/dashboard/tech-tree\">\n                <FlaskConical className=\"w-4 h-4 text-purple-600\" />\n                <span className=\"truncate\">Investigar</span>\n            </Link>\n        </Button>\n        <Button variant=\"outline\" className=\"w-full justify-start gap-2 h-auto py-2 px-3 text-xs\" asChild>\n            <Link href=\"/dashboard/map?action=attack\">\n                <Crosshair className=\"w-4 h-4 text-red-600\" />\n                <span className=\"truncate\">Atacar</span>\n            </Link>\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n"
                },
                {
                  "name": "resource-ticker.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { useEffect, useState, useRef } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface ResourceTickerProps {\n  initialValue: number;\n  productionRate: number; // per hour\n  lastUpdated?: string; // timestamp string (ISO)\n  className?: string;\n}\n\nexport function ResourceTicker({ initialValue, productionRate, lastUpdated, className }: ResourceTickerProps) {\n  const [currentValue, setCurrentValue] = useState(initialValue);\n  const animationFrameRef = useRef<number | null>(null);\n\n  // Parse lastUpdated if provided, otherwise assume initialValue is fresh from server rendering\n  const baseTimeRef = useRef(lastUpdated ? new Date(lastUpdated).getTime() : Date.now());\n  const initialValueRef = useRef(initialValue);\n\n  // If initialValue updates (re-render from server or parent), we should sync up but maintain smoothness.\n  // Actually, if parent passes new initialValue, it implies a fresh fetch.\n  useEffect(() => {\n    initialValueRef.current = initialValue;\n    baseTimeRef.current = lastUpdated ? new Date(lastUpdated).getTime() : Date.now();\n    setCurrentValue(initialValue);\n  }, [initialValue, lastUpdated]);\n\n  useEffect(() => {\n    const ratePerSecond = productionRate / 3600;\n    \n    // Function to calculate the current value\n    const updateValue = () => {\n      const now = Date.now();\n      \n      const secondsElapsed = (now - baseTimeRef.current) / 1000;\n      const addedValue = secondsElapsed * ratePerSecond;\n      \n      setCurrentValue(initialValueRef.current + addedValue);\n      \n      animationFrameRef.current = requestAnimationFrame(updateValue);\n    };\n\n    // Start the loop\n    animationFrameRef.current = requestAnimationFrame(updateValue);\n\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [productionRate]);\n\n  return <span className={cn(className)}>{Math.floor(currentValue).toLocaleString()}</span>;\n}\n"
                }
              ]
            },
            {
              "name": "recruitment",
              "type": "directory",
              "children": [
                {
                  "name": "recruitment-queue-list.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ColaDetalle } from \"@/types/game\";\nimport { useEffect, useState } from \"react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Progress } from \"@/components/ui/progress\";\n\ninterface RecruitmentQueueListProps {\n  queue: ColaDetalle[];\n}\n\nexport function RecruitmentQueueList({ queue }: RecruitmentQueueListProps) {\n  const [timeLeft, setTimeLeft] = useState<number>(0);\n\n  useEffect(() => {\n    if (queue.length === 0) return;\n\n    const interval = setInterval(() => {\n      const firstItem = queue[0];\n      const end = new Date(firstItem.fecha_fin).getTime();\n      const now = Date.now();\n      const diff = Math.max(0, Math.floor((end - now) / 1000));\n      setTimeLeft(diff);\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [queue]);\n\n  if (queue.length === 0) {\n    return (\n      <Card className=\"border-primary bg-stone-200 text-black\">\n        <CardHeader className=\"bg-primary/80 py-2 px-4\">\n          <CardTitle className=\"text-lg text-primary-foreground\">\n            Cola de Reclutamiento (0)\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-4 flex flex-col items-center gap-2\">\n          <p className=\"text-sm text-gray-500\">No hay tropas en entrenamiento.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Format time left\n  const hours = Math.floor(timeLeft / 3600);\n  const minutes = Math.floor((timeLeft % 3600) / 60);\n  const seconds = timeLeft % 60;\n  const timeLeftStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4\">\n        <CardTitle className=\"text-lg text-primary-foreground\">\n          Cola de Reclutamiento ({queue.length})\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4 flex flex-col items-center gap-2\">\n        <div className=\"w-full space-y-2\">\n          <Select defaultValue={queue[0]?.id}>\n            <SelectTrigger className=\"w-full bg-white\">\n              <SelectValue placeholder={`${queue.length} procesos activos`} />\n            </SelectTrigger>\n            <SelectContent>\n              {queue.map((item, index) => {\n                // Determine display string for each item\n                // Only the first item is actively processing (usually) in this game logic?\n                // Assuming sequential processing.\n                const isFirst = index === 0;\n                return (\n                  <SelectItem key={item.id} value={item.id} disabled={!isFirst}>\n                    {item.cantidad} {item.nombre} {isFirst ? `- ${timeLeftStr}` : '(En cola)'}\n                  </SelectItem>\n                );\n              })}\n            </SelectContent>\n          </Select>\n          <div className=\"text-xs text-center text-muted-foreground\">\n             Finaliza: {new Date(queue[0].fecha_fin).toLocaleTimeString()}\n          </div>\n          {/* Progress bar could be added here if we knew total duration, but we assume lazy updates or just countdown */}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n"
                },
                {
                  "name": "recruitment-view.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { GameStateProvider, useGameState } from \"@/components/providers/game-state-provider\";\nimport { DashboardData, ConfiguracionTropa } from \"@/types/game\";\nimport { TroopCard } from \"./troop-card\";\nimport { RecruitmentQueueList } from \"./recruitment-queue-list\";\n\nfunction RecruitmentContent({ troops }: { troops: ConfiguracionTropa[] }) {\n    const { gameState } = useGameState();\n\n    if (!gameState) return <div>Cargando...</div>;\n\n    const { propiedad, tropas, cola_reclutamiento, recursos } = gameState;\n    const queue = cola_reclutamiento || [];\n\n    // Create a simple resources object from nested structure\n    const currentResources = {\n        armas: recursos.armas.val,\n        municion: recursos.municion.val,\n        alcohol: recursos.alcohol.val,\n        dolares: recursos.dolares.val,\n    };\n\n    return (\n        <div className=\"space-y-4\">\n            <RecruitmentQueueList queue={queue} />\n\n            <div className=\"space-y-2\">\n                {troops.map((troop) => {\n                    const myTroop = tropas.find(t => t.id === troop.id);\n                    return (\n                        <TroopCard\n                            key={troop.id}\n                            troop={troop}\n                            currentAmount={myTroop?.cantidad || 0}\n                            resources={currentResources}\n                        />\n                    );\n                })}\n            </div>\n        </div>\n    );\n}\n\nexport function RecruitmentView({ initialData, troops }: { initialData: DashboardData; troops: ConfiguracionTropa[] }) {\n    return (\n        <GameStateProvider initialData={initialData}>\n            <RecruitmentContent troops={troops} />\n        </GameStateProvider>\n    );\n}\n"
                },
                {
                  "name": "troop-card.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { Coins, Shell, Droplets } from \"lucide-react\";\nimport { useState, useTransition } from \"react\";\nimport { ConfiguracionTropa, Recursos } from \"@/types/game\";\nimport { recruitTroopsAction } from \"@/lib/actions/recruitment.actions\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype TroopCardProps = {\n  troop: ConfiguracionTropa;\n  currentAmount: number;\n  resources: Recursos;\n};\n\nconst ResourceIcon = ({ type }: { type: string }) => {\n    switch (type) {\n        case 'Armas': return <Shell className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Municion': return <Coins className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Alcohol': return <Droplets className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Dolares': return <p className=\"text-lg font-bold text-green-600 inline-block ml-1\">$</p>;\n        default: return null;\n    }\n}\n\nexport function TroopCard({ troop, currentAmount, resources }: TroopCardProps) {\n  // Use a fallback image if 'troop.url_imagen' is not in PlaceHolderImages logic or use direct URL\n  // Assuming PlaceHolderImages has logic for IDs. If `url_imagen` is a filename like 'troop-porteador', we use it.\n  // The DB `url_imagen` might be 'troop-porteador'.\n  const image = PlaceHolderImages.find((p) => p.id === troop.url_imagen) || PlaceHolderImages.find(p => p.id === 'dark-alley');\n  \n  const [amount, setAmount] = useState<number | ''>('');\n  const [isPending, startTransition] = useTransition();\n  const { toast } = useToast();\n\n  const calculateMax = () => {\n    let max = Infinity;\n    if (troop.costo_armas > 0) max = Math.min(max, Math.floor(resources.armas / troop.costo_armas));\n    if (troop.costo_municion > 0) max = Math.min(max, Math.floor(resources.municion / troop.costo_municion));\n    if (troop.costo_dolares > 0) max = Math.min(max, Math.floor(resources.dolares / troop.costo_dolares));\n    // Alcohol is not usually a cost for troops unless specified, but schema doesn't have it.\n    // Wait, schema has `costo_armas`, `costo_municion`, `costo_dolares`. No alcohol cost in schema.\n    \n    return max === Infinity ? 0 : max;\n  };\n\n  const maxRecruitable = calculateMax();\n\n  const handleRecruit = async () => {\n    const quantity = Number(amount);\n    if (!quantity || quantity <= 0) return;\n\n    if (quantity > maxRecruitable) {\n        toast({ title: \"Error\", description: \"No tienes suficientes recursos.\", variant: \"destructive\" });\n        return;\n    }\n\n    startTransition(async () => {\n        const result = await recruitTroopsAction(troop.id, quantity);\n        if (result.success) {\n            toast({ title: \"Reclutamiento iniciado\", description: `Reclutando ${quantity} ${troop.nombre}.` });\n            setAmount('');\n        } else {\n            toast({ title: \"Error\", description: result.error || \"Error desconocido\", variant: \"destructive\" });\n        }\n    });\n  };\n\n  // Format duration\n  const formatDuration = (seconds: number) => {\n    const h = Math.floor(seconds / 3600);\n    const m = Math.floor((seconds % 3600) / 60);\n    const s = seconds % 60;\n    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"bg-stone-200 text-black p-4 rounded-md border border-primary/50 flex flex-col items-start gap-4\">\n        <div className=\"flex justify-between w-full\">\n            <h3 className=\"font-bold text-lg text-primary\">{troop.nombre}</h3>\n            <span className=\"text-sm font-bold bg-white/50 px-2 py-1 rounded\">Disponibles: {currentAmount}</span>\n        </div>\n        <div className=\"flex flex-col md:flex-row gap-4 w-full\">\n            <div className=\"flex-shrink-0 w-24\">\n                {image && (\n                    <Image\n                        src={image.imageUrl}\n                        alt={troop.nombre}\n                        width={100}\n                        height={100}\n                        className=\"rounded w-full h-auto object-cover\"\n                    />\n                )}\n                <p className=\"text-xs text-center mt-1\">{formatDuration(troop.duracion_reclutamiento)}</p>\n            </div>\n            <div className=\"flex-1\">\n                <p className=\"text-sm mb-2\">{troop.descripcion}</p>\n                <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm border-t border-b border-black/10 py-2\">\n                    {troop.costo_armas > 0 && (\n                        <div className=\"flex items-center\">\n                            <span>Armas: {troop.costo_armas}</span>\n                            <ResourceIcon type=\"Armas\" />\n                        </div>\n                    )}\n                    {troop.costo_municion > 0 && (\n                        <div className=\"flex items-center\">\n                            <span>Munición: {troop.costo_municion}</span>\n                            <ResourceIcon type=\"Municion\" />\n                        </div>\n                    )}\n                     {troop.costo_dolares > 0 && (\n                        <div className=\"flex items-center\">\n                            <span>Dólares: {troop.costo_dolares}</span>\n                            <ResourceIcon type=\"Dolares\" />\n                        </div>\n                    )}\n                </div>\n                 <div className=\"mt-2 text-xs flex gap-2 text-muted-foreground\">\n                    <span>ATK: {troop.ataque}</span>\n                    <span>DEF: {troop.defensa}</span>\n                    <span>VEL: {troop.velocidad}</span>\n                    <span>CAP: {troop.capacidad_carga}</span>\n                </div>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n                <Input\n                    type=\"number\"\n                    placeholder=\"0\"\n                    className=\"w-20 h-8 text-sm text-center\"\n                    value={amount}\n                    onChange={(e) => setAmount(Number(e.target.value))}\n                    min={1}\n                    max={maxRecruitable}\n                />\n                <div className=\"flex gap-1\">\n                    <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"bg-accent hover:bg-accent/90 h-8 text-xs\"\n                        onClick={handleRecruit}\n                        disabled={isPending || !amount || Number(amount) <= 0 || Number(amount) > maxRecruitable}\n                    >\n                        {isPending ? \"...\" : \"Reclutar\"}\n                    </Button>\n                    <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"h-8 text-xs\"\n                        onClick={() => setAmount(maxRecruitable)}\n                        disabled={maxRecruitable === 0}\n                    >\n                        Max ({maxRecruitable})\n                    </Button>\n                </div>\n            </div>\n        </div>\n    </div>\n  );\n}\n"
                }
              ]
            },
            {
              "name": "reset-password",
              "type": "directory",
              "children": [
                {
                  "name": "reset-password-form.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { resetPassword } from '@/actions/auth.stubs'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect } from 'react'\nimport { useToast } from '@/hooks/use-toast'\n\nconst initialState = {\n  message: '',\n  errors: {} as Record<string, string[]>,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Restableciendo...' : 'Restablecer Contraseña'}\n    </Button>\n  )\n}\n\nexport function ResetPasswordForm() {\n  const [state, formAction] = useActionState(resetPassword, initialState)\n  const { toast } = useToast()\n\n  useEffect(() => {\n    if (state?.message) {\n      toast({\n        title: 'Error',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Restablecer Contraseña</CardTitle>\n        <CardDescription>\n          Ingresa tu nueva contraseña a continuación.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Nueva Contraseña</Label>\n            <Input id=\"password\" name=\"password\" type=\"password\" required />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "resource-bar.tsx",
              "type": "file",
              "content": "'use client'\n\nimport { Coins, Droplets, Shell } from \"lucide-react\";\nimport { useGameState } from \"@/components/providers/game-state-provider\";\n\nexport function ResourceBar() {\n    const { gameState } = useGameState();\n\n    if (!gameState) {\n        return <div className=\"bg-stone-800 text-white shadow-lg p-2 text-center text-xs\">Cargando recursos...</div>;\n    }\n\n    const { recursos } = gameState;\n\n    const resources = [\n        { name: \"Armas\", shortName: \"A\", value: recursos.armas.val, icon: <Shell className=\"w-5 h-5 text-gray-500\" /> },\n        { name: \"Municion\", shortName: \"M\", value: recursos.municion.val, icon: <Coins className=\"w-5 h-5 text-yellow-500\" /> },\n        { name: \"Alcohol\", shortName: \"A\", value: recursos.alcohol.val, icon: <Droplets className=\"w-5 h-5 text-blue-400\" /> },\n        { name: \"Dolares\", shortName: \"D\", value: recursos.dolares.val, icon: <p className=\"text-lg font-bold text-green-500\">$</p> },\n    ];\n\n    return (\n        <div className=\"bg-stone-800 text-white shadow-lg\">\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-px bg-black/20\">\n                {resources.map(resource => (\n                    <div key={resource.name} className=\"bg-stone-700/80 p-2\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"text-sm font-bold text-stone-400\">\n                                <span className=\"hidden md:inline\">{resource.name}:</span>\n                                <span className=\"md:hidden\">{resource.shortName}:</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm font-mono\">{Math.floor(resource.value).toLocaleString()}</span>\n                                {resource.icon}\n                            </div>\n                        </div>\n                    </div>\n                ))}\n            </div>\n        </div>\n    )\n}\n"
            },
            {
              "name": "resources",
              "type": "directory",
              "children": [
                {
                  "name": "building-production.tsx",
                  "type": "file",
                  "content": "import {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n} from \"@/components/ui/table\";\nimport { buildingProductionData } from \"@/lib/data/resources-data\";\n  \nexport function BuildingProduction() {\n    const totals = buildingProductionData.buildings.reduce((acc, building) => {\n        acc.armas += building.production.armas;\n        acc.municion += building.production.municion;\n        acc.alcohol += building.production.alcohol;\n        acc.dolares += building.production.dolares;\n        return acc;\n    }, { ...buildingProductionData.baseSalary });\n\n    return (\n        <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4\">\n                <CardTitle className=\"text-lg text-primary-foreground\">Edificio 34:13:129 / Recursos / Hora</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n                <Table>\n                    <TableHeader>\n                        <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                            <TableHead className=\"text-primary-foreground w-[200px]\"></TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Armas</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Munición</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Alcohol</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Dólares</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-semibold\">Salario base</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{buildingProductionData.baseSalary.armas}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{buildingProductionData.baseSalary.municion}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{buildingProductionData.baseSalary.alcohol}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.baseSalary.dolares}</TableCell>\n                        </TableRow>\n                        {buildingProductionData.buildings.map((building) => (\n                            <TableRow key={building.name} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                <TableCell className=\"font-semibold\">{building.name} ({building.level})</TableCell>\n                                <TableCell className={`text-center ${building.production.armas > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.armas}</TableCell>\n                                <TableCell className={`text-center ${building.production.municion > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.municion}</TableCell>\n                                <TableCell className={`text-center ${building.production.alcohol > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.alcohol}</TableCell>\n                                <TableCell className={`text-center ${building.production.dolares > 0 ? 'text-green-600 font-bold' : ''}`}>{building.production.dolares}</TableCell>\n                            </TableRow>\n                        ))}\n                        <TableRow className=\"bg-primary/20 hover:bg-primary/30\">\n                            <TableCell className=\"font-semibold text-center text-lg\">=</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{totals.armas}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{totals.municion}</TableCell>\n                            <TableCell className=\"text-center text-green-600 font-bold\">{totals.alcohol}</TableCell>\n                            <TableCell className=\"text-center\">{totals.dolares}</TableCell>\n                        </TableRow>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-semibold\">Capacidad de Almacenamiento</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.armas.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.municion.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.alcohol.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.capacity.dolares.toLocaleString()}</TableCell>\n                        </TableRow>\n                        <TableRow className=\"bg-stone-200 hover:bg-stone-300/60\">\n                            <TableCell className=\"font-semibold\">Almacenados en forma segura</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.armas.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.municion.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.alcohol.toLocaleString()}</TableCell>\n                            <TableCell className=\"text-center\">{buildingProductionData.storage.safe.dolares.toLocaleString()}</TableCell>\n                        </TableRow>\n                    </TableBody>\n                </Table>\n            </CardContent>\n        </Card>\n    );\n}\n"
                },
                {
                  "name": "total-production.tsx",
                  "type": "file",
                  "content": "import {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n  } from \"@/components/ui/card\";\nimport {\n    Table,\n    TableBody,\n    TableCell,\n    TableHead,\n    TableHeader,\n    TableRow,\n  } from \"@/components/ui/table\";\nimport { totalProductionData } from \"@/lib/data/resources-data\";\n\nexport function TotalProduction() {\n    return (\n        <Card className=\"border-primary bg-stone-200 text-black overflow-hidden\">\n            <CardHeader className=\"bg-primary/80 py-2 px-4\">\n                <CardTitle className=\"text-lg text-primary-foreground\">Producción Total</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n                <Table>\n                    <TableHeader>\n                        <TableRow className=\"bg-primary/70 hover:bg-primary/70\">\n                            <TableHead className=\"text-primary-foreground w-1/3\">Recurso</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Hora</TableHead>\n                            <TableHead className=\"text-primary-foreground text-center\">Día</TableHead>\n                        </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                        {totalProductionData.map((item) => (\n                            <TableRow key={item.resource} className=\"bg-stone-200 hover:bg-stone-300/60\">\n                                <TableCell className=\"font-semibold\">{item.resource}</TableCell>\n                                <TableCell className=\"text-center\">{item.hour}</TableCell>\n                                <TableCell className=\"text-center\">{item.day.toLocaleString()}</TableCell>\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n            </CardContent>\n        </Card>\n    );\n}\n"
                }
              ]
            },
            {
              "name": "rooms",
              "type": "directory",
              "children": [
                {
                  "name": "construction-queue-list.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Clock, Hammer } from \"lucide-react\";\nimport { ColaDetalle } from \"@/types/game\";\nimport { useEffect, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ConstructionQueueListProps {\n  queue: ColaDetalle[];\n  limit?: number;\n  compact?: boolean;\n}\n\nexport function ConstructionQueueList({ queue, limit, compact = false }: ConstructionQueueListProps) {\n  const [now, setNow] = useState<number>(Date.now());\n\n  useEffect(() => {\n    if (queue.length === 0) return;\n    const interval = setInterval(() => setNow(Date.now()), 1000);\n    return () => clearInterval(interval);\n  }, [queue.length]);\n\n  if (!queue || queue.length === 0) {\n    if (compact) {\n        return (\n            <Card className=\"border-dashed border-stone-300 bg-stone-50/50 shadow-none\">\n                <CardContent className=\"p-4 text-center text-sm text-muted-foreground flex flex-col items-center gap-2\">\n                    <Hammer className=\"w-4 h-4 opacity-50\" />\n                    <span>Cola de construcción vacía</span>\n                </CardContent>\n            </Card>\n        )\n    }\n    return null;\n  }\n\n  const displayQueue = limit ? queue.slice(0, limit) : queue;\n\n  return (\n    <Card className={cn(\"border-amber-500/30 bg-amber-950/10\", compact && \"shadow-sm\")}>\n      <CardContent className={cn(\"space-y-3\", compact ? \"p-3\" : \"p-4\")}>\n        <div className=\"flex items-center gap-2 mb-2\">\n            <Hammer className={cn(\"text-amber-600\", compact ? \"w-4 h-4\" : \"w-5 h-5\")} />\n            <h3 className={cn(\"font-bold text-amber-800 dark:text-amber-500\", compact ? \"text-sm\" : \"\")}>\n                Cola de Construcción\n            </h3>\n            <Badge variant=\"outline\" className=\"ml-auto border-amber-500/50 text-amber-700 dark:text-amber-400\">\n                {queue.length} / 5\n            </Badge>\n        </div>\n        \n        <div className={cn(\"grid gap-3\", compact ? \"grid-cols-1\" : \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5\")}>\n            {displayQueue.map((item) => {\n                const endTime = new Date(item.fecha_fin).getTime();\n                const timeLeft = Math.max(0, endTime - now);\n                const secondsLeft = Math.floor(timeLeft / 1000);\n                \n                const hours = Math.floor(secondsLeft / 3600);\n                const minutes = Math.floor((secondsLeft % 3600) / 60);\n                const seconds = secondsLeft % 60;\n                \n                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n\n                return (\n                    <div key={item.id} className=\"bg-card border border-border/50 rounded p-2 flex flex-col gap-1 shadow-sm\">\n                        <div className=\"flex justify-between items-start\">\n                            <span className={cn(\"font-semibold truncate pr-2\", compact ? \"text-xs\" : \"text-sm\")}>{item.nombre}</span>\n                            <span className=\"text-xs font-mono bg-muted px-1 rounded\">{timeString}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center text-xs text-muted-foreground\">\n                            <span>Nivel {item.nivel_destino}</span>\n                            <Clock className=\"w-3 h-3\" />\n                        </div>\n                         <Progress value={100} className=\"h-1 mt-1 animate-pulse\" /> \n                    </div>\n                );\n            })}\n        </div>\n        {limit && queue.length > limit && (\n            <div className=\"text-center text-xs text-muted-foreground pt-1\">\n                + {queue.length - limit} más...\n            </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n"
                },
                {
                  "name": "room-card.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { Coins, Shell, Droplets } from \"lucide-react\";\nimport type { Room } from \"@/lib/data/rooms-data\";\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { upgradeBuildingAction, cancelConstructionAction } from \"@/actions/game.actions\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState, useOptimistic, useTransition } from \"react\";\nimport { ColaDetalle } from \"@/types/game\";\nimport { Progress } from \"@/components/ui/progress\";\n\ntype RoomCardProps = {\n  room: Room;\n  propiedadId?: string;\n  dynamicLevel: number;\n  construction?: ColaDetalle;\n  isQueueFull?: boolean;\n};\n\nconst ResourceIcon = ({ type }: { type: string }) => {\n    const iconClass = \"w-3 h-3 md:w-4 md:h-4 mr-1\";\n    switch (type) {\n        case 'Armas':\n            return <Shell className={`${iconClass} text-stone-600`} />;\n        case 'Municion':\n            return <Coins className={`${iconClass} text-yellow-600`} />;\n        case 'Dolares':\n            return <span className={`${iconClass} font-bold text-green-700 flex items-center justify-center`}>$</span>;\n        default:\n            return null;\n    }\n}\n\nexport function RoomCard({ room, propiedadId, dynamicLevel, construction, isQueueFull = false }: RoomCardProps) {\n  const image = PlaceHolderImages.find((p) => p.id === room.image) || PlaceHolderImages.find(p => p.id === 'dark-alley');\n  const { toast } = useToast();\n  const [isPending, startTransition] = useTransition();\n\n  const handleUpgrade = async () => {\n    if (!propiedadId) return;\n\n    startTransition(async () => {\n      const result = await upgradeBuildingAction(room.id);\n      if (result.success) {\n        toast({ title: \"Construcción iniciada\", description: `Mejorando ${room.name}.` });\n      } else {\n        toast({ title: \"Error\", description: result.error, variant: \"destructive\" });\n      }\n    });\n  };\n\n  const handleCancel = async () => {\n      if (!construction) return;\n      startTransition(async () => {\n          const result = await cancelConstructionAction(construction.id);\n          if (result.success) {\n              toast({ title: \"Cancelado\", description: \"Construcción cancelada.\" });\n          } else {\n              toast({ title: \"Error\", description: result.error, variant: \"destructive\" });\n          }\n      });\n  };\n\n  const isConstructing = !!construction;\n\n  return (\n    <Card className=\"flex flex-col sm:flex-row overflow-hidden hover:shadow-lg transition-shadow duration-300 border-primary/20 bg-card\">\n      {/* Image Section */}\n      <div className=\"relative w-full sm:w-1/3 min-h-[160px] sm:min-h-full\">\n        {image && (\n            <Image\n            src={image.imageUrl}\n            alt={image.description}\n            fill\n            className=\"object-cover\"\n            data-ai-hint={image.imageHint}\n            sizes=\"(max-width: 640px) 100vw, 33vw\"\n            />\n        )}\n        <div className=\"absolute top-2 right-2 sm:hidden\">\n             <Badge variant=\"secondary\" className=\"font-bold\">Nv. {dynamicLevel}</Badge>\n        </div>\n      </div>\n\n      {/* Content Section */}\n      <div className=\"flex-1 flex flex-col justify-between p-4 gap-3\">\n        <div className=\"space-y-2\">\n            <div className=\"flex justify-between items-start\">\n                <h3 className=\"font-bold text-lg md:text-xl text-primary font-headline leading-tight\">\n                {room.name}\n                </h3>\n                <Badge variant=\"outline\" className=\"hidden sm:inline-flex border-primary/50 text-primary font-bold\">\n                    Nv. {dynamicLevel}\n                </Badge>\n            </div>\n            \n            <p className=\"text-sm text-muted-foreground line-clamp-2 md:line-clamp-3\">\n                {room.description}\n            </p>\n        </div>\n\n        {/* Resources & Action Footer */}\n        <div className=\"space-y-3 pt-2 border-t border-border/50\">\n             <div className=\"flex flex-wrap gap-x-4 gap-y-2 text-xs md:text-sm text-muted-foreground\">\n                {Object.entries(room.costs).map(([resource, value]) => (\n                    <div key={resource} className=\"flex items-center font-medium\">\n                        <ResourceIcon type={resource} />\n                        <span>{value}</span>\n                    </div>\n                ))}\n                <div className=\"flex items-center ml-auto text-xs font-mono bg-secondary/30 px-2 py-0.5 rounded\">\n                    ⏱ {room.duration}\n                </div>\n            </div>\n\n            <div className=\"flex justify-end pt-1\">\n                {isConstructing ? (\n                <div className=\"w-full space-y-2\">\n                    <div className=\"flex justify-between text-xs\">\n                        <span className=\"font-bold text-amber-600\">En construcción...</span>\n                        <span>{new Date(construction.fecha_fin).toLocaleTimeString()}</span>\n                    </div>\n                    {/* Simplified progress bar or countdown could be here */}\n                    <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"w-full h-7 text-xs\"\n                        onClick={handleCancel}\n                        disabled={isPending}\n                    >\n                        {isPending ? \"Cancelando...\" : \"Cancelar\"}\n                    </Button>\n                </div>\n                ) : (\n                <Button\n                    className=\"w-full sm:w-auto\"\n                    size=\"sm\"\n                    onClick={handleUpgrade}\n                    disabled={isPending || !propiedadId || isQueueFull}\n                    title={isQueueFull ? \"Cola de construcción llena (5/5)\" : \"Ampliar edificio\"}\n                >\n                    {isPending ? \"Iniciando...\" : (isQueueFull ? \"Cola Llena\" : \"Ampliar\")}\n                </Button>\n                )}\n            </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n"
                },
                {
                  "name": "rooms-view.tsx",
                  "type": "file",
                  "content": "'use client';\n\nimport { GameStateProvider, useGameState } from \"@/components/providers/game-state-provider\";\nimport { DashboardData } from \"@/types/game\";\nimport { roomsData } from \"@/lib/data/rooms-data\";\nimport { RoomCard } from \"./room-card\";\nimport { ConstructionQueueList } from \"./construction-queue-list\";\nimport { MAX_CONSTRUCTION_QUEUE_SIZE } from \"@/lib/constants\";\n\n// Inner component that consumes hook\nfunction RoomsContent() {\n    const { gameState } = useGameState();\n\n    if (!gameState) return <div>Cargando...</div>;\n\n    const { propiedad, edificios, colas } = gameState;\n    const queueLength = colas.construccion.length;\n    const isQueueFull = queueLength >= MAX_CONSTRUCTION_QUEUE_SIZE;\n\n    return (\n      <div className=\"space-y-6\">\n          <ConstructionQueueList queue={colas.construccion} />\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4 md:gap-6\">\n            {roomsData.map((room) => {\n                // Find dynamic data\n                // Match room.id with edificios.id\n                const edificio = edificios.find(e => e.id === room.id);\n                // Match room.id with colas.construccion.habitacion_id\n                const construction = colas.construccion.find(c => c.habitacion_id === room.id);\n\n                return (\n                  <RoomCard\n                    key={room.id}\n                    room={room}\n                    propiedadId={propiedad.id}\n                    dynamicLevel={edificio?.nivel || 0}\n                    construction={construction}\n                    isQueueFull={isQueueFull}\n                  />\n                );\n            })}\n          </div>\n      </div>\n    );\n}\n\nexport function RoomsView({ initialData }: { initialData: DashboardData }) {\n    return (\n        <GameStateProvider initialData={initialData}>\n            <div className=\"space-y-4 md:space-y-6\">\n                <div className=\"bg-primary text-primary-foreground text-center py-3 rounded-sm shadow-sm\">\n                    <h1 className=\"text-xl md:text-2xl font-bold tracking-wide\">Gestión de Habitaciones</h1>\n                </div>\n                <RoomsContent />\n            </div>\n        </GameStateProvider>\n    );\n}\n"
                }
              ]
            },
            {
              "name": "server-time.tsx",
              "type": "file",
              "content": "'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\n\nexport function ServerTime() {\n  const [serverTime, setServerTime] = useState('');\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      const now = new Date();\n      const date = `${String(now.getDate()).padStart(2, '0')}.${String(\n        now.getMonth() + 1\n      ).padStart(2, '0')}.${now.getFullYear()}`;\n      const time = `${String(now.getHours()).padStart(2, '0')}:${String(\n        now.getMinutes()\n      ).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;\n      setServerTime(`${date} - ${time}`);\n    }, 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4 flex-row items-center justify-between\">\n        <CardTitle className=\"text-lg text-primary-foreground\">\n          Hora del servidor\n        </CardTitle>\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-primary-foreground\">\n          <span className=\"font-bold\">[-]</span>\n        </Button>\n      </CardHeader>\n      <CardContent className=\"p-4 text-center\">\n        <p className=\"text-xl font-bold\">{serverTime}</p>\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "side-nav.tsx",
              "type": "file",
              "content": "'use client'\n\nimport React from \"react\";\nimport Link from \"next/link\";\nimport { Bell, BookOpen, Building, ChevronDown, Castle, Crosshair, FileText, Globe, Hand, HelpCircle, Home, LogOut, Map, MessageSquare, Scale, Search, Settings, Shield, Swords, Users, Warehouse, Eye } from \"lucide-react\";\nimport { SidebarHeader, SidebarContent, SidebarMenu, SidebarMenuItem, SidebarMenuButton, useSidebar } from \"@/components/ui/sidebar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { SignOutButton } from \"./sign-out-button\";\nimport { ClientSelect } from \"@/components/ui/client-select\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\nconst menuItems = [\n    { name: \"Nueva alerta\", icon: Bell, href: \"/dashboard/alerts\", highlight: true },\n    { name: \"Vision general\", icon: Home, href: \"/dashboard\" },\n    { name: \"Visión Global\", icon: Eye, href: \"/dashboard/overview\" },\n    { name: \"Habitaciones\", icon: Building, href: \"/dashboard/rooms\" },\n    { name: \"Reclutamiento\", icon: Users, href: \"/dashboard/recruitment\" },\n    { name: \"Seguridad\", icon: Shield, href: \"/dashboard/security\" },\n    { name: \"Entrenamiento\", icon: Crosshair, href: \"/dashboard/training\" },\n    { name: \"Edificios\", icon: Castle, href: \"/dashboard/buildings\" },\n    { name: \"Recursos\", icon: Warehouse, href: \"/dashboard/resources\" },\n    { name: \"Arbol Tecnologico\", icon: FileText, href: \"/dashboard/tech-tree\" },\n    { name: \"Buscar\", icon: Search, href: \"/dashboard/search\", isSearch: true },\n    { name: \"Familia\", icon: Users, href: \"/dashboard/family\" },\n    { name: \"Mapa\", icon: Map, href: \"/dashboard/map\" },\n    { name: \"Simulador\", icon: Globe, href: \"/dashboard/simulator\" },\n    { name: \"Mercado\", icon: Hand, href: \"/dashboard/market\" },\n    { name: \"Misiones\", icon: FileText, href: \"/dashboard/missions\" },\n    { name: \"Mensajes\", icon: MessageSquare, href: \"/dashboard/messages\" },\n    { name: \"Chat\", icon: Globe, href: \"/dashboard/chat\" },\n    { name: \"Guerras\", icon: Swords, href: \"/dashboard/wars\" },\n    { name: \"Records\", icon: BookOpen, href: \"/dashboard/records\" },\n    { name: \"Batallas\", icon: Crosshair, href: \"/dashboard/battles\" },\n    { name: \"Clasificacion\", icon: Scale, href: \"/dashboard/ranking\" },\n    { name: \"Opciones\", icon: Settings, href: \"/dashboard/options\" },\n];\n\n\nexport function SideNav({ userEmail }: { userEmail: string | undefined }) {\n    const { setOpenMobile } = useSidebar();\n    const [currentDate, setCurrentDate] = React.useState('');\n\n    React.useEffect(() => {\n        const updateDate = () => {\n            const date = new Date().toLocaleString('en-US', {\n                weekday: 'short',\n                month: 'numeric',\n                day: 'numeric',\n                year: 'numeric',\n                hour: '2-digit',\n                minute: '2-digit',\n                second: '2-digit',\n                hour12: false,\n            }).replace(',', ' -');\n            setCurrentDate(date.replace(/\\//g, '.'));\n        };\n\n        updateDate();\n        const intervalId = setInterval(updateDate, 1000);\n\n        return () => clearInterval(intervalId);\n    }, []);\n\n    const handleLinkClick = () => {\n        setOpenMobile(false);\n    }\n\n    return (\n        <div className=\"flex flex-col h-full bg-stone-900 text-stone-300\">\n            <SidebarHeader className=\"bg-stone-950 p-4 text-center border-b border-stone-800\">\n                <h2 className=\"font-bold text-xl text-primary font-headline tracking-wider\">VENDETTA</h2>\n                <p className=\"text-xs text-stone-500 font-mono mt-1\">{currentDate}</p>\n            </SidebarHeader>\n            \n            <SidebarContent className=\"flex-1 overflow-hidden\">\n                <ScrollArea className=\"h-full\">\n                    <SidebarMenu className=\"p-2 gap-1\">\n                        {menuItems.map((item) => (\n                            <SidebarMenuItem key={item.name}>\n                                {item.isSearch ? (\n                                    <div className=\"p-2 my-2 border border-stone-800 rounded bg-stone-950/50\">\n                                        <div className=\"flex items-center gap-2 text-sm\">\n                                            <Search className=\"h-4 w-4 text-stone-500\" />\n                                            <div className=\"flex-1\">\n                                                 <ClientSelect />\n                                            </div>\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <Link href={item.href} passHref onClick={handleLinkClick} className=\"w-full\">\n                                    <SidebarMenuButton \n                                        className={`w-full justify-start h-10 px-3 transition-all duration-200 \n                                            ${item.highlight \n                                                ? 'bg-primary/20 text-primary hover:bg-primary/30 border-l-2 border-primary' \n                                                : 'hover:bg-stone-800 hover:text-white border-l-2 border-transparent hover:border-stone-600'\n                                            }`}\n                                    >\n                                        <item.icon className={`h-4 w-4 mr-3 ${item.highlight ? 'text-primary' : 'text-stone-500 group-hover:text-stone-300'}`} />\n                                        <span className=\"font-medium text-sm\">{item.name}</span>\n                                    </SidebarMenuButton>\n                                    </Link>\n                                )}\n                            </SidebarMenuItem>\n                        ))}\n                    </SidebarMenu>\n                </ScrollArea>\n            </SidebarContent>\n\n            <div className=\"mt-auto border-t border-stone-800 bg-stone-950 p-4\">\n                <div className=\"mb-4 px-2\">\n                    <p className=\"text-xs font-medium text-stone-500 uppercase tracking-wider mb-1\">Cuenta</p>\n                    <p className=\"text-sm text-stone-300 truncate font-mono\" title={userEmail}>\n                        {userEmail || 'Invitado'}\n                    </p>\n                </div>\n                <SignOutButton />\n            </div>\n        </div>\n    );\n}\n"
            },
            {
              "name": "sign-out-button.tsx",
              "type": "file",
              "content": "'use client'\n\nimport { signOutAction as signOut } from '@/actions/auth.actions'\nimport { Button } from '@/components/ui/button'\nimport { LogOut } from 'lucide-react'\n\nexport function SignOutButton() {\n  return (\n    <form action={signOut}>\n      <Button type=\"submit\" variant=\"secondary\" size=\"sm\" className=\"w-full justify-start text-white bg-stone-700 hover:bg-stone-600\">\n        <LogOut className=\"mr-2 h-4 w-4\" />\n        Cerrar Sesión\n      </Button>\n    </form>\n  )\n}\n"
            },
            {
              "name": "tech-tree",
              "type": "directory",
              "children": [
                {
                  "name": "tech-card.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { useTransition } from 'react'\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Progress } from '@/components/ui/progress'\nimport { startResearchAction } from '@/lib/actions/research.actions'\nimport { useToast } from '@/hooks/use-toast'\nimport { ConfiguracionEntrenamiento, ColaInvestigacion } from '@/types/database'\nimport { Recursos } from '@/types/game'\nimport { Loader2, Lock, Clock, Pickaxe, Shield, Sword } from 'lucide-react'\nimport Image from 'next/image'\n\ninterface TechCardProps {\n  config: ConfiguracionEntrenamiento\n  level: number\n  queueItem?: ColaInvestigacion\n  resources: Recursos\n  requirementsMet: boolean\n  requirementsText: string[]\n  propertyId: string\n  queueFull: boolean\n}\n\nexport function TechCard({\n  config,\n  level,\n  queueItem,\n  resources,\n  requirementsMet,\n  requirementsText,\n  propertyId,\n  queueFull\n}: TechCardProps) {\n  const [isPending, startTransition] = useTransition()\n  const { toast } = useToast()\n\n  const canAfford = \n    resources.armas >= (config.costo_armas || 0) &&\n    resources.municion >= (config.costo_municion || 0) &&\n    resources.dolares >= (config.costo_dolares || 0)\n\n  const isResearching = !!queueItem\n  \n  // Calculate progress if researching\n  const calculateProgress = () => {\n    if (!queueItem) return 0\n    const start = new Date(queueItem.fecha_inicio).getTime()\n    const end = new Date(queueItem.fecha_fin).getTime()\n    const now = new Date().getTime()\n    const total = end - start\n    const current = now - start\n    return Math.min(Math.max((current / total) * 100, 0), 100)\n  }\n\n  const handleStartResearch = () => {\n    startTransition(async () => {\n      const result = await startResearchAction(propertyId, config.id)\n      if (result.success) {\n        toast({\n          title: \"Investigación iniciada\",\n          description: `Se ha iniciado la investigación de ${config.nombre}`,\n        })\n      } else {\n        toast({\n          title: \"Error\",\n          description: result.error,\n          variant: \"destructive\"\n        })\n      }\n    })\n  }\n\n  const formatDuration = (seconds: number) => {\n    const h = Math.floor(seconds / 3600)\n    const m = Math.floor((seconds % 3600) / 60)\n    const s = seconds % 60\n    return `${h > 0 ? h + 'h ' : ''}${m}m ${s}s`\n  }\n\n  return (\n    <Card className={`relative overflow-hidden ${!requirementsMet ? 'opacity-75 bg-stone-100' : ''}`}>\n      {!requirementsMet && (\n        <div className=\"absolute inset-0 bg-stone-900/10 z-10 pointer-events-none flex items-center justify-center\">\n          <Lock className=\"w-12 h-12 text-stone-500 opacity-20\" />\n        </div>\n      )}\n      \n      <CardHeader className=\"pb-2\">\n        <div className=\"flex justify-between items-start\">\n          <CardTitle className=\"text-lg font-bold truncate\">{config.nombre}</CardTitle>\n          <Badge variant={level > 0 ? \"default\" : \"secondary\"}>\n            Nvl {level}\n          </Badge>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        <div className=\"relative aspect-video w-full overflow-hidden rounded-md bg-stone-200\">\n           {/* Placeholder or Image */}\n           <div className=\"absolute inset-0 flex items-center justify-center text-stone-400\">\n             {config.url_imagen ? (\n                <Image \n                  src={`/images/${config.url_imagen}.jpg`} \n                  alt={config.nombre}\n                  fill\n                  className=\"object-cover\"\n                  onError={(e) => {\n                    // Fallback if image fails\n                    (e.target as HTMLImageElement).style.display = 'none'\n                  }}\n                />\n             ) : (\n                <Pickaxe className=\"w-10 h-10\" />\n             )}\n           </div>\n           \n           {isResearching && (\n             <div className=\"absolute inset-0 bg-black/60 flex flex-col items-center justify-center p-4\">\n                <span className=\"text-white text-sm font-medium mb-2\">Investigando...</span>\n                <Progress value={calculateProgress()} className=\"h-2 w-full\" />\n                <span className=\"text-white text-xs mt-1\">\n                   {formatDuration((config.duracion_entrenamiento || 0))}\n                </span>\n             </div>\n           )}\n        </div>\n\n        <div className=\"space-y-2 text-sm\">\n          {config.costo_armas && config.costo_armas > 0 ? (\n            <div className={`flex justify-between ${resources.armas < config.costo_armas ? 'text-red-500' : ''}`}>\n              <span className=\"flex items-center gap-1\"><Sword className=\"w-3 h-3\"/> Armas</span>\n              <span>{config.costo_armas.toLocaleString()}</span>\n            </div>\n          ) : null}\n          \n          {config.costo_municion && config.costo_municion > 0 ? (\n            <div className={`flex justify-between ${resources.municion < config.costo_municion ? 'text-red-500' : ''}`}>\n               <span className=\"flex items-center gap-1\"><Shield className=\"w-3 h-3\"/> Munición</span>\n               <span>{config.costo_municion.toLocaleString()}</span>\n            </div>\n          ) : null}\n          \n          {config.costo_dolares && config.costo_dolares > 0 ? (\n            <div className={`flex justify-between ${resources.dolares < config.costo_dolares ? 'text-red-500' : ''}`}>\n               <span className=\"flex items-center gap-1\">$ Dólares</span>\n               <span>{config.costo_dolares.toLocaleString()}</span>\n            </div>\n          ) : null}\n\n          <div className=\"flex justify-between text-stone-500\">\n             <span className=\"flex items-center gap-1\"><Clock className=\"w-3 h-3\"/> Tiempo</span>\n             <span>{formatDuration(config.duracion_entrenamiento || 0)}</span>\n          </div>\n        </div>\n\n        {!requirementsMet && requirementsText.length > 0 && (\n           <div className=\"text-xs text-red-500 mt-2 bg-red-50 p-2 rounded\">\n             <p className=\"font-semibold mb-1\">Requisitos:</p>\n             <ul className=\"list-disc list-inside\">\n               {requirementsText.map((req, i) => (\n                 <li key={i}>{req}</li>\n               ))}\n             </ul>\n           </div>\n        )}\n      </CardContent>\n\n      <CardFooter>\n        <Button \n          className=\"w-full\" \n          onClick={handleStartResearch}\n          disabled={!requirementsMet || !canAfford || isResearching || queueFull || isPending}\n        >\n          {isPending ? (\n            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n          ) : isResearching ? (\n            \"En Progreso\"\n          ) : (\n            \"Investigar\"\n          )}\n        </Button>\n      </CardFooter>\n    </Card>\n  )\n}\n"
                },
                {
                  "name": "tech-tree-table.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { TechCard } from './tech-card'\nimport { ConfiguracionEntrenamiento, RequisitoEntrenamiento, ColaInvestigacion } from '@/types/database'\nimport { Recursos, InvestigacionDetalle } from '@/types/game' \nimport { ScrollArea } from '@/components/ui/scroll-area'\n\ninterface TechTreeViewProps {\n  configs: ConfiguracionEntrenamiento[]\n  requirements: RequisitoEntrenamiento[]\n  userResearch: InvestigacionDetalle[]\n  queue: ColaInvestigacion | null \n  activeQueueItem?: ColaInvestigacion \n  resources: Recursos\n  propertyId: string\n}\n\nexport function TechTreeView({\n  configs,\n  requirements,\n  userResearch,\n  activeQueueItem,\n  resources,\n  propertyId\n}: TechTreeViewProps) {\n\n  // Helper to find current level\n  const getLevel = (techId: string) => {\n    const research = userResearch.find(r => r.id === techId)\n    return research ? research.nivel : 0\n  }\n\n  // Helper to check requirements\n  const checkRequirements = (techId: string) => {\n    const techReqs = requirements.filter(r => r.entrenamiento_id === techId)\n    if (techReqs.length === 0) return { met: true, texts: [] }\n\n    const missing: string[] = []\n    \n    for (const req of techReqs) {\n      if (req.entrenamiento_requerido_id) {\n        const currentLvl = getLevel(req.entrenamiento_requerido_id)\n        if (currentLvl < (req.nivel_requerido || 1)) {\n           const reqConfig = configs.find(c => c.id === req.entrenamiento_requerido_id)\n           const reqName = reqConfig ? reqConfig.nombre : req.entrenamiento_requerido_id\n           missing.push(`${reqName} (Nvl ${req.nivel_requerido})`)\n        }\n      }\n    }\n\n    return {\n      met: missing.length === 0,\n      texts: missing\n    }\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-4\">\n      {configs.map(config => {\n        const level = getLevel(config.id)\n        const reqStatus = checkRequirements(config.id)\n        const queueItem = activeQueueItem && activeQueueItem.entrenamiento_id === config.id ? activeQueueItem : undefined\n        \n        return (\n          <TechCard\n            key={config.id}\n            config={config}\n            level={level}\n            queueItem={queueItem}\n            resources={resources}\n            requirementsMet={reqStatus.met}\n            requirementsText={reqStatus.texts}\n            propertyId={propertyId}\n            queueFull={!!activeQueueItem && activeQueueItem.entrenamiento_id !== config.id}\n          />\n        )\n      })}\n    </div>\n  )\n}\n"
                },
                {
                  "name": "tech-tree-view.tsx",
                  "type": "file",
                  "content": "'use client'\n\nimport { TechCard } from './tech-card'\nimport { ConfiguracionEntrenamiento, RequisitoEntrenamiento, ColaInvestigacion } from '@/types/database'\nimport { Recursos, InvestigacionDetalle } from '@/types/game' \nimport { ScrollArea } from '@/components/ui/scroll-area'\n\ninterface TechTreeViewProps {\n  configs: ConfiguracionEntrenamiento[]\n  requirements: RequisitoEntrenamiento[]\n  userResearch: InvestigacionDetalle[]\n  queue: ColaInvestigacion | null \n  activeQueueItem?: ColaInvestigacion \n  resources: Recursos\n  propertyId: string\n}\n\nexport function TechTreeView({\n  configs,\n  requirements,\n  userResearch,\n  activeQueueItem,\n  resources,\n  propertyId\n}: TechTreeViewProps) {\n\n  // Helper to find current level\n  const getLevel = (techId: string) => {\n    const research = userResearch.find(r => r.id === techId)\n    return research ? research.nivel : 0\n  }\n\n  // Helper to check requirements\n  const checkRequirements = (techId: string) => {\n    const techReqs = requirements.filter(r => r.entrenamiento_id === techId)\n    if (techReqs.length === 0) return { met: true, texts: [] }\n\n    const missing: string[] = []\n    \n    for (const req of techReqs) {\n      if (req.entrenamiento_requerido_id) {\n        const currentLvl = getLevel(req.entrenamiento_requerido_id)\n        if (currentLvl < (req.nivel_requerido || 1)) {\n           const reqConfig = configs.find(c => c.id === req.entrenamiento_requerido_id)\n           const reqName = reqConfig ? reqConfig.nombre : req.entrenamiento_requerido_id\n           missing.push(`${reqName} (Nvl ${req.nivel_requerido})`)\n        }\n      }\n    }\n\n    return {\n      met: missing.length === 0,\n      texts: missing\n    }\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 p-4\">\n      {configs.map(config => {\n        const level = getLevel(config.id)\n        const reqStatus = checkRequirements(config.id)\n        const queueItem = activeQueueItem && activeQueueItem.entrenamiento_id === config.id ? activeQueueItem : undefined\n        \n        return (\n          <TechCard\n            key={config.id}\n            config={config}\n            level={level}\n            queueItem={queueItem}\n            resources={resources}\n            requirementsMet={reqStatus.met}\n            requirementsText={reqStatus.texts}\n            propertyId={propertyId}\n            queueFull={!!activeQueueItem && activeQueueItem.entrenamiento_id !== config.id}\n          />\n        )\n      })}\n    </div>\n  )\n}\n"
                }
              ]
            },
            {
              "name": "training",
              "type": "directory",
              "children": [
                {
                  "name": "training-card.tsx",
                  "type": "file",
                  "content": "\n'use client';\n\nimport Image from \"next/image\";\nimport { Button } from \"@/components/ui/button\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { Coins, Shell, Droplets } from \"lucide-react\";\nimport { Training, trainingData } from \"@/lib/data/training-data\";\n\ntype TrainingCardProps = {\n  training: Training;\n};\n\nconst ResourceIcon = ({ type }: { type: string }) => {\n    switch (type) {\n        case 'Armas': return <Shell className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Municion': return <Coins className=\"w-4 h-4 inline-block ml-1\" />;\n        case 'Dolares': return <p className=\"text-lg font-bold text-green-600 inline-block ml-1\">$</p>;\n        default: return null;\n    }\n}\n\nexport function TrainingCard({ training }: TrainingCardProps) {\n  const image = PlaceHolderImages.find((p) => p.id === training.image);\n\n  return (\n    <div className=\"bg-stone-300/60 text-black p-4 rounded-md border border-primary/50 flex flex-col md:flex-row gap-4 items-start w-full\">\n      <div className=\"flex-shrink-0 w-24\">\n        {image && (\n            <Image\n                src={image.imageUrl}\n                alt={image.description}\n                width={100}\n                height={100}\n                className=\"rounded w-full h-auto object-cover\"\n                data-ai-hint={image.imageHint}\n            />\n        )}\n      </div>\n      <div className=\"flex-1\">\n        <h3 className=\"font-bold text-lg text-primary\">{training.name}</h3>\n        <p className=\"text-sm my-2\">{training.description}</p>\n        <div className=\"flex items-center flex-wrap gap-x-4 gap-y-1 text-sm\">\n          {Object.entries(training.costs).map(([resource, value]) => (\n            <div key={resource} className=\"flex items-center\">\n              <span>{resource.charAt(0)}: {value.toLocaleString()}</span>\n              <ResourceIcon type={resource} />\n            </div>\n          ))}\n           <span>Duración: {training.duration}</span>\n        </div>\n      </div>\n      <div className=\"flex flex-col items-center justify-center h-full ml-auto text-center\">\n        <Button variant=\"link\" className=\"text-green-600 h-auto p-0 flex flex-col items-center\">\n            <span className=\"text-lg\">Inizia</span>\n            <span>espansione</span>\n        </Button>\n      </div>\n    </div>\n  );\n}\n"
                }
              ]
            },
            {
              "name": "training.tsx",
              "type": "file",
              "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { useGameState } from '@/components/providers/game-state-provider';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function Training() {\n  const { gameState } = useGameState();\n\n  if (!gameState) {\n    return <Skeleton className=\"h-[100px] w-full\" />;\n  }\n\n  // Active research queues\n  const activeResearch = gameState.colas.investigacion;\n  // Completed research count\n  const completedResearchCount = gameState.investigaciones ? gameState.investigaciones.length : 0;\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4 flex-row items-center justify-between\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Capacitación</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4 text-center\">\n        {activeResearch && activeResearch.length > 0 ? (\n           <div className=\"space-y-2\">\n             {activeResearch.map(queue => (\n               <div key={queue.id} className=\"text-sm border-b border-black/10 pb-1 last:border-0\">\n                 <div className=\"font-semibold\">{queue.nombre}</div>\n                 <div className=\"text-xs text-muted-foreground\">Nivel {queue.nivel_destino}</div>\n                 {/* <div className=\"text-xs text-blue-700\">{formatTimeRemaining(queue.fecha_fin)}</div> */}\n               </div>\n             ))}\n           </div>\n        ) : (\n          <div className=\"space-y-1\">\n             <p className=\"text-sm text-muted-foreground\">-</p>\n             {completedResearchCount > 0 && (\n                 <p className=\"text-xs text-stone-600 mt-2\">{completedResearchCount} investigaciones completadas</p>\n             )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "troops-defense.tsx",
              "type": "file",
              "content": "import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\n\nexport function TroopsDefense() {\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4 flex-row items-center justify-between\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Tropas / Defensa</CardTitle>\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-primary-foreground\">\n          <span className=\"font-bold\">[-]</span>\n        </Button>\n      </CardHeader>\n      <CardContent className=\"p-4 text-center\">\n        <p className=\"text-sm\">-</p>\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "troops-in-training.tsx",
              "type": "file",
              "content": "import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\n\nexport function TroopsInTraining() {\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4 flex-row items-center justify-between\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Tropas en entrenamiento</CardTitle>\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-primary-foreground\">\n          <span className=\"font-bold\">[-]</span>\n        </Button>\n      </CardHeader>\n      <CardContent className=\"p-4 text-center\">\n        <p className=\"text-sm\">-</p>\n      </CardContent>\n    </Card>\n  );\n}\n"
            },
            {
              "name": "troops.tsx",
              "type": "file",
              "content": "'use client';\n\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport Link from 'next/link';\nimport { useGameState } from '@/components/providers/game-state-provider';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport function Troops() {\n  const { gameState } = useGameState();\n\n  if (!gameState) {\n    return <Skeleton className=\"h-[200px] w-full\" />;\n  }\n\n  const { tropas } = gameState;\n\n  return (\n    <Card className=\"border-primary bg-stone-200 text-black\">\n      <CardHeader className=\"bg-primary/80 py-2 px-4\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Tropas</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-4 space-y-2 text-center\">\n        <Link href=\"/dashboard/troops\" className=\"block hover:underline text-sm text-blue-800\">\n          Visión global de las tropas\n        </Link>\n        <Link href=\"/dashboard/missions\" className=\"block hover:underline text-sm text-blue-800\">\n          Visión global de las Misiones\n        </Link>\n\n        <div className=\"mt-4 text-left\">\n          {tropas && tropas.length > 0 ? (\n            <div className=\"space-y-1\">\n              {tropas.map(tropa => (\n                <div key={tropa.id} className=\"flex justify-between text-sm\">\n                  <span>{tropa.nombre}</span>\n                  <span className=\"font-bold\">{tropa.cantidad.toLocaleString()}</span>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-sm text-center text-muted-foreground\">Sin unidad</p>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n"
            }
          ]
        },
        {
          "name": "landing",
          "type": "directory",
          "children": [
            {
              "name": "game-preview.tsx",
              "type": "file",
              "content": "'use client'\nimport Image from \"next/image\";\nimport {\n    Card,\n    CardContent,\n    CardHeader,\n    CardTitle,\n} from \"@/components/ui/card\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\n\n\nconst previewImages = [\n    PlaceHolderImages.find(p => p.id === \"game-preview-1\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-2\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-3\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-4\"),\n    PlaceHolderImages.find(p => p.id === \"game-preview-5\"),\n].filter(Boolean) as (typeof PlaceHolderImages[0])[];\n\n\nexport function GamePreview() {\n    return (\n        <section>\n            <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Vista previa del juego</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4 text-center\">\n                    <p className=\"text-sm text-gray-300 mb-4\">Haz clic en las imágenes para ampliarlas y echar un vistazo al juego.</p>\n                    <div className=\"flex justify-center gap-2\">\n                        {previewImages.map((img, index) => (\n                             <Dialog key={index}>\n                                <DialogTrigger>\n                                     <Image\n                                        key={index}\n                                        src={img.imageUrl}\n                                        alt={`${img.description} ${index + 1}`}\n                                        width={120}\n                                        height={90}\n                                        className=\"border-2 border-gray-500 hover:border-accent cursor-pointer transition-all\"\n                                        data-ai-hint={img.imageHint}\n                                    />\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-4xl bg-card border-primary\">\n                                     <Image\n                                        src={img.imageUrl}\n                                        alt={`${img.description} ${index + 1}`}\n                                        width={800}\n                                        height={600}\n                                        className=\"w-full h-auto\"\n                                        data-ai-hint={img.imageHint}\n                                    />\n                                </DialogContent>\n                            </Dialog>\n                        ))}\n                    </div>\n                </CardContent>\n            </Card>\n        </section>\n    )\n}\n"
            },
            {
              "name": "landing-page.tsx",
              "type": "file",
              "content": "import Image from \"next/image\";\nimport Link from \"next/link\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { PlaceHolderImages } from \"@/lib/placeholder-images\";\nimport { GamePreview } from \"./game-preview\";\nimport { getPublicStats } from \"@/lib/actions/public-stats\";\nimport { LoginForm } from \"./login-form\";\nimport { TopPlayers } from \"./top-players\";\n\nexport async function LandingPage() {\n  const vendettaHeader = PlaceHolderImages.find(p => p.id === \"vendetta-header\");\n  const gangster = PlaceHolderImages.find(p => p.id === \"gangster-silhouette\");\n\n  // Fetch stats server-side\n  const stats = await getPublicStats();\n\n  return (\n    <div className=\"bg-black text-white min-h-screen\">\n      <div className=\"container mx-auto px-4 py-2\">\n        <header className=\"relative text-center py-4 border-b-4 border-primary\">\n          {vendettaHeader && (\n            <Image\n              src={vendettaHeader.imageUrl}\n              alt={vendettaHeader.description}\n              fill\n              style={{ objectFit: 'cover' }}\n              className=\"opacity-20\"\n              data-ai-hint={vendettaHeader.imageHint}\n              priority\n            />\n          )}\n          <div className=\"relative z-10\">\n            <h1 className=\"text-6xl md:text-8xl vendetta-font text-gray-200\">VENDETTA</h1>\n            <p className=\"text-xl md:text-2xl vendetta-font text-gray-300\">THE VAULT GATE</p>\n          </div>\n        </header>\n\n        <nav className=\"bg-primary text-primary-foreground flex justify-between items-center px-4 py-2 text-sm\">\n          <Link href=\"/signup\" className=\"hover:underline font-bold\">\n            ¡REGÍSTRATE GRATIS!\n          </Link>\n          <div className=\"flex gap-4\">\n            <span>Online: {stats.online}</span>\n            <span>Jugadores: {stats.registered}</span>\n          </div>\n        </nav>\n\n        <div className=\"bg-gray-800/50 flex justify-between items-center px-4 py-1 text-xs border-b border-border\">\n          <div className=\"flex gap-2\">\n            <button aria-label=\"Select language: Italian\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/it.svg\" width={20} height={15} alt=\"Italian Flag\" />\n            </button>\n            <button aria-label=\"Select language: English\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/gb.svg\" width={20} height={15} alt=\"British Flag\" />\n            </button>\n            <button aria-label=\"Select language: French\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/fr.svg\" width={20} height={15} alt=\"French Flag\" />\n            </button>\n            <button aria-label=\"Select language: German\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/de.svg\" width={20} height={15} alt=\"German Flag\" />\n            </button>\n            <button aria-label=\"Select language: Spanish\" className=\"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded-sm hover:opacity-80 transition-opacity\">\n              <Image src=\"https://flagcdn.com/es.svg\" width={20} height={15} alt=\"Spanish Flag\" />\n            </button>\n          </div>\n          <div className=\"text-gray-400\">\n             Server Time: {new Date().toLocaleTimeString()}\n          </div>\n        </div>\n\n        <main className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 py-4\">\n\n          {/* Left Column */}\n          <div className=\"space-y-4 lg:col-span-2\">\n\n            {/* Login Section */}\n            <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Login</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4\">\n                    <LoginForm />\n                </CardContent>\n                </Card>\n            </section>\n\n             {/* Game Preview Carousel */}\n             <GamePreview />\n\n             {/* Description / Register Call to Action */}\n             <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Regístrate</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4 text-center text-sm text-gray-300 space-y-4\">\n                    <p>¿Quieres ser el Capo de la Mafia más importante en la ciudad? ¿Qué esperas?</p>\n                    <p>Construye habitaciones para obtener más recursos junto con las más avanzadas tecnologías, tropas de ataque e incluso podrás obtener un ejército inmejorable con las tropas de defensa mejor desarrolladas, y así...</p>\n                    <p className=\"font-bold text-lg text-red-500\">¡Dominar la ciudad!</p>\n                    <p>Entrena a tus &quot;chicos&quot; para volverse más fuertes; vigila el mapa de la ciudad para comprobar aquellos aliados o enemigos que se encuentren cerca de tu zona; revisa la clasificación para conocer quienes son actualmente los mafiosos más poderosos y... ¡muchas cosas más!</p>\n                    <Link href=\"/signup\">\n                        <Button variant=\"destructive\" size=\"lg\" className=\"w-full bg-accent hover:bg-accent/90 mt-2\">\n                            REGÍSTRATE GRATIS EN EL SERVIDOR 1\n                        </Button>\n                    </Link>\n                </CardContent>\n                </Card>\n            </section>\n\n          </div>\n\n          {/* Right Column */}\n          <div className=\"space-y-4\">\n\n            {/* Top Players */}\n            <section>\n                <TopPlayers />\n            </section>\n\n            {/* Support */}\n            <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                    <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Supporto Tecnico / SOS</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-4 bg-card/80\">\n                    <div className=\"bg-black/50 p-4 rounded-sm\">\n                        <h3 className=\"text-lg font-bold text-yellow-500 flex items-center gap-2\"><AlertTriangle size={20}/> SYSTEM ALERT</h3>\n                        <ul className=\"text-sm mt-2 space-y-1 list-disc list-inside text-gray-300\">\n                            <li><span className=\"mr-2\">🇬🇧</span> Login issues? Account locked?</li>\n                            <li><span className=\"mr-2\">🇮🇹</span> Problemi di accesso? Account bloccato?</li>\n                            <li><span className=\"mr-2\">🇪🇸</span> ¿Problemas de conexión?</li>\n                        </ul>\n                        <Button variant=\"destructive\" className=\"mt-4 w-full bg-accent hover:bg-accent/90 text-xs\">APRI SEGNALAZIONE SOS</Button>\n                    </div>\n                    </CardContent>\n                </Card>\n            </section>\n\n             {/* Maintenance Notice */}\n             <section>\n                <Card className=\"bg-primary/20 border-primary\">\n                <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n                    <CardTitle className=\"text-lg text-primary-foreground\">Aviso Importante</CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4 text-xs text-gray-300 space-y-2\">\n                    <p className=\"font-bold\">MANTENIMIENTO PROGRAMADO:</p>\n                    <p>Cada Sábado ha sido designado como día oficial para el mantenimiento rutinario.</p>\n                </CardContent>\n                </Card>\n            </section>\n\n            {/* Banner */}\n            <section>\n                <Card className=\"bg-stone-200 border-stone-400 text-black p-4 flex flex-col items-center justify-center text-center\">\n                {gangster && (\n                    <Image src={gangster.imageUrl} alt={gangster.description} width={80} height={100} data-ai-hint={gangster.imageHint} className=\"mb-2\" />\n                )}\n                <h2 className=\"text-4xl font-bold vendetta-font text-black/80\">REGISTRATI</h2>\n                <h2 className=\"text-4xl font-bold vendetta-font text-black/80\">ORA</h2>\n                </Card>\n            </section>\n\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}\n"
            },
            {
              "name": "login-form.tsx",
              "type": "file",
              "content": "'use client';\n\nimport { useActionState } from 'react';\nimport { login } from '@/lib/actions/auth';\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport Link from 'next/link';\n\nexport function LoginForm() {\n  const [state, formAction, isPending] = useActionState(login, null);\n\n  return (\n    <div className=\"w-full\">\n      <form action={formAction} className=\"flex flex-col md:flex-row items-center gap-2\">\n        <Select defaultValue=\"server1\" name=\"server\">\n          <SelectTrigger className=\"w-full md:w-[150px] bg-input text-foreground\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"server1\">Server 1</SelectItem>\n          </SelectContent>\n        </Select>\n\n        <Input\n          name=\"email\"\n          placeholder=\"Email\"\n          className=\"bg-input text-foreground\"\n          required\n        />\n        <Input\n          type=\"password\"\n          name=\"password\"\n          placeholder=\"Password\"\n          className=\"bg-input text-foreground\"\n          required\n        />\n\n        <Button\n          type=\"submit\"\n          variant=\"destructive\"\n          className=\"w-full md:w-auto bg-accent hover:bg-accent/90\"\n          disabled={isPending}\n        >\n          {isPending ? 'Entrando...' : 'Entrar'}\n        </Button>\n      </form>\n\n      {state?.message && (\n        <p className=\"text-red-500 text-xs mt-2 text-center md:text-left\">{state.message}</p>\n      )}\n\n      <Link href=\"/forgot-password\" passHref>\n          <p className=\"text-xs text-right mt-2 hover:underline cursor-pointer text-gray-400\">¿Olvidaste tu password?</p>\n      </Link>\n    </div>\n  );\n}\n"
            },
            {
              "name": "top-players.tsx",
              "type": "file",
              "content": "import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\nimport { getTopPlayers } from \"@/lib/actions/public-stats\";\n\nexport async function TopPlayers() {\n  const players = await getTopPlayers(10);\n\n  return (\n    <Card className=\"bg-primary/20 border-primary\">\n      <CardHeader className=\"bg-primary py-2 px-4 rounded-t-sm\">\n        <CardTitle className=\"text-lg text-primary-foreground\">Mejores Jugadores</CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <Table>\n          <TableHeader>\n            <TableRow className=\"border-b border-primary/20 hover:bg-transparent\">\n              <TableHead className=\"text-gray-300 w-[50px]\">#</TableHead>\n              <TableHead className=\"text-gray-300\">Jugador</TableHead>\n              <TableHead className=\"text-right text-gray-300\">Puntos</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {players.length > 0 ? (\n              players.map((player, index) => (\n                <TableRow key={index} className=\"border-b border-primary/10 hover:bg-primary/10\">\n                  <TableCell className=\"font-medium text-gray-400\">\n                    {player.ranking_position || index + 1}\n                  </TableCell>\n                  <TableCell className=\"text-white\">{player.username}</TableCell>\n                  <TableCell className=\"text-right text-yellow-500 font-mono\">\n                    {Math.floor(player.total_points || 0).toLocaleString()}\n                  </TableCell>\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell colSpan={3} className=\"text-center text-gray-500 py-4\">\n                  Sin datos\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </CardContent>\n    </Card>\n  );\n}\n"
            }
          ]
        },
        {
          "name": "providers",
          "type": "directory",
          "children": [
            {
              "name": "game-state-provider.tsx",
              "type": "file",
              "content": "'use client';\n\nimport React, { createContext, useContext, ReactNode } from 'react';\nimport { DashboardData } from '@/types/game';\nimport { useGameRealtime } from '@/hooks/use-game-realtime';\n\ninterface GameStateContextType {\n  gameState: DashboardData | null;\n}\n\nconst GameStateContext = createContext<GameStateContextType | undefined>(undefined);\n\ninterface GameStateProviderProps {\n  initialData: DashboardData | null;\n  children: ReactNode;\n}\n\nexport function GameStateProvider({ initialData, children }: GameStateProviderProps) {\n  const gameState = useGameRealtime(initialData);\n\n  return (\n    <GameStateContext.Provider value={{ gameState }}>\n      {children}\n    </GameStateContext.Provider>\n  );\n}\n\nexport function useGameState() {\n  const context = useContext(GameStateContext);\n  if (context === undefined) {\n    throw new Error('useGameState must be used within a GameStateProvider');\n  }\n  return context;\n}\n"
            }
          ]
        },
        {
          "name": "reset-password",
          "type": "directory",
          "children": [
            {
              "name": "reset-password-form.tsx",
              "type": "file",
              "content": "'use client'\n\nimport { useActionState } from 'react'\nimport { useFormStatus } from 'react-dom'\nimport { resetPassword } from '@/lib/actions/auth'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useEffect } from 'react'\nimport { useToast } from '@/hooks/use-toast'\n\nconst initialState = {\n  message: '',\n  errors: undefined,\n}\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus()\n  return (\n    <Button type=\"submit\" className=\"w-full\" disabled={pending}>\n      {pending ? 'Restableciendo...' : 'Restablecer Contraseña'}\n    </Button>\n  )\n}\n\nexport function ResetPasswordForm() {\n  const [state, formAction] = useActionState(resetPassword, initialState)\n  const { toast } = useToast()\n\n  useEffect(() => {\n    if (state?.message) {\n      toast({\n        title: 'Error',\n        description: state.message,\n        variant: 'destructive',\n      })\n    }\n  }, [state, toast])\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-2xl\">Restablecer Contraseña</CardTitle>\n        <CardDescription>\n          Ingresa tu nueva contraseña a continuación.\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form action={formAction} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\">Nueva Contraseña</Label>\n            <Input id=\"password\" name=\"password\" type=\"password\" required />\n            {state?.errors?.password && (\n              <p className=\"text-sm text-destructive\">{state.errors.password[0]}</p>\n            )}\n          </div>\n          <SubmitButton />\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n"
            }
          ]
        },
        {
          "name": "ui",
          "type": "directory",
          "children": [
            {
              "name": "accordion.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n"
            },
            {
              "name": "alert-dialog.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n"
            },
            {
              "name": "alert.tsx",
              "type": "file",
              "content": "import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n"
            },
            {
              "name": "avatar.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n"
            },
            {
              "name": "badge.tsx",
              "type": "file",
              "content": "import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"
            },
            {
              "name": "button.tsx",
              "type": "file",
              "content": "import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"
            },
            {
              "name": "calendar.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker, type ChevronProps } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        button_previous: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 absolute left-1\"\n        ),\n        button_next: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 absolute right-1\"\n        ),\n        month_grid: \"w-full border-collapse space-y-1\",\n        weekdays: \"flex\",\n        weekday: \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        week: \"flex w-full mt-2\",\n        day: \"h-9 w-9 text-center text-sm p-0 relative focus-within:relative focus-within:z-20\",\n        day_button: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        range_start: \"day-range-start\",\n        range_end: \"day-range-end\",\n        selected: \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        today: \"bg-accent text-accent-foreground\",\n        outside: \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n        disabled: \"text-muted-foreground opacity-50\",\n        range_middle: \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        Chevron: ({ orientation, ...props }: ChevronProps) => {\n          const Icon = orientation === \"left\" ? ChevronLeft : ChevronRight\n          return <Icon className={cn(\"h-4 w-4\", props.className)} />\n        },\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }"
            },
            {
              "name": "card.tsx",
              "type": "file",
              "content": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"
            },
            {
              "name": "carousel.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n"
            },
            {
              "name": "chart.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n"
            },
            {
              "name": "checkbox.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n"
            },
            {
              "name": "client-select.tsx",
              "type": "file",
              "content": "'use client'\n\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n  } from \"@/components/ui/select\"\n  import { useEffect, useState } from \"react\"\n  \n  export function ClientSelect() {\n    const [isClient, setIsClient] = useState(false)\n  \n    useEffect(() => {\n      setIsClient(true)\n    }, [])\n  \n    return (\n        <>\n         {isClient && (\n            <Select defaultValue=\"34:13:129\">\n                <SelectTrigger className=\"w-auto h-6 text-xs bg-white border-stone-400 focus:ring-0\">\n                    <SelectValue/>\n                </SelectTrigger>\n                <SelectContent>\n                    <SelectItem value=\"34:13:129\">34:13:129</SelectItem>\n                </SelectContent>\n            </Select>\n         )}\n        </>\n    )\n  }\n  "
            },
            {
              "name": "collapsible.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n"
            },
            {
              "name": "dialog.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n"
            },
            {
              "name": "dropdown-menu.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n"
            },
            {
              "name": "form.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n"
            },
            {
              "name": "input.tsx",
              "type": "file",
              "content": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"
            },
            {
              "name": "label.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n"
            },
            {
              "name": "menubar.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n"
            },
            {
              "name": "popover.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n"
            },
            {
              "name": "progress.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n"
            },
            {
              "name": "radio-group.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n"
            },
            {
              "name": "scroll-area.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n"
            },
            {
              "name": "select.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n"
            },
            {
              "name": "separator.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n"
            },
            {
              "name": "sheet.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n"
            },
            {
              "name": "sidebar.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from \"@/components/ui/sheet\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(\n  (\n    {\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-stone-800 text-white p-0 [&>button]:top-2 [&>button]:right-2\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side=\"left\"\n          >\n            <SheetHeader className=\"p-2 text-center border-b-2 border-black/30\">\n                <SheetTitle className=\"text-white text-lg\">Menu</SheetTitle>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col overflow-hidden\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n        <div\n        ref={ref}\n        data-state={state}\n        className={cn(\"hidden md:flex flex-col bg-stone-800 text-white border-r-2 border-black/30 transition-all duration-300 ease-in-out\", state === 'expanded' ? \"w-64\" : \"w-0\", className)}\n        {...props}\n      >\n        <div className={cn(\"overflow-hidden\", state === 'expanded' ? \"w-64\" : \"w-0\")}>\n            {children}\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7 text-primary-foreground hover:bg-white/20 hover:text-primary-foreground\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col overflow-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-3 p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarProvider,\n  SidebarInset,\n  SidebarTrigger,\n  useSidebar,\n}\n"
            },
            {
              "name": "skeleton.tsx",
              "type": "file",
              "content": "import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n"
            },
            {
              "name": "slider.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n"
            },
            {
              "name": "switch.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n"
            },
            {
              "name": "table.tsx",
              "type": "file",
              "content": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n"
            },
            {
              "name": "tabs.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n"
            },
            {
              "name": "textarea.tsx",
              "type": "file",
              "content": "import * as React from 'react';\n\nimport {cn} from '@/lib/utils';\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, React.ComponentProps<'textarea'>>(\n  ({className, ...props}, ref) => {\n    return (\n      <textarea\n        className={cn(\n          'flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nTextarea.displayName = 'Textarea';\n\nexport {Textarea};\n"
            },
            {
              "name": "toast.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n"
            },
            {
              "name": "toaster.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n"
            },
            {
              "name": "tooltip.tsx",
              "type": "file",
              "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n"
            }
          ]
        }
      ]
    },
    {
      "name": "hooks",
      "type": "directory",
      "children": [
        {
          "name": "use-game-realtime.ts",
          "type": "file",
          "content": "import { useEffect, useState, useRef } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { DashboardData } from '@/types/game';\nimport { getDashboardDataAction } from '@/actions/game.actions';\n\nexport function useGameRealtime(initialData: DashboardData | null) {\n  const [data, setData] = useState<DashboardData | null>(initialData);\n  const supabase = createClient();\n\n  // Ref for client-side interpolation state\n  const lastUpdateRef = useRef<number>(Date.now());\n  const interpolationIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (!initialData?.propiedad.id) return;\n\n    const propertyId = initialData.propiedad.id;\n    const userId = initialData.propiedad.usuario_id;\n\n    // Helper to refresh full data on complex events\n    const refreshData = async () => {\n      const result = await getDashboardDataAction();\n      if (result.success && result.data) {\n        setData(result.data);\n        lastUpdateRef.current = Date.now();\n      }\n    };\n\n    // Subscription\n    const channel = supabase.channel('game-dashboard')\n      .on(\n        'postgres_changes',\n        {\n          event: 'UPDATE',\n          schema: 'public',\n          table: 'propiedad',\n          filter: `id=eq.${propertyId}`,\n        },\n        (payload) => {\n          // Optimistic/Partial update for property resources\n          setData((prev) => {\n            if (!prev) return null;\n            return {\n              ...prev,\n              propiedad: { ...prev.propiedad, ...payload.new as any },\n              recursos: {\n                ...prev.recursos,\n                armas: { ...prev.recursos.armas, val: payload.new.armas },\n                municion: { ...prev.recursos.municion, val: payload.new.municion },\n                alcohol: { ...prev.recursos.alcohol, val: payload.new.alcohol },\n                dolares: { ...prev.recursos.dolares, val: payload.new.dolares },\n              }\n            };\n          });\n          lastUpdateRef.current = Date.now();\n        }\n      )\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'cola_construccion', filter: `propiedad_id=eq.${propertyId}` },\n        () => refreshData()\n      )\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'habitacion_usuario', filter: `propiedad_id=eq.${propertyId}` },\n        () => refreshData()\n      )\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'cola_reclutamiento', filter: `propiedad_id=eq.${propertyId}` },\n        () => refreshData()\n      )\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'tropa_propiedad', filter: `propiedad_id=eq.${propertyId}` },\n        () => refreshData()\n      );\n\n    if (userId) {\n      channel\n        .on(\n          'postgres_changes',\n          { event: '*', schema: 'public', table: 'ataque_entrante', filter: `defensor_id=eq.${userId}` },\n          () => refreshData()\n        )\n        .on(\n          'postgres_changes',\n          { event: '*', schema: 'public', table: 'cola_misiones', filter: `usuario_id=eq.${userId}` },\n          () => refreshData()\n        );\n    }\n\n    channel.subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [initialData?.propiedad.id, initialData?.propiedad.usuario_id, supabase]);\n\n  // Interpolation effect\n  useEffect(() => {\n    if (!data) return;\n\n    interpolationIntervalRef.current = setInterval(() => {\n      const now = Date.now();\n      const elapsedSeconds = (now - lastUpdateRef.current) / 1000;\n\n      // Don't interpolate if elapsed time is negligible or too large (tab inactive)\n      if (elapsedSeconds < 0.1 || elapsedSeconds > 5) return;\n\n      setData((prev) => {\n        if (!prev) return null;\n\n        const interpolate = (current: number, max: number, prodPerHour: number) => {\n          const prodPerSec = prodPerHour / 3600;\n          const added = prodPerSec * elapsedSeconds;\n          return Math.min(max, current + added);\n        };\n\n        return {\n          ...prev,\n          recursos: {\n            ...prev.recursos,\n            armas: { ...prev.recursos.armas, val: interpolate(prev.recursos.armas.val, prev.recursos.armas.max, prev.recursos.armas.prod) },\n            municion: { ...prev.recursos.municion, val: interpolate(prev.recursos.municion.val, prev.recursos.municion.max, prev.recursos.municion.prod) },\n            alcohol: { ...prev.recursos.alcohol, val: interpolate(prev.recursos.alcohol.val, prev.recursos.alcohol.max, prev.recursos.alcohol.prod) },\n            dolares: { ...prev.recursos.dolares, val: interpolate(prev.recursos.dolares.val, prev.recursos.dolares.max, prev.recursos.dolares.prod) },\n          }\n        };\n      });\n\n      lastUpdateRef.current = now;\n    }, 1000); // Update every second\n\n    return () => {\n      if (interpolationIntervalRef.current) {\n        clearInterval(interpolationIntervalRef.current);\n      }\n    };\n  }, [data?.recursos.armas.prod]); // Re-run if production rates change (e.g. after refreshData)\n\n  return data;\n}\n"
        },
        {
          "name": "use-mobile.tsx",
          "type": "file",
          "content": "import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n"
        },
        {
          "name": "use-toast.ts",
          "type": "file",
          "content": "\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n"
        }
      ]
    },
    {
      "name": "lib",
      "type": "directory",
      "children": [
        {
          "name": "actions",
          "type": "directory",
          "children": [
            {
              "name": "auth.ts",
              "type": "file",
              "content": "'use server'\n\nimport { createClient } from '@/lib/supabase/server'\nimport { headers } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { z } from 'zod'\n\nconst loginSchema = z.object({\n  email: z.string().email({ message: 'Correo electrónico inválido' }),\n  password: z.string().min(6, { message: 'La contraseña debe tener al menos 6 caracteres' }),\n})\n\nexport async function login(prevState: any, formData: FormData) {\n  const supabase = createClient()\n  const validatedFields = loginSchema.safeParse(Object.fromEntries(formData.entries()))\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: 'Por favor, corrige los errores en el formulario.',\n    }\n  }\n  \n  const { email, password } = validatedFields.data\n\n  const { error } = await supabase.auth.signInWithPassword({\n    email,\n    password,\n  })\n\n  if (error) {\n    return {\n        message: 'Credenciales inválidas. Por favor, inténtalo de nuevo.',\n    }\n  }\n\n  return redirect('/dashboard')\n}\n\nconst signupSchema = z.object({\n  email: z.string().email({ message: 'Correo electrónico inválido' }),\n  password: z.string().min(6, { message: 'La contraseña debe tener al menos 6 caracteres' }),\n})\n\nexport async function signup(prevState: any, formData: FormData) {\n  const origin = (await headers()).get('origin')\n  const supabase = createClient()\n  const validatedFields = signupSchema.safeParse(Object.fromEntries(formData.entries()))\n  \n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: 'Por favor, corrige los errores en el formulario.',\n    }\n  }\n  \n  const { email, password } = validatedFields.data\n\n  const { error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${origin}/auth/callback`,\n    },\n  })\n\n  if (error) {\n    if (error.message.includes('User already registered')) {\n        return { message: 'Este correo electrónico ya está registrado.'}\n    }\n    return { message: 'No se pudo crear la cuenta. Por favor, inténtalo de nuevo.' }\n  }\n\n  return { message: '¡Revisa tu correo electrónico para verificar tu cuenta!' }\n}\n\nconst forgotPasswordSchema = z.object({\n    email: z.string().email({ message: 'Correo electrónico inválido' }),\n})\n\nexport async function forgotPassword(prevState: any, formData: FormData) {\n    const origin = (await headers()).get('origin')\n    const supabase = createClient()\n    const validatedFields = forgotPasswordSchema.safeParse(Object.fromEntries(formData.entries()))\n\n    if (!validatedFields.success) {\n        return {\n            errors: validatedFields.error.flatten().fieldErrors,\n            message: 'Por favor, corrige los errores en el formulario.',\n        }\n    }\n\n    const { email } = validatedFields.data\n\n    const { error } = await supabase.auth.resetPasswordForEmail(email, {\n        redirectTo: `${origin}/reset-password`,\n    })\n\n    if (error) {\n        return { message: 'No se pudo enviar el correo de restablecimiento. Por favor, inténtalo de nuevo.' }\n    }\n\n    return { message: 'Si existe una cuenta con este correo, recibirás un enlace para restablecer tu contraseña.' }\n}\n\nconst resetPasswordSchema = z.object({\n    password: z.string().min(6, { message: 'La contraseña debe tener al menos 6 caracteres' }),\n});\n\nexport async function resetPassword(prevState: any, formData: FormData) {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) {\n        return { message: 'No estás autenticado o la sesión ha expirado.' };\n    }\n\n    const validatedFields = resetPasswordSchema.safeParse(Object.fromEntries(formData.entries()));\n\n    if (!validatedFields.success) {\n        return {\n            errors: validatedFields.error.flatten().fieldErrors,\n            message: 'Por favor, corrige los errores en el formulario.',\n        }\n    }\n    const { password } = validatedFields.data;\n    \n    const { error } = await supabase.auth.updateUser({ password });\n\n    if (error) {\n        return { message: 'No se pudo restablecer la contraseña. El enlace puede haber expirado.' };\n    }\n\n    redirect('/dashboard');\n}\n\nexport async function socialLogin(provider: 'google' | 'github') {\n  const origin = (await headers()).get('origin')\n  const supabase = createClient()\n  const { data, error } = await supabase.auth.signInWithOAuth({\n    provider,\n    options: {\n      redirectTo: `${origin}/auth/callback`,\n    },\n  })\n\n  if (error) {\n    // This will be caught by the nearest error boundary\n    return redirect(`/login?message=No se pudo iniciar sesión con ${provider}.`)\n  }\n  \n  return redirect(data.url)\n}\n\nexport async function signOut() {\n  const supabase = createClient()\n  await supabase.auth.signOut()\n  redirect('/login')\n}\n"
            },
            {
              "name": "buildings.ts",
              "type": "file",
              "content": "'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { createClient } from '@/lib/supabase/server';\nimport { z } from 'zod';\n\nconst EnqueueSchema = z.object({\n  baseId: z.string().uuid(),\n  buildingId: z.string().min(1),\n});\n\nconst CancelSchema = z.object({\n  queueId: z.string().uuid(),\n});\n\nexport async function enqueueBuildingUpgrade(baseId: string, buildingId: string) {\n  const supabase = await createClient(); // Await createClient in Next.js 15\n\n  const validated = EnqueueSchema.safeParse({ baseId, buildingId });\n  if (!validated.success) {\n    return { error: 'Invalid input' };\n  }\n\n  const { error, data } = await supabase.rpc('enqueue_building_upgrade', {\n    p_base_id: baseId,\n    p_building_id: buildingId,\n  });\n\n  if (error) {\n    console.error('RPC Error:', error);\n    return { error: 'Database error occurred' };\n  }\n\n  // RPC returns { error: '...' } or { success: true }\n  // We need to check the JSON result\n  if (data && typeof data === 'object' && 'error' in data) {\n    return { error: (data as any).error };\n  }\n\n  revalidatePath('/dashboard/buildings');\n  return { success: true };\n}\n\nexport async function cancelBuildingUpgrade(queueId: string) {\n  const supabase = await createClient();\n\n  const validated = CancelSchema.safeParse({ queueId });\n  if (!validated.success) {\n    return { error: 'Invalid input' };\n  }\n\n  const { error, data } = await supabase.rpc('cancel_building_upgrade', {\n    p_queue_id: queueId,\n  });\n\n  if (error) {\n    console.error('RPC Error:', error);\n    return { error: 'Database error occurred' };\n  }\n\n  if (data && typeof data === 'object' && 'error' in data) {\n    return { error: (data as any).error };\n  }\n\n  revalidatePath('/dashboard/buildings');\n  return { success: true };\n}\n\nexport async function getBuildingProductionProjection(baseId: string, buildingId: string) {\n    const supabase = await createClient();\n\n    const { data, error } = await supabase.rpc('get_building_production_projection', {\n        p_base_id: baseId,\n        p_building_id: buildingId,\n        p_limit: 10\n    });\n\n    if (error) {\n        console.error('RPC Error:', error);\n        return [];\n    }\n\n    return data;\n}\n"
            },
            {
              "name": "construccion.ts",
              "type": "file",
              "content": "'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { createClient } from '@/lib/supabase/server';\nimport { IniciarConstruccionSchema } from '@/types/game';\nimport { sanitizeDatabaseError } from '@/lib/utils/db-error';\n\nexport async function iniciarConstruccionHabitacion(\n  propiedad_id: string,\n  habitacion_id: string\n) {\n  const supabase = createClient();\n\n  // 1. Validar las entradas\n  const validatedFields = IniciarConstruccionSchema.safeParse({\n    propiedad_id,\n    habitacion_id,\n  });\n\n  if (!validatedFields.success) {\n    return {\n      error: 'Campos inválidos.',\n    };\n  }\n\n  const { data: parsedData } = validatedFields;\n\n  try {\n    // 2. Llamar a la función RPC de la base de datos\n    const { data, error } = await supabase.rpc('iniciar_construccion_habitacion', {\n      p_propiedad_id: parsedData.propiedad_id,\n      p_habitacion_id: parsedData.habitacion_id,\n    });\n\n    if (error) {\n      console.error('Error al iniciar construcción:', error);\n      // El error de la base de datos puede contener información sensible,\n      // devolvemos un mensaje genérico o uno específico si es seguro.\n      return {\n        error: sanitizeDatabaseError(error),\n      };\n    }\n\n    // El RPC puede devolver un JSON con un campo de error específico\n    if (data && typeof data === 'object' && 'error' in data) {\n        return {\n            error: data.error,\n        };\n    }\n\n    // 3. Devolver una respuesta exitosa\n    revalidatePath('/dashboard/rooms');\n    return {\n      success: true,\n      data,\n    };\n  } catch (e) {\n    console.error('Excepción al llamar a RPC:', e);\n    return {\n      error: 'Ocurrió un error inesperado en el servidor.',\n    };\n  }\n}\n"
            },
            {
              "name": "public-stats.ts",
              "type": "file",
              "content": "'use server';\n\nimport { createClient } from '@/lib/supabase/server';\nimport { unstable_cache } from 'next/cache';\n\nexport async function getPublicStats() {\n  const supabase = await createClient();\n\n  // Registered Count\n  const { count: registeredCount, error: countError } = await supabase\n    .from('profiles')\n    .select('*', { count: 'exact', head: true });\n\n  if (countError) {\n    console.error('Error fetching registered count:', countError);\n  }\n\n  // Online Count (Active in last 10 minutes)\n  const tenMinutesAgo = new Date(Date.now() - 10 * 60 * 1000).toISOString();\n  const { count: onlineCount, error: onlineError } = await supabase\n    .from('profiles')\n    .select('*', { count: 'exact', head: true })\n    .gt('last_active_at', tenMinutesAgo);\n\n  if (onlineError) {\n    console.error('Error fetching online count:', onlineError);\n  }\n\n  return {\n    registered: registeredCount || 0,\n    online: onlineCount || 0,\n  };\n}\n\nexport async function getTopPlayers(limit = 5) {\n  const supabase = await createClient();\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('username, total_points, ranking_position')\n    .order('ranking_position', { ascending: true }) // Assuming 1 is top\n    .limit(limit);\n\n  if (error) {\n    console.error('Error fetching top players:', error);\n    return [];\n  }\n\n  return data;\n}\n"
            },
            {
              "name": "recruitment.actions.ts",
              "type": "file",
              "content": "'use server';\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport { revalidatePath } from \"next/cache\";\nimport { getUserProperty } from \"@/lib/services/game.service\";\nimport { sanitizeDatabaseError } from \"@/lib/utils/db-error\";\n\nexport async function recruitTroopsAction(troopId: string, quantity: number) {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    return { success: false, error: 'Usuario no autenticado' };\n  }\n\n  if (quantity <= 0) {\n    return { success: false, error: 'La cantidad debe ser mayor a 0' };\n  }\n\n  const propertyId = await getUserProperty(user.id);\n  if (!propertyId) {\n    return { success: false, error: 'Propiedad no encontrada' };\n  }\n\n  const { error } = await supabase.rpc('iniciar_reclutamiento', {\n    p_propiedad_id: propertyId,\n    p_tropa_id: troopId,\n    p_cantidad: quantity,\n  });\n\n  if (error) {\n    console.error('Error reclutando tropas:', error);\n    // Supabase RPC errors are often formatted as \"Error: message\"\n    // We try to extract the message if it's a known format or return the raw message\n    return { success: false, error: sanitizeDatabaseError(error) };\n  }\n\n  revalidatePath('/dashboard/recruitment');\n  return { success: true };\n}\n"
            },
            {
              "name": "research.actions.ts",
              "type": "file",
              "content": "'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { startResearch } from '@/lib/services/game.service'\n\nexport async function startResearchAction(propertyId: string, researchId: string) {\n  try {\n    const result = await startResearch(propertyId, researchId)\n    \n    if (result.success) {\n      revalidatePath('/dashboard/tech-tree')\n      return { success: true }\n    } else {\n      return { success: false, error: result.error || 'Failed to start research' }\n    }\n  } catch (error) {\n    console.error('Error starting research:', error)\n    return { success: false, error: 'Internal server error' }\n  }\n}\n"
            }
          ]
        },
        {
          "name": "constants.ts",
          "type": "file",
          "content": "export const MAX_CONSTRUCTION_QUEUE_SIZE = 5;\n"
        },
        {
          "name": "data",
          "type": "directory",
          "children": [
            {
              "name": "overview-data.ts",
              "type": "file",
              "content": "export const overviewData = {\n    playerName: \"niyose2\",\n    mainBuilding: {\n      name: \"Edificio\",\n      value: \"34:13:129\",\n    },\n    resources: [\n      { name: \"Armas\", value: \"7.513\", max: \"10.000\", highlight: false },\n      { name: \"Municion\", value: \"6.011\", max: \"10.000\", highlight: false },\n      { name: \"Dolares\", value: \"8.975\", max: \"10.000\", highlight: false },\n      { name: \"Alcohol\", value: \"10.000\", max: \"10.000\", highlight: true },\n    ],\n    levels: [\n      { name: \"Oficina del Jefe\", level: 2 },\n      { name: \"Escuela de especialización\", level: 1 },\n      { name: \"Armería\", level: 0 },\n      { name: \"Almacén de munición\", level: 1 },\n      { name: \"Cervecería\", level: 1 },\n      { name: \"Taberna\", level: 0 },\n      { name: \"Contrabando\", level: 0 },\n      { name: \"Almacén de armas\", level: 0 },\n      { name: \"Depósito de munición\", level: 0 },\n      { name: \"Almacén de alcohol\", level: 0 },\n      { name: \"Caja fuerte\", level: 0 },\n      { name: \"Campo de entrenamiento\", level: 1 },\n      { name: \"Seguridad\", level: 0 },\n      { name: \"Torreta de fuego automático\", level: 0 },\n      { name: \"Minas ocultas\", level: 0 },\n    ],\n    points: 108,\n  };\n  "
            },
            {
              "name": "poderataque-data.ts",
              "type": "file",
              "content": "export const attackPowerData = {\n    honorLevels: [0, 1, 2, 3, 4, 5, 6, 7, 8],\n    buildingLevels: [\n        { level: 5, values: [99, 99, 99, 99, 99, 99, 99, 99, 99] },\n        { level: 10, values: [99, 99, 99, 99, 99, 99, 99, 99, 99] },\n        { level: 15, values: [98, 98, 99, 99, 99, 99, 99, 99, 99] },\n        { level: 20, values: [94, 95, 96, 97, 98, 98, 99, 99, 99] },\n        { level: 25, values: [86, 89, 92, 94, 95, 96, 97, 98, 98] },\n        { level: 30, values: [72, 78, 83, 87, 90, 93, 95, 96, 97] },\n        { level: 35, values: [56, 64, 72, 78, 84, 88, 91, 93, 95] },\n        { level: 40, values: [40, 49, 59, 67, 74, 81, 86, 89, 92] },\n        { level: 45, values: [28, 36, 46, 55, 64, 72, 79, 85, 89] },\n        { level: 50, values: [19, 26, 35, 44, 54, 63, 71, 79, 84] },\n        { level: 55, values: [13, 19, 26, 34, 44, 54, 63, 72, 79] },\n        { level: 60, values: [9, 13, 19, 26, 35, 45, 55, 65, 73] },\n        { level: 65, values: [6, 10, 14, 20, 28, 37, 47, 57, 67] },\n        { level: 70, values: [5, 7, 11, 15, 22, 30, 40, 50, 61] },\n        { level: 75, values: [3, 5, 8, 12, 17, 25, 33, 44, 54] },\n        { level: 80, values: [2, 4, 6, 9, 14, 20, 28, 38, 48] },\n        { level: 85, values: [2, 3, 5, 7, 11, 16, 23, 32, 43] },\n        { level: 90, values: [1, 2, 3, 6, 9, 13, 19, 28, 37] },\n        { level: 95, values: [1, 2, 3, 4, 7, 11, 16, 24, 33] },\n        { level: 100, values: [1, 1, 2, 3, 6, 9, 14, 20, 29] },\n    ]\n};\n"
            },
            {
              "name": "recruitment-data.ts",
              "type": "file",
              "content": "export type Troop = {\n    id: string;\n    name: string;\n    description: string;\n    image: string;\n    stats: {\n        attack: number;\n        defense: number;\n        speed: number;\n        capacity: number;\n    };\n    costs: {\n        Armas?: number;\n        Municion?: number;\n        Alcohol?: number;\n        Dolares?: number;\n    };\n    duration: string;\n};\n\nexport const recruitmentData: Troop[] = [\n    {\n        id: \"porteador\",\n        name: \"Porteador\",\n        description: \"Los porteadores son meras unidades civiles, que simplemente llevan cosas de aquí para allá. Por lo cual sólo los deberías utilizar como unidad de transporte y no como unidades de combate.\",\n        image: \"troop-porteador\",\n        stats: { attack: 0, defense: 0, speed: 10, capacity: 1000 },\n        costs: { Armas: 300, Municion: 100, Dolares: 1000 },\n        duration: \"01:00:00\",\n    },\n    {\n        id: \"maton\",\n        name: \"Matón\",\n        description: \"Los Matones son unidades de combate simple, no dejarán escapar la oportunidad de atacar a cualquier unidad enemiga que detecte. En cantidades grandes incluso pueden ser muy peligrosos.\",\n        image: \"troop-maton\",\n        stats: { attack: 10, defense: 5, speed: 10, capacity: 50 },\n        costs: { Armas: 200, Municion: 1000 },\n        duration: \"00:23:20\",\n    },\n    {\n        id: \"asesino\",\n        name: \"Asesino\",\n        description: \"El Asesino es una unidad especializada en el sigilo y la eliminación de objetivos clave. Alto ataque, pero baja defensa.\",\n        image: \"troop-assassin\",\n        stats: { attack: 30, defense: 10, speed: 15, capacity: 20 },\n        costs: { Armas: 150, Municion: 100, Dolares: 50 },\n        duration: \"00:05:00\",\n    },\n    {\n        id: \"gorila\",\n        name: \"Gorila\",\n        description: \"El Gorila es la unidad de defensa principal. Con una gran cantidad de puntos de vida y defensa, son perfectos para proteger tu territorio.\",\n        image: \"troop-enforcer\",\n        stats: { attack: 5, defense: 40, speed: 5, capacity: 10 },\n        costs: { Armas: 80, Municion: 200, Alcohol: 10 },\n        duration: \"00:08:20\",\n    },\n    {\n        id: \"consigliere\",\n        name: \"Consigliere\",\n        description: \"El Consigliere no es un luchador, pero reduce el costo de reclutamiento y construcción. Una unidad de apoyo invaluable.\",\n        image: \"troop-consigliere\",\n        stats: { attack: 0, defense: 5, speed: 8, capacity: 5 },\n        costs: { Dolares: 1000, Alcohol: 50 },\n        duration: \"00:15:00\",\n    },\n];\n\nexport const recruitmentQueue = [\n    { name: \"Porteador\", quantity: 1, duration: \"00:59:59\" }\n]\n"
            },
            {
              "name": "resources-data.ts",
              "type": "file",
              "content": "export const totalProductionData = [\n    { resource: 'Armas', hour: 10, day: 240 },\n    { resource: 'Municion', hour: 20, day: 480 },\n    { resource: 'Alcohol', hour: 60, day: 1440 },\n    { resource: 'Dolares', hour: 0, day: 0 },\n];\n  \nexport const buildingProductionData = {\n    baseSalary: { armas: 10, municion: 10, alcohol: 10, dolares: 0 },\n    buildings: [\n        { name: 'Almacén de munición', level: 1, production: { armas: 0, municion: 10, alcohol: 0, dolares: 0 } },\n        { name: 'Cervecería', level: 1, production: { armas: 0, municion: 0, alcohol: 50, dolares: 0 } },\n    ],\n    storage: {\n        capacity: { armas: 10000, municion: 10000, alcohol: 10000, dolares: 10000 },\n        safe: { armas: 1000, municion: 1000, alcohol: 1000, dolares: 1000 },\n    }\n};"
            },
            {
              "name": "rooms-data.ts",
              "type": "file",
              "content": "export type Room = {\n    id: string;\n    name: string;\n    level?: number;\n    description: string;\n    image: string;\n    costs: {\n        Armas?: number;\n        Municion?: number;\n        Dolares?: number;\n    };\n    duration: string;\n    status: 'upgrade' | 'expand';\n    upgradeLevel?: number;\n};\n  \n\nexport const roomsData: Room[] = [\n    {\n        id: \"oficina_del_jefe\",\n        name: \"Oficina del Jefe\",\n        level: 2,\n        description: \"El Jefe se encuentra en esta oficina, y aquí, se toman todas las decisiones. Coordina el desarrollo y la velocidad de construcción de las otras áreas. Cuando más nivel, más rápido se desarrollan el resto.\",\n        image: \"room-office\",\n        costs: { Armas: 900, Municion: 1800 },\n        duration: \"00:22:30\",\n        status: 'upgrade',\n        upgradeLevel: 3,\n    },\n    {\n        id: \"escuela_especializacion\",\n        name: \"Escuela de especialización\",\n        description: \"Como ya dice el nombre, esta habitación permite el entrenamiento de \\\"los chicos\\\" en nuevas ténicas, permitiéndoles tener más experiencia en combate. Al igual que para la oficina de El Jefe, cuánto más rápido se haga el entrenamiento, más rápido se desarrollan las habilidades.\",\n        image: \"room-specialization\",\n        costs: { Armas: 1000, Municion: 1000, Dolares: 25 },\n        duration: \"00:05:33\",\n        status: 'expand',\n    },\n    {\n        id: \"armeria\",\n        name: \"Armería\",\n        description: \"Aquí, en la Armería, como dice el nombre, se guardan armas. Serán de gran necesidad para ocupar nuevos lugares, y para entrenamientos en combate. Cuanto mejor desarrollada esté, más armas podrás hacer al mismo tiempo.\",\n        image: \"room-armory\",\n        costs: { Armas: 12, Municion: 60 },\n        duration: \"00:01:23\",\n        status: 'expand',\n    },\n    {\n        id: \"almacen_de_municion\",\n        name: \"Almacén de munición\",\n        level: 1,\n        description: \"El almacén de munición es similar a la armería. Aquí, se manufactura la munición importante. Es necesaria, en grandes cantidades, al ocupar áreas, así como para su uso en entrenamientos. A diferencia de las armas, la munición se usa mucho más rápido.\",\n        image: \"room-ammo\",\n        costs: { Armas: 36, Municion: 60 },\n        duration: \"00:06:40\",\n        status: 'upgrade',\n        upgradeLevel: 2,\n    },\n    {\n        id: \"cerveceria\",\n        name: \"Cervecería\",\n        description: \"Esta habitación manufactura alcohol. Desgraciadamente (¿o afortunadamente?) está prohibido y por tanto, muy demandado por la población, así que es un negocio próspero. Sin embargo, necesitarás ciertas estrategias para poder llevarlo hasta los ciudadanos.\",\n        image: \"room-brewery\",\n        costs: { Armas: 20, Municion: 20 },\n        duration: \"00:02:47\",\n        status: 'expand',\n    },\n    {\n        id: \"campo_de_entrenamiento\",\n        name: \"Campo de entrenamiento\",\n        description: \"Tal y como dice el nombre, en el campo de entrenamiento, tus \\\"chicos\\\" entrenarán. El mismo, dependerá según el tipo de unidades que puedas producir, por ejemplo, simples delincuentes, asesinos, profesionales, a los que tus enemigos tendrán un respeto extremo. Dependiendo del nivel, las unidades serán creadas en menor tiempo.\",\n        image: \"room-training\",\n        costs: { Armas: 1000, Municion: 2500 },\n        duration: \"00:15:33\",\n        status: 'expand',\n    },\n];\n"
            },
            {
              "name": "tech-tree-data.ts",
              "type": "file",
              "content": "\n\nexport type Requirement = {\n    name: string;\n    level: number;\n};\n  \nexport type TechItem = {\n    id: string;\n    name: string;\n    image: string;\n    available: boolean;\n    requirements: Requirement[];\n};\n  \nexport const roomsTechData: TechItem[] = [\n    {\n        id: \"oficina-jefe\",\n        name: \"Oficina del Jefe\",\n        image: \"room-office\",\n        available: true,\n        requirements: [],\n    },\n    {\n        id: \"escuela-especializacion\",\n        name: \"Escuela de especialización\",\n        image: \"room-specialization\",\n        available: true,\n        requirements: [],\n    },\n    {\n        id: \"armeria\",\n        name: \"Armería\",\n        image: \"room-armory\",\n        available: true,\n        requirements: [],\n    },\n    {\n        id: \"almacen-municion\",\n        name: \"Almacén de munición\",\n        image: \"room-ammo\",\n        available: true,\n        requirements: [],\n    },\n    {\n        id: \"cerveceria\",\n        name: \"Cervecería\",\n        image: \"room-brewery\",\n        available: true,\n        requirements: [],\n    },\n    {\n        id: \"taberna\",\n        name: \"Taberna\",\n        image: \"room-tavern\",\n        available: false,\n        requirements: [{ name: \"Cervecería\", level: 1 }],\n    },\n    {\n        id: \"contrabando\",\n        name: \"Contrabando\",\n        image: \"room-contraband\",\n        available: false,\n        requirements: [\n            { name: \"Oficina del Jefe\", level: 5 },\n            { name: \"Cervecería\", level: 8 }\n        ],\n    },\n    {\n        id: \"almacen-armas\",\n        name: \"Almacén de armas\",\n        image: \"room-armory\",\n        available: false,\n        requirements: [{ name: \"Armería\", level: 5 }],\n    },\n    {\n        id: \"deposito-municion\",\n        name: \"Depósito de munición\",\n        image: \"room-ammo\",\n        available: false,\n        requirements: [{ name: \"Almacén de munición\", level: 5 }],\n    },\n    {\n        id: \"almacen-alcohol\",\n        name: \"Almacén de alcohol\",\n        image: \"room-brewery\",\n        available: false,\n        requirements: [{ name: \"Cervecería\", level: 5 }],\n    },\n    {\n        id: \"caja-fuerte\",\n        name: \"Caja fuerte\",\n        image: \"room-vault\",\n        available: false,\n        requirements: [{ name: \"Taberna\", level: 5 }],\n    },\n    {\n        id: \"campo-entrenamiento\",\n        name: \"Campo de entrenamiento\",\n        image: \"room-training\",\n        available: true,\n        requirements: [],\n    },\n    {\n        id: \"seguridad\",\n        name: \"Seguridad\",\n        image: \"room-security\",\n        available: false,\n        requirements: [{ name: \"Campo de entrenamiento\", level: 2 }],\n    },\n    {\n        id: \"torreta-fuego-automatico\",\n        name: \"Torreta de fuego automático\",\n        image: \"room-turret\",\n        available: false,\n        requirements: [{ name: \"Oficina del Jefe\", level: 5 }],\n    },\n    {\n        id: \"minas-ocultas\",\n        name: \"Minas ocultas\",\n        image: \"room-mines\",\n        available: false,\n        requirements: [{ name: \"Oficina del Jefe\", level: 5 }],\n    },\n];\n\n\nexport const trainingTechData: TechItem[] = [\n    {\n      id: \"planificacion-rutas\",\n      name: \"Planificación de rutas\",\n      image: \"training-routes\",\n      available: true,\n      requirements: [],\n    },\n    {\n      id: \"planificacion-encargos\",\n      name: \"Planificación de encargos\",\n      image: \"training-planning\",\n      available: false,\n      requirements: [{ name: \"Planificación de rutas\", level: 4 }],\n    },\n    {\n      id: \"extorsion\",\n      name: \"Extorsión\",\n      image: \"training-extortion\",\n      available: true,\n      requirements: [],\n    },\n    {\n      id: \"administracion-base\",\n      name: \"Administración de base\",\n      image: \"training-base-admin\",\n      available: false,\n      requirements: [{ name: \"Seguridad\", level: 5 }],\n    },\n    {\n      id: \"contrabando-training\",\n      name: \"Contrabando\",\n      image: \"room-contraband\",\n      available: false,\n      requirements: [{ name: \"Planificación de encargos\", level: 1 }],\n    },\n    {\n      id: \"espionaje\",\n      name: \"Espionaje\",\n      image: \"training-espionage\",\n      available: true,\n      requirements: [],\n    },\n    {\n      id: \"seguridad\",\n      name: \"Seguridad\",\n      image: \"training-security\",\n      available: true,\n      requirements: [],\n    },\n    {\n      id: \"proteccion-grupo\",\n      name: \"Protección de grupo\",\n      image: \"room-contraband\",\n      available: false,\n      requirements: [{ name: \"Seguridad\", level: 4 }],\n    },\n    {\n      id: \"combate-cuerpo-a-cuerpo\",\n      name: \"Combate cuerpo a cuerpo\",\n      image: \"training-hand-combat\",\n      available: false,\n      requirements: [{ name: \"Extorsión\", level: 3 }],\n    },\n    {\n      id: \"combate-armas-corta-distancia\",\n      name: \"Combate de armas a corta distancia\",\n      image: \"training-close-combat\",\n      available: false,\n      requirements: [{ name: \"Extorsión\", level: 5 }],\n    },\n    {\n      id: \"entrenamiento-tiro\",\n      name: \"Entrenamiento de Tiro\",\n      image: \"training-shooting\",\n      available: false,\n      requirements: [\n        { name: \"Combate de armas a corta distancia\", level: 4 },\n        { name: \"Protección de grupo\", level: 4 },\n      ],\n    },\n    {\n      id: \"fabricacion-explosivos\",\n      name: \"Fabricación de explosivos\",\n      image: \"training-explosives\",\n      available: false,\n      requirements: [\n        { name: \"Planificación de encargos\", level: 4 },\n        { name: \"Combate cuerpo a cuerpo\", level: 4 },\n      ],\n    },\n    {\n      id: \"entrenamiento-guerrilla\",\n      name: \"Entrenamiento de guerrilla\",\n      image: \"training-guerrilla\",\n      available: false,\n      requirements: [\n        { name: \"Seguridad\", level: 6 },\n        { name: \"Entrenamiento de Tiro\", level: 6 },\n      ],\n    },\n    {\n      id: \"entrenamiento-psicologico\",\n      name: \"Entrenamiento psicológico\",\n      image: \"training-psychological\",\n      available: false,\n      requirements: [{ name: \"Entrenamiento de guerrilla\", level: 4 }],\n    },\n    {\n      id: \"entrenamiento-quimico\",\n      name: \"Entrenamiento Químico\",\n      image: \"training-chemical\",\n      available: false,\n      requirements: [\n        { name: \"Fabricación de explosivos\", level: 4 },\n        { name: \"Entrenamiento psicológico\", level: 4 },\n      ],\n    },\n    {\n      id: \"honor\",\n      name: \"Honor\",\n      image: \"training-honor\",\n      available: false,\n      requirements: [\n        { name: \"Espionaje\", level: 8 },\n        { name: \"Contrabando\", level: 8 },\n      ],\n    },\n  ];\n"
            },
            {
              "name": "training-data.ts",
              "type": "file",
              "content": "\nexport type Training = {\n    id: string;\n    name: string;\n    description: string;\n    image: string;\n    costs: {\n        Armas?: number;\n        Municion?: number;\n        Dolares?: number;\n    };\n    duration: string;\n};\n\nexport const trainingData: Training[] = [\n    {\n        id: \"planificacion-rutas\",\n        name: \"Planificacion de rutas\",\n        description: \"Para ser más efectivos en llegar tan rápido como sea posible al objetivo, tus chicos deberían hacer este entrenamiento. Aquí aprenderán a planear rutas, viajar silenciosamente, y aproximarse al objetivo sin ser detectados, para llevar a cabo su trabajo tan efectivamente como sea posible.\",\n        image: \"training-routes\",\n        costs: { Armas: 500, Municion: 1200 },\n        duration: \"00:11:07\",\n    },\n    {\n        id: \"extorsion\",\n        name: \"Extorsion\",\n        description: \"Con ayuda de este entrenamiento tus chicos mejorarán notablemente cuando se trata de sacar dinero a base de extorsionar a tus enemigos. Esto se notará en la fuerza de combate que aumentará según el nivel alcanzado.\",\n        image: \"training-extortion\",\n        costs: { Armas: 1000, Municion: 2000 },\n        duration: \"00:16:40\",\n    },\n    {\n        id: \"espionaje\",\n        name: \"Espionaje\",\n        description: \"En este entrenamiento aprenderás las virtudes del espionaje por el cual tus espías podrán sacar información amplia y valiosa de tus enemigos.\",\n        image: \"training-espionage\",\n        costs: { Armas: 500, Municion: 500, Dolares: 300 },\n        duration: \"00:23:20\",\n    },\n    {\n        id: \"seguridad\",\n        name: \"Seguridad\",\n        description: \"Seguridad te permite desarrollar todos los sistemas necesarios para proteger tu edificio. A mayor nivel alcanzado mejor será tu defensa y tus chicos sabrán defenderse con mayor eficacia ante ataques.\",\n        image: \"training-security\",\n        costs: { Armas: 1000, Municion: 4000, Dolares: 1000 },\n        duration: \"00:22:13\",\n    },\n];\n"
            }
          ]
        },
        {
          "name": "placeholder-images.json",
          "type": "file",
          "content": "{\n  \"placeholderImages\": [\n    {\n      \"id\": \"vendetta-logo\",\n      \"description\": \"Vendetta game logo, a stylized V in crimson.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1677098258706-fefdbc23bd58?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw1fHxsb2dvJTIwY3JpbXNvbnxlbnwwfHx8fDE3NjY5Nzc3ODZ8MA&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"logo crimson\"\n    },\n    {\n      \"id\": \"vendetta-header\",\n      \"description\": \"Gangster with a vintage car in a dark alley, representing the Vendetta game theme.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1764165067534-4a2d987b3c98?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwyfHxnYW5nc3RlciUyMHZpbnRhZ2V8ZW58MHx8fHwxNzY2OTc5MDIxfDA&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"gangster vintage\"\n    },\n    {\n      \"id\": \"gangster-silhouette\",\n      \"description\": \"Silhouette of a gangster holding a submachine gun.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1669264736964-7beeb59ef28c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw4fHxnYW5nc3RlciUyMHNpbGhvdWV0dGV8ZW58MHx8fHwxNzY2OTcixMDIxfDA&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"gangster silhouette\"\n    },\n    {\n      \"id\": \"game-preview-1\",\n      \"description\": \"Game interface screenshot.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1697256936504-7c9177a74fc5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw5fHxnYW1lJTIwaW50ZXJmYWNlfGVufDB8fHx8MTc2Njk0NDU1NXww&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"game interface\"\n    },\n    {\n      \"id\": \"game-preview-2\",\n      \"description\": \"Game map screenshot.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1761716475708-ef98183ccb62?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw5fHxnYW1lJTIwbWFwfGVufDB8fHx8MTc2NjkyNzgwNHww&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"game map\"\n    },\n    {\n      \"id\": \"game-preview-3\",\n      \"description\": \"Character stats screenshot.\",\n      \"imageUrl\": \"https://picsum.photos/seed/game3/200/150\",\n      \"imageHint\": \"game stats\"\n    },\n    {\n      \"id\": \"game-preview-4\",\n      \"description\": \"City view in game.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1761716475708-ef98183ccb62?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw5fHxnYW1lJTIwY2l0eXxlbnwwfHx8fDE3NjY5NzkwMjF8MA&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"game city\"\n    },\n    {\n      \"id\": \"game-preview-5\",\n      \"description\": \"Game battle screen.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1736349294306-b966cd053399?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHw5fHxnYW1lJTIwYmF0dGxlfGVufDB8fHx8MTc2Njk3OTAyMXww&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"game battle\"\n    },\n    {\n      \"id\": \"changelog\",\n      \"description\": \"A scroll with blood splatters on a poker table, with gangsters in the background.\",\n      \"imageUrl\": \"https://images.unsplash.com/photo-1718788939529-693a2538f5da?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwxfHxnYW5nc3RlcnMlMjBwb2tlciUyMHRhYmxlfGVufDB8fHx8MTc2NzAzNTk4Nnww&ixlib=rb-4.1.0&q=80&w=1080\",\n      \"imageHint\": \"gangsters poker\"\n    },\n    {\n      \"id\": \"dark-alley\",\n      \"description\": \"A dark, empty city alley at night.\",\n      \"imageUrl\": \"/nuevas/edificionuevo2.webp\",\n      \"imageHint\": \"dark alley\"\n    },\n    {\n      \"id\": \"room-office\",\n      \"description\": \"A dimly lit, classic mob boss office with a large wooden desk.\",\n      \"imageUrl\": \"/img/hab/oficina.webp\",\n      \"imageHint\": \"boss office\"\n    },\n    {\n      \"id\": \"room-specialization\",\n      \"description\": \"A training dummy for specialization.\",\n      \"imageUrl\": \"/img/hab/escuela.webp\",\n      \"imageHint\": \"training dummy\"\n    },\n    {\n      \"id\": \"room-armory\",\n      \"description\": \"An armory with rifles on the wall.\",\n      \"imageUrl\": \"/img/hab/armeria.webp\",\n      \"imageHint\": \"armory rifles\"\n    },\n    {\n      \"id\": \"room-ammo\",\n      \"description\": \"An ammo warehouse with boxes of bullets.\",\n      \"imageUrl\": \"/img/hab/municion.webp\",\n      \"imageHint\": \"ammo warehouse\"\n    },\n    {\n      \"id\": \"room-brewery\",\n      \"description\": \"A vintage brewery with wooden barrels.\",\n      \"imageUrl\": \"/img/hab/cerveceria.webp\",\n      \"imageHint\": \"vintage brewery\"\n    },\n    {\n      \"id\": \"room-training\",\n      \"description\": \"A training camp with targets.\",\n      \"imageUrl\": \"/img/hab/campo.webp\",\n      \"imageHint\": \"training camp\"\n    },\n    {\n      \"id\": \"troop-porteador\",\n      \"description\": \"A civilian carrying goods.\",\n      \"imageUrl\": \"/img/trp/porteador.webp\",\n      \"imageHint\": \"civilian carrier\"\n    },\n    {\n      \"id\": \"troop-maton\",\n      \"description\": \"A tough looking street thug.\",\n      \"imageUrl\": \"/img/trp/maton.webp\",\n      \"imageHint\": \"street thug\"\n    },\n    {\n      \"id\": \"troop-assassin\",\n      \"description\": \"A stealthy assassin in the shadows.\",\n      \"imageUrl\": \"/img/trp/asesino.webp\",\n      \"imageHint\": \"stealthy assassin\"\n    },\n    {\n      \"id\": \"troop-enforcer\",\n      \"description\": \"A heavily built enforcer.\",\n      \"imageUrl\": \"/img/trp/guardaespaldas.webp\",\n      \"imageHint\": \"mafia enforcer\"\n    },\n    {\n      \"id\": \"troop-consigliere\",\n      \"description\": \"A wise and well-dressed consigliere.\",\n      \"imageUrl\": \"/img/trp/ilegal.webp\",\n      \"imageHint\": \"mafia consigliere\"\n    },\n    {\n      \"id\": \"room-tavern\",\n      \"description\": \"A dark tavern with wooden furniture.\",\n      \"imageUrl\": \"/img/hab/taberna.webp\",\n      \"imageHint\": \"dark tavern\"\n    },\n    {\n      \"id\": \"room-contraband\",\n      \"description\": \"Boxes of contraband goods.\",\n      \"imageUrl\": \"/img/hab/contrabando.webp\",\n      \"imageHint\": \"contraband goods\"\n    },\n    {\n      \"id\": \"room-vault\",\n      \"description\": \"A large bank vault.\",\n      \"imageUrl\": \"/img/hab/caja.webp\",\n      \"imageHint\": \"bank vault\"\n    },\n    {\n      \"id\": \"room-security\",\n      \"description\": \"A security room with monitors.\",\n      \"imageUrl\": \"/img/hab/seguridad.webp\",\n      \"imageHint\": \"security room\"\n    },\n    {\n      \"id\": \"room-turret\",\n      \"description\": \"An automated turret.\",\n      \"imageUrl\": \"/img/hab/torreta.webp\",\n      \"imageHint\": \"automated turret\"\n    },\n    {\n      \"id\": \"room-mines\",\n      \"description\": \"Hidden land mines.\",\n      \"imageUrl\": \"/img/hab/minas.webp\",\n      \"imageHint\": \"land mines\"\n    },\n    {\n      \"id\": \"training-routes\",\n      \"description\": \"A map with routes planned on it.\",\n      \"imageUrl\": \"/img/ent/rutas.webp\",\n      \"imageHint\": \"route map\"\n    },\n    {\n      \"id\": \"training-planning\",\n      \"description\": \"A blueprint on a wooden table.\",\n      \"imageUrl\": \"/img/ent/encargos.webp\",\n      \"imageHint\": \"blueprint plan\"\n    },\n    {\n      \"id\": \"training-extortion\",\n      \"description\": \"Stacks of cash on a table.\",\n      \"imageUrl\": \"/img/ent/extorsion.webp\",\n      \"imageHint\": \"cash stacks\"\n    },\n    {\n      \"id\": \"training-base-admin\",\n      \"description\": \"Documents and a pen on a desk.\",\n      \"imageUrl\": \"/img/ent/administracion.webp\",\n      \"imageHint\": \"office documents\"\n    },\n    {\n      \"id\": \"training-espionage\",\n      \"description\": \"A map with a knife and a magnifying glass.\",\n      \"imageUrl\": \"/img/ent/espionaje.webp\",\n      \"imageHint\": \"espionage tools\"\n    },\n    {\n      \"id\": \"training-security\",\n      \"description\": \"A secure door with a keypad.\",\n      \"imageUrl\": \"/img/ent/seguridad.webp\",\n      \"imageHint\": \"security door\"\n    },\n    {\n      \"id\": \"training-hand-combat\",\n      \"description\": \"Two coins on a table.\",\n      \"imageUrl\": \"/img/ent/combate.webp\",\n      \"imageHint\": \"old coins\"\n    },\n    {\n      \"id\": \"training-close-combat\",\n      \"description\": \"A combat knife on a wooden surface.\",\n      \"imageUrl\": \"/img/ent/armas.webp\",\n      \"imageHint\": \"combat knife\"\n    },\n    {\n      \"id\": \"training-shooting\",\n      \"description\": \"A rifle with accessories on a table.\",\n      \"imageUrl\": \"/img/ent/tiro.webp\",\n      \"imageHint\": \"rifle accessories\"\n    },\n    {\n      \"id\": \"training-explosives\",\n      \"description\": \"Sticks of dynamite and a blueprint.\",\n      \"imageUrl\": \"/img/ent/explosivos.webp\",\n      \"imageHint\": \"dynamite blueprint\"\n    },\n    {\n      \"id\": \"training-guerrilla\",\n      \"description\": \"A map, a compass and a knife.\",\n      \"imageUrl\": \"/img/ent/guerrilla.webp\",\n      \"imageHint\": \"guerrilla tools\"\n    },\n    {\n      \"id\": \"training-psychological\",\n      \"description\": \"Pills and dice on a table.\",\n      \"imageUrl\": \"/img/ent/psicologico.webp\",\n      \"imageHint\": \"pills dice\"\n    },\n    {\n      \"id\": \"training-chemical\",\n      \"description\": \"Concrete cylinders on a surface.\",\n      \"imageUrl\": \"/img/ent/quimico.webp\",\n      \"imageHint\": \"concrete cylinders\"\n    },\n    {\n      \"id\": \"training-honor\",\n      \"description\": \"A framed certificate on a table.\",\n      \"imageUrl\": \"/img/ent/honor.webp\",\n      \"imageHint\": \"framed certificate\"\n    },\n    {\n      \"id\": \"troop-acuchillador\",\n      \"description\": \"A figure holding a large knife.\",\n      \"imageUrl\": \"/img/trp/acuchillador.webp\",\n      \"imageHint\": \"knife wielder\"\n    },\n    {\n      \"id\": \"troop-centinela\",\n      \"description\": \"A watchful sentinel on guard.\",\n      \"imageUrl\": \"/img/trp/centinela.webp\",\n      \"imageHint\": \"watchful sentinel\"\n    },\n    {\n      \"id\": \"troop-cia\",\n      \"description\": \"A CIA agent in a suit.\",\n      \"imageUrl\": \"/img/trp/cia.webp\",\n      \"imageHint\": \"cia agent\"\n    },\n    {\n      \"id\": \"troop-demolition\",\n      \"description\": \"A demolition expert with explosives.\",\n      \"imageUrl\": \"/img/trp/demolicion.webp\",\n      \"imageHint\": \"demolition expert\"\n    },\n    {\n      \"id\": \"troop-spy\",\n      \"description\": \"A spy in a trench coat.\",\n      \"imageUrl\": \"/img/trp/espia.webp\",\n      \"imageHint\": \"trench-coat spy\"\n    },\n    {\n      \"id\": \"troop-fbi\",\n      \"description\": \"An FBI agent with a badge.\",\n      \"imageUrl\": \"/img/trp/fbi.webp\",\n      \"imageHint\": \"fbi agent\"\n    },\n    {\n      \"id\": \"troop-sniper\",\n      \"description\": \"A sniper with a long-range rifle.\",\n      \"imageUrl\": \"/img/trp/francotirador.webp\",\n      \"imageHint\": \"sniper rifle\"\n    },\n    {\n      \"id\": \"troop-bodyguard\",\n      \"description\": \"A muscular bodyguard.\",\n      \"imageUrl\": \"/img/trp/guardaespalda.webp\",\n      \"imageHint\": \"muscular bodyguard\"\n    },\n    {\n      \"id\": \"troop-guard\",\n      \"description\": \"A security guard in uniform.\",\n      \"imageUrl\": \"/img/trp/guardia.webp\",\n      \"imageHint\": \"security guard\"\n    },\n    {\n      \"id\": \"troop-mercenary\",\n      \"description\": \"A soldier of fortune with a rifle.\",\n      \"imageUrl\": \"/img/trp/mercenario.webp\",\n      \"imageHint\": \"mercenary rifle\"\n    },\n    {\n      \"id\": \"troop-ninja\",\n      \"description\": \"A ninja with a sword.\",\n      \"imageUrl\": \"/img/trp/ninja.webp\",\n      \"imageHint\": \"ninja sword\"\n    },\n    {\n      \"id\": \"troop-occupation\",\n      \"description\": \"A soldier in combat gear.\",\n      \"imageUrl\": \"/img/trp/ocupacion.webp\",\n      \"imageHint\": \"combat soldier\"\n    },\n    {\n      \"id\": \"troop-gunman\",\n      \"description\": \"A gunman with a pistol.\",\n      \"imageUrl\": \"/img/trp/pistolero.webp\",\n      \"imageHint\": \"pistol gunman\"\n    },\n    {\n      \"id\": \"troop-police\",\n      \"description\": \"A police officer in uniform.\",\n      \"imageUrl\": \"/img/trp/policia.webp\",\n      \"imageHint\": \"police officer\"\n    },\n    {\n      \"id\": \"troop-doorman\",\n      \"description\": \"A doorman in a uniform.\",\n      \"imageUrl\": \"/img/trp/portero.webp\",\n      \"imageHint\": \"uniformed doorman\"\n    },\n    {\n      \"id\": \"troop-tactical\",\n      \"description\": \"A tactical operator in full gear.\",\n      \"imageUrl\": \"/img/trp/tactico.webp\",\n      \"imageHint\": \"tactical operator\"\n    },\n    {\n      \"id\": \"troop-carrier\",\n      \"description\": \"A person carrying a heavy load.\",\n      \"imageUrl\": \"/img/trp/transportista.webp\",\n      \"imageHint\": \"heavy load\"\n    }\n  ]\n}"
        },
        {
          "name": "placeholder-images.ts",
          "type": "file",
          "content": "import data from './placeholder-images.json';\n\nexport type ImagePlaceholder = {\n  id: string;\n  description: string;\n  imageUrl: string;\n  imageHint: string;\n};\n\nexport const PlaceHolderImages: ImagePlaceholder[] = data.placeholderImages;\n"
        },
        {
          "name": "services",
          "type": "directory",
          "children": [
            {
              "name": "auth.service.ts",
              "type": "file",
              "content": "import { createClient } from '@/lib/supabase/server'\nimport { headers } from 'next/headers'\nimport { redirect } from 'next/navigation'\n\nexport async function signUp(data: { email: string; password: string; full_name: string }) {\n  const supabase = await createClient()\n\n  // The origin is needed for email verification links if we were using them,\n  // but standard signup might not need it if not redirecting immediately with oauth.\n  // However, for good measure let's get origin if possible, or use a default.\n  // For password signup, Supabase might send a confirmation email.\n  const origin = (await headers()).get('origin')\n\n  const { error, data: authData } = await supabase.auth.signUp({\n    email: data.email,\n    password: data.password,\n    options: {\n      data: {\n        full_name: data.full_name,\n      },\n      // If email confirmation is enabled, this is where they'll be redirected\n      emailRedirectTo: `${origin}/auth/callback`, \n    },\n  })\n\n  if (error) {\n    return { success: false, error: error.message }\n  }\n\n  return { success: true, data: authData }\n}\n\nexport async function signIn(data: { email: string; password: string }) {\n  const supabase = await createClient()\n\n  const { error } = await supabase.auth.signInWithPassword({\n    email: data.email,\n    password: data.password,\n  })\n\n  if (error) {\n    return { success: false, error: error.message }\n  }\n\n  return { success: true }\n}\n\nexport async function signOut() {\n  const supabase = await createClient()\n  await supabase.auth.signOut()\n  redirect('/login')\n}\n"
            },
            {
              "name": "game.service.ts",
              "type": "file",
              "content": "import { createClient } from '@/lib/supabase/server'\nimport { Propiedad, AtaqueEntrante, ColaMisiones, MiembroFamilia, Familia } from '@/types/database'\nimport { RespuestaConstruccion, ColaConstruccion, DashboardData } from '@/types/game'\nimport { sanitizeDatabaseError } from '@/lib/utils/db-error'\n\ninterface CreateInitialPropertyData {\n  nombre: string\n  ciudad: number\n  barrio: number\n  edificio: number\n}\n\ninterface CreateInitialPropertyResponse {\n  success?: boolean\n  error?: string\n  propiedad_id?: string\n}\n\ninterface ResearchResponse {\n  success?: boolean\n  error?: string\n}\n\ninterface RecruitResponse {\n  success?: boolean\n  error?: string\n}\n\ninterface MissionData {\n  propiedad_origen_id: string\n  tipo_mision: 'atacar' | 'transportar' | 'espiar' | 'colonizar' | 'recolectar'\n  tropas: Record<string, number>\n  recursos?: Record<string, number>\n  destino_ciudad: number\n  destino_barrio: number\n  destino_edificio: number\n  velocidad_flota?: number\n}\n\ninterface MissionResponse {\n  success?: boolean\n  error?: string\n  mision_id?: string\n}\n\nexport interface MapTileData {\n  propiedad_id: string\n  coordenada_edificio: number\n  usuario_id: string\n  nombre_usuario: string\n  nombre_familia: string | null\n  etiqueta_familia: string | null\n  puntos: number\n  es_propia: boolean\n}\n\nexport async function getMapTiles(city: number, district: number): Promise<MapTileData[]> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('get_map_tiles', {\n    p_ciudad: city,\n    p_barrio: district\n  })\n\n  if (error) {\n    console.error('Error fetching map tiles:', error)\n    return []\n  }\n\n  return data as MapTileData[]\n}\n\nexport async function createInitialProperty(data: CreateInitialPropertyData): Promise<CreateInitialPropertyResponse> {\n  const supabase = await createClient()\n\n  const { data: result, error } = await supabase.rpc('crear_propiedad_inicial', {\n    p_nombre: data.nombre,\n    p_ciudad: data.ciudad,\n    p_barrio: data.barrio,\n    p_edificio: data.edificio\n  })\n\n  if (error) {\n    console.error('Error creating initial property:', error)\n    return { error: sanitizeDatabaseError(error) }\n  }\n\n  return result as CreateInitialPropertyResponse\n}\n\nexport async function getUserProperty(userId: string): Promise<string | null> {\n  const supabase = await createClient()\n  const { data, error } = await supabase.from('propiedad').select('id').eq('usuario_id', userId).maybeSingle()\n\n  if (error) {\n    console.error('Error checking user property:', error)\n    return null\n  }\n  return data?.id || null\n}\n\nexport async function getDashboardData(propertyId: string): Promise<DashboardData | null> {\n  const supabase = await createClient()\n\n  const { data: dashboardData, error } = await supabase.rpc('get_dashboard_data', {\n    p_propiedad_id: propertyId\n  })\n\n  if (error || !dashboardData) {\n    console.error('Error fetching dashboard data:', error)\n    return null\n  }\n\n  // Fetch real-time collections in parallel\n  const [attacks, missions] = await Promise.all([\n    getIncomingAttacks(propertyId),\n    getActiveMissions(propertyId)\n  ])\n\n  // Merge into expanded DashboardData structure\n  const result: DashboardData = {\n    ...dashboardData,\n    incoming_attacks: attacks,\n    cola_misiones: missions,\n    tropa_usuario: dashboardData.tropas || [],\n    cola_reclutamiento: dashboardData.colas?.reclutamiento || []\n  }\n\n  return result\n}\n\nexport async function getIncomingAttacks(propertyId: string): Promise<AtaqueEntrante[]> {\n  const supabase = await createClient()\n\n  // First get the user_id for this property to filter attacks targeting this user\n  const { data: prop, error: propError } = await supabase\n    .from('propiedad')\n    .select('usuario_id')\n    .eq('id', propertyId)\n    .single()\n\n  if (propError || !prop) {\n      console.error('Error getting property owner for attacks:', propError)\n      return []\n  }\n\n  const { data, error } = await supabase\n    .from('ataque_entrante')\n    .select('*')\n    .eq('defensor_id', prop.usuario_id)\n    .order('fecha_llegada', { ascending: true })\n\n  if (error) {\n    console.error('Error fetching incoming attacks:', error)\n    return []\n  }\n\n  return data as AtaqueEntrante[]\n}\n\nexport async function getActiveMissions(propertyId: string): Promise<ColaMisiones[]> {\n  const supabase = await createClient()\n  const { data, error } = await supabase\n      .from('cola_misiones')\n      .select('*')\n      .eq('propiedad_origen_id', propertyId)\n      .order('fecha_llegada', { ascending: true })\n\n  if (error) {\n      console.error('Error fetching active missions:', error)\n      return []\n  }\n\n  return data as ColaMisiones[]\n}\n\nexport async function getFamilyInfo(userId: string): Promise<{ miembro: MiembroFamilia, familia: Familia } | null> {\n  const supabase = await createClient()\n  const { data: miembro, error: mError } = await supabase\n      .from('miembro_familia')\n      .select('*')\n      .eq('usuario_id', userId)\n      .maybeSingle()\n  \n  if (mError || !miembro) return null\n\n  const { data: familia, error: fError } = await supabase\n      .from('familia')\n      .select('*')\n      .eq('id', miembro.familia_id)\n      .single()\n  \n  if (fError || !familia) return null\n\n  return { miembro, familia }\n}\n\nexport async function cancelConstruction(queueId: string): Promise<{ success: boolean; error?: string }> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('cancelar_construccion', {\n    p_cola_id: queueId\n  })\n\n  if (error) {\n    console.error('Error cancelling construction:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  const result = data as { success: boolean; error?: string }\n  if (result.error) {\n    return { success: false, error: result.error }\n  }\n\n  return { success: true }\n}\n\nexport async function syncResources(propertyId: string): Promise<Propiedad | null> {\n  const supabase = await createClient()\n  \n  // 1. Process queues (construction, research, etc.) for this property\n  const { error: queueError } = await supabase.rpc('procesar_colas_propiedad', {\n    p_propiedad_id: propertyId\n  })\n\n  if (queueError) {\n    console.error('Error processing queues:', queueError)\n    // Continue anyway to at least try to get resources\n  }\n\n  // 2. Materialize resources (lazy update)\n  const { error: rpcError } = await supabase.rpc('materializar_recursos', {\n    p_propiedad_id: propertyId\n  })\n\n  if (rpcError) {\n    console.error('Error synchronizing resources:', rpcError)\n  }\n\n  // 3. Fetch the updated property data\n  const { data, error } = await supabase\n    .from('propiedad')\n    .select('*')\n    .eq('id', propertyId)\n    .single()\n\n  if (error) {\n    console.error('Error fetching property:', error)\n    return null\n  }\n\n  return data\n}\n\nexport async function startConstruction(propertyId: string, buildingId: string): Promise<RespuestaConstruccion> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_construccion_habitacion', {\n    p_propiedad_id: propertyId,\n    p_habitacion_id: buildingId\n  })\n\n  if (error) {\n    console.error('Error starting construction:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as RespuestaConstruccion\n}\n\nexport async function getConstructionQueue(propertyId: string): Promise<ColaConstruccion[]> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from('cola_construccion')\n    .select('id, propiedad_id, habitacion_id, nivel_destino, fecha_fin')\n    .eq('propiedad_id', propertyId)\n    .order('fecha_fin', { ascending: true })\n\n  if (error) {\n    console.error('Error fetching construction queue:', error)\n    return []\n  }\n\n  return data as ColaConstruccion[]\n}\n\nexport async function startResearch(propertyId: string, researchId: string): Promise<ResearchResponse> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_entrenamiento', {\n    p_propiedad_id: propertyId,\n    p_entrenamiento_id: researchId\n  })\n\n  if (error) {\n    console.error('Error starting research:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as ResearchResponse\n}\n\nexport async function recruitTroops(propertyId: string, troopId: string, amount: number): Promise<RecruitResponse> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_reclutamiento', {\n    p_propiedad_id: propertyId,\n    p_tropa_id: troopId,\n    p_cantidad: amount\n  })\n\n  if (error) {\n    console.error('Error recruiting troops:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as RecruitResponse\n}\n\nexport async function launchMission(missionData: MissionData): Promise<MissionResponse> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.rpc('iniciar_mision', {\n    p_propiedad_origen_id: missionData.propiedad_origen_id,\n    p_tipo_mision: missionData.tipo_mision,\n    p_tropas: missionData.tropas,\n    p_recursos: missionData.recursos || {},\n    p_destino_ciudad: missionData.destino_ciudad,\n    p_destino_barrio: missionData.destino_barrio,\n    p_destino_edificio: missionData.destino_edificio,\n    p_velocidad_flota: missionData.velocidad_flota || 100\n  })\n\n  if (error) {\n    console.error('Error launching mission:', error)\n    return { success: false, error: sanitizeDatabaseError(error) }\n  }\n\n  return data as MissionResponse\n}\n"
            },
            {
              "name": "user.service.ts",
              "type": "file",
              "content": "import { createClient } from '@/lib/supabase/server'\nimport { Usuario } from '@/types/database'\n\nexport async function getUserProfile(userId: string): Promise<Usuario | null> {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('usuario')\n    .select('*')\n    .eq('id', userId)\n    .single()\n\n  if (error) {\n    console.error('Error fetching user profile:', error)\n    return null\n  }\n\n  return data\n}\n"
            }
          ]
        },
        {
          "name": "supabase",
          "type": "directory",
          "children": [
            {
              "name": "client.ts",
              "type": "file",
              "content": "import { createBrowserClient } from '@supabase/ssr'\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  )\n}\n"
            },
            {
              "name": "server.ts",
              "type": "file",
              "content": "import { createServerClient, type CookieOptions } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport const createClient = () => {\n  const cookieStore = cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        async get(name: string) {\n          return (await cookieStore).get(name)?.value\n        },\n        async set(name: string, value: string, options: CookieOptions) {\n          try {\n            (await cookieStore).set({ name, value, ...options })\n          } catch (error) {\n            // The `set` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n        async remove(name: string, options: CookieOptions) {\n          try {\n            (await cookieStore).set({ name, value: '', ...options })\n          } catch (error) {\n            // The `delete` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n"
            }
          ]
        },
        {
          "name": "utils",
          "type": "directory",
          "children": [
            {
              "name": "db-error.ts",
              "type": "file",
              "content": "/**\n * Utility to sanitize database errors and return user-friendly messages.\n * Prevents leaking raw database error details to the client.\n */\nexport function sanitizeDatabaseError(error: unknown): string {\n  if (!error) return 'Ha ocurrido un error desconocido.';\n\n  // If the error is already a string\n  if (typeof error === 'string') {\n    // If it looks like a raw database error message, sanitize it.\n    const lowerError = error.toLowerCase();\n    if (\n      lowerError.includes('violate') ||\n      lowerError.includes('constraint') ||\n      lowerError.includes('syntax') ||\n      lowerError.includes('relation') ||\n      lowerError.includes('column') ||\n      lowerError.includes('function')\n    ) {\n       return 'Ha ocurrido un error técnico. Por favor intenta de nuevo.';\n    }\n    // Otherwise assume it is a safe application error message\n    return error;\n  }\n\n  const err = error as { code?: string; message?: string; details?: string; hint?: string };\n\n  // Handle specific Postgres error codes\n  if (err.code) {\n    switch (err.code) {\n      case '42501': // insufficient_privilege\n        return 'No tienes permisos para realizar esta acción.';\n      case '23505': // unique_violation\n        return 'Ya existe un registro con estos datos.';\n      case '23503': // foreign_key_violation\n        return 'Operación inválida: referencia a datos inexistentes.';\n      case '23502': // not_null_violation\n        return 'Faltan datos requeridos.';\n      case '40P01': // deadlock_detected\n        return 'El sistema está ocupado, por favor intenta de nuevo.';\n      case '57014': // query_canceled\n        return 'La operación tardó demasiado y fue cancelada.';\n      case 'PGRST116':\n        return 'No se encontraron los datos solicitados.';\n      // Add more codes as needed\n    }\n  }\n\n  // Handle network-like errors\n  if (err.message) {\n      if (\n          err.message.includes('fetch failed') ||\n          err.message.includes('network') ||\n          err.message.includes('connection')\n        ) {\n        return 'Error de conexión con el servidor.';\n      }\n\n      // If we couldn't match a code, but we have a message, it might be a raw DB message.\n      // We apply the same string heuristics.\n      const lowerMsg = err.message.toLowerCase();\n       if (\n          lowerMsg.includes('violate') ||\n          lowerMsg.includes('constraint') ||\n          lowerMsg.includes('syntax') ||\n          lowerMsg.includes('relation') ||\n          lowerMsg.includes('column') ||\n          lowerMsg.includes('function')\n        ) {\n           return 'Ha ocurrido un error técnico en la base de datos.';\n        }\n  }\n\n  // Fallback generic message\n  return 'Ha ocurrido un error inesperado. Por favor, inténtalo de nuevo más tarde.';\n}\n"
            },
            {
              "name": "map-utils.ts",
              "type": "file",
              "content": "\nexport interface MapCoordinates {\n  city: number;\n  district: number;\n  building: number;\n}\n\n/**\n * Calculates the distance between two points in the game universe.\n * Uses a hierarchical distance model since the exact world grid is not fully defined.\n *\n * Base Grid: 17 columns x 15 rows (255 tiles).\n * Scaling:\n * - Same District: Standard Euclidean distance on the grid.\n * - Different District: Adds a significant distance penalty per district unit.\n * - Different City: Adds a massive distance penalty per city unit.\n */\nexport function calculateDistance(origin: MapCoordinates, target: MapCoordinates): number {\n  // Constants for scaling\n  const DISTRICT_SCALE = 50; // Distance unit equivalent for 1 district step\n  const CITY_SCALE = 500;    // Distance unit equivalent for 1 city step\n\n  // Calculate grid coordinates (0-indexed)\n  // Assuming building ID maps to 17x15 grid\n  const GRID_WIDTH = 17;\n\n  const originX = (origin.building - 1) % GRID_WIDTH;\n  const originY = Math.floor((origin.building - 1) / GRID_WIDTH);\n\n  const targetX = (target.building - 1) % GRID_WIDTH;\n  const targetY = Math.floor((target.building - 1) / GRID_WIDTH);\n\n  // Euclidean distance within the grid\n  const gridDist = Math.sqrt(Math.pow(targetX - originX, 2) + Math.pow(targetY - originY, 2));\n\n  // Hierarchical distance\n  const cityDiff = Math.abs(target.city - origin.city);\n  const districtDiff = Math.abs(target.district - origin.district);\n\n  if (cityDiff === 0 && districtDiff === 0) {\n    return Number(gridDist.toFixed(2));\n  }\n\n  // If different district or city, we abstract the distance\n  // We treat the grid distance as negligible compared to inter-district travel,\n  // or we add it to the center-to-center distance.\n  // Simple approximation:\n  const totalDist = gridDist + (districtDiff * DISTRICT_SCALE) + (cityDiff * CITY_SCALE);\n\n  return Number(totalDist.toFixed(2));\n}\n\n/**\n * Calculates travel time in seconds.\n * @param distance Distance in game units\n * @param fleetSpeed Speed of the fleet (units per hour, or arbitrary speed metric)\n * Assuming fleetSpeed is units/hour for this calculation, but we return seconds.\n *\n * Standard formula: Time = Distance / Speed\n */\nexport function calculateTravelTime(distance: number, fleetSpeed: number): number {\n  if (fleetSpeed <= 0) return Infinity;\n\n  // Example: Speed is 100 => 100 units per hour\n  // Time (hours) = Distance / Speed\n  // Time (seconds) = (Distance / Speed) * 3600\n\n  // However, check if legacy has specific formula.\n  // Requirement says: \"Retorna segundos.\"\n\n  const timeInSeconds = (distance / fleetSpeed) * 3600;\n  return Math.ceil(timeInSeconds);\n}\n\n/**\n * Formats seconds into HH:MM:SS string\n */\nexport function formatDuration(seconds: number): string {\n  if (!isFinite(seconds)) return \"N/A\";\n\n  const h = Math.floor(seconds / 3600);\n  const m = Math.floor((seconds % 3600) / 60);\n  const s = Math.floor(seconds % 60);\n\n  const pad = (n: number) => n.toString().padStart(2, '0');\n\n  return `${pad(h)}:${pad(m)}:${pad(s)}`;\n}\n"
            }
          ]
        },
        {
          "name": "utils.ts",
          "type": "file",
          "content": "import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"
        }
      ]
    },
    {
      "name": "middleware.ts",
      "type": "file",
      "content": "\nimport { createServerClient, type CookieOptions } from '@supabase/ssr'\nimport { type NextRequest, NextResponse } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n  let response = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  })\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return request.cookies.get(name)?.value\n        },\n        set(name: string, value: string, options: CookieOptions) {\n          request.cookies.set({ name, value, ...options })\n          response = NextResponse.next({\n            request: { headers: request.headers },\n          })\n          response.cookies.set({ name, value, ...options })\n        },\n        remove(name: string, options: CookieOptions) {\n          request.cookies.set({ name, value: '', ...options })\n          response = NextResponse.next({\n            request: { headers: request.headers },\n          })\n          response.cookies.set({ name, value: '', ...options })\n        },\n      },\n    }\n  )\n\n  const { data: { user } } = await supabase.auth.getUser()\n\n  const publicPaths = ['/', '/login', '/signup', '/forgot-password', '/reset-password']\n\n  if (!user && !publicPaths.includes(request.nextUrl.pathname) && !request.nextUrl.pathname.startsWith('/auth/callback')) {\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n\n  if (user && publicPaths.includes(request.nextUrl.pathname) && request.nextUrl.pathname !== '/reset-password') {\n    return NextResponse.redirect(new URL('/dashboard', request.url))\n  }\n  \n  if (user && request.nextUrl.pathname === '/reset-password') {\n    // allow access to reset-password if user is authenticated through recovery link\n  }\n\n\n  return response\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * Feel free to modify this pattern to include more paths.\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n}\n"
    },
    {
      "name": "types",
      "type": "directory",
      "children": [
        {
          "name": "database.ts",
          "type": "file",
          "content": "// src/types/database.ts\n\n// Enums\nexport type EstadoInvitacion = 'pendiente' | 'aceptada' | 'rechazada';\n// Alias for typo compatibility if needed, though strictly we should use the correct one.\nexport type EstadoInvaticion = EstadoInvitacion; \n\nexport type RolFamilia = 'miembro' | 'capitan' | 'lider';\nexport type CategoriaMensaje = 'jugador' | 'familia' | 'sistema' | 'batalla' | 'espionaje';\nexport type EstadoFlota = 'en_camino' | 'regresando' | 'estacionada' | 'combatiendo';\nexport type TipoMision = 'atacar' | 'transportar' | 'espiar' | 'colonizar' | 'recolectar';\n\n// Interfaces for Tables\nexport interface Usuario {\n  id: string; // uuid\n  nombre_usuario: string;\n  email: string;\n  url_avatar?: string;\n  nombre?: string;\n  titulo?: string;\n  rol?: string;\n  primer_login?: boolean;\n  ultimo_visto?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface HistorialAcceso {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  fecha_acceso?: string; // timestamptz\n  direccion_ip?: string;\n  agente_usuario?: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface PuntuacionUsuario {\n  usuario_id: string; // uuid\n  puntos_habitaciones?: number; // real\n  puntos_tropas?: number; // real\n  puntos_entrenamientos?: number; // real\n  puntos_totales?: number; // real\n  puntos_honor_atacante?: number; // real\n  puntos_honor_defensor?: number; // real\n  puntos_honor_totales?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ErroresConfiguracion {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  mensaje_error?: string;\n  fecha_creacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionHabitacion {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_construccion?: number; // integer\n  produccion_base?: number; // real\n  recurso_producido?: string;\n  puntos?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionEntrenamiento {\n  id: string;\n  nombre: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_entrenamiento?: number; // integer\n  puntos?: number; // real\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion?: string;\n  url_imagen: string;\n  costo_armas?: number; // bigint\n  costo_municion?: number; // bigint\n  costo_dolares?: number; // bigint\n  duracion_reclutamiento?: number; // integer\n  ataque?: number; // integer\n  defensa?: number; // integer\n  capacidad_carga?: number; // integer\n  velocidad?: number; // bigint\n  salario?: number; // integer\n  puntos?: number; // real\n  tipo: string;\n  requisitos?: Record<string, any>; // jsonb\n  bonus_ataque?: string[];\n  bonus_defensa?: string[];\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface RequisitoHabitacion {\n  id: string; // uuid\n  habitacion_id?: string;\n  habitacion_requerida_id?: string;\n  nivel_requerido?: number; // integer\n}\n\nexport interface RequisitoEntrenamiento {\n  id: string; // uuid\n  entrenamiento_id?: string;\n  entrenamiento_requerido_id?: string;\n  nivel_requerido?: number; // integer\n}\n\nexport interface TropaBonusContrincante {\n  id: string; // uuid\n  tropa_atacante_id?: string;\n  tropa_defensora_id?: string;\n  factor_prioridad?: number; // real\n}\n\nexport interface Propiedad {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  nombre: string;\n  coordenada_ciudad: number; // integer\n  coordenada_barrio: number; // integer\n  coordenada_edificio: number; // integer\n  armas?: number; // bigint\n  municion?: number; // bigint\n  alcohol?: number; // bigint\n  dolares?: number; // bigint\n  ultima_recogida_recursos?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface HabitacionUsuario {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  habitacion_id?: string;\n  nivel?: number; // smallint\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface TropaPropiedad {\n  propiedad_id: string; // uuid\n  tropa_id: string;\n  cantidad?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface TropaSeguridadPropiedad {\n  propiedad_id: string; // uuid\n  tropa_id: string;\n  cantidad?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface EntrenamientoUsuario {\n  usuario_id: string; // uuid\n  entrenamiento_id: string;\n  nivel?: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaConstruccion {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  habitacion_id?: string;\n  nivel_destino: number; // integer\n  duracion_segundos: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaInvestigacion {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  propiedad_id?: string; // uuid\n  entrenamiento_id?: string;\n  nivel_destino: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaReclutamiento {\n  id: string; // uuid\n  propiedad_id?: string; // uuid\n  tropa_id?: string;\n  cantidad: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_fin: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface Familia {\n  id: string; // uuid\n  nombre: string;\n  etiqueta: string;\n  descripcion?: string;\n  url_avatar?: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface MiembroFamilia {\n  usuario_id: string; // uuid\n  familia_id?: string; // uuid\n  rol?: RolFamilia;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface InvitacionFamilia {\n  id: string; // uuid\n  familia_id?: string; // uuid\n  usuario_id?: string; // uuid\n  tipo: string;\n  estado?: EstadoInvitacion;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface AnuncioFamilia {\n  id: string; // uuid\n  familia_id?: string; // uuid\n  autor_id?: string; // uuid\n  contenido: string;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaMisiones {\n  id: string; // uuid\n  usuario_id?: string; // uuid\n  propiedad_origen_id?: string; // uuid\n  tipo_mision: TipoMision;\n  tropas: Record<string, any>; // jsonb\n  recursos?: Record<string, any>; // jsonb\n  origen_ciudad: number; // integer\n  origen_barrio: number; // integer\n  origen_edificio: number; // integer\n  destino_ciudad: number; // integer\n  destino_barrio: number; // integer\n  destino_edificio: number; // integer\n  fecha_inicio: string; // timestamptz\n  fecha_llegada: string; // timestamptz\n  fecha_regreso?: string; // timestamptz\n  velocidad_flota: number; // integer\n  duracion_viaje: number; // integer\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface ColaEventosFlota {\n  id: string; // uuid\n  datos: Record<string, any>; // jsonb\n  estado?: string;\n  fecha_ejecucion?: string; // timestamptz\n  fecha_creacion?: string; // timestamptz\n}\n\nexport interface InformeBatalla {\n  id: string; // uuid\n  atacante_id?: string; // uuid\n  defensor_id?: string; // uuid\n  coordenada_ciudad: number; // integer\n  coordenada_barrio: number; // integer\n  coordenada_edificio: number; // integer\n  ganador: string;\n  detalles: Record<string, any>; // jsonb\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface InformeEspionaje {\n  id: string; // uuid\n  atacante_id?: string; // uuid\n  defensor_id?: string; // uuid\n  detalles: Record<string, any>; // jsonb\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface Mensaje {\n  id: string; // uuid\n  remitente_id?: string; // uuid\n  destinatario_id?: string; // uuid\n  asunto: string;\n  contenido: string;\n  categoria?: CategoriaMensaje;\n  informe_batalla_id?: string; // uuid\n  informe_espionaje_id?: string; // uuid\n  leido?: boolean;\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n\nexport interface AtaqueEntrante {\n  id: string; // uuid\n  defensor_id?: string; // uuid\n  atacante_id?: string; // uuid\n  nombre_atacante: string;\n  propiedad_objetivo: string;\n  total_tropas: number; // integer\n  fecha_llegada: string; // timestamptz\n  mision_id?: string; // uuid\n  fecha_creacion?: string; // timestamptz\n  fecha_actualizacion?: string; // timestamptz\n}\n"
        },
        {
          "name": "game.ts",
          "type": "file",
          "content": "import { z } from 'zod';\nimport { Propiedad, ColaConstruccion as ColaConstruccionDB, AtaqueEntrante, ColaMisiones, Familia, MiembroFamilia } from './database';\n\nexport interface IncomingAttack extends AtaqueEntrante {}\n\nexport interface ActiveMission extends ColaMisiones {}\n\nexport interface FamilyInfo extends MiembroFamilia {\n  familia: Familia | null;\n}\n\nexport interface RecursoDetalle {\n  val: number;\n  max: number;\n  prod: number;\n}\n\nexport interface EdificioDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface TropaDetalle {\n  id: string;\n  cantidad: number;\n  nombre: string;\n}\n\nexport interface InvestigacionDetalle {\n  id: string;\n  nivel: number;\n  nombre: string;\n}\n\nexport interface ConfiguracionTropa {\n  id: string;\n  nombre: string;\n  descripcion: string | null;\n  url_imagen: string;\n  costo_armas: number;\n  costo_municion: number;\n  costo_dolares: number;\n  duracion_reclutamiento: number;\n  ataque: number;\n  defensa: number;\n  capacidad_carga: number;\n  velocidad: number;\n  salario: number;\n  puntos: number;\n  tipo: string;\n  requisitos: Record<string, number> | null;\n  bonus_ataque: string[] | null;\n  bonus_defensa: string[] | null;\n  fecha_creacion: string | null;\n  fecha_actualizacion: string | null;\n}\n\nexport interface ColaDetalle {\n  id: string;\n  habitacion_id?: string;\n  entrenamiento_id?: string;\n  tropa_id?: string;\n  nivel_destino?: number;\n  cantidad?: number;\n  fecha_fin: string;\n  nombre: string;\n}\n\nexport interface Colas {\n  construccion: ColaDetalle[];\n  investigacion: ColaDetalle[];\n  reclutamiento: ColaDetalle[];\n}\n\nexport interface DashboardData {\n  propiedad: Propiedad;\n  recursos: {\n    armas: RecursoDetalle;\n    municion: RecursoDetalle;\n    alcohol: RecursoDetalle;\n    dolares: RecursoDetalle;\n  };\n  edificios: EdificioDetalle[];\n  colas: Colas;\n  tropas: TropaDetalle[];\n  investigaciones: InvestigacionDetalle[];\n  puntos: number;\n  cola_misiones: ActiveMission[];\n  incoming_attacks: IncomingAttack[];\n  tropa_usuario: TropaDetalle[];\n  cola_reclutamiento: ColaDetalle[];\n}\n\nexport interface Recursos {\n  armas: number;\n  municion: number;\n  alcohol: number;\n  dolares: number;\n}\n\nexport interface RespuestaConstruccion {\n  success: boolean;\n  fecha_inicio?: string;\n  fecha_fin?: string;\n  error?: string;\n}\n\nexport type ColaConstruccion = Pick<ColaConstruccionDB, 'id' | 'propiedad_id' | 'habitacion_id' | 'nivel_destino' | 'fecha_fin'>;\n\nexport const IniciarConstruccionSchema = z.object({\n  propiedad_id: z.string().uuid(),\n  habitacion_id: z.string().min(1),\n});\n"
        },
        {
          "name": "legacy_schema.ts",
          "type": "file",
          "content": "export interface ConfigBuilding {\n  id: string;\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n  created_at?: string;\n}\n\n// Flat structure returned by get_base_buildings RPC\nexport interface BaseBuildingRPC {\n  id: string; // base_building id\n  base_id: string;\n  building_id: string;\n  level: number;\n  created_at?: string;\n\n  // Joined Config Fields\n  name: string;\n  description: string | null;\n  cost_armaments: number;\n  cost_munitions: number;\n  cost_dollars: number;\n  base_duration: number;\n  base_production: number;\n  points: number;\n}\n\nexport interface ConstructionQueueItem {\n  id: string;\n  base_id: string;\n  building_id: string;\n  target_level: number;\n  start_time: string;\n  end_time: string;\n  created_at?: string;\n  // Joined fields\n  building_name?: string;\n}\n\nexport interface Base {\n  id: string;\n  user_id: string;\n  name: string | null;\n  coord_x: number;\n  coord_y: number;\n  coord_z: number;\n  resources_armaments: number;\n  resources_munitions: number;\n  resources_alcohol: number;\n  resources_dollars: number;\n  points: number;\n  last_updated_at?: string;\n  created_at?: string;\n}\n"
        }
      ]
    }
  ]
}