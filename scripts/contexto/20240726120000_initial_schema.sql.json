{
    "filename": "20240726120000_initial_schema.sql",
    "timestamp": "2024-07-26T12:00:00",
    "content": "\n-- Create a table for public user profiles\ncreate table profiles (\n  id uuid not null references auth.users on delete cascade,\n  updated_at timestamp with time zone,\n  username text unique,\n  full_name text,\n  avatar_url text,\n  website text,\n\n  primary key (id),\n  constraint username_length check (char_length(username) >= 3)\n);\n\n-- Set up Row Level Security (RLS)\n-- See https://supabase.com/docs/guides/auth/row-level-security\nalter table profiles\n  enable row level security;\n\ncreate policy \"Los perfiles públicos son visibles para todos.\" on profiles\n  for select using (true);\n\ncreate policy \"Los usuarios pueden insertar sus propios perfiles.\" on profiles\n  for insert with check ((select auth.uid()) = id);\n\ncreate policy \"Los usuarios pueden actualizar sus propios perfiles.\" on profiles\n  for update using ((select auth.uid()) = id);\n\n-- This trigger automatically creates a profile entry when a new user signs up\ncreate function public.handle_new_user()\nreturns trigger as $$\nbegin\n  insert into public.profiles (id, username)\n  values (new.id, new.raw_user_meta_data->>'username');\n  return new;\nend;\n$$ language plpgsql security definer;\ncreate trigger on_auth_user_created\n  after insert on auth.users\n  for each row execute procedure public.handle_new_user();\n\n-- Set up Storage!\ninsert into storage.buckets (id, name)\n  values ('avatars', 'avatars');\n\n-- Set up access controls for storage.\n-- See https://supabase.com/docs/guides/storage#policy-examples\ncreate policy \"Las imágenes de avatar son públicamente accesibles.\" on storage.objects\n  for select using (bucket_id = 'avatars');\n\ncreate policy \"Cualquiera puede subir un avatar.\" on storage.objects\n  for insert with check (bucket_id = 'avatars');\n",
    "summary": {
        "tables_created": [
            "profiles"
        ],
        "functions_created": [
            "handle_new_user"
        ]
    }
}